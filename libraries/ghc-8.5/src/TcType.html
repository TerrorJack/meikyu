<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

\section[TcType]{Types used in the typechecker}

This module provides the Type interface for front-end parts of the
compiler.  These parts

        * treat &quot;source types&quot; as opaque:
                newtypes, and predicates are meaningful.
        * look through usage types

The &quot;tc&quot; prefix is for &quot;TypeChecker&quot;, because the type checker
is the principal client.
-}</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-pragma">{-# LANGUAGE CPP, ScopedTypeVariables, MultiWayIf, FlexibleContexts #-}</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TcType</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-21"></a><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><a name="line-22"></a><span>  </span><span class="hs-comment">-- Types</span><span>
</span><a name="line-23"></a><span>  </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTauType"><span class="hs-identifier hs-type">TcTauType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>  </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyVarSet"><span class="hs-identifier hs-type">TcTyVarSet</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcDTyVarSet"><span class="hs-identifier hs-type">TcDTyVarSet</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyCoVarSet"><span class="hs-identifier hs-type">TcTyCoVarSet</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcDTyCoVarSet"><span class="hs-identifier hs-type">TcDTyCoVarSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>  </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcCoVar"><span class="hs-identifier hs-type">TcCoVar</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyCoVar"><span class="hs-identifier hs-type">TcTyCoVar</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyVarBinder"><span class="hs-identifier hs-type">TcTyVarBinder</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span>  </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcType.html#InferResult"><span class="hs-identifier hs-type">InferResult</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span>  </span><a href="TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcType.html#synKnownType"><span class="hs-identifier hs-var">synKnownType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#mkSynFunTys"><span class="hs-identifier hs-var">mkSynFunTys</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>  </span><span class="hs-comment">-- TcLevel</span><span>
</span><a name="line-32"></a><span>  </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcType.html#topTcLevel"><span class="hs-identifier hs-var">topTcLevel</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isTopTcLevel"><span class="hs-identifier hs-var">isTopTcLevel</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>  </span><a href="TcType.html#strictlyDeeperThan"><span class="hs-identifier hs-var">strictlyDeeperThan</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#sameDepthAs"><span class="hs-identifier hs-var">sameDepthAs</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#fmvTcLevel"><span class="hs-identifier hs-var">fmvTcLevel</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>  </span><a href="TcType.html#tcTypeLevel"><span class="hs-identifier hs-var">tcTypeLevel</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcTyVarLevel"><span class="hs-identifier hs-var">tcTyVarLevel</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#maxTcLevel"><span class="hs-identifier hs-var">maxTcLevel</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><a name="line-37"></a><span>  </span><span class="hs-comment">-- MetaDetails</span><span>
</span><a name="line-38"></a><span>  </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcType.html#pprUserTypeCtxt"><span class="hs-identifier hs-var">pprUserTypeCtxt</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isSigMaybe"><span class="hs-identifier hs-var">isSigMaybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>  </span><a href="TcType.html#TcTyVarDetails"><span class="hs-identifier hs-type">TcTyVarDetails</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcType.html#pprTcTyVarDetails"><span class="hs-identifier hs-var">pprTcTyVarDetails</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#vanillaSkolemTv"><span class="hs-identifier hs-var">vanillaSkolemTv</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#superSkolemTv"><span class="hs-identifier hs-var">superSkolemTv</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>  </span><a href="TcType.html#MetaDetails"><span class="hs-identifier hs-type">MetaDetails</span></a><span class="hs-special">(</span><a href="TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#Indirect"><span class="hs-identifier hs-var">Indirect</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>  </span><a href="TcType.html#isImmutableTyVar"><span class="hs-identifier hs-var">isImmutableTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isSkolemTyVar"><span class="hs-identifier hs-var">isSkolemTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a><span class="hs-special">,</span><span>  </span><a href="TcType.html#isMetaTyVarTy"><span class="hs-identifier hs-var">isMetaTyVarTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isTyVarTy"><span class="hs-identifier hs-var">isTyVarTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>  </span><a href="TcType.html#isSigTyVar"><span class="hs-identifier hs-var">isSigTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isOverlappableTyVar"><span class="hs-identifier hs-var">isOverlappableTyVar</span></a><span class="hs-special">,</span><span>  </span><a href="TcType.html#isTyConableTyVar"><span class="hs-identifier hs-var">isTyConableTyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>  </span><a href="TcType.html#isFskTyVar"><span class="hs-identifier hs-var">isFskTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isFmvTyVar"><span class="hs-identifier hs-var">isFmvTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isFlattenTyVar"><span class="hs-identifier hs-var">isFlattenTyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>  </span><a href="TcType.html#isAmbiguousTyVar"><span class="hs-identifier hs-var">isAmbiguousTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#metaTyVarRef"><span class="hs-identifier hs-var">metaTyVarRef</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#metaTyVarInfo"><span class="hs-identifier hs-var">metaTyVarInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>  </span><a href="TcType.html#isFlexi"><span class="hs-identifier hs-var">isFlexi</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isIndirect"><span class="hs-identifier hs-var">isIndirect</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isRuntimeUnkSkol"><span class="hs-identifier hs-var">isRuntimeUnkSkol</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>  </span><a href="TcType.html#metaTyVarTcLevel"><span class="hs-identifier hs-var">metaTyVarTcLevel</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#setMetaTyVarTcLevel"><span class="hs-identifier hs-var">setMetaTyVarTcLevel</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#metaTyVarTcLevel_maybe"><span class="hs-identifier hs-var">metaTyVarTcLevel_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>  </span><a href="TcType.html#isTouchableMetaTyVar"><span class="hs-identifier hs-var">isTouchableMetaTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isTouchableOrFmv"><span class="hs-identifier hs-var">isTouchableOrFmv</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>  </span><a href="TcType.html#isFloatedTouchableMetaTyVar"><span class="hs-identifier hs-var">isFloatedTouchableMetaTyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>  </span><a href="TcType.html#findDupSigTvs"><span class="hs-identifier hs-var">findDupSigTvs</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#mkTyVarNamePairs"><span class="hs-identifier hs-var">mkTyVarNamePairs</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><a name="line-52"></a><span>  </span><span class="hs-comment">-- Builders</span><span>
</span><a name="line-53"></a><span>  </span><a href="TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#mkInfSigmaTy"><span class="hs-identifier hs-var">mkInfSigmaTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#mkSpecSigmaTy"><span class="hs-identifier hs-var">mkSpecSigmaTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#mkSigmaTy"><span class="hs-identifier hs-var">mkSigmaTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>  </span><a href="TcType.html#mkNakedTyConApp"><span class="hs-identifier hs-var">mkNakedTyConApp</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#mkNakedAppTys"><span class="hs-identifier hs-var">mkNakedAppTys</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#mkNakedAppTy"><span class="hs-identifier hs-var">mkNakedAppTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>  </span><a href="TcType.html#mkNakedCastTy"><span class="hs-identifier hs-var">mkNakedCastTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><a name="line-58"></a><span>  </span><span class="hs-comment">-- Splitters</span><span>
</span><a name="line-59"></a><span>  </span><span class="hs-comment">-- These are important because they do not look through newtypes</span><span>
</span><a name="line-60"></a><span>  </span><a href="Type.html#getTyVar"><span class="hs-identifier hs-var">getTyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>  </span><a href="TcType.html#tcSplitForAllTy_maybe"><span class="hs-identifier hs-var">tcSplitForAllTy_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>  </span><a href="TcType.html#tcSplitForAllTys"><span class="hs-identifier hs-var">tcSplitForAllTys</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcSplitPiTys"><span class="hs-identifier hs-var">tcSplitPiTys</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcSplitPiTy_maybe"><span class="hs-identifier hs-var">tcSplitPiTy_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcSplitForAllTyVarBndrs"><span class="hs-identifier hs-var">tcSplitForAllTyVarBndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>  </span><a href="TcType.html#tcSplitPhiTy"><span class="hs-identifier hs-var">tcSplitPhiTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcSplitPredFunTy_maybe"><span class="hs-identifier hs-var">tcSplitPredFunTy_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>  </span><a href="TcType.html#tcSplitFunTy_maybe"><span class="hs-identifier hs-var">tcSplitFunTy_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcFunArgTy"><span class="hs-identifier hs-var">tcFunArgTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcFunResultTy"><span class="hs-identifier hs-var">tcFunResultTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcFunResultTyN"><span class="hs-identifier hs-var">tcFunResultTyN</span></a><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>  </span><a href="TcType.html#tcSplitFunTysN"><span class="hs-identifier hs-var">tcSplitFunTysN</span></a><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>  </span><a href="TcType.html#tcSplitTyConApp"><span class="hs-identifier hs-var">tcSplitTyConApp</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-67"></a><span>  </span><a href="Type.html#tcRepSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcRepSplitTyConApp_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcRepSplitTyConApp_maybe%27"><span class="hs-identifier hs-var">tcRepSplitTyConApp_maybe'</span></a><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>  </span><a href="TcType.html#tcTyConAppTyCon"><span class="hs-identifier hs-var">tcTyConAppTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcTyConAppTyCon_maybe"><span class="hs-identifier hs-var">tcTyConAppTyCon_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcTyConAppArgs"><span class="hs-identifier hs-var">tcTyConAppArgs</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>  </span><a href="TcType.html#tcSplitAppTy_maybe"><span class="hs-identifier hs-var">tcSplitAppTy_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcSplitAppTy"><span class="hs-identifier hs-var">tcSplitAppTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcSplitAppTys"><span class="hs-identifier hs-var">tcSplitAppTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tcRepSplitAppTy_maybe"><span class="hs-identifier hs-var">tcRepSplitAppTy_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>  </span><a href="TcType.html#tcRepGetNumAppTys"><span class="hs-identifier hs-var">tcRepGetNumAppTys</span></a><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>  </span><a href="TcType.html#tcGetCastedTyVar_maybe"><span class="hs-identifier hs-var">tcGetCastedTyVar_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcGetTyVar_maybe"><span class="hs-identifier hs-var">tcGetTyVar_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcGetTyVar"><span class="hs-identifier hs-var">tcGetTyVar</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#nextRole"><span class="hs-identifier hs-var">nextRole</span></a><span class="hs-special">,</span><span>
</span><a name="line-72"></a><span>  </span><a href="TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcSplitNestedSigmaTys"><span class="hs-identifier hs-var">tcSplitNestedSigmaTys</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcDeepSplitSigmaTy_maybe"><span class="hs-identifier hs-var">tcDeepSplitSigmaTy_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span>  </span><span class="hs-comment">---------------------------------</span><span>
</span><a name="line-75"></a><span>  </span><span class="hs-comment">-- Predicates.</span><span>
</span><a name="line-76"></a><span>  </span><span class="hs-comment">-- Again, newtypes are opaque</span><span>
</span><a name="line-77"></a><span>  </span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#eqTypes"><span class="hs-identifier hs-var">eqTypes</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#nonDetCmpType"><span class="hs-identifier hs-var">nonDetCmpType</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#nonDetCmpTypes"><span class="hs-identifier hs-var">nonDetCmpTypes</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a><span class="hs-special">,</span><span>
</span><a name="line-78"></a><span>  </span><a href="TcType.html#pickyEqType"><span class="hs-identifier hs-var">pickyEqType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcEqType"><span class="hs-identifier hs-var">tcEqType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcEqKind"><span class="hs-identifier hs-var">tcEqKind</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcEqTypeNoKindCheck"><span class="hs-identifier hs-var">tcEqTypeNoKindCheck</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcEqTypeVis"><span class="hs-identifier hs-var">tcEqTypeVis</span></a><span class="hs-special">,</span><span>
</span><a name="line-79"></a><span>  </span><a href="TcType.html#isSigmaTy"><span class="hs-identifier hs-var">isSigmaTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isRhoTy"><span class="hs-identifier hs-var">isRhoTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isRhoExpTy"><span class="hs-identifier hs-var">isRhoExpTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isOverloadedTy"><span class="hs-identifier hs-var">isOverloadedTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-80"></a><span>  </span><a href="TcType.html#isFloatingTy"><span class="hs-identifier hs-var">isFloatingTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isDoubleTy"><span class="hs-identifier hs-var">isDoubleTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isFloatTy"><span class="hs-identifier hs-var">isFloatTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isIntTy"><span class="hs-identifier hs-var">isIntTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isWordTy"><span class="hs-identifier hs-var">isWordTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isStringTy"><span class="hs-identifier hs-var">isStringTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-81"></a><span>  </span><a href="TcType.html#isIntegerTy"><span class="hs-identifier hs-var">isIntegerTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isBoolTy"><span class="hs-identifier hs-var">isBoolTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isUnitTy"><span class="hs-identifier hs-var">isUnitTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isCharTy"><span class="hs-identifier hs-var">isCharTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isCallStackTy"><span class="hs-identifier hs-var">isCallStackTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isCallStackPred"><span class="hs-identifier hs-var">isCallStackPred</span></a><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>  </span><a href="TcType.html#hasIPPred"><span class="hs-identifier hs-var">hasIPPred</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#isTauTyCon"><span class="hs-identifier hs-var">isTauTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcIsTyVarTy"><span class="hs-identifier hs-var">tcIsTyVarTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcIsForAllTy"><span class="hs-identifier hs-var">tcIsForAllTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>  </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isTyVarClassPred"><span class="hs-identifier hs-var">isTyVarClassPred</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isTyVarHead"><span class="hs-identifier hs-var">isTyVarHead</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isInsolubleOccursCheck"><span class="hs-identifier hs-var">isInsolubleOccursCheck</span></a><span class="hs-special">,</span><span>
</span><a name="line-84"></a><span>  </span><a href="TcType.html#checkValidClsArgs"><span class="hs-identifier hs-var">checkValidClsArgs</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#hasTyVarHead"><span class="hs-identifier hs-var">hasTyVarHead</span></a><span class="hs-special">,</span><span>
</span><a name="line-85"></a><span>  </span><a href="TcType.html#isRigidTy"><span class="hs-identifier hs-var">isRigidTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span>  </span><span class="hs-comment">---------------------------------</span><span>
</span><a name="line-88"></a><span>  </span><span class="hs-comment">-- Misc type manipulators</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span>  </span><a href="TcType.html#deNoteType"><span class="hs-identifier hs-var">deNoteType</span></a><span class="hs-special">,</span><span>
</span><a name="line-91"></a><span>  </span><a href="CoreFVs.html#orphNamesOfType"><span class="hs-identifier hs-var">orphNamesOfType</span></a><span class="hs-special">,</span><span> </span><a href="CoreFVs.html#orphNamesOfCo"><span class="hs-identifier hs-var">orphNamesOfCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-92"></a><span>  </span><a href="CoreFVs.html#orphNamesOfTypes"><span class="hs-identifier hs-var">orphNamesOfTypes</span></a><span class="hs-special">,</span><span> </span><a href="CoreFVs.html#orphNamesOfCoCon"><span class="hs-identifier hs-var">orphNamesOfCoCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-93"></a><span>  </span><a href="TcType.html#getDFunTyKey"><span class="hs-identifier hs-var">getDFunTyKey</span></a><span class="hs-special">,</span><span>
</span><a name="line-94"></a><span>  </span><a href="TcType.html#evVarPred_maybe"><span class="hs-identifier hs-var">evVarPred_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#evVarPred"><span class="hs-identifier hs-var">evVarPred</span></a><span class="hs-special">,</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span>  </span><span class="hs-comment">---------------------------------</span><span>
</span><a name="line-97"></a><span>  </span><span class="hs-comment">-- Predicate types</span><span>
</span><a name="line-98"></a><span>  </span><a href="TcType.html#mkMinimalBySCs"><span class="hs-identifier hs-var">mkMinimalBySCs</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#transSuperClasses"><span class="hs-identifier hs-var">transSuperClasses</span></a><span class="hs-special">,</span><span>
</span><a name="line-99"></a><span>  </span><a href="TcType.html#pickQuantifiablePreds"><span class="hs-identifier hs-var">pickQuantifiablePreds</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#pickCapturedPreds"><span class="hs-identifier hs-var">pickCapturedPreds</span></a><span class="hs-special">,</span><span>
</span><a name="line-100"></a><span>  </span><a href="TcType.html#immSuperClasses"><span class="hs-identifier hs-var">immSuperClasses</span></a><span class="hs-special">,</span><span>
</span><a name="line-101"></a><span>  </span><a href="TcType.html#isImprovementPred"><span class="hs-identifier hs-var">isImprovementPred</span></a><span class="hs-special">,</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span>  </span><span class="hs-comment">-- * Finding type instances</span><span>
</span><a name="line-104"></a><span>  </span><a href="TcType.html#tcTyFamInsts"><span class="hs-identifier hs-var">tcTyFamInsts</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isTyFamFree"><span class="hs-identifier hs-var">isTyFamFree</span></a><span class="hs-special">,</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span>  </span><span class="hs-comment">-- * Finding &quot;exact&quot; (non-dead) type variables</span><span>
</span><a name="line-107"></a><span>  </span><a href="TcType.html#exactTyCoVarsOfType"><span class="hs-identifier hs-var">exactTyCoVarsOfType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#exactTyCoVarsOfTypes"><span class="hs-identifier hs-var">exactTyCoVarsOfTypes</span></a><span class="hs-special">,</span><span>
</span><a name="line-108"></a><span>  </span><a href="TcType.html#candidateQTyVarsOfType"><span class="hs-identifier hs-var">candidateQTyVarsOfType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#candidateQTyVarsOfTypes"><span class="hs-identifier hs-var">candidateQTyVarsOfTypes</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-109"></a><span>  </span><a href="TcType.html#anyRewritableTyVar"><span class="hs-identifier hs-var">anyRewritableTyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span>  </span><span class="hs-comment">-- * Extracting bound variables</span><span>
</span><a name="line-112"></a><span>  </span><a href="TcType.html#allBoundVariables"><span class="hs-identifier hs-var">allBoundVariables</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#allBoundVariabless"><span class="hs-identifier hs-var">allBoundVariabless</span></a><span class="hs-special">,</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span>  </span><span class="hs-comment">---------------------------------</span><span>
</span><a name="line-115"></a><span>  </span><span class="hs-comment">-- Foreign import and export</span><span>
</span><a name="line-116"></a><span>  </span><a href="TcType.html#isFFIArgumentTy"><span class="hs-identifier hs-var">isFFIArgumentTy</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- :: DynFlags -&gt; Safety -&gt; Type -&gt; Bool</span><span>
</span><a name="line-117"></a><span>  </span><a href="TcType.html#isFFIImportResultTy"><span class="hs-identifier hs-var">isFFIImportResultTy</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- :: DynFlags -&gt; Type -&gt; Bool</span><span>
</span><a name="line-118"></a><span>  </span><a href="TcType.html#isFFIExportResultTy"><span class="hs-identifier hs-var">isFFIExportResultTy</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- :: Type -&gt; Bool</span><span>
</span><a name="line-119"></a><span>  </span><a href="TcType.html#isFFIExternalTy"><span class="hs-identifier hs-var">isFFIExternalTy</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- :: Type -&gt; Bool</span><span>
</span><a name="line-120"></a><span>  </span><a href="TcType.html#isFFIDynTy"><span class="hs-identifier hs-var">isFFIDynTy</span></a><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- :: Type -&gt; Type -&gt; Bool</span><span>
</span><a name="line-121"></a><span>  </span><a href="TcType.html#isFFIPrimArgumentTy"><span class="hs-identifier hs-var">isFFIPrimArgumentTy</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- :: DynFlags -&gt; Type -&gt; Bool</span><span>
</span><a name="line-122"></a><span>  </span><a href="TcType.html#isFFIPrimResultTy"><span class="hs-identifier hs-var">isFFIPrimResultTy</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- :: DynFlags -&gt; Type -&gt; Bool</span><span>
</span><a name="line-123"></a><span>  </span><a href="TcType.html#isFFILabelTy"><span class="hs-identifier hs-var">isFFILabelTy</span></a><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- :: Type -&gt; Bool</span><span>
</span><a name="line-124"></a><span>  </span><a href="TcType.html#isFFITy"><span class="hs-identifier hs-var">isFFITy</span></a><span class="hs-special">,</span><span>             </span><span class="hs-comment">-- :: Type -&gt; Bool</span><span>
</span><a name="line-125"></a><span>  </span><a href="TcType.html#isFunPtrTy"><span class="hs-identifier hs-var">isFunPtrTy</span></a><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- :: Type -&gt; Bool</span><span>
</span><a name="line-126"></a><span>  </span><a href="TcType.html#tcSplitIOType_maybe"><span class="hs-identifier hs-var">tcSplitIOType_maybe</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- :: Type -&gt; Maybe Type</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><a name="line-129"></a><span>  </span><span class="hs-comment">-- Rexported from Kind</span><span>
</span><a name="line-130"></a><span>  </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-131"></a><span>  </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-132"></a><span>  </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-133"></a><span>  </span><a href="TyCoRep.html#isLiftedTypeKind"><span class="hs-identifier hs-var">isLiftedTypeKind</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#isUnliftedTypeKind"><span class="hs-identifier hs-var">isUnliftedTypeKind</span></a><span class="hs-special">,</span><span> </span><a href="Kind.html#classifiesTypeWithValues"><span class="hs-identifier hs-var">classifiesTypeWithValues</span></a><span class="hs-special">,</span><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><a name="line-136"></a><span>  </span><span class="hs-comment">-- Rexported from Type</span><span>
</span><a name="line-137"></a><span>  </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#ArgFlag"><span class="hs-identifier hs-type">ArgFlag</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span>  </span><a href="TyCoRep.html#mkForAllTy"><span class="hs-identifier hs-var">mkForAllTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkInvForAllTys"><span class="hs-identifier hs-var">mkInvForAllTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkSpecForAllTys"><span class="hs-identifier hs-var">mkSpecForAllTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkInvForAllTy"><span class="hs-identifier hs-var">mkInvForAllTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-140"></a><span>  </span><a href="TyCoRep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkFunTys"><span class="hs-identifier hs-var">mkFunTys</span></a><span class="hs-special">,</span><span>
</span><a name="line-141"></a><span>  </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkAppTys"><span class="hs-identifier hs-var">mkAppTys</span></a><span class="hs-special">,</span><span>
</span><a name="line-142"></a><span>  </span><a href="TyCoRep.html#mkTyConTy"><span class="hs-identifier hs-var">mkTyConTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-143"></a><span>  </span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span class="hs-special">,</span><span>
</span><a name="line-144"></a><span>
</span><a name="line-145"></a><span>  </span><a href="Type.html#isClassPred"><span class="hs-identifier hs-var">isClassPred</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isEqPred"><span class="hs-identifier hs-var">isEqPred</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isNomEqPred"><span class="hs-identifier hs-var">isNomEqPred</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isIPPred"><span class="hs-identifier hs-var">isIPPred</span></a><span class="hs-special">,</span><span>
</span><a name="line-146"></a><span>  </span><a href="Type.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a><span class="hs-special">,</span><span>
</span><a name="line-147"></a><span>  </span><a href="Type.html#isDictLikeTy"><span class="hs-identifier hs-var">isDictLikeTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-148"></a><span>  </span><a href="TcType.html#tcSplitDFunTy"><span class="hs-identifier hs-var">tcSplitDFunTy</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcSplitDFunHead"><span class="hs-identifier hs-var">tcSplitDFunHead</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#tcSplitMethodTy"><span class="hs-identifier hs-var">tcSplitMethodTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-149"></a><span>  </span><a href="TyCoRep.html#isRuntimeRepVar"><span class="hs-identifier hs-var">isRuntimeRepVar</span></a><span class="hs-special">,</span><span> </span><a href="Kind.html#isKindLevPoly"><span class="hs-identifier hs-var">isKindLevPoly</span></a><span class="hs-special">,</span><span>
</span><a name="line-150"></a><span>  </span><a href="TyCoRep.html#isVisibleBinder"><span class="hs-identifier hs-var">isVisibleBinder</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#isInvisibleBinder"><span class="hs-identifier hs-var">isInvisibleBinder</span></a><span class="hs-special">,</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span>  </span><span class="hs-comment">-- Type substitutions</span><span>
</span><a name="line-153"></a><span>  </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- Representation visible to a few friends</span><span>
</span><a name="line-154"></a><span>  </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-155"></a><span>  </span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-156"></a><span>  </span><a href="TyCoRep.html#mkTvSubstPrs"><span class="hs-identifier hs-var">mkTvSubstPrs</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#notElemTCvSubst"><span class="hs-identifier hs-var">notElemTCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#unionTCvSubst"><span class="hs-identifier hs-var">unionTCvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-157"></a><span>  </span><a href="TyCoRep.html#getTvSubstEnv"><span class="hs-identifier hs-var">getTvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#setTvSubstEnv"><span class="hs-identifier hs-var">setTvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#getTCvInScope"><span class="hs-identifier hs-var">getTCvInScope</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#extendTCvInScope"><span class="hs-identifier hs-var">extendTCvInScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-158"></a><span>  </span><a href="TyCoRep.html#extendTCvInScopeList"><span class="hs-identifier hs-var">extendTCvInScopeList</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#extendTCvInScopeSet"><span class="hs-identifier hs-var">extendTCvInScopeSet</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#extendTvSubstAndInScope"><span class="hs-identifier hs-var">extendTvSubstAndInScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-159"></a><span>  </span><a href="TyCoRep.html#lookupTyVar"><span class="hs-identifier hs-var">Type</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookupTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#extendTCvSubst"><span class="hs-identifier hs-var">Type</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">extendTCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTyVarBndr"><span class="hs-identifier hs-var">Type</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">substTyVarBndr</span></a><span class="hs-special">,</span><span>
</span><a name="line-160"></a><span>  </span><a href="TyCoRep.html#extendTvSubst"><span class="hs-identifier hs-var">Type</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">extendTvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-161"></a><span>  </span><a href="TyCoRep.html#isInScope"><span class="hs-identifier hs-var">isInScope</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTCvSubst"><span class="hs-identifier hs-var">mkTCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTvSubst"><span class="hs-identifier hs-var">mkTvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#zipTyEnv"><span class="hs-identifier hs-var">zipTyEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#zipCoEnv"><span class="hs-identifier hs-var">zipCoEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-162"></a><span>  </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">Type</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">substTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTys"><span class="hs-identifier hs-var">substTys</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTyWithCoVars"><span class="hs-identifier hs-var">substTyWithCoVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-163"></a><span>  </span><a href="TyCoRep.html#substTyAddInScope"><span class="hs-identifier hs-var">substTyAddInScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-164"></a><span>  </span><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTysUnchecked"><span class="hs-identifier hs-var">substTysUnchecked</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substThetaUnchecked"><span class="hs-identifier hs-var">substThetaUnchecked</span></a><span class="hs-special">,</span><span>
</span><a name="line-165"></a><span>  </span><a href="TyCoRep.html#substTyWithUnchecked"><span class="hs-identifier hs-var">substTyWithUnchecked</span></a><span class="hs-special">,</span><span>
</span><a name="line-166"></a><span>  </span><a href="TyCoRep.html#substCoUnchecked"><span class="hs-identifier hs-var">substCoUnchecked</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substCoWithUnchecked"><span class="hs-identifier hs-var">substCoWithUnchecked</span></a><span class="hs-special">,</span><span>
</span><a name="line-167"></a><span>  </span><a href="TyCoRep.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a><span class="hs-special">,</span><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span>  </span><a href="Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- Source types are always lifted</span><span>
</span><a name="line-170"></a><span>  </span><a href="Type.html#isUnboxedTupleType"><span class="hs-identifier hs-var">isUnboxedTupleType</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- Ditto</span><span>
</span><a name="line-171"></a><span>  </span><a href="Type.html#isPrimitiveType"><span class="hs-identifier hs-var">isPrimitiveType</span></a><span class="hs-special">,</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span>  </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span class="hs-special">,</span><span>
</span><a name="line-174"></a><span>
</span><a name="line-175"></a><span>  </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#closeOverKinds"><span class="hs-identifier hs-var">closeOverKinds</span></a><span class="hs-special">,</span><span>
</span><a name="line-176"></a><span>  </span><a href="TyCoRep.html#tyCoFVsOfType"><span class="hs-identifier hs-var">tyCoFVsOfType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoFVsOfTypes"><span class="hs-identifier hs-var">tyCoFVsOfTypes</span></a><span class="hs-special">,</span><span>
</span><a name="line-177"></a><span>  </span><a href="TyCoRep.html#tyCoVarsOfTypeDSet"><span class="hs-identifier hs-var">tyCoVarsOfTypeDSet</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypesDSet"><span class="hs-identifier hs-var">tyCoVarsOfTypesDSet</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#closeOverKindsDSet"><span class="hs-identifier hs-var">closeOverKindsDSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-178"></a><span>  </span><a href="TyCoRep.html#tyCoVarsOfTypeList"><span class="hs-identifier hs-var">tyCoVarsOfTypeList</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypesList"><span class="hs-identifier hs-var">tyCoVarsOfTypesList</span></a><span class="hs-special">,</span><span>
</span><a name="line-179"></a><span>  </span><a href="TyCoRep.html#noFreeVarsOfType"><span class="hs-identifier hs-var">noFreeVarsOfType</span></a><span class="hs-special">,</span><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><a name="line-182"></a><span>  </span><span class="hs-comment">-- Transforming Types to TcTypes</span><span>
</span><a name="line-183"></a><span>  </span><a href="TcType.html#toTcType"><span class="hs-identifier hs-var">toTcType</span></a><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- :: Type -&gt; TcType</span><span>
</span><a name="line-184"></a><span>  </span><a href="TcType.html#toTcTypeBag"><span class="hs-identifier hs-var">toTcTypeBag</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- :: Bag EvVar -&gt; Bag EvVar</span><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span>  </span><a href="TyCoRep.html#pprKind"><span class="hs-identifier hs-var">pprKind</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprParendKind"><span class="hs-identifier hs-var">pprParendKind</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprSigmaType"><span class="hs-identifier hs-var">pprSigmaType</span></a><span class="hs-special">,</span><span>
</span><a name="line-187"></a><span>  </span><a href="TyCoRep.html#pprType"><span class="hs-identifier hs-var">pprType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprParendType"><span class="hs-identifier hs-var">pprParendType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprTypeApp"><span class="hs-identifier hs-var">pprTypeApp</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprTyThingCategory"><span class="hs-identifier hs-var">pprTyThingCategory</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyThingCategory"><span class="hs-identifier hs-var">tyThingCategory</span></a><span class="hs-special">,</span><span>
</span><a name="line-188"></a><span>  </span><a href="TyCoRep.html#pprTheta"><span class="hs-identifier hs-var">pprTheta</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprParendTheta"><span class="hs-identifier hs-var">pprParendTheta</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprThetaArrowTy"><span class="hs-identifier hs-var">pprThetaArrowTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprClassPred"><span class="hs-identifier hs-var">pprClassPred</span></a><span class="hs-special">,</span><span>
</span><a name="line-189"></a><span>  </span><a href="TyCoRep.html#pprTvBndr"><span class="hs-identifier hs-var">pprTvBndr</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprTvBndrs"><span class="hs-identifier hs-var">pprTvBndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span>  </span><a href="TcType.html#TypeSize"><span class="hs-identifier hs-type">TypeSize</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#sizeType"><span class="hs-identifier hs-var">sizeType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#sizeTypes"><span class="hs-identifier hs-var">sizeTypes</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#toposortTyVars"><span class="hs-identifier hs-var">toposortTyVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-192"></a><span>
</span><a name="line-193"></a><span>  </span><span class="hs-comment">---------------------------------</span><span>
</span><a name="line-194"></a><span>  </span><span class="hs-comment">-- argument visibility</span><span>
</span><a name="line-195"></a><span>  </span><a href="TcType.html#tcTyConVisibilities"><span class="hs-identifier hs-var">tcTyConVisibilities</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isNextTyConArgVisible"><span class="hs-identifier hs-var">isNextTyConArgVisible</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#isNextArgVisible"><span class="hs-identifier hs-var">isNextArgVisible</span></a><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span class="hs-comment">-- friends:</span><span>
</span><a name="line-202"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span class="hs-keyword">import</span><span> </span><a href="Kind.html"><span class="hs-identifier">Kind</span></a><span>
</span><a name="line-205"></a><span class="hs-keyword">import</span><span> </span><a href="TyCoRep.html"><span class="hs-identifier">TyCoRep</span></a><span>
</span><a name="line-206"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-207"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-208"></a><span class="hs-keyword">import</span><span> </span><a href="ForeignCall.html"><span class="hs-identifier">ForeignCall</span></a><span>
</span><a name="line-209"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-210"></a><span class="hs-keyword">import</span><span> </span><a href="Coercion.html"><span class="hs-identifier">Coercion</span></a><span>
</span><a name="line-211"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-212"></a><span class="hs-keyword">import</span><span> </span><a href="RepType.html"><span class="hs-identifier">RepType</span></a><span>
</span><a name="line-213"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-comment">-- others:</span><span>
</span><a name="line-216"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-217"></a><span class="hs-keyword">import</span><span> </span><a href="CoreFVs.html"><span class="hs-identifier">CoreFVs</span></a><span>
</span><a name="line-218"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span> </span><span class="hs-comment">-- hiding (varName)</span><span>
</span><a name="line-219"></a><span>            </span><span class="hs-comment">-- We use this to make dictionaries for type literals.</span><span>
</span><a name="line-220"></a><span>            </span><span class="hs-comment">-- Perhaps there's a better way to do this?</span><span>
</span><a name="line-221"></a><span class="hs-keyword">import</span><span> </span><a href="NameSet.html"><span class="hs-identifier">NameSet</span></a><span>
</span><a name="line-222"></a><span class="hs-keyword">import</span><span> </span><a href="VarEnv.html"><span class="hs-identifier">VarEnv</span></a><span>
</span><a name="line-223"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span>
</span><a name="line-224"></a><span class="hs-keyword">import</span><span> </span><a href="TysWiredIn.html"><span class="hs-identifier">TysWiredIn</span></a><span class="hs-special">(</span><span> </span><a href="TysWiredIn.html#coercibleClass"><span class="hs-identifier hs-var">coercibleClass</span></a><span class="hs-special">,</span><span> </span><a href="TysWiredIn.html#unitTyCon"><span class="hs-identifier hs-var">unitTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TysWiredIn.html#unitTyConKey"><span class="hs-identifier hs-var">unitTyConKey</span></a><span>
</span><a name="line-225"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="TysWiredIn.html#listTyCon"><span class="hs-identifier hs-var">listTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-226"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-227"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-228"></a><span class="hs-keyword">import</span><span> </span><a href="Bag.html"><span class="hs-identifier">Bag</span></a><span>
</span><a name="line-229"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>
</span><a name="line-230"></a><span class="hs-keyword">import</span><span> </span><a href="ListSetOps.html"><span class="hs-identifier">ListSetOps</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="ListSetOps.html#getNth"><span class="hs-identifier hs-var">getNth</span></a><span class="hs-special">,</span><span> </span><a href="ListSetOps.html#findDupsEq"><span class="hs-identifier hs-var">findDupsEq</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-231"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-232"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-233"></a><span class="hs-keyword">import</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span class="hs-special">(</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="ErrUtils.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a><span class="hs-special">,</span><span> </span><a href="ErrUtils.html#isValid"><span class="hs-identifier hs-var">isValid</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-234"></a><span class="hs-keyword">import</span><span> </span><a href="FV.html"><span class="hs-identifier">FV</span></a><span>
</span><a name="line-235"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../ghc-boot-8.5/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">LanguageExtensions</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.IORef.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IORef</span></a><span>
</span><a name="line-238"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.NonEmpty.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-operator">.</span><span class="hs-identifier">NonEmpty</span></a><span class="hs-special">(</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.Identity.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Functor</span><span class="hs-operator">.</span><span class="hs-identifier">Identity</span></a><span>
</span><a name="line-240"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Semigroup.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Semigroup</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Semi</span><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
              Types
*                                                                      *
************************************************************************

The type checker divides the generic Type world into the
following more structured beasts:

sigma ::= forall tyvars. phi
        -- A sigma type is a qualified type
        --
        -- Note that even if 'tyvars' is empty, theta
        -- may not be: e.g.   (?x::Int) =&gt; Int

        -- Note that 'sigma' is in prenex form:
        -- all the foralls are at the front.
        -- A 'phi' type has no foralls to the right of
        -- an arrow

phi :: theta =&gt; rho

rho ::= sigma -&gt; rho
     |  tau

-- A 'tau' type has no quantification anywhere
-- Note that the args of a type constructor must be taus
tau ::= tyvar
     |  tycon tau_1 .. tau_n
     |  tau_1 tau_2
     |  tau_1 -&gt; tau_2

-- In all cases, a (saturated) type synonym application is legal,
-- provided it expands to the required form.

Note [TcTyVars in the typechecker]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The typechecker uses a lot of type variables with special properties,
notably being a unification variable with a mutable reference.  These
use the 'TcTyVar' variant of Var.Var.

However, the type checker and constraint solver can encounter type
variables that use the 'TyVar' variant of Var.Var, for a couple of
reasons:

  - When unifying or flattening under (forall a. ty)

  - When typechecking a class decl, say
       class C (a :: k) where
          foo :: T a -&gt; Int
    We have first kind-check the header; fix k and (a:k) to be
    TyVars, bring 'k' and 'a' into scope, and kind check the
    signature for 'foo'.  In doing so we call solveEqualities to
    solve any kind equalities in foo's signature.  So the solver
    may see free occurrences of 'k'.

    See calls to tcExtendTyVarEnv for other places that ordinary
    TyVars are bought into scope, and hence may show up in the types
    and inds generated by TcHsType.

It's convenient to simply treat these TyVars as skolem constants,
which of course they are.  So

* Var.tcTyVarDetails succeeds on a TyVar, returning
  vanillaSkolemTv, as well as on a TcTyVar.

* tcIsTcTyVar returns True for both TyVar and TcTyVar variants
  of Var.Var.  The &quot;tc&quot; prefix means &quot;a type variable that can be
  encountered by the typechecker&quot;.

This is a bit of a change from an earlier era when we remoselessly
insisted on real TcTyVars in the type checker.  But that seems
unnecessary (for skolems, TyVars are fine) and it's now very hard
to guarantee, with the advent of kind equalities.

Note [Coercion variables in free variable lists]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
There are several places in the GHC codebase where functions like
tyCoVarsOfType, tyCoVarsOfCt, et al. are used to compute the free type
variables of a type. The &quot;Co&quot; part of these functions' names shouldn't be
dismissed, as it is entirely possible that they will include coercion variables
in addition to type variables! As a result, there are some places in TcType
where we must take care to check that a variable is a _type_ variable (using
isTyVar) before calling tcTyVarDetails--a partial function that is not defined
for coercion variables--on the variable. Failing to do so led to
GHC Trac #12785.
-}</span><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span class="hs-comment">-- See Note [TcTyVars in the typechecker]</span><span>
</span><a name="line-332"></a><span class="hs-keyword">type</span><span> </span><a name="TcTyVar"><a href="TcType.html#TcTyVar"><span class="hs-identifier">TcTyVar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>    </span><span class="hs-comment">-- Used only during type inference</span><span>
</span><a name="line-333"></a><span class="hs-keyword">type</span><span> </span><a name="TcCoVar"><a href="TcType.html#TcCoVar"><span class="hs-identifier">TcCoVar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span>    </span><span class="hs-comment">-- Used only during type inference</span><span>
</span><a name="line-334"></a><span class="hs-keyword">type</span><span> </span><a name="TcType"><a href="TcType.html#TcType"><span class="hs-identifier">TcType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>      </span><span class="hs-comment">-- A TcType can have mutable type variables</span><span>
</span><a name="line-335"></a><span class="hs-keyword">type</span><span> </span><a name="TcTyCoVar"><a href="TcType.html#TcTyCoVar"><span class="hs-identifier">TcTyCoVar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span>    </span><span class="hs-comment">-- Either a TcTyVar or a CoVar</span><span>
</span><a name="line-336"></a><span>        </span><span class="hs-comment">-- Invariant on ForAllTy in TcTypes:</span><span>
</span><a name="line-337"></a><span>        </span><span class="hs-comment">--      forall a. T</span><span>
</span><a name="line-338"></a><span>        </span><span class="hs-comment">-- a cannot occur inside a MutTyVar in T; that is,</span><span>
</span><a name="line-339"></a><span>        </span><span class="hs-comment">-- T is &quot;flattened&quot; before quantifying over a</span><span>
</span><a name="line-340"></a><span>
</span><a name="line-341"></a><span class="hs-keyword">type</span><span> </span><a name="TcTyVarBinder"><a href="TcType.html#TcTyVarBinder"><span class="hs-identifier">TcTyVarBinder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#TyVarBinder"><span class="hs-identifier hs-type">TyVarBinder</span></a><span>
</span><a name="line-342"></a><span class="hs-keyword">type</span><span> </span><a name="TcTyCon"><a href="TcType.html#TcTyCon"><span class="hs-identifier">TcTyCon</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>   </span><span class="hs-comment">-- these can be the TcTyCon constructor</span><span>
</span><a name="line-343"></a><span>
</span><a name="line-344"></a><span class="hs-comment">-- These types do not have boxy type variables in them</span><span>
</span><a name="line-345"></a><span class="hs-keyword">type</span><span> </span><a name="TcPredType"><a href="TcType.html#TcPredType"><span class="hs-identifier">TcPredType</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span>
</span><a name="line-346"></a><span class="hs-keyword">type</span><span> </span><a name="TcThetaType"><a href="TcType.html#TcThetaType"><span class="hs-identifier">TcThetaType</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span>
</span><a name="line-347"></a><span class="hs-keyword">type</span><span> </span><a name="TcSigmaType"><a href="TcType.html#TcSigmaType"><span class="hs-identifier">TcSigmaType</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-348"></a><span class="hs-keyword">type</span><span> </span><a name="TcRhoType"><a href="TcType.html#TcRhoType"><span class="hs-identifier">TcRhoType</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>  </span><span class="hs-comment">-- Note [TcRhoType]</span><span>
</span><a name="line-349"></a><span class="hs-keyword">type</span><span> </span><a name="TcTauType"><a href="TcType.html#TcTauType"><span class="hs-identifier">TcTauType</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-350"></a><span class="hs-keyword">type</span><span> </span><a name="TcKind"><a href="TcType.html#TcKind"><span class="hs-identifier">TcKind</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span>
</span><a name="line-351"></a><span class="hs-keyword">type</span><span> </span><a name="TcTyVarSet"><a href="TcType.html#TcTyVarSet"><span class="hs-identifier">TcTyVarSet</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a><span>
</span><a name="line-352"></a><span class="hs-keyword">type</span><span> </span><a name="TcTyCoVarSet"><a href="TcType.html#TcTyCoVarSet"><span class="hs-identifier">TcTyCoVarSet</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span>
</span><a name="line-353"></a><span class="hs-keyword">type</span><span> </span><a name="TcDTyVarSet"><a href="TcType.html#TcDTyVarSet"><span class="hs-identifier">TcDTyVarSet</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#DTyVarSet"><span class="hs-identifier hs-type">DTyVarSet</span></a><span>
</span><a name="line-354"></a><span class="hs-keyword">type</span><span> </span><a name="TcDTyCoVarSet"><a href="TcType.html#TcDTyCoVarSet"><span class="hs-identifier">TcDTyCoVarSet</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#DTyCoVarSet"><span class="hs-identifier hs-type">DTyCoVarSet</span></a><span>
</span><a name="line-355"></a><span>
</span><a name="line-356"></a><span>
</span><a name="line-357"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
          ExpType: an &quot;expected type&quot; in the type checker
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span class="hs-comment">-- | An expected type to check against during type-checking.</span><span>
</span><a name="line-364"></a><span class="hs-comment">-- See Note [ExpType] in TcMType, where you'll also find manipulators.</span><span>
</span><a name="line-365"></a><span class="hs-keyword">data</span><span> </span><a name="ExpType"><a href="TcType.html#ExpType"><span class="hs-identifier">ExpType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Check"><a href="TcType.html#Check"><span class="hs-identifier">Check</span></a></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-366"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a name="Infer"><a href="TcType.html#Infer"><span class="hs-identifier">Infer</span></a></a><span> </span><span class="hs-glyph">!</span><a href="TcType.html#InferResult"><span class="hs-identifier hs-type">InferResult</span></a><span>
</span><a name="line-367"></a><span>
</span><a name="line-368"></a><span class="hs-keyword">data</span><span> </span><a name="InferResult"><a href="TcType.html#InferResult"><span class="hs-identifier">InferResult</span></a></a><span>
</span><a name="line-369"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="IR"><a href="TcType.html#IR"><span class="hs-identifier">IR</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="ir_uniq"><a href="TcType.html#ir_uniq"><span class="hs-identifier">ir_uniq</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>  </span><span class="hs-comment">-- For debugging only</span><span>
</span><a name="line-370"></a><span>       </span><span class="hs-special">,</span><span> </span><a name="ir_lvl"><a href="TcType.html#ir_lvl"><span class="hs-identifier">ir_lvl</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-comment">-- See Note [TcLevel of ExpType] in TcMType</span><span>
</span><a name="line-371"></a><span>       </span><span class="hs-special">,</span><span> </span><a name="ir_inst"><a href="TcType.html#ir_inst"><span class="hs-identifier">ir_inst</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>    </span><span class="hs-comment">-- True &lt;=&gt; deeply instantiate before returning</span><span>
</span><a name="line-372"></a><span>                            </span><span class="hs-comment">--           i.e. return a RhoType</span><span>
</span><a name="line-373"></a><span>                            </span><span class="hs-comment">-- False &lt;=&gt; do not instantiate before returning</span><span>
</span><a name="line-374"></a><span>                            </span><span class="hs-comment">--           i.e. return a SigmaType</span><span>
</span><a name="line-375"></a><span>       </span><span class="hs-special">,</span><span> </span><a name="ir_ref"><a href="TcType.html#ir_ref"><span class="hs-identifier">ir_ref</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-376"></a><span>         </span><span class="hs-comment">-- The type that fills in this hole should be a Type,</span><span>
</span><a name="line-377"></a><span>         </span><span class="hs-comment">-- that is, its kind should be (TYPE rr) for some rr</span><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span class="hs-keyword">type</span><span> </span><a name="ExpSigmaType"><a href="TcType.html#ExpSigmaType"><span class="hs-identifier">ExpSigmaType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span>
</span><a name="line-380"></a><span class="hs-keyword">type</span><span> </span><a name="ExpRhoType"><a href="TcType.html#ExpRhoType"><span class="hs-identifier">ExpRhoType</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span>
</span><a name="line-381"></a><span>
</span><a name="line-382"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-383"></a><span>  </span><a name="local-8214565720323905585"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#Check"><span class="hs-identifier hs-var">Check</span></a><span> </span><a name="local-6989586621679592403"><a href="#local-6989586621679592403"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Check&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592403"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-384"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcType.html#Infer"><span class="hs-identifier hs-var">Infer</span></a><span> </span><a name="local-6989586621679592404"><a href="#local-6989586621679592404"><span class="hs-identifier">ir</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592404"><span class="hs-identifier hs-var">ir</span></a><span>
</span><a name="line-385"></a><span>
</span><a name="line-386"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcType.html#InferResult"><span class="hs-identifier hs-type">InferResult</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-387"></a><span>  </span><a name="local-8214565720323905585"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#IR"><span class="hs-identifier hs-var">IR</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ir_uniq</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592400"><a href="#local-6989586621679592400"><span class="hs-identifier">u</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ir_lvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592401"><a href="#local-6989586621679592401"><span class="hs-identifier">lvl</span></a></a><span>
</span><a name="line-388"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ir_inst</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592402"><a href="#local-6989586621679592402"><span class="hs-identifier">inst</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-389"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Infer&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592400"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592401"><span class="hs-identifier hs-var">lvl</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592402"><span class="hs-identifier hs-var">inst</span></a><span class="hs-special">)</span><span>
</span><a name="line-390"></a><span>
</span><a name="line-391"></a><span class="hs-comment">-- | Make an 'ExpType' suitable for checking.</span><span>
</span><a name="line-392"></a><span class="hs-identifier">mkCheckExpType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span>
</span><a name="line-393"></a><a name="mkCheckExpType"><a href="TcType.html#mkCheckExpType"><span class="hs-identifier">mkCheckExpType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#Check"><span class="hs-identifier hs-var">Check</span></a><span>
</span><a name="line-394"></a><span>
</span><a name="line-395"></a><span>
</span><a name="line-396"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
          SyntaxOpType
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-401"></a><span>
</span><a name="line-402"></a><span class="hs-comment">-- | What to expect for an argument to a rebindable-syntax operator.</span><span>
</span><a name="line-403"></a><span class="hs-comment">-- Quite like 'Type', but allows for holes to be filled in by tcSyntaxOp.</span><span>
</span><a name="line-404"></a><span class="hs-comment">-- The callback called from tcSyntaxOp gets a list of types; the meaning</span><span>
</span><a name="line-405"></a><span class="hs-comment">-- of these types is determined by a left-to-right depth-first traversal</span><span>
</span><a name="line-406"></a><span class="hs-comment">-- of the 'SyntaxOpType' tree. So if you pass in</span><span>
</span><a name="line-407"></a><span class="hs-comment">--</span><span>
</span><a name="line-408"></a><span class="hs-comment">-- &gt; SynAny `SynFun` (SynList `SynFun` SynType Int) `SynFun` SynAny</span><span>
</span><a name="line-409"></a><span class="hs-comment">--</span><span>
</span><a name="line-410"></a><span class="hs-comment">-- you'll get three types back: one for the first 'SynAny', the /element/</span><span>
</span><a name="line-411"></a><span class="hs-comment">-- type of the list, and one for the last 'SynAny'. You don't get anything</span><span>
</span><a name="line-412"></a><span class="hs-comment">-- for the 'SynType', because you've said positively that it should be an</span><span>
</span><a name="line-413"></a><span class="hs-comment">-- Int, and so it shall be.</span><span>
</span><a name="line-414"></a><span class="hs-comment">--</span><span>
</span><a name="line-415"></a><span class="hs-comment">-- This is defined here to avoid defining it in TcExpr.hs-boot.</span><span>
</span><a name="line-416"></a><span class="hs-keyword">data</span><span> </span><a name="SyntaxOpType"><a href="TcType.html#SyntaxOpType"><span class="hs-identifier">SyntaxOpType</span></a></a><span>
</span><a name="line-417"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="SynAny"><a href="TcType.html#SynAny"><span class="hs-identifier">SynAny</span></a></a><span>     </span><span class="hs-comment">-- ^ Any type</span><span>
</span><a name="line-418"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SynRho"><a href="TcType.html#SynRho"><span class="hs-identifier">SynRho</span></a></a><span>     </span><span class="hs-comment">-- ^ A rho type, deeply skolemised or instantiated as appropriate</span><span>
</span><a name="line-419"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SynList"><a href="TcType.html#SynList"><span class="hs-identifier">SynList</span></a></a><span>    </span><span class="hs-comment">-- ^ A list type. You get back the element type of the list</span><span>
</span><a name="line-420"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SynFun"><a href="TcType.html#SynFun"><span class="hs-identifier">SynFun</span></a></a><span> </span><a href="TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a><span> </span><a href="TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a><span>
</span><a name="line-421"></a><span>               </span><span class="hs-comment">-- ^ A function.</span><span>
</span><a name="line-422"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SynType"><a href="TcType.html#SynType"><span class="hs-identifier">SynType</span></a></a><span> </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span>   </span><span class="hs-comment">-- ^ A known type.</span><span>
</span><a name="line-423"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SynFun</span><span class="hs-special">`</span><span>
</span><a name="line-424"></a><span>
</span><a name="line-425"></a><span class="hs-comment">-- | Like 'SynType' but accepts a regular TcType</span><span>
</span><a name="line-426"></a><span class="hs-identifier">synKnownType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a><span>
</span><a name="line-427"></a><a name="synKnownType"><a href="TcType.html#synKnownType"><span class="hs-identifier">synKnownType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#SynType"><span class="hs-identifier hs-var">SynType</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a><span>
</span><a name="line-428"></a><span>
</span><a name="line-429"></a><span class="hs-comment">-- | Like 'mkFunTys' but for 'SyntaxOpType'</span><span>
</span><a name="line-430"></a><span class="hs-identifier">mkSynFunTys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a><span>
</span><a name="line-431"></a><a name="mkSynFunTys"><a href="TcType.html#mkSynFunTys"><span class="hs-identifier">mkSynFunTys</span></a></a><span> </span><a name="local-6989586621679592406"><a href="#local-6989586621679592406"><span class="hs-identifier">arg_tys</span></a></a><span> </span><a name="local-6989586621679592407"><a href="#local-6989586621679592407"><span class="hs-identifier">res_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><a href="TcType.html#SynFun"><span class="hs-identifier hs-var">SynFun</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#SynType"><span class="hs-identifier hs-var">SynType</span></a><span> </span><a href="#local-6989586621679592407"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592406"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><span>
</span><a name="line-434"></a><span class="hs-comment">{-
Note [TcRhoType]
~~~~~~~~~~~~~~~~
A TcRhoType has no foralls or contexts at the top, or to the right of an arrow
  YES    (forall a. a-&gt;a) -&gt; Int
  NO     forall a. a -&gt;  Int
  NO     Eq a =&gt; a -&gt; a
  NO     Int -&gt; forall a. a -&gt; Int


************************************************************************
*                                                                      *
        TyVarDetails, MetaDetails, MetaInfo
*                                                                      *
************************************************************************

TyVarDetails gives extra info about type variables, used during type
checking.  It's attached to mutable type variables only.
It's knot-tied back to Var.hs.  There is no reason in principle
why Var.hs shouldn't actually have the definition, but it &quot;belongs&quot; here.

Note [Signature skolems]
~~~~~~~~~~~~~~~~~~~~~~~~
A SigTv is a specialised variant of TauTv, with the following invarints:

    * A SigTv can be unified only with a TyVar,
      not with any other type

    * Its MetaDetails, if filled in, will always be another SigTv
      or a SkolemTv

SigTvs are only distinguished to improve error messages.
Consider this

  f :: forall a. [a] -&gt; Int
  f (x::b : xs) = 3

Here 'b' is a lexically scoped type variable, but it turns out to be
the same as the skolem 'a'.  So we make them both SigTvs, which can unify
with each other.

Similarly consider
  data T (a:k1) = MkT (S a)
  data S (b:k2) = MkS (T b)
When doing kind inference on {S,T} we don't want *skolems* for k1,k2,
because they end up unifying; we want those SigTvs again.

SigTvs are used *only* for pattern type signatures.

Note [TyVars and TcTyVars during type checking]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The Var type has constructors TyVar and TcTyVar.  They are used
as follows:

* TcTyVar: used /only/ during type checking.  Should never appear
  afterwards.  May contain a mutable field, in the MetaTv case.

* TyVar: is never seen by the constraint solver, except locally
  inside a type like (forall a. [a] -&gt;[a]), where 'a' is a TyVar.
  We instantiate these with TcTyVars before exposing the type
  to the constraint solver.

I have swithered about the latter invariant, excluding TyVars from the
constraint solver.  It's not strictly essential, and indeed
(historically but still there) Var.tcTyVarDetails returns
vanillaSkolemTv for a TyVar.

But ultimately I want to seeparate Type from TcType, and in that case
we would need to enforce the separation.
-}</span><span>
</span><a name="line-504"></a><span>
</span><a name="line-505"></a><span class="hs-comment">-- A TyVarDetails is inside a TyVar</span><span>
</span><a name="line-506"></a><span class="hs-comment">-- See Note [TyVars and TcTyVars]</span><span>
</span><a name="line-507"></a><span class="hs-keyword">data</span><span> </span><a name="TcTyVarDetails"><a href="TcType.html#TcTyVarDetails"><span class="hs-identifier">TcTyVarDetails</span></a></a><span>
</span><a name="line-508"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="SkolemTv"><a href="TcType.html#SkolemTv"><span class="hs-identifier">SkolemTv</span></a></a><span>      </span><span class="hs-comment">-- A skolem</span><span>
</span><a name="line-509"></a><span>       </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span>    </span><span class="hs-comment">-- Level of the implication that binds it</span><span>
</span><a name="line-510"></a><span>       </span><span class="hs-identifier hs-type">Bool</span><span>       </span><span class="hs-comment">-- True &lt;=&gt; this skolem type variable can be overlapped</span><span>
</span><a name="line-511"></a><span>                  </span><span class="hs-comment">--          when looking up instances</span><span>
</span><a name="line-512"></a><span>                  </span><span class="hs-comment">-- See Note [Binding when looking up instances] in InstEnv</span><span>
</span><a name="line-513"></a><span>
</span><a name="line-514"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RuntimeUnk"><a href="TcType.html#RuntimeUnk"><span class="hs-identifier">RuntimeUnk</span></a></a><span>    </span><span class="hs-comment">-- Stands for an as-yet-unknown type in the GHCi</span><span>
</span><a name="line-515"></a><span>                  </span><span class="hs-comment">-- interactive context</span><span>
</span><a name="line-516"></a><span>
</span><a name="line-517"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MetaTv"><a href="TcType.html#MetaTv"><span class="hs-identifier">MetaTv</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="mtv_info"><a href="TcType.html#mtv_info"><span class="hs-identifier">mtv_info</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a><span>
</span><a name="line-518"></a><span>           </span><span class="hs-special">,</span><span> </span><a name="mtv_ref"><a href="TcType.html#mtv_ref"><span class="hs-identifier">mtv_ref</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a><span> </span><a href="TcType.html#MetaDetails"><span class="hs-identifier hs-type">MetaDetails</span></a><span>
</span><a name="line-519"></a><span>           </span><span class="hs-special">,</span><span> </span><a name="mtv_tclvl"><a href="TcType.html#mtv_tclvl"><span class="hs-identifier">mtv_tclvl</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-special">}</span><span>  </span><span class="hs-comment">-- See Note [TcLevel and untouchable type variables]</span><span>
</span><a name="line-520"></a><span>
</span><a name="line-521"></a><span class="hs-identifier">vanillaSkolemTv</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">superSkolemTv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVarDetails"><span class="hs-identifier hs-type">TcTyVarDetails</span></a><span>
</span><a name="line-522"></a><span class="hs-comment">-- See Note [Binding when looking up instances] in InstEnv</span><span>
</span><a name="line-523"></a><a name="vanillaSkolemTv"><a href="TcType.html#vanillaSkolemTv"><span class="hs-identifier">vanillaSkolemTv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a><span> </span><a href="TcType.html#topTcLevel"><span class="hs-identifier hs-var">topTcLevel</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">False</span><span>  </span><span class="hs-comment">-- Might be instantiated</span><span>
</span><a name="line-524"></a><a name="superSkolemTv"><a href="TcType.html#superSkolemTv"><span class="hs-identifier">superSkolemTv</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a><span> </span><a href="TcType.html#topTcLevel"><span class="hs-identifier hs-var">topTcLevel</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">True</span><span>   </span><span class="hs-comment">-- Treat this as a completely distinct type</span><span>
</span><a name="line-525"></a><span>
</span><a name="line-526"></a><span class="hs-comment">-----------------------------</span><span>
</span><a name="line-527"></a><span class="hs-keyword">data</span><span> </span><a name="MetaDetails"><a href="TcType.html#MetaDetails"><span class="hs-identifier">MetaDetails</span></a></a><span>
</span><a name="line-528"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Flexi"><a href="TcType.html#Flexi"><span class="hs-identifier">Flexi</span></a></a><span>  </span><span class="hs-comment">-- Flexi type variables unify to become Indirects</span><span>
</span><a name="line-529"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Indirect"><a href="TcType.html#Indirect"><span class="hs-identifier">Indirect</span></a></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-530"></a><span>
</span><a name="line-531"></a><span class="hs-keyword">data</span><span> </span><a name="MetaInfo"><a href="TcType.html#MetaInfo"><span class="hs-identifier">MetaInfo</span></a></a><span>
</span><a name="line-532"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="TauTv"><a href="TcType.html#TauTv"><span class="hs-identifier">TauTv</span></a></a><span>         </span><span class="hs-comment">-- This MetaTv is an ordinary unification variable</span><span>
</span><a name="line-533"></a><span>                   </span><span class="hs-comment">-- A TauTv is always filled in with a tau-type, which</span><span>
</span><a name="line-534"></a><span>                   </span><span class="hs-comment">-- never contains any ForAlls.</span><span>
</span><a name="line-535"></a><span>
</span><a name="line-536"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="SigTv"><a href="TcType.html#SigTv"><span class="hs-identifier">SigTv</span></a></a><span>         </span><span class="hs-comment">-- A variant of TauTv, except that it should not be</span><span>
</span><a name="line-537"></a><span>                   </span><span class="hs-comment">--   unified with a type, only with a type variable</span><span>
</span><a name="line-538"></a><span>                   </span><span class="hs-comment">-- See Note [Signature skolems]</span><span>
</span><a name="line-539"></a><span>
</span><a name="line-540"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="FlatMetaTv"><a href="TcType.html#FlatMetaTv"><span class="hs-identifier">FlatMetaTv</span></a></a><span>    </span><span class="hs-comment">-- A flatten meta-tyvar</span><span>
</span><a name="line-541"></a><span>                   </span><span class="hs-comment">-- It is a meta-tyvar, but it is always untouchable, with level 0</span><span>
</span><a name="line-542"></a><span>                   </span><span class="hs-comment">-- See Note [The flattening story] in TcFlatten</span><span>
</span><a name="line-543"></a><span>
</span><a name="line-544"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="FlatSkolTv"><a href="TcType.html#FlatSkolTv"><span class="hs-identifier">FlatSkolTv</span></a></a><span>    </span><span class="hs-comment">-- A flatten skolem tyvar</span><span>
</span><a name="line-545"></a><span>                   </span><span class="hs-comment">-- Just like FlatMetaTv, but is comletely &quot;owned&quot; by</span><span>
</span><a name="line-546"></a><span>                   </span><span class="hs-comment">--   its Given CFunEqCan.</span><span>
</span><a name="line-547"></a><span>                   </span><span class="hs-comment">-- It is filled in /only/ by unflattenGivens</span><span>
</span><a name="line-548"></a><span>                   </span><span class="hs-comment">-- See Note [The flattening story] in TcFlatten</span><span>
</span><a name="line-549"></a><span>
</span><a name="line-550"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcType.html#MetaDetails"><span class="hs-identifier hs-type">MetaDetails</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-551"></a><span>  </span><a name="local-8214565720323905585"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Flexi&quot;</span><span>
</span><a name="line-552"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcType.html#Indirect"><span class="hs-identifier hs-var">Indirect</span></a><span> </span><a name="local-6989586621679592399"><a href="#local-6989586621679592399"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Indirect&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592399"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-553"></a><span>
</span><a name="line-554"></a><span class="hs-identifier">pprTcTyVarDetails</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVarDetails"><span class="hs-identifier hs-type">TcTyVarDetails</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-555"></a><span class="hs-comment">-- For debugging</span><span>
</span><a name="line-556"></a><a name="pprTcTyVarDetails"><a href="TcType.html#pprTcTyVarDetails"><span class="hs-identifier">pprTcTyVarDetails</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#RuntimeUnk"><span class="hs-identifier hs-var">RuntimeUnk</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;rt&quot;</span><span>
</span><a name="line-557"></a><span class="hs-identifier">pprTcTyVarDetails</span><span> </span><span class="hs-special">(</span><a href="TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a><span> </span><a name="local-6989586621679592408"><a href="#local-6989586621679592408"><span class="hs-identifier">lvl</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ssk&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592408"><span class="hs-identifier hs-var">lvl</span></a><span>
</span><a name="line-558"></a><span class="hs-identifier">pprTcTyVarDetails</span><span> </span><span class="hs-special">(</span><a href="TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a><span> </span><a name="local-6989586621679592409"><a href="#local-6989586621679592409"><span class="hs-identifier">lvl</span></a></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;sk&quot;</span><span>  </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592409"><span class="hs-identifier hs-var">lvl</span></a><span>
</span><a name="line-559"></a><span class="hs-identifier">pprTcTyVarDetails</span><span> </span><span class="hs-special">(</span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_info</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592410"><a href="#local-6989586621679592410"><span class="hs-identifier">info</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">mtv_tclvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592411"><a href="#local-6989586621679592411"><span class="hs-identifier">tclvl</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-560"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592412"><span class="hs-identifier hs-var">pp_info</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592411"><span class="hs-identifier hs-var">tclvl</span></a><span>
</span><a name="line-561"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-562"></a><span>    </span><a name="local-6989586621679592412"><a href="#local-6989586621679592412"><span class="hs-identifier">pp_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679592410"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-563"></a><span>                </span><a href="TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;tau&quot;</span><span>
</span><a name="line-564"></a><span>                </span><a href="TcType.html#SigTv"><span class="hs-identifier hs-var">SigTv</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;sig&quot;</span><span>
</span><a name="line-565"></a><span>                </span><a href="TcType.html#FlatMetaTv"><span class="hs-identifier hs-var">FlatMetaTv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;fmv&quot;</span><span>
</span><a name="line-566"></a><span>                </span><a href="TcType.html#FlatSkolTv"><span class="hs-identifier hs-var">FlatSkolTv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;fsk&quot;</span><span>
</span><a name="line-567"></a><span>
</span><a name="line-568"></a><span>
</span><a name="line-569"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
          UserTypeCtxt
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-574"></a><span>
</span><a name="line-575"></a><span class="hs-comment">-------------------------------------</span><span>
</span><a name="line-576"></a><span class="hs-comment">-- UserTypeCtxt describes the origin of the polymorphic type</span><span>
</span><a name="line-577"></a><span class="hs-comment">-- in the places where we need to an expression has that type</span><span>
</span><a name="line-578"></a><span>
</span><a name="line-579"></a><span class="hs-keyword">data</span><span> </span><a name="UserTypeCtxt"><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier">UserTypeCtxt</span></a></a><span>
</span><a name="line-580"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="FunSigCtxt"><a href="TcType.html#FunSigCtxt"><span class="hs-identifier">FunSigCtxt</span></a></a><span>      </span><span class="hs-comment">-- Function type signature, when checking the type</span><span>
</span><a name="line-581"></a><span>                    </span><span class="hs-comment">-- Also used for types in SPECIALISE pragmas</span><span>
</span><a name="line-582"></a><span>       </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>              </span><span class="hs-comment">-- Name of the function</span><span>
</span><a name="line-583"></a><span>       </span><span class="hs-identifier hs-type">Bool</span><span>              </span><span class="hs-comment">-- True &lt;=&gt; report redundant constraints</span><span>
</span><a name="line-584"></a><span>                            </span><span class="hs-comment">-- This is usually True, but False for</span><span>
</span><a name="line-585"></a><span>                            </span><span class="hs-comment">--   * Record selectors (not important here)</span><span>
</span><a name="line-586"></a><span>                            </span><span class="hs-comment">--   * Class and instance methods.  Here</span><span>
</span><a name="line-587"></a><span>                            </span><span class="hs-comment">--     the code may legitimately be more</span><span>
</span><a name="line-588"></a><span>                            </span><span class="hs-comment">--     polymorphic than the signature</span><span>
</span><a name="line-589"></a><span>                            </span><span class="hs-comment">--     generated from the class</span><span>
</span><a name="line-590"></a><span>                            </span><span class="hs-comment">--     declaration</span><span>
</span><a name="line-591"></a><span>
</span><a name="line-592"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="InfSigCtxt"><a href="TcType.html#InfSigCtxt"><span class="hs-identifier">InfSigCtxt</span></a></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>     </span><span class="hs-comment">-- Inferred type for function</span><span>
</span><a name="line-593"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ExprSigCtxt"><a href="TcType.html#ExprSigCtxt"><span class="hs-identifier">ExprSigCtxt</span></a></a><span>         </span><span class="hs-comment">-- Expression type signature</span><span>
</span><a name="line-594"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TypeAppCtxt"><a href="TcType.html#TypeAppCtxt"><span class="hs-identifier">TypeAppCtxt</span></a></a><span>         </span><span class="hs-comment">-- Visible type application</span><span>
</span><a name="line-595"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ConArgCtxt"><a href="TcType.html#ConArgCtxt"><span class="hs-identifier">ConArgCtxt</span></a></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>     </span><span class="hs-comment">-- Data constructor argument</span><span>
</span><a name="line-596"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TySynCtxt"><a href="TcType.html#TySynCtxt"><span class="hs-identifier">TySynCtxt</span></a></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>      </span><span class="hs-comment">-- RHS of a type synonym decl</span><span>
</span><a name="line-597"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PatSynCtxt"><a href="TcType.html#PatSynCtxt"><span class="hs-identifier">PatSynCtxt</span></a></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>     </span><span class="hs-comment">-- Type sig for a pattern synonym</span><span>
</span><a name="line-598"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PatSigCtxt"><a href="TcType.html#PatSigCtxt"><span class="hs-identifier">PatSigCtxt</span></a></a><span>          </span><span class="hs-comment">-- Type sig in pattern</span><span>
</span><a name="line-599"></a><span>                        </span><span class="hs-comment">--   eg  f (x::t) = ...</span><span>
</span><a name="line-600"></a><span>                        </span><span class="hs-comment">--   or  (x::t, y) = e</span><span>
</span><a name="line-601"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RuleSigCtxt"><a href="TcType.html#RuleSigCtxt"><span class="hs-identifier">RuleSigCtxt</span></a></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>    </span><span class="hs-comment">-- LHS of a RULE forall</span><span>
</span><a name="line-602"></a><span>                        </span><span class="hs-comment">--    RULE &quot;foo&quot; forall (x :: a -&gt; a). f (Just x) = ...</span><span>
</span><a name="line-603"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ResSigCtxt"><a href="TcType.html#ResSigCtxt"><span class="hs-identifier">ResSigCtxt</span></a></a><span>          </span><span class="hs-comment">-- Result type sig</span><span>
</span><a name="line-604"></a><span>                        </span><span class="hs-comment">--      f x :: t = ....</span><span>
</span><a name="line-605"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ForSigCtxt"><a href="TcType.html#ForSigCtxt"><span class="hs-identifier">ForSigCtxt</span></a></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>     </span><span class="hs-comment">-- Foreign import or export signature</span><span>
</span><a name="line-606"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DefaultDeclCtxt"><a href="TcType.html#DefaultDeclCtxt"><span class="hs-identifier">DefaultDeclCtxt</span></a></a><span>     </span><span class="hs-comment">-- Types in a default declaration</span><span>
</span><a name="line-607"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="InstDeclCtxt"><a href="TcType.html#InstDeclCtxt"><span class="hs-identifier">InstDeclCtxt</span></a></a><span>        </span><span class="hs-comment">-- An instance declaration</span><span>
</span><a name="line-608"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SpecInstCtxt"><a href="TcType.html#SpecInstCtxt"><span class="hs-identifier">SpecInstCtxt</span></a></a><span>        </span><span class="hs-comment">-- SPECIALISE instance pragma</span><span>
</span><a name="line-609"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ThBrackCtxt"><a href="TcType.html#ThBrackCtxt"><span class="hs-identifier">ThBrackCtxt</span></a></a><span>         </span><span class="hs-comment">-- Template Haskell type brackets [t| ... |]</span><span>
</span><a name="line-610"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="GenSigCtxt"><a href="TcType.html#GenSigCtxt"><span class="hs-identifier">GenSigCtxt</span></a></a><span>          </span><span class="hs-comment">-- Higher-rank or impredicative situations</span><span>
</span><a name="line-611"></a><span>                        </span><span class="hs-comment">-- e.g. (f e) where f has a higher-rank type</span><span>
</span><a name="line-612"></a><span>                        </span><span class="hs-comment">-- We might want to elaborate this</span><span>
</span><a name="line-613"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="GhciCtxt"><a href="TcType.html#GhciCtxt"><span class="hs-identifier">GhciCtxt</span></a></a><span>            </span><span class="hs-comment">-- GHCi command :kind &lt;type&gt;</span><span>
</span><a name="line-614"></a><span>
</span><a name="line-615"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ClassSCCtxt"><a href="TcType.html#ClassSCCtxt"><span class="hs-identifier">ClassSCCtxt</span></a></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>    </span><span class="hs-comment">-- Superclasses of a class</span><span>
</span><a name="line-616"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SigmaCtxt"><a href="TcType.html#SigmaCtxt"><span class="hs-identifier">SigmaCtxt</span></a></a><span>           </span><span class="hs-comment">-- Theta part of a normal for-all type</span><span>
</span><a name="line-617"></a><span>                        </span><span class="hs-comment">--      f :: &lt;S&gt; =&gt; a -&gt; a</span><span>
</span><a name="line-618"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DataTyCtxt"><a href="TcType.html#DataTyCtxt"><span class="hs-identifier">DataTyCtxt</span></a></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>     </span><span class="hs-comment">-- The &quot;stupid theta&quot; part of a data decl</span><span>
</span><a name="line-619"></a><span>                        </span><span class="hs-comment">--      data &lt;S&gt; =&gt; T a = MkT a</span><span>
</span><a name="line-620"></a><span>
</span><a name="line-621"></a><span class="hs-comment">{-
-- Notes re TySynCtxt
-- We allow type synonyms that aren't types; e.g.  type List = []
--
-- If the RHS mentions tyvars that aren't in scope, we'll
-- quantify over them:
--      e.g.    type T = a-&gt;a
-- will become  type T = forall a. a-&gt;a
--
-- With gla-exts that's right, but for H98 we should complain.
-}</span><span>
</span><a name="line-632"></a><span>
</span><a name="line-633"></a><span>
</span><a name="line-634"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-635"></a><a name="pprUserTypeCtxt"><a href="TcType.html#pprUserTypeCtxt"><span class="hs-identifier">pprUserTypeCtxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a><span> </span><a name="local-6989586621679592413"><a href="#local-6989586621679592413"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the type signature for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592413"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-636"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><span class="hs-special">(</span><a href="TcType.html#InfSigCtxt"><span class="hs-identifier hs-var">InfSigCtxt</span></a><span> </span><a name="local-6989586621679592414"><a href="#local-6989586621679592414"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the inferred type for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592414"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-637"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><span class="hs-special">(</span><a href="TcType.html#RuleSigCtxt"><span class="hs-identifier hs-var">RuleSigCtxt</span></a><span> </span><a name="local-6989586621679592415"><a href="#local-6989586621679592415"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a RULE for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592415"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-638"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><a href="TcType.html#ExprSigCtxt"><span class="hs-identifier hs-var">ExprSigCtxt</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;an expression type signature&quot;</span><span>
</span><a name="line-639"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><a href="TcType.html#TypeAppCtxt"><span class="hs-identifier hs-var">TypeAppCtxt</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a type argument&quot;</span><span>
</span><a name="line-640"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><span class="hs-special">(</span><a href="TcType.html#ConArgCtxt"><span class="hs-identifier hs-var">ConArgCtxt</span></a><span> </span><a name="local-6989586621679592416"><a href="#local-6989586621679592416"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the type of the constructor&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592416"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-641"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><span class="hs-special">(</span><a href="TcType.html#TySynCtxt"><span class="hs-identifier hs-var">TySynCtxt</span></a><span> </span><a name="local-6989586621679592417"><a href="#local-6989586621679592417"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the RHS of the type synonym&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592417"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-642"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><a href="TcType.html#ThBrackCtxt"><span class="hs-identifier hs-var">ThBrackCtxt</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a Template Haskell quotation [t|...|]&quot;</span><span>
</span><a name="line-643"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><a href="TcType.html#PatSigCtxt"><span class="hs-identifier hs-var">PatSigCtxt</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a pattern type signature&quot;</span><span>
</span><a name="line-644"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><a href="TcType.html#ResSigCtxt"><span class="hs-identifier hs-var">ResSigCtxt</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a result type signature&quot;</span><span>
</span><a name="line-645"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><span class="hs-special">(</span><a href="TcType.html#ForSigCtxt"><span class="hs-identifier hs-var">ForSigCtxt</span></a><span> </span><a name="local-6989586621679592418"><a href="#local-6989586621679592418"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the foreign declaration for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592418"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-646"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><a href="TcType.html#DefaultDeclCtxt"><span class="hs-identifier hs-var">DefaultDeclCtxt</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a type in a `default' declaration&quot;</span><span>
</span><a name="line-647"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><a href="TcType.html#InstDeclCtxt"><span class="hs-identifier hs-var">InstDeclCtxt</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;an instance declaration&quot;</span><span>
</span><a name="line-648"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><a href="TcType.html#SpecInstCtxt"><span class="hs-identifier hs-var">SpecInstCtxt</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a SPECIALISE instance pragma&quot;</span><span>
</span><a name="line-649"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><a href="TcType.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a type expected by the context&quot;</span><span>
</span><a name="line-650"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><a href="TcType.html#GhciCtxt"><span class="hs-identifier hs-var">GhciCtxt</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a type in a GHCi command&quot;</span><span>
</span><a name="line-651"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><span class="hs-special">(</span><a href="TcType.html#ClassSCCtxt"><span class="hs-identifier hs-var">ClassSCCtxt</span></a><span> </span><a name="local-6989586621679592419"><a href="#local-6989586621679592419"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the super-classes of class&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592419"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-652"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><a href="TcType.html#SigmaCtxt"><span class="hs-identifier hs-var">SigmaCtxt</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the context of a polymorphic type&quot;</span><span>
</span><a name="line-653"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><span class="hs-special">(</span><a href="TcType.html#DataTyCtxt"><span class="hs-identifier hs-var">DataTyCtxt</span></a><span> </span><a name="local-6989586621679592420"><a href="#local-6989586621679592420"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the context of the data type declaration for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592420"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-654"></a><span class="hs-identifier">pprUserTypeCtxt</span><span> </span><span class="hs-special">(</span><a href="TcType.html#PatSynCtxt"><span class="hs-identifier hs-var">PatSynCtxt</span></a><span> </span><a name="local-6989586621679592421"><a href="#local-6989586621679592421"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the signature for pattern synonym&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592421"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-655"></a><span>
</span><a name="line-656"></a><span class="hs-identifier">isSigMaybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-657"></a><a name="isSigMaybe"><a href="TcType.html#isSigMaybe"><span class="hs-identifier">isSigMaybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a><span> </span><a name="local-6989586621679592422"><a href="#local-6989586621679592422"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679592422"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-658"></a><span class="hs-identifier">isSigMaybe</span><span> </span><span class="hs-special">(</span><a href="TcType.html#ConArgCtxt"><span class="hs-identifier hs-var">ConArgCtxt</span></a><span> </span><a name="local-6989586621679592423"><a href="#local-6989586621679592423"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679592423"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-659"></a><span class="hs-identifier">isSigMaybe</span><span> </span><span class="hs-special">(</span><a href="TcType.html#ForSigCtxt"><span class="hs-identifier hs-var">ForSigCtxt</span></a><span> </span><a name="local-6989586621679592424"><a href="#local-6989586621679592424"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679592424"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-660"></a><span class="hs-identifier">isSigMaybe</span><span> </span><span class="hs-special">(</span><a href="TcType.html#PatSynCtxt"><span class="hs-identifier hs-var">PatSynCtxt</span></a><span> </span><a name="local-6989586621679592425"><a href="#local-6989586621679592425"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679592425"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-661"></a><span class="hs-identifier">isSigMaybe</span><span> </span><span class="hs-identifier">_</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-662"></a><span>
</span><a name="line-663"></a><span>
</span><a name="line-664"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                Untoucable type variables
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-669"></a><span>
</span><a name="line-670"></a><span class="hs-keyword">newtype</span><span> </span><a name="TcLevel"><a href="TcType.html#TcLevel"><span class="hs-identifier">TcLevel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TcLevel"><a href="TcType.html#TcLevel"><span class="hs-identifier">TcLevel</span></a></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-671"></a><span>  </span><span class="hs-comment">-- See Note [TcLevel and untouchable type variables] for what this Int is</span><span>
</span><a name="line-672"></a><span>  </span><span class="hs-comment">-- See also Note [TcLevel assignment]</span><span>
</span><a name="line-673"></a><span>
</span><a name="line-674"></a><span class="hs-comment">{-
Note [TcLevel and untouchable type variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* Each unification variable (MetaTv)
  and each Implication
  has a level number (of type TcLevel)

* INVARIANTS.  In a tree of Implications,

    (ImplicInv) The level number (ic_tclvl) of an Implication is
                STRICTLY GREATER THAN that of its parent

    (GivenInv) The level number of a unification variable appearing
                 in the 'ic_given' of an implication I should be
                 STRICTLY LESS THAN the ic_tclvl of I

    (WantedInv) The level number of a unification variable appearing
                in the 'ic_wanted' of an implication I should be
                LESS THAN OR EQUAL TO the ic_tclvl of I
                See Note [WantedInv]

* A unification variable is *touchable* if its level number
  is EQUAL TO that of its immediate parent implication.

Note [WantedInv]
~~~~~~~~~~~~~~~~
Why is WantedInv important?  Consider this implication, where
the constraint (C alpha[3]) disobeys WantedInv:

   forall[2] a. blah =&gt; (C alpha[3])
                        (forall[3] b. alpha[3] ~ b)

We can unify alpha:=b in the inner implication, because 'alpha' is
touchable; but then 'b' has excaped its scope into the outer implication.

Note [Skolem escape prevention]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We only unify touchable unification variables.  Because of
(WantedInv), there can be no occurrences of the variable further out,
so the unification can't cause the skolems to escape. Example:
     data T = forall a. MkT a (a-&gt;Int)
     f x (MkT v f) = length [v,x]
We decide (x::alpha), and generate an implication like
      [1]forall a. (a ~ alpha[0])
But we must not unify alpha:=a, because the skolem would escape.

For the cases where we DO want to unify, we rely on floating the
equality.   Example (with same T)
     g x (MkT v f) = x &amp;&amp; True
We decide (x::alpha), and generate an implication like
      [1]forall a. (Bool ~ alpha[0])
We do NOT unify directly, bur rather float out (if the constraint
does not mention 'a') to get
      (Bool ~ alpha[0]) /\ [1]forall a.()
and NOW we can unify alpha.

The same idea of only unifying touchables solves another problem.
Suppose we had
   (F Int ~ uf[0])  /\  [1](forall a. C a =&gt; F Int ~ beta[1])
In this example, beta is touchable inside the implication. The
first solveSimpleWanteds step leaves 'uf' un-unified. Then we move inside
the implication where a new constraint
       uf  ~  beta
emerges. If we (wrongly) spontaneously solved it to get uf := beta,
the whole implication disappears but when we pop out again we are left with
(F Int ~ uf) which will be unified by our final zonking stage and
uf will get unified *once more* to (F Int).

Note [TcLevel assignment]
~~~~~~~~~~~~~~~~~~~~~~~~~
We arrange the TcLevels like this

   0   Level for all flatten meta-vars
   1   Top level
   2   First-level implication constraints
   3   Second-level implication constraints
   ...etc...

The flatten meta-vars are all at level 0, just to make them untouchable.
-}</span><span>
</span><a name="line-754"></a><span>
</span><a name="line-755"></a><span class="hs-identifier">maxTcLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span>
</span><a name="line-756"></a><a name="maxTcLevel"><a href="TcType.html#maxTcLevel"><span class="hs-identifier">maxTcLevel</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-var">TcLevel</span></a><span> </span><a name="local-6989586621679592426"><a href="#local-6989586621679592426"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-var">TcLevel</span></a><span> </span><a name="local-6989586621679592427"><a href="#local-6989586621679592427"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-var">TcLevel</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592426"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">max</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592427"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-757"></a><span>
</span><a name="line-758"></a><span class="hs-identifier">fmvTcLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span>
</span><a name="line-759"></a><span class="hs-comment">-- See Note [TcLevel assignment]</span><span>
</span><a name="line-760"></a><a name="fmvTcLevel"><a href="TcType.html#fmvTcLevel"><span class="hs-identifier">fmvTcLevel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-var">TcLevel</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-761"></a><span>
</span><a name="line-762"></a><span class="hs-identifier">topTcLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span>
</span><a name="line-763"></a><span class="hs-comment">-- See Note [TcLevel assignment]</span><span>
</span><a name="line-764"></a><a name="topTcLevel"><a href="TcType.html#topTcLevel"><span class="hs-identifier">topTcLevel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-var">TcLevel</span></a><span> </span><span class="hs-number">1</span><span>   </span><span class="hs-comment">-- 1 = outermost level</span><span>
</span><a name="line-765"></a><span>
</span><a name="line-766"></a><span class="hs-identifier">isTopTcLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-767"></a><a name="isTopTcLevel"><a href="TcType.html#isTopTcLevel"><span class="hs-identifier">isTopTcLevel</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-var">TcLevel</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-768"></a><span class="hs-identifier">isTopTcLevel</span><span> </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-769"></a><span>
</span><a name="line-770"></a><span class="hs-identifier">pushTcLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span>
</span><a name="line-771"></a><span class="hs-comment">-- See Note [TcLevel assignment]</span><span>
</span><a name="line-772"></a><a name="pushTcLevel"><a href="TcType.html#pushTcLevel"><span class="hs-identifier">pushTcLevel</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-var">TcLevel</span></a><span> </span><a name="local-6989586621679592428"><a href="#local-6989586621679592428"><span class="hs-identifier">us</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-var">TcLevel</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592428"><span class="hs-identifier hs-var">us</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-773"></a><span>
</span><a name="line-774"></a><span class="hs-identifier">strictlyDeeperThan</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-775"></a><a name="strictlyDeeperThan"><a href="TcType.html#strictlyDeeperThan"><span class="hs-identifier">strictlyDeeperThan</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-var">TcLevel</span></a><span> </span><a name="local-6989586621679592429"><a href="#local-6989586621679592429"><span class="hs-identifier">tv_tclvl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-var">TcLevel</span></a><span> </span><a name="local-6989586621679592430"><a href="#local-6989586621679592430"><span class="hs-identifier">ctxt_tclvl</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-776"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592429"><span class="hs-identifier hs-var">tv_tclvl</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679592430"><span class="hs-identifier hs-var">ctxt_tclvl</span></a><span>
</span><a name="line-777"></a><span>
</span><a name="line-778"></a><span class="hs-identifier">sameDepthAs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-779"></a><a name="sameDepthAs"><a href="TcType.html#sameDepthAs"><span class="hs-identifier">sameDepthAs</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-var">TcLevel</span></a><span> </span><a name="local-6989586621679592431"><a href="#local-6989586621679592431"><span class="hs-identifier">ctxt_tclvl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-var">TcLevel</span></a><span> </span><a name="local-6989586621679592432"><a href="#local-6989586621679592432"><span class="hs-identifier">tv_tclvl</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-780"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592431"><span class="hs-identifier hs-var">ctxt_tclvl</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679592432"><span class="hs-identifier hs-var">tv_tclvl</span></a><span>   </span><span class="hs-comment">-- NB: invariant ctxt_tclvl &gt;= tv_tclvl</span><span>
</span><a name="line-781"></a><span>                             </span><span class="hs-comment">--     So &lt;= would be equivalent</span><span>
</span><a name="line-782"></a><span>
</span><a name="line-783"></a><span class="hs-identifier">checkTcLevelInvariant</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-784"></a><span class="hs-comment">-- Checks (WantedInv) from Note [TcLevel and untouchable type variables]</span><span>
</span><a name="line-785"></a><a name="checkTcLevelInvariant"><a href="TcType.html#checkTcLevelInvariant"><span class="hs-identifier">checkTcLevelInvariant</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-var">TcLevel</span></a><span> </span><a name="local-6989586621679592433"><a href="#local-6989586621679592433"><span class="hs-identifier">ctxt_tclvl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-var">TcLevel</span></a><span> </span><a name="local-6989586621679592434"><a href="#local-6989586621679592434"><span class="hs-identifier">tv_tclvl</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-786"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592433"><span class="hs-identifier hs-var">ctxt_tclvl</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679592434"><span class="hs-identifier hs-var">tv_tclvl</span></a><span>
</span><a name="line-787"></a><span>
</span><a name="line-788"></a><span class="hs-identifier">tcTyVarLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span>
</span><a name="line-789"></a><a name="tcTyVarLevel"><a href="TcType.html#tcTyVarLevel"><span class="hs-identifier">tcTyVarLevel</span></a></a><span> </span><a name="local-6989586621679592435"><a href="#local-6989586621679592435"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-790"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tcIsTcTyVar</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">,</span><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-791"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592435"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-792"></a><span>          </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_tclvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592436"><a href="#local-6989586621679592436"><span class="hs-identifier">tv_lvl</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592436"><span class="hs-identifier hs-var">tv_lvl</span></a><span>
</span><a name="line-793"></a><span>          </span><a href="TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a><span> </span><a name="local-6989586621679592437"><a href="#local-6989586621679592437"><span class="hs-identifier">tv_lvl</span></a></a><span> </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592437"><span class="hs-identifier hs-var">tv_lvl</span></a><span>
</span><a name="line-794"></a><span>          </span><a href="TcType.html#RuntimeUnk"><span class="hs-identifier hs-var">RuntimeUnk</span></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#topTcLevel"><span class="hs-identifier hs-var">topTcLevel</span></a><span>
</span><a name="line-795"></a><span>
</span><a name="line-796"></a><span class="hs-identifier">tcTypeLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span>
</span><a name="line-797"></a><span class="hs-comment">-- Max level of any free var of the type</span><span>
</span><a name="line-798"></a><a name="tcTypeLevel"><a href="TcType.html#tcTypeLevel"><span class="hs-identifier">tcTypeLevel</span></a></a><span> </span><a name="local-6989586621679592438"><a href="#local-6989586621679592438"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-799"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#foldDVarSet"><span class="hs-identifier hs-var">foldDVarSet</span></a><span> </span><a href="#local-6989586621679592439"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="TcType.html#topTcLevel"><span class="hs-identifier hs-var">topTcLevel</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypeDSet"><span class="hs-identifier hs-var">tyCoVarsOfTypeDSet</span></a><span> </span><a href="#local-6989586621679592438"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-800"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-801"></a><span>    </span><a name="local-6989586621679592439"><a href="#local-6989586621679592439"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-6989586621679592440"><a href="#local-6989586621679592440"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679592441"><a href="#local-6989586621679592441"><span class="hs-identifier">lvl</span></a></a><span>
</span><a name="line-802"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a><span> </span><a href="#local-6989586621679592440"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592441"><span class="hs-identifier hs-var">lvl</span></a><span> </span><span class="hs-special">`</span><a href="TcType.html#maxTcLevel"><span class="hs-identifier hs-var">maxTcLevel</span></a><span class="hs-special">`</span><span> </span><a href="TcType.html#tcTyVarLevel"><span class="hs-identifier hs-var">tcTyVarLevel</span></a><span> </span><a href="#local-6989586621679592440"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-803"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592441"><span class="hs-identifier hs-var">lvl</span></a><span>
</span><a name="line-804"></a><span>
</span><a name="line-805"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-806"></a><span>  </span><a name="local-8214565720323905585"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-var">TcLevel</span></a><span> </span><a name="local-6989586621679592398"><a href="#local-6989586621679592398"><span class="hs-identifier">us</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592398"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-807"></a><span>
</span><a name="line-808"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
    Finding type family instances
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-814"></a><span>
</span><a name="line-815"></a><span class="hs-comment">-- | Finds outermost type-family applications occuring in a type,</span><span>
</span><a name="line-816"></a><span class="hs-comment">-- after expanding synonyms.  In the list (F, tys) that is returned</span><span>
</span><a name="line-817"></a><span class="hs-comment">-- we guarantee that tys matches F's arity.  For example, given</span><span>
</span><a name="line-818"></a><span class="hs-comment">--    type family F a :: * -&gt; *    (arity 1)</span><span>
</span><a name="line-819"></a><span class="hs-comment">-- calling tcTyFamInsts on (Maybe (F Int Bool) will return</span><span>
</span><a name="line-820"></a><span class="hs-comment">--     (F, [Int]), not (F, [Int,Bool])</span><span>
</span><a name="line-821"></a><span class="hs-comment">--</span><span>
</span><a name="line-822"></a><span class="hs-comment">-- This is important for its use in deciding termination of type</span><span>
</span><a name="line-823"></a><span class="hs-comment">-- instances (see Trac #11581).  E.g.</span><span>
</span><a name="line-824"></a><span class="hs-comment">--    type instance G [Int] = ...(F Int &lt;big type&gt;)...</span><span>
</span><a name="line-825"></a><span class="hs-comment">-- we don't need to take &lt;big type&gt; into account when asking if</span><span>
</span><a name="line-826"></a><span class="hs-comment">-- the calls on the RHS are smaller than the LHS</span><span>
</span><a name="line-827"></a><span class="hs-identifier">tcTyFamInsts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-828"></a><a name="tcTyFamInsts"><a href="TcType.html#tcTyFamInsts"><span class="hs-identifier">tcTyFamInsts</span></a></a><span> </span><a name="local-6989586621679592442"><a href="#local-6989586621679592442"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-829"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592443"><a href="#local-6989586621679592443"><span class="hs-identifier">exp_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592442"><span class="hs-identifier hs-var">ty</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcTyFamInsts"><span class="hs-identifier hs-var">tcTyFamInsts</span></a><span> </span><a href="#local-6989586621679592443"><span class="hs-identifier hs-var">exp_ty</span></a><span>
</span><a name="line-830"></a><span class="hs-identifier">tcTyFamInsts</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-831"></a><span class="hs-identifier">tcTyFamInsts</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621679592444"><a href="#local-6989586621679592444"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679592445"><a href="#local-6989586621679592445"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-832"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a><span> </span><a href="#local-6989586621679592444"><span class="hs-identifier hs-var">tc</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679592444"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#take"><span class="hs-identifier hs-var">take</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConArity</span><span> </span><a href="#local-6989586621679592444"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592445"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-833"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TcType.html#tcTyFamInsts"><span class="hs-identifier hs-var">tcTyFamInsts</span></a><span> </span><a href="#local-6989586621679592445"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-834"></a><span class="hs-identifier">tcTyFamInsts</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-835"></a><span class="hs-identifier">tcTyFamInsts</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><a name="local-6989586621679592446"><a href="#local-6989586621679592446"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621679592447"><a href="#local-6989586621679592447"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcTyFamInsts"><span class="hs-identifier hs-var">tcTyFamInsts</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#binderKind"><span class="hs-identifier hs-var">binderKind</span></a><span> </span><a href="#local-6989586621679592446"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-836"></a><span>                                  </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="TcType.html#tcTyFamInsts"><span class="hs-identifier hs-var">tcTyFamInsts</span></a><span> </span><a href="#local-6989586621679592447"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-837"></a><span class="hs-identifier">tcTyFamInsts</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679592448"><a href="#local-6989586621679592448"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679592449"><a href="#local-6989586621679592449"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcTyFamInsts"><span class="hs-identifier hs-var">tcTyFamInsts</span></a><span> </span><a href="#local-6989586621679592448"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="TcType.html#tcTyFamInsts"><span class="hs-identifier hs-var">tcTyFamInsts</span></a><span> </span><a href="#local-6989586621679592449"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-838"></a><span class="hs-identifier">tcTyFamInsts</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621679592450"><a href="#local-6989586621679592450"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679592451"><a href="#local-6989586621679592451"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcTyFamInsts"><span class="hs-identifier hs-var">tcTyFamInsts</span></a><span> </span><a href="#local-6989586621679592450"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="TcType.html#tcTyFamInsts"><span class="hs-identifier hs-var">tcTyFamInsts</span></a><span> </span><a href="#local-6989586621679592451"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-839"></a><span class="hs-identifier">tcTyFamInsts</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621679592452"><a href="#local-6989586621679592452"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcTyFamInsts"><span class="hs-identifier hs-var">tcTyFamInsts</span></a><span> </span><a href="#local-6989586621679592452"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-840"></a><span class="hs-identifier">tcTyFamInsts</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- don't count tyfams in coercions,</span><span>
</span><a name="line-841"></a><span>                                      </span><span class="hs-comment">-- as they never get normalized, anyway</span><span>
</span><a name="line-842"></a><span>
</span><a name="line-843"></a><span class="hs-identifier">isTyFamFree</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-844"></a><span class="hs-comment">-- ^ Check that a type does not contain any type family applications.</span><span>
</span><a name="line-845"></a><a name="isTyFamFree"><a href="TcType.html#isTyFamFree"><span class="hs-identifier">isTyFamFree</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TcType.html#tcTyFamInsts"><span class="hs-identifier hs-var">tcTyFamInsts</span></a><span>
</span><a name="line-846"></a><span>
</span><a name="line-847"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
          The &quot;exact&quot; free variables of a type
*                                                                      *
************************************************************************

Note [Silly type synonym]
~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  type T a = Int
What are the free tyvars of (T x)?  Empty, of course!
Here's the example that Ralf Laemmel showed me:
  foo :: (forall a. C u a -&gt; C u a) -&gt; u
  mappend :: Monoid u =&gt; u -&gt; u -&gt; u

  bar :: Monoid u =&gt; u
  bar = foo (\t -&gt; t `mappend` t)
We have to generalise at the arg to f, and we don't
want to capture the constraint (Monad (C u a)) because
it appears to mention a.  Pretty silly, but it was useful to him.

exactTyCoVarsOfType is used by the type checker to figure out exactly
which type variables are mentioned in a type.  It's also used in the
smart-app checking code --- see TcExpr.tcIdApp

On the other hand, consider a *top-level* definition
  f = (\x -&gt; x) :: T a -&gt; T a
If we don't abstract over 'a' it'll get fixed to GHC.Prim.Any, and then
if we have an application like (f &quot;x&quot;) we get a confusing error message
involving Any.  So the conclusion is this: when generalising
  - at top level use tyCoVarsOfType
  - in nested bindings use exactTyCoVarsOfType
See Trac #1813 for example.
-}</span><span>
</span><a name="line-882"></a><span>
</span><a name="line-883"></a><span class="hs-identifier">exactTyCoVarsOfType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span>
</span><a name="line-884"></a><span class="hs-comment">-- Find the free type variables (of any kind)</span><span>
</span><a name="line-885"></a><span class="hs-comment">-- but *expand* type synonyms.  See Note [Silly type synonym] above.</span><span>
</span><a name="line-886"></a><a name="exactTyCoVarsOfType"><a href="TcType.html#exactTyCoVarsOfType"><span class="hs-identifier">exactTyCoVarsOfType</span></a></a><span> </span><a name="local-6989586621679592453"><a href="#local-6989586621679592453"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-887"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592454"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592453"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-888"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-889"></a><span>    </span><a name="local-6989586621679592454"><a href="#local-6989586621679592454"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679592459"><a href="#local-6989586621679592459"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592460"><a href="#local-6989586621679592460"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592459"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592454"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592460"><span class="hs-identifier hs-var">ty'</span></a><span>  </span><span class="hs-comment">-- This is the key line</span><span>
</span><a name="line-890"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621679592461"><a href="#local-6989586621679592461"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592458"><span class="hs-identifier hs-var">goVar</span></a><span> </span><a href="#local-6989586621679592461"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-891"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679592462"><a href="#local-6989586621679592462"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#exactTyCoVarsOfTypes"><span class="hs-identifier hs-var">exactTyCoVarsOfTypes</span></a><span> </span><a href="#local-6989586621679592462"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-892"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span>
</span><a name="line-893"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621679592463"><a href="#local-6989586621679592463"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621679592464"><a href="#local-6989586621679592464"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592454"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592463"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592454"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592464"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-894"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679592465"><a href="#local-6989586621679592465"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679592466"><a href="#local-6989586621679592466"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592454"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592465"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592454"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592466"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-895"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><a name="local-6989586621679592467"><a href="#local-6989586621679592467"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621679592468"><a href="#local-6989586621679592468"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#delBinderVar"><span class="hs-identifier hs-var">delBinderVar</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592454"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592468"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592467"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592454"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#binderKind"><span class="hs-identifier hs-var">binderKind</span></a><span> </span><a href="#local-6989586621679592467"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-896"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621679592469"><a href="#local-6989586621679592469"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679592470"><a href="#local-6989586621679592470"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592454"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592469"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592470"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-897"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-6989586621679592471"><a href="#local-6989586621679592471"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592471"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-898"></a><span>
</span><a name="line-899"></a><span>    </span><a name="local-6989586621679592455"><a href="#local-6989586621679592455"><span class="hs-identifier">goCo</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679592472"><a href="#local-6989586621679592472"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592454"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592472"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-900"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679592473"><a href="#local-6989586621679592473"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592456"><span class="hs-identifier hs-var">goCos</span></a><span> </span><a href="#local-6989586621679592473"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-901"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a name="local-6989586621679592474"><a href="#local-6989586621679592474"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679592475"><a href="#local-6989586621679592475"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592474"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592475"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-902"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a name="local-6989586621679592476"><a href="#local-6989586621679592476"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679592477"><a href="#local-6989586621679592477"><span class="hs-identifier">k_co</span></a></a><span> </span><a name="local-6989586621679592478"><a href="#local-6989586621679592478"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-903"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592478"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#delVarSet"><span class="hs-identifier hs-var">delVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592476"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592477"><span class="hs-identifier hs-var">k_co</span></a><span>
</span><a name="line-904"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679592479"><a href="#local-6989586621679592479"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679592480"><a href="#local-6989586621679592480"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592479"><span class="hs-identifier hs-var">co1</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592480"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-905"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a name="local-6989586621679592481"><a href="#local-6989586621679592481"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592458"><span class="hs-identifier hs-var">goVar</span></a><span> </span><a href="#local-6989586621679592481"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-906"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a><span> </span><a name="local-6989586621679592482"><a href="#local-6989586621679592482"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592458"><span class="hs-identifier hs-var">goVar</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a><span> </span><a href="#local-6989586621679592482"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-907"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">AxiomInstCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679592483"><a href="#local-6989586621679592483"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592456"><span class="hs-identifier hs-var">goCos</span></a><span> </span><a href="#local-6989586621679592483"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-908"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><a name="local-6989586621679592484"><a href="#local-6989586621679592484"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679592485"><a href="#local-6989586621679592485"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679592486"><a href="#local-6989586621679592486"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592457"><span class="hs-identifier hs-var">goProv</span></a><span> </span><a href="#local-6989586621679592484"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592454"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592485"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592454"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592486"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-909"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a name="local-6989586621679592487"><a href="#local-6989586621679592487"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592487"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-910"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span> </span><a name="local-6989586621679592488"><a href="#local-6989586621679592488"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679592489"><a href="#local-6989586621679592489"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592488"><span class="hs-identifier hs-var">co1</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592489"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-911"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679592490"><a href="#local-6989586621679592490"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592490"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-912"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679592491"><a href="#local-6989586621679592491"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592491"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-913"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a name="local-6989586621679592492"><a href="#local-6989586621679592492"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679592493"><a href="#local-6989586621679592493"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592492"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592493"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-914"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoherenceCo"><span class="hs-identifier hs-var">CoherenceCo</span></a><span> </span><a name="local-6989586621679592494"><a href="#local-6989586621679592494"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621679592495"><a href="#local-6989586621679592495"><span class="hs-identifier">c2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592494"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592495"><span class="hs-identifier hs-var">c2</span></a><span>
</span><a name="line-915"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a><span> </span><a name="local-6989586621679592496"><a href="#local-6989586621679592496"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592496"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-916"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a name="local-6989586621679592497"><a href="#local-6989586621679592497"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592497"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-917"></a><span>    </span><span class="hs-identifier">goCo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679592498"><a href="#local-6989586621679592498"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592456"><span class="hs-identifier hs-var">goCos</span></a><span> </span><a href="#local-6989586621679592498"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-918"></a><span>
</span><a name="line-919"></a><span>    </span><a name="local-6989586621679592456"><a href="#local-6989586621679592456"><span class="hs-identifier">goCos</span></a></a><span> </span><a name="local-6989586621679592499"><a href="#local-6989586621679592499"><span class="hs-identifier">cos</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-special">(</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span class="hs-special">)</span><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span> </span><a href="#local-6989586621679592499"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-920"></a><span>
</span><a name="line-921"></a><span>    </span><a name="local-6989586621679592457"><a href="#local-6989586621679592457"><span class="hs-identifier">goProv</span></a></a><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span>
</span><a name="line-922"></a><span>    </span><span class="hs-identifier">goProv</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><a name="local-6989586621679592500"><a href="#local-6989586621679592500"><span class="hs-identifier">kco</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592500"><span class="hs-identifier hs-var">kco</span></a><span>
</span><a name="line-923"></a><span>    </span><span class="hs-identifier">goProv</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><a name="local-6989586621679592501"><a href="#local-6989586621679592501"><span class="hs-identifier">kco</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592455"><span class="hs-identifier hs-var">goCo</span></a><span> </span><a href="#local-6989586621679592501"><span class="hs-identifier hs-var">kco</span></a><span>
</span><a name="line-924"></a><span>    </span><span class="hs-identifier">goProv</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PluginProv"><span class="hs-identifier hs-var">PluginProv</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span>
</span><a name="line-925"></a><span>
</span><a name="line-926"></a><span>    </span><a name="local-6989586621679592458"><a href="#local-6989586621679592458"><span class="hs-identifier">goVar</span></a></a><span> </span><a name="local-6989586621679592502"><a href="#local-6989586621679592502"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#unitVarSet"><span class="hs-identifier hs-var">unitVarSet</span></a><span> </span><a href="#local-6989586621679592502"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592454"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679592502"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-927"></a><span>
</span><a name="line-928"></a><span class="hs-identifier">exactTyCoVarsOfTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a><span>
</span><a name="line-929"></a><a name="exactTyCoVarsOfTypes"><a href="TcType.html#exactTyCoVarsOfTypes"><span class="hs-identifier">exactTyCoVarsOfTypes</span></a></a><span> </span><a name="local-6989586621679592503"><a href="#local-6989586621679592503"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#mapUnionVarSet"><span class="hs-identifier hs-var">mapUnionVarSet</span></a><span> </span><a href="TcType.html#exactTyCoVarsOfType"><span class="hs-identifier hs-var">exactTyCoVarsOfType</span></a><span> </span><a href="#local-6989586621679592503"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-930"></a><span>
</span><a name="line-931"></a><span class="hs-identifier">anyRewritableTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>    </span><span class="hs-comment">-- Ignore casts and coercions</span><span>
</span><a name="line-932"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a><span>   </span><span class="hs-comment">-- Ambient role</span><span>
</span><a name="line-933"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Type.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-934"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-935"></a><span class="hs-comment">-- (anyRewritableTyVar ignore_cos pred ty) returns True</span><span>
</span><a name="line-936"></a><span class="hs-comment">--    if the 'pred' returns True of any free TyVar in 'ty'</span><span>
</span><a name="line-937"></a><span class="hs-comment">-- Do not look inside casts and coercions if 'ignore_cos' is True</span><span>
</span><a name="line-938"></a><span class="hs-comment">-- See Note [anyRewritableTyVar must be role-aware]</span><span>
</span><a name="line-939"></a><a name="anyRewritableTyVar"><a href="TcType.html#anyRewritableTyVar"><span class="hs-identifier">anyRewritableTyVar</span></a></a><span> </span><a name="local-6989586621679592504"><a href="#local-6989586621679592504"><span class="hs-identifier">ignore_cos</span></a></a><span> </span><a name="local-6989586621679592505"><a href="#local-6989586621679592505"><span class="hs-identifier">role</span></a></a><span> </span><a name="local-6989586621679592506"><a href="#local-6989586621679592506"><span class="hs-identifier">pred</span></a></a><span> </span><a name="local-6989586621679592507"><a href="#local-6989586621679592507"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-940"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592509"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592505"><span class="hs-identifier hs-var">role</span></a><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span> </span><a href="#local-6989586621679592507"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-941"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-942"></a><span>    </span><a name="local-6989586621679592508"><a href="#local-6989586621679592508"><span class="hs-identifier">go_tv</span></a></a><span> </span><a name="local-6989586621679592513"><a href="#local-6989586621679592513"><span class="hs-identifier">rl</span></a></a><span> </span><a name="local-6989586621679592514"><a href="#local-6989586621679592514"><span class="hs-identifier">bvs</span></a></a><span> </span><a name="local-6989586621679592515"><a href="#local-6989586621679592515"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679592515"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592514"><span class="hs-identifier hs-var">bvs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-943"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592506"><span class="hs-identifier hs-var">pred</span></a><span> </span><a href="#local-6989586621679592513"><span class="hs-identifier hs-var">rl</span></a><span> </span><a href="#local-6989586621679592515"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-944"></a><span>
</span><a name="line-945"></a><span>    </span><a name="local-6989586621679592509"><a href="#local-6989586621679592509"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679592516"><a href="#local-6989586621679592516"><span class="hs-identifier">rl</span></a></a><span> </span><a name="local-6989586621679592517"><a href="#local-6989586621679592517"><span class="hs-identifier">bvs</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621679592518"><a href="#local-6989586621679592518"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592508"><span class="hs-identifier hs-var">go_tv</span></a><span> </span><a href="#local-6989586621679592516"><span class="hs-identifier hs-var">rl</span></a><span> </span><a href="#local-6989586621679592517"><span class="hs-identifier hs-var">bvs</span></a><span> </span><a href="#local-6989586621679592518"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-946"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-947"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592519"><a href="#local-6989586621679592519"><span class="hs-identifier">rl</span></a></a><span> </span><a name="local-6989586621679592520"><a href="#local-6989586621679592520"><span class="hs-identifier">bvs</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621679592521"><a href="#local-6989586621679592521"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679592522"><a href="#local-6989586621679592522"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592510"><span class="hs-identifier hs-var">go_tc</span></a><span> </span><a href="#local-6989586621679592519"><span class="hs-identifier hs-var">rl</span></a><span> </span><a href="#local-6989586621679592520"><span class="hs-identifier hs-var">bvs</span></a><span> </span><a href="#local-6989586621679592521"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679592522"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-948"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592523"><a href="#local-6989586621679592523"><span class="hs-identifier">rl</span></a></a><span> </span><a name="local-6989586621679592524"><a href="#local-6989586621679592524"><span class="hs-identifier">bvs</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621679592525"><a href="#local-6989586621679592525"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621679592526"><a href="#local-6989586621679592526"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592509"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592523"><span class="hs-identifier hs-var">rl</span></a><span> </span><a href="#local-6989586621679592524"><span class="hs-identifier hs-var">bvs</span></a><span> </span><a href="#local-6989586621679592525"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679592509"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span> </span><a href="#local-6989586621679592524"><span class="hs-identifier hs-var">bvs</span></a><span> </span><a href="#local-6989586621679592526"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-949"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592527"><a href="#local-6989586621679592527"><span class="hs-identifier">rl</span></a></a><span> </span><a name="local-6989586621679592528"><a href="#local-6989586621679592528"><span class="hs-identifier">bvs</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679592529"><a href="#local-6989586621679592529"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679592530"><a href="#local-6989586621679592530"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592509"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592527"><span class="hs-identifier hs-var">rl</span></a><span> </span><a href="#local-6989586621679592528"><span class="hs-identifier hs-var">bvs</span></a><span> </span><a href="#local-6989586621679592529"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679592509"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592527"><span class="hs-identifier hs-var">rl</span></a><span> </span><a href="#local-6989586621679592528"><span class="hs-identifier hs-var">bvs</span></a><span> </span><a href="#local-6989586621679592530"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-950"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592531"><a href="#local-6989586621679592531"><span class="hs-identifier">rl</span></a></a><span> </span><a name="local-6989586621679592532"><a href="#local-6989586621679592532"><span class="hs-identifier">bvs</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><a name="local-6989586621679592533"><a href="#local-6989586621679592533"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679592534"><a href="#local-6989586621679592534"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592509"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592531"><span class="hs-identifier hs-var">rl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592532"><span class="hs-identifier hs-var">bvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#extendVarSet"><span class="hs-identifier hs-var">extendVarSet</span></a><span class="hs-special">`</span><span> </span><a href="Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a><span> </span><a href="#local-6989586621679592533"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592534"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-951"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592535"><a href="#local-6989586621679592535"><span class="hs-identifier">rl</span></a></a><span> </span><a name="local-6989586621679592536"><a href="#local-6989586621679592536"><span class="hs-identifier">bvs</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621679592537"><a href="#local-6989586621679592537"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679592538"><a href="#local-6989586621679592538"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592509"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592535"><span class="hs-identifier hs-var">rl</span></a><span> </span><a href="#local-6989586621679592536"><span class="hs-identifier hs-var">bvs</span></a><span> </span><a href="#local-6989586621679592537"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679592512"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621679592535"><span class="hs-identifier hs-var">rl</span></a><span> </span><a href="#local-6989586621679592536"><span class="hs-identifier hs-var">bvs</span></a><span> </span><a href="#local-6989586621679592538"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-952"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592539"><a href="#local-6989586621679592539"><span class="hs-identifier">rl</span></a></a><span> </span><a name="local-6989586621679592540"><a href="#local-6989586621679592540"><span class="hs-identifier">bvs</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-6989586621679592541"><a href="#local-6989586621679592541"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592512"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621679592539"><span class="hs-identifier hs-var">rl</span></a><span> </span><a href="#local-6989586621679592540"><span class="hs-identifier hs-var">bvs</span></a><span> </span><a href="#local-6989586621679592541"><span class="hs-identifier hs-var">co</span></a><span>  </span><span class="hs-comment">-- ToDo: check</span><span>
</span><a name="line-953"></a><span>
</span><a name="line-954"></a><span>    </span><a name="local-6989586621679592510"><a href="#local-6989586621679592510"><span class="hs-identifier">go_tc</span></a></a><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span>  </span><a name="local-6989586621679592542"><a href="#local-6989586621679592542"><span class="hs-identifier">bvs</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><a name="local-6989586621679592543"><a href="#local-6989586621679592543"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592509"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span> </span><a href="#local-6989586621679592542"><span class="hs-identifier hs-var">bvs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592543"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-955"></a><span>    </span><span class="hs-identifier">go_tc</span><span> </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span> </span><a name="local-6989586621679592544"><a href="#local-6989586621679592544"><span class="hs-identifier">bvs</span></a></a><span> </span><a name="local-6989586621679592545"><a href="#local-6989586621679592545"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679592546"><a href="#local-6989586621679592546"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&amp;&amp;</span><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-6989586621679592511"><span class="hs-identifier hs-var">go_arg</span></a><span> </span><a href="#local-6989586621679592544"><span class="hs-identifier hs-var">bvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-956"></a><span>                              </span><span class="hs-special">(</span><a href="Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a><span> </span><a href="#local-6989586621679592545"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592546"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-957"></a><span>
</span><a name="line-958"></a><span>    </span><a name="local-6989586621679592511"><a href="#local-6989586621679592511"><span class="hs-identifier">go_arg</span></a></a><span> </span><a name="local-6989586621679592547"><a href="#local-6989586621679592547"><span class="hs-identifier">bvs</span></a></a><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">,</span><span>          </span><a name="local-6989586621679592548"><a href="#local-6989586621679592548"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592509"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span>  </span><a href="#local-6989586621679592547"><span class="hs-identifier hs-var">bvs</span></a><span> </span><a href="#local-6989586621679592548"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-959"></a><span>    </span><span class="hs-identifier">go_arg</span><span> </span><a name="local-6989586621679592549"><a href="#local-6989586621679592549"><span class="hs-identifier">bvs</span></a></a><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592550"><a href="#local-6989586621679592550"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592509"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span> </span><a href="#local-6989586621679592549"><span class="hs-identifier hs-var">bvs</span></a><span> </span><a href="#local-6989586621679592550"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-960"></a><span>    </span><span class="hs-identifier">go_arg</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">(</span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span class="hs-special">,</span><span>          </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>  </span><span class="hs-comment">-- We never rewrite with phantoms</span><span>
</span><a name="line-961"></a><span>
</span><a name="line-962"></a><span>    </span><a name="local-6989586621679592512"><a href="#local-6989586621679592512"><span class="hs-identifier">go_co</span></a></a><span> </span><a name="local-6989586621679592551"><a href="#local-6989586621679592551"><span class="hs-identifier">rl</span></a></a><span> </span><a name="local-6989586621679592552"><a href="#local-6989586621679592552"><span class="hs-identifier">bvs</span></a></a><span> </span><a name="local-6989586621679592553"><a href="#local-6989586621679592553"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-963"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679592504"><span class="hs-identifier hs-var">ignore_cos</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-964"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#anyVarSet"><span class="hs-identifier hs-var">anyVarSet</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592508"><span class="hs-identifier hs-var">go_tv</span></a><span> </span><a href="#local-6989586621679592551"><span class="hs-identifier hs-var">rl</span></a><span> </span><a href="#local-6989586621679592552"><span class="hs-identifier hs-var">bvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a><span> </span><a href="#local-6989586621679592553"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-965"></a><span>      </span><span class="hs-comment">-- We don't have an equivalent of anyRewritableTyVar for coercions</span><span>
</span><a name="line-966"></a><span>      </span><span class="hs-comment">-- (at least not yet) so take the free vars and test them</span><span>
</span><a name="line-967"></a><span>
</span><a name="line-968"></a><span class="hs-comment">{- Note [anyRewritableTyVar must be role-aware]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
anyRewritableTyVar is used during kick-out from the inert set,
to decide if, given a new equality (a ~ ty), we should kick out
a constraint C.  Rather than gather free variables and see if 'a'
is among them, we instead pass in a predicate; this is just efficiency.

Moreover, consider
  work item:   [G] a ~R f b
  inert item:  [G] b ~R f a
We use anyRewritableTyVar to decide whether to kick out the inert item,
on the grounds that the work item might rewrite it. Well, 'a' is certainly
free in [G] b ~R f a.  But because the role of a type variable ('f' in
this case) is nominal, the work item can't actually rewrite the inert item.
Moreover, if we were to kick out the inert item the exact same situation
would re-occur and we end up with an infinite loop in which each kicks
out the other (Trac #14363).
-}</span><span>
</span><a name="line-986"></a><span>
</span><a name="line-987"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
          Bound variables in a type
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-992"></a><span>
</span><a name="line-993"></a><span class="hs-comment">-- | Find all variables bound anywhere in a type.</span><span>
</span><a name="line-994"></a><span class="hs-comment">-- See also Note [Scope-check inferred kinds] in TcHsType</span><span>
</span><a name="line-995"></a><span class="hs-identifier">allBoundVariables</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a><span>
</span><a name="line-996"></a><a name="allBoundVariables"><a href="TcType.html#allBoundVariables"><span class="hs-identifier">allBoundVariables</span></a></a><span> </span><a name="local-6989586621679592554"><a href="#local-6989586621679592554"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#fvVarSet"><span class="hs-identifier hs-var">fvVarSet</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679592555"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592554"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-997"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-998"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FV.html#FV"><span class="hs-identifier hs-type">FV</span></a><span>
</span><a name="line-999"></a><span>    </span><a name="local-6989586621679592555"><a href="#local-6989586621679592555"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621679592556"><a href="#local-6989586621679592556"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592555"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679592556"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1000"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679592557"><a href="#local-6989586621679592557"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#mapUnionFV"><span class="hs-identifier hs-var">mapUnionFV</span></a><span> </span><a href="#local-6989586621679592555"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592557"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1001"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621679592558"><a href="#local-6989586621679592558"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679592559"><a href="#local-6989586621679592559"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592555"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592558"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">`</span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">unionFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592555"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592559"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1002"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679592560"><a href="#local-6989586621679592560"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679592561"><a href="#local-6989586621679592561"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592555"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592560"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">`</span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">unionFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592555"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592561"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1003"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TvBndr"><span class="hs-identifier hs-var">TvBndr</span></a><span> </span><a name="local-6989586621679592562"><a href="#local-6989586621679592562"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679592563"><a href="#local-6989586621679592563"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#unitFV"><span class="hs-identifier hs-var">FV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unitFV</span></a><span> </span><a href="#local-6989586621679592562"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">unionFV</span></a><span class="hs-special">`</span><span>
</span><a name="line-1004"></a><span>                                    </span><a href="#local-6989586621679592555"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679592562"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">unionFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592555"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592563"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1005"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#emptyFV"><span class="hs-identifier hs-var">emptyFV</span></a><span>
</span><a name="line-1006"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621679592564"><a href="#local-6989586621679592564"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592555"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592564"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1007"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#emptyFV"><span class="hs-identifier hs-var">emptyFV</span></a><span>
</span><a name="line-1008"></a><span>      </span><span class="hs-comment">-- any types mentioned in a coercion should also be mentioned in</span><span>
</span><a name="line-1009"></a><span>      </span><span class="hs-comment">-- a type.</span><span>
</span><a name="line-1010"></a><span>
</span><a name="line-1011"></a><span class="hs-identifier">allBoundVariabless</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a><span>
</span><a name="line-1012"></a><a name="allBoundVariabless"><a href="TcType.html#allBoundVariabless"><span class="hs-identifier">allBoundVariabless</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#mapUnionVarSet"><span class="hs-identifier hs-var">mapUnionVarSet</span></a><span> </span><a href="TcType.html#allBoundVariables"><span class="hs-identifier hs-var">allBoundVariables</span></a><span>
</span><a name="line-1013"></a><span>
</span><a name="line-1014"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
          Type and kind variables in a type
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-1019"></a><span>
</span><a name="line-1020"></a><span class="hs-keyword">data</span><span> </span><a name="CandidatesQTvs"><a href="TcType.html#CandidatesQTvs"><span class="hs-identifier">CandidatesQTvs</span></a></a><span>  </span><span class="hs-comment">-- See Note [Dependent type variables]</span><span>
</span><a name="line-1021"></a><span>                     </span><span class="hs-comment">-- See Note [CandidatesQTvs determinism]</span><span>
</span><a name="line-1022"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="DV"><a href="TcType.html#DV"><span class="hs-identifier">DV</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="dv_kvs"><a href="TcType.html#dv_kvs"><span class="hs-identifier">dv_kvs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#DTyCoVarSet"><span class="hs-identifier hs-type">DTyCoVarSet</span></a><span>  </span><span class="hs-comment">-- &quot;kind&quot; variables (dependent)</span><span>
</span><a name="line-1023"></a><span>       </span><span class="hs-special">,</span><span> </span><a name="dv_tvs"><a href="TcType.html#dv_tvs"><span class="hs-identifier">dv_tvs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#DTyVarSet"><span class="hs-identifier hs-type">DTyVarSet</span></a><span>    </span><span class="hs-comment">-- &quot;type&quot; variables (non-dependent)</span><span>
</span><a name="line-1024"></a><span>         </span><span class="hs-comment">-- A variable may appear in both sets</span><span>
</span><a name="line-1025"></a><span>         </span><span class="hs-comment">-- E.g.   T k (x::k)    The first occurrence of k makes it</span><span>
</span><a name="line-1026"></a><span>         </span><span class="hs-comment">--                      show up in dv_tvs, the second in dv_kvs</span><span>
</span><a name="line-1027"></a><span>         </span><span class="hs-comment">-- See Note [Dependent type variables]</span><span>
</span><a name="line-1028"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1029"></a><span>
</span><a name="line-1030"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Semigroup"><span class="hs-identifier hs-type">Semi</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Semigroup</span></a><span> </span><a href="TcType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1031"></a><span>   </span><span class="hs-special">(</span><a href="TcType.html#DV"><span class="hs-identifier hs-var">DV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dv_kvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592394"><a href="#local-6989586621679592394"><span class="hs-identifier">kv1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dv_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592395"><a href="#local-6989586621679592395"><span class="hs-identifier">tv1</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-3458764513820541482"><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%3E"><span class="hs-operator">&lt;&gt;</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#DV"><span class="hs-identifier hs-var">DV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dv_kvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592396"><a href="#local-6989586621679592396"><span class="hs-identifier">kv2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dv_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592397"><a href="#local-6989586621679592397"><span class="hs-identifier">tv2</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1032"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#DV"><span class="hs-identifier hs-var">DV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dv_kvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592394"><span class="hs-identifier hs-var">kv1</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionDVarSet"><span class="hs-identifier hs-var">unionDVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592396"><span class="hs-identifier hs-var">kv2</span></a><span>
</span><a name="line-1033"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dv_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592395"><span class="hs-identifier hs-var">tv1</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionDVarSet"><span class="hs-identifier hs-var">unionDVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592397"><span class="hs-identifier hs-var">tv2</span></a><span class="hs-special">}</span><span>
</span><a name="line-1034"></a><span>
</span><a name="line-1035"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Monoid"><span class="hs-identifier hs-type">Monoid</span></a><span> </span><a href="TcType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1036"></a><span>   </span><a name="local-3458764513820541483"><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mempty"><span class="hs-identifier">mempty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#DV"><span class="hs-identifier hs-var">DV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dv_kvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#emptyDVarSet"><span class="hs-identifier hs-var">emptyDVarSet</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dv_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#emptyDVarSet"><span class="hs-identifier hs-var">emptyDVarSet</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1037"></a><span>   </span><a name="local-3458764513820541484"><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mappend"><span class="hs-identifier">mappend</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3C%3E"><span class="hs-identifier hs-var">Semi</span><span class="hs-operator hs-var">.&lt;&gt;</span></a><span class="hs-special">)</span><span>
</span><a name="line-1038"></a><span>
</span><a name="line-1039"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1040"></a><span>  </span><a name="local-8214565720323905585"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#DV"><span class="hs-identifier hs-var">DV</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">dv_kvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592392"><a href="#local-6989586621679592392"><span class="hs-identifier">kvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dv_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592393"><a href="#local-6989586621679592393"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1041"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;DV&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;dv_kvs =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592392"><span class="hs-identifier hs-var">kvs</span></a><span>
</span><a name="line-1042"></a><span>                                </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;dv_tvs =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592393"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1043"></a><span>
</span><a name="line-1044"></a><span class="hs-comment">{- Note [Dependent type variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In Haskell type inference we quantify over type variables; but we only
quantify over /kind/ variables when -XPolyKinds is on.  Without -XPolyKinds
we default the kind variables to *.

So, to support this defaulting, and only for that reason, when
collecting the free vars of a type, prior to quantifying, we must keep
the type and kind variables separate.

But what does that mean in a system where kind variables /are/ type
variables? It's a fairly arbitrary distinction based on how the
variables appear:

  - &quot;Kind variables&quot; appear in the kind of some other free variable
     PLUS any free coercion variables

     These are the ones we default to * if -XPolyKinds is off

  - &quot;Type variables&quot; are all free vars that are not kind variables

E.g.  In the type    T k (a::k)
      'k' is a kind variable, because it occurs in the kind of 'a',
          even though it also appears at &quot;top level&quot; of the type
      'a' is a type variable, because it doesn't

We gather these variables using a CandidatesQTvs record:
  DV { dv_kvs: Variables free in the kind of a free type variable
               or of a forall-bound type variable
     , dv_tvs: Variables sytactically free in the type }

So:  dv_kvs            are the kind variables of the type
     (dv_tvs - dv_kvs) are the type variable of the type

Note that

* A variable can occur in both.
      T k (x::k)    The first occurrence of k makes it
                    show up in dv_tvs, the second in dv_kvs

* We include any coercion variables in the &quot;dependent&quot;,
  &quot;kind-variable&quot; set because we never quantify over them.

* Both sets are un-ordered, of course.

* The &quot;kind variables&quot; might depend on each other; e.g
     (k1 :: k2), (k2 :: *)
  The &quot;type variables&quot; do not depend on each other; if
  one did, it'd be classified as a kind variable!

Note [CandidatesQTvs determinism and order]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* Determinism: when we quantify over type variables we decide the
  order in which they appear in the final type. Because the order of
  type variables in the type can end up in the interface file and
  affects some optimizations like worker-wrapper, we want this order to
  be deterministic.

  To achieve that we use deterministic sets of variables that can be
  converted to lists in a deterministic order. For more information
  about deterministic sets see Note [Deterministic UniqFM] in UniqDFM.

* Order: as well as being deterministic, we use an
  accumulating-parameter style for candidateQTyVarsOfType so that we
  add variables one at a time, left to right.  That means we tend to
  produce the variables in left-to-right order.  This is just to make
  it bit more predicatable for the programmer.
-}</span><span>
</span><a name="line-1112"></a><span>
</span><a name="line-1113"></a><span class="hs-comment">-- | Worker for 'splitDepVarsOfType'. This might output the same var</span><span>
</span><a name="line-1114"></a><span class="hs-comment">-- in both sets, if it's used in both a type and a kind.</span><span>
</span><a name="line-1115"></a><span class="hs-comment">-- See Note [CandidatesQTvs determinism and order]</span><span>
</span><a name="line-1116"></a><span class="hs-comment">-- See Note [Dependent type variables]</span><span>
</span><a name="line-1117"></a><span class="hs-identifier">candidateQTyVarsOfType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a><span>
</span><a name="line-1118"></a><a name="candidateQTyVarsOfType"><a href="TcType.html#candidateQTyVarsOfType"><span class="hs-identifier">candidateQTyVarsOfType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#split_dvs"><span class="hs-identifier hs-var">split_dvs</span></a><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a><span>
</span><a name="line-1119"></a><span>
</span><a name="line-1120"></a><span class="hs-identifier">split_dvs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a><span>
</span><a name="line-1121"></a><a name="split_dvs"><a href="TcType.html#split_dvs"><span class="hs-identifier">split_dvs</span></a></a><span> </span><a name="local-6989586621679592565"><a href="#local-6989586621679592565"><span class="hs-identifier">bound</span></a></a><span> </span><a name="local-6989586621679592566"><a href="#local-6989586621679592566"><span class="hs-identifier">dvs</span></a></a><span> </span><a name="local-6989586621679592567"><a href="#local-6989586621679592567"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1122"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592568"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592566"><span class="hs-identifier hs-var">dvs</span></a><span> </span><a href="#local-6989586621679592567"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1123"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1124"></a><span>    </span><a name="local-6989586621679592568"><a href="#local-6989586621679592568"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679592571"><a href="#local-6989586621679592571"><span class="hs-identifier">dv</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621679592572"><a href="#local-6989586621679592572"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679592573"><a href="#local-6989586621679592573"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592568"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592568"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592571"><span class="hs-identifier hs-var">dv</span></a><span> </span><a href="#local-6989586621679592572"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592573"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1125"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592574"><a href="#local-6989586621679592574"><span class="hs-identifier">dv</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679592575"><a href="#local-6989586621679592575"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a><span> </span><a href="#local-6989586621679592568"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592574"><span class="hs-identifier hs-var">dv</span></a><span> </span><a href="#local-6989586621679592575"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1126"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592576"><a href="#local-6989586621679592576"><span class="hs-identifier">dv</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679592577"><a href="#local-6989586621679592577"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679592578"><a href="#local-6989586621679592578"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592568"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592568"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592576"><span class="hs-identifier hs-var">dv</span></a><span> </span><a href="#local-6989586621679592577"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592578"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-1127"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592579"><a href="#local-6989586621679592579"><span class="hs-identifier">dv</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592579"><span class="hs-identifier hs-var">dv</span></a><span>
</span><a name="line-1128"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592580"><a href="#local-6989586621679592580"><span class="hs-identifier">dv</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621679592581"><a href="#local-6989586621679592581"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679592582"><a href="#local-6989586621679592582"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592568"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592580"><span class="hs-identifier hs-var">dv</span></a><span> </span><a href="#local-6989586621679592581"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mappend"><span class="hs-identifier hs-var">mappend</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592569"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621679592582"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1129"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592583"><a href="#local-6989586621679592583"><span class="hs-identifier">dv</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-6989586621679592584"><a href="#local-6989586621679592584"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592583"><span class="hs-identifier hs-var">dv</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mappend"><span class="hs-identifier hs-var">mappend</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592569"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621679592584"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1130"></a><span>
</span><a name="line-1131"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592585"><a href="#local-6989586621679592585"><span class="hs-identifier">dv</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcType.html#DV"><span class="hs-identifier hs-var">DV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dv_kvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592586"><a href="#local-6989586621679592586"><span class="hs-identifier">kvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dv_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592587"><a href="#local-6989586621679592587"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621679592588"><a href="#local-6989586621679592588"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1132"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679592588"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592565"><span class="hs-identifier hs-var">bound</span></a><span>
</span><a name="line-1133"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592585"><span class="hs-identifier hs-var">dv</span></a><span>
</span><a name="line-1134"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1135"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#DV"><span class="hs-identifier hs-var">DV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dv_kvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592586"><span class="hs-identifier hs-var">kvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionDVarSet"><span class="hs-identifier hs-var">unionDVarSet</span></a><span class="hs-special">`</span><span>
</span><a name="line-1136"></a><span>                      </span><a href="#local-6989586621679592570"><span class="hs-identifier hs-var">kill_bound</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypeDSet"><span class="hs-identifier hs-var">tyCoVarsOfTypeDSet</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679592588"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1137"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dv_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592587"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#extendDVarSet"><span class="hs-identifier hs-var">extendDVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592588"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1138"></a><span>
</span><a name="line-1139"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592589"><a href="#local-6989586621679592589"><span class="hs-identifier">dv</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TvBndr"><span class="hs-identifier hs-var">TvBndr</span></a><span> </span><a name="local-6989586621679592590"><a href="#local-6989586621679592590"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679592591"><a href="#local-6989586621679592591"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1140"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#DV"><span class="hs-identifier hs-var">DV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dv_kvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592592"><span class="hs-identifier hs-var">kvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionDVarSet"><span class="hs-identifier hs-var">unionDVarSet</span></a><span class="hs-special">`</span><span>
</span><a name="line-1141"></a><span>                      </span><a href="#local-6989586621679592570"><span class="hs-identifier hs-var">kill_bound</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypeDSet"><span class="hs-identifier hs-var">tyCoVarsOfTypeDSet</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679592590"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1142"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dv_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592593"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1143"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1144"></a><span>        </span><a href="TcType.html#DV"><span class="hs-identifier hs-var">DV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dv_kvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592592"><a href="#local-6989586621679592592"><span class="hs-identifier">kvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dv_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592593"><a href="#local-6989586621679592593"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#split_dvs"><span class="hs-identifier hs-var">split_dvs</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592565"><span class="hs-identifier hs-var">bound</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#extendVarSet"><span class="hs-identifier hs-var">extendVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592590"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592589"><span class="hs-identifier hs-var">dv</span></a><span> </span><a href="#local-6989586621679592591"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1145"></a><span>
</span><a name="line-1146"></a><span>    </span><a name="local-6989586621679592569"><a href="#local-6989586621679592569"><span class="hs-identifier">go_co</span></a></a><span> </span><a name="local-6989586621679592594"><a href="#local-6989586621679592594"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#DV"><span class="hs-identifier hs-var">DV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dv_kvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592570"><span class="hs-identifier hs-var">kill_bound</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfCoDSet"><span class="hs-identifier hs-var">tyCoVarsOfCoDSet</span></a><span> </span><a href="#local-6989586621679592594"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1147"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dv_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#emptyDVarSet"><span class="hs-identifier hs-var">emptyDVarSet</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1148"></a><span>
</span><a name="line-1149"></a><span>    </span><a name="local-6989586621679592570"><a href="#local-6989586621679592570"><span class="hs-identifier">kill_bound</span></a></a><span> </span><a name="local-6989586621679592595"><a href="#local-6989586621679592595"><span class="hs-identifier">free</span></a></a><span>
</span><a name="line-1150"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="VarSet.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a><span> </span><a href="#local-6989586621679592565"><span class="hs-identifier hs-var">bound</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592595"><span class="hs-identifier hs-var">free</span></a><span>
</span><a name="line-1151"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592595"><span class="hs-identifier hs-var">free</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#dVarSetMinusVarSet"><span class="hs-identifier hs-var">dVarSetMinusVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592565"><span class="hs-identifier hs-var">bound</span></a><span>
</span><a name="line-1152"></a><span>
</span><a name="line-1153"></a><span class="hs-comment">-- | Like 'splitDepVarsOfType', but over a list of types</span><span>
</span><a name="line-1154"></a><span class="hs-identifier">candidateQTyVarsOfTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a><span>
</span><a name="line-1155"></a><a name="candidateQTyVarsOfTypes"><a href="TcType.html#candidateQTyVarsOfTypes"><span class="hs-identifier">candidateQTyVarsOfTypes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#split_dvs"><span class="hs-identifier hs-var">split_dvs</span></a><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a><span>
</span><a name="line-1156"></a><span>
</span><a name="line-1157"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Predicates
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1164"></a><span>
</span><a name="line-1165"></a><span class="hs-identifier">tcIsTcTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1166"></a><span class="hs-comment">-- See Note [TcTyVars in the typechecker]</span><span>
</span><a name="line-1167"></a><a name="tcIsTcTyVar"><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier">tcIsTcTyVar</span></a></a><span> </span><a name="local-6989586621679592596"><a href="#local-6989586621679592596"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-6989586621679592596"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1168"></a><span>
</span><a name="line-1169"></a><span class="hs-identifier">isTouchableOrFmv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1170"></a><a name="isTouchableOrFmv"><a href="TcType.html#isTouchableOrFmv"><span class="hs-identifier">isTouchableOrFmv</span></a></a><span> </span><a name="local-6989586621679592597"><a href="#local-6989586621679592597"><span class="hs-identifier">ctxt_tclvl</span></a></a><span> </span><a name="local-6989586621679592598"><a href="#local-6989586621679592598"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1171"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tcIsTcTyVar</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">,</span><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1172"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592598"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1173"></a><span>      </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_tclvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592599"><a href="#local-6989586621679592599"><span class="hs-identifier">tv_tclvl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">mtv_info</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592600"><a href="#local-6989586621679592600"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1174"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">checkTcLevelInvariant</span><span> </span><a href="TcType.html#checkTcLevelInvariant"><span class="hs-identifier hs-var">ctxt_tclvl</span></a><span> </span><span class="hs-identifier">tv_tclvl</span><span class="hs-special">,</span><span>
</span><a name="line-1175"></a><span>                    </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tv</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tv_tclvl</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ctxt_tclvl</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1176"></a><span>           </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679592600"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1177"></a><span>             </span><a href="TcType.html#FlatMetaTv"><span class="hs-identifier hs-var">FlatMetaTv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1178"></a><span>             </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592599"><span class="hs-identifier hs-var">tv_tclvl</span></a><span> </span><span class="hs-special">`</span><a href="TcType.html#sameDepthAs"><span class="hs-identifier hs-var">sameDepthAs</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592597"><span class="hs-identifier hs-var">ctxt_tclvl</span></a><span>
</span><a name="line-1179"></a><span>      </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1180"></a><span>
</span><a name="line-1181"></a><span class="hs-identifier">isTouchableMetaTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1182"></a><a name="isTouchableMetaTyVar"><a href="TcType.html#isTouchableMetaTyVar"><span class="hs-identifier">isTouchableMetaTyVar</span></a></a><span> </span><a name="local-6989586621679592601"><a href="#local-6989586621679592601"><span class="hs-identifier">ctxt_tclvl</span></a></a><span> </span><a name="local-6989586621679592602"><a href="#local-6989586621679592602"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1183"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-6989586621679592602"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-comment">-- See Note [Coercion variables in free variable lists]</span><span>
</span><a name="line-1184"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tcIsTcTyVar</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">,</span><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1185"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592602"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1186"></a><span>      </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_tclvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592603"><a href="#local-6989586621679592603"><span class="hs-identifier">tv_tclvl</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1187"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">checkTcLevelInvariant</span><span> </span><a href="TcType.html#checkTcLevelInvariant"><span class="hs-identifier hs-var">ctxt_tclvl</span></a><span> </span><span class="hs-identifier">tv_tclvl</span><span class="hs-special">,</span><span>
</span><a name="line-1188"></a><span>                    </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tv</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tv_tclvl</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ctxt_tclvl</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1189"></a><span>           </span><a href="#local-6989586621679592603"><span class="hs-identifier hs-var">tv_tclvl</span></a><span> </span><span class="hs-special">`</span><a href="TcType.html#sameDepthAs"><span class="hs-identifier hs-var">sameDepthAs</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592601"><span class="hs-identifier hs-var">ctxt_tclvl</span></a><span>
</span><a name="line-1190"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1191"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1192"></a><span>
</span><a name="line-1193"></a><span class="hs-identifier">isFloatedTouchableMetaTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1194"></a><a name="isFloatedTouchableMetaTyVar"><a href="TcType.html#isFloatedTouchableMetaTyVar"><span class="hs-identifier">isFloatedTouchableMetaTyVar</span></a></a><span> </span><a name="local-6989586621679592604"><a href="#local-6989586621679592604"><span class="hs-identifier">ctxt_tclvl</span></a></a><span> </span><a name="local-6989586621679592605"><a href="#local-6989586621679592605"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1195"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-6989586621679592605"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-comment">-- See Note [Coercion variables in free variable lists]</span><span>
</span><a name="line-1196"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tcIsTcTyVar</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">,</span><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1197"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592605"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1198"></a><span>      </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_tclvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592606"><a href="#local-6989586621679592606"><span class="hs-identifier">tv_tclvl</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592606"><span class="hs-identifier hs-var">tv_tclvl</span></a><span> </span><span class="hs-special">`</span><a href="TcType.html#strictlyDeeperThan"><span class="hs-identifier hs-var">strictlyDeeperThan</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592604"><span class="hs-identifier hs-var">ctxt_tclvl</span></a><span>
</span><a name="line-1199"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1200"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1201"></a><span>
</span><a name="line-1202"></a><span class="hs-identifier">isImmutableTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1203"></a><a name="isImmutableTyVar"><a href="TcType.html#isImmutableTyVar"><span class="hs-identifier">isImmutableTyVar</span></a></a><span> </span><a name="local-6989586621679592607"><a href="#local-6989586621679592607"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#isSkolemTyVar"><span class="hs-identifier hs-var">isSkolemTyVar</span></a><span> </span><a href="#local-6989586621679592607"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1204"></a><span>
</span><a name="line-1205"></a><span class="hs-identifier">isTyConableTyVar</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isSkolemTyVar</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isOverlappableTyVar</span><span class="hs-special">,</span><span>
</span><a name="line-1206"></a><span>  </span><span class="hs-identifier">isMetaTyVar</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isAmbiguousTyVar</span><span class="hs-special">,</span><span>
</span><a name="line-1207"></a><span>  </span><span class="hs-identifier">isFmvTyVar</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isFskTyVar</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isFlattenTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1208"></a><span>
</span><a name="line-1209"></a><a name="isTyConableTyVar"><a href="TcType.html#isTyConableTyVar"><span class="hs-identifier">isTyConableTyVar</span></a></a><span> </span><a name="local-6989586621679592608"><a href="#local-6989586621679592608"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1210"></a><span>        </span><span class="hs-comment">-- True of a meta-type variable that can be filled in</span><span>
</span><a name="line-1211"></a><span>        </span><span class="hs-comment">-- with a type constructor application; in particular,</span><span>
</span><a name="line-1212"></a><span>        </span><span class="hs-comment">-- not a SigTv</span><span>
</span><a name="line-1213"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-6989586621679592608"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-comment">-- See Note [Coercion variables in free variable lists]</span><span>
</span><a name="line-1214"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tcIsTcTyVar</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">,</span><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1215"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592608"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1216"></a><span>        </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_info</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#SigTv"><span class="hs-identifier hs-var">SigTv</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1217"></a><span>        </span><span class="hs-identifier">_</span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1218"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1219"></a><span>
</span><a name="line-1220"></a><a name="isFmvTyVar"><a href="TcType.html#isFmvTyVar"><span class="hs-identifier">isFmvTyVar</span></a></a><span> </span><a name="local-6989586621679592609"><a href="#local-6989586621679592609"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1221"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tcIsTcTyVar</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">,</span><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1222"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592609"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1223"></a><span>        </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_info</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#FlatMetaTv"><span class="hs-identifier hs-var">FlatMetaTv</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1224"></a><span>        </span><span class="hs-identifier">_</span><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1225"></a><span>
</span><a name="line-1226"></a><a name="isFskTyVar"><a href="TcType.html#isFskTyVar"><span class="hs-identifier">isFskTyVar</span></a></a><span> </span><a name="local-6989586621679592610"><a href="#local-6989586621679592610"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1227"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tcIsTcTyVar</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">,</span><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1228"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592610"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1229"></a><span>        </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_info</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#FlatSkolTv"><span class="hs-identifier hs-var">FlatSkolTv</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1230"></a><span>        </span><span class="hs-identifier">_</span><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1231"></a><span>
</span><a name="line-1232"></a><span class="hs-comment">-- | True of both given and wanted flatten-skolems (fak and usk)</span><span>
</span><a name="line-1233"></a><a name="isFlattenTyVar"><a href="TcType.html#isFlattenTyVar"><span class="hs-identifier">isFlattenTyVar</span></a></a><span> </span><a name="local-6989586621679592611"><a href="#local-6989586621679592611"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1234"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#isFmvTyVar"><span class="hs-identifier hs-var">isFmvTyVar</span></a><span> </span><a href="#local-6989586621679592611"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="TcType.html#isFskTyVar"><span class="hs-identifier hs-var">isFskTyVar</span></a><span> </span><a href="#local-6989586621679592611"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1235"></a><span>
</span><a name="line-1236"></a><a name="isSkolemTyVar"><a href="TcType.html#isSkolemTyVar"><span class="hs-identifier">isSkolemTyVar</span></a></a><span> </span><a name="local-6989586621679592612"><a href="#local-6989586621679592612"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1237"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tcIsTcTyVar</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">,</span><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1238"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592612"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1239"></a><span>        </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1240"></a><span>        </span><a name="local-6989586621679592613"><a href="#local-6989586621679592613"><span class="hs-identifier">_other</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1241"></a><span>
</span><a name="line-1242"></a><a name="isOverlappableTyVar"><a href="TcType.html#isOverlappableTyVar"><span class="hs-identifier">isOverlappableTyVar</span></a></a><span> </span><a name="local-6989586621679592614"><a href="#local-6989586621679592614"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1243"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-6989586621679592614"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-comment">-- See Note [Coercion variables in free variable lists]</span><span>
</span><a name="line-1244"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tcIsTcTyVar</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">,</span><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1245"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592614"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1246"></a><span>        </span><a href="TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679592615"><a href="#local-6989586621679592615"><span class="hs-identifier">overlappable</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592615"><span class="hs-identifier hs-var">overlappable</span></a><span>
</span><a name="line-1247"></a><span>        </span><span class="hs-identifier">_</span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1248"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1249"></a><span>
</span><a name="line-1250"></a><a name="isMetaTyVar"><a href="TcType.html#isMetaTyVar"><span class="hs-identifier">isMetaTyVar</span></a></a><span> </span><a name="local-6989586621679592616"><a href="#local-6989586621679592616"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1251"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-6989586621679592616"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-comment">-- See Note [Coercion variables in free variable lists]</span><span>
</span><a name="line-1252"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tcIsTcTyVar</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">,</span><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="TcType.html#tcIsTcTyVar"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1253"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592616"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1254"></a><span>        </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1255"></a><span>        </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1256"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1257"></a><span>
</span><a name="line-1258"></a><span class="hs-comment">-- isAmbiguousTyVar is used only when reporting type errors</span><span>
</span><a name="line-1259"></a><span class="hs-comment">-- It picks out variables that are unbound, namely meta</span><span>
</span><a name="line-1260"></a><span class="hs-comment">-- type variables and the RuntimUnk variables created by</span><span>
</span><a name="line-1261"></a><span class="hs-comment">-- RtClosureInspect.zonkRTTIType.  These are &quot;ambiguous&quot; in</span><span>
</span><a name="line-1262"></a><span class="hs-comment">-- the sense that they stand for an as-yet-unknown type</span><span>
</span><a name="line-1263"></a><a name="isAmbiguousTyVar"><a href="TcType.html#isAmbiguousTyVar"><span class="hs-identifier">isAmbiguousTyVar</span></a></a><span> </span><a name="local-6989586621679592617"><a href="#local-6989586621679592617"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1264"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-6989586621679592617"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-comment">-- See Note [Coercion variables in free variable lists]</span><span>
</span><a name="line-1265"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592617"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1266"></a><span>        </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1267"></a><span>        </span><a href="TcType.html#RuntimeUnk"><span class="hs-identifier hs-var">RuntimeUnk</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1268"></a><span>        </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1269"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1270"></a><span>
</span><a name="line-1271"></a><span class="hs-identifier">isMetaTyVarTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1272"></a><a name="isMetaTyVarTy"><a href="TcType.html#isMetaTyVarTy"><span class="hs-identifier">isMetaTyVarTy</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621679592618"><a href="#local-6989586621679592618"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a><span> </span><a href="#local-6989586621679592618"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1273"></a><span class="hs-identifier">isMetaTyVarTy</span><span> </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1274"></a><span>
</span><a name="line-1275"></a><span class="hs-identifier">metaTyVarInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a><span>
</span><a name="line-1276"></a><a name="metaTyVarInfo"><a href="TcType.html#metaTyVarInfo"><span class="hs-identifier">metaTyVarInfo</span></a></a><span> </span><a name="local-6989586621679592619"><a href="#local-6989586621679592619"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1277"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592619"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1278"></a><span>      </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_info</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592620"><a href="#local-6989586621679592620"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592620"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-1279"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;metaTyVarInfo&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592619"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1280"></a><span>
</span><a name="line-1281"></a><span class="hs-identifier">metaTyVarTcLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span>
</span><a name="line-1282"></a><a name="metaTyVarTcLevel"><a href="TcType.html#metaTyVarTcLevel"><span class="hs-identifier">metaTyVarTcLevel</span></a></a><span> </span><a name="local-6989586621679592621"><a href="#local-6989586621679592621"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1283"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592621"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1284"></a><span>      </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_tclvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592622"><a href="#local-6989586621679592622"><span class="hs-identifier">tclvl</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592622"><span class="hs-identifier hs-var">tclvl</span></a><span>
</span><a name="line-1285"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;metaTyVarTcLevel&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592621"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1286"></a><span>
</span><a name="line-1287"></a><span class="hs-identifier">metaTyVarTcLevel_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span>
</span><a name="line-1288"></a><a name="metaTyVarTcLevel_maybe"><a href="TcType.html#metaTyVarTcLevel_maybe"><span class="hs-identifier">metaTyVarTcLevel_maybe</span></a></a><span> </span><a name="local-6989586621679592623"><a href="#local-6989586621679592623"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1289"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592623"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1290"></a><span>      </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_tclvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592624"><a href="#local-6989586621679592624"><span class="hs-identifier">tclvl</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679592624"><span class="hs-identifier hs-var">tclvl</span></a><span>
</span><a name="line-1291"></a><span>      </span><span class="hs-identifier">_</span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1292"></a><span>
</span><a name="line-1293"></a><span class="hs-identifier">metaTyVarRef</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a><span> </span><a href="TcType.html#MetaDetails"><span class="hs-identifier hs-type">MetaDetails</span></a><span>
</span><a name="line-1294"></a><a name="metaTyVarRef"><a href="TcType.html#metaTyVarRef"><span class="hs-identifier">metaTyVarRef</span></a></a><span> </span><a name="local-6989586621679592625"><a href="#local-6989586621679592625"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1295"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592625"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1296"></a><span>        </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679592626"><a href="#local-6989586621679592626"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592626"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-1297"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;metaTyVarRef&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592625"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1298"></a><span>
</span><a name="line-1299"></a><span class="hs-identifier">setMetaTyVarTcLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>
</span><a name="line-1300"></a><a name="setMetaTyVarTcLevel"><a href="TcType.html#setMetaTyVarTcLevel"><span class="hs-identifier">setMetaTyVarTcLevel</span></a></a><span> </span><a name="local-6989586621679592627"><a href="#local-6989586621679592627"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679592628"><a href="#local-6989586621679592628"><span class="hs-identifier">tclvl</span></a></a><span>
</span><a name="line-1301"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592627"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1302"></a><span>      </span><a name="local-6989586621679592629"><a href="#local-6989586621679592629"><span class="hs-identifier">details</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#setTcTyVarDetails"><span class="hs-identifier hs-var">setTcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592627"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592629"><span class="hs-identifier hs-var">details</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_tclvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592628"><span class="hs-identifier hs-var">tclvl</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1303"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;metaTyVarTcLevel&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592627"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1304"></a><span>
</span><a name="line-1305"></a><span class="hs-identifier">isSigTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1306"></a><a name="isSigTyVar"><a href="TcType.html#isSigTyVar"><span class="hs-identifier">isSigTyVar</span></a></a><span> </span><a name="local-6989586621679592630"><a href="#local-6989586621679592630"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1307"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592630"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1308"></a><span>        </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_info</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#SigTv"><span class="hs-identifier hs-var">SigTv</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1309"></a><span>        </span><span class="hs-identifier">_</span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1310"></a><span>
</span><a name="line-1311"></a><span class="hs-identifier">isFlexi</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isIndirect</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#MetaDetails"><span class="hs-identifier hs-type">MetaDetails</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1312"></a><a name="isFlexi"><a href="TcType.html#isFlexi"><span class="hs-identifier">isFlexi</span></a></a><span> </span><a href="TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1313"></a><span class="hs-identifier">isFlexi</span><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1314"></a><span>
</span><a name="line-1315"></a><a name="isIndirect"><a href="TcType.html#isIndirect"><span class="hs-identifier">isIndirect</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#Indirect"><span class="hs-identifier hs-var">Indirect</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1316"></a><span class="hs-identifier">isIndirect</span><span> </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1317"></a><span>
</span><a name="line-1318"></a><span class="hs-identifier">isRuntimeUnkSkol</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1319"></a><span class="hs-comment">-- Called only in TcErrors; see Note [Runtime skolems] there</span><span>
</span><a name="line-1320"></a><a name="isRuntimeUnkSkol"><a href="TcType.html#isRuntimeUnkSkol"><span class="hs-identifier">isRuntimeUnkSkol</span></a></a><span> </span><a name="local-6989586621679592631"><a href="#local-6989586621679592631"><span class="hs-identifier">x</span></a></a><span>
</span><a name="line-1321"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcType.html#RuntimeUnk"><span class="hs-identifier hs-var">RuntimeUnk</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679592631"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1322"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1323"></a><span>
</span><a name="line-1324"></a><span class="hs-identifier">mkTyVarNamePairs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1325"></a><span class="hs-comment">-- Just pair each TyVar with its own name</span><span>
</span><a name="line-1326"></a><a name="mkTyVarNamePairs"><a href="TcType.html#mkTyVarNamePairs"><span class="hs-identifier">mkTyVarNamePairs</span></a></a><span> </span><a name="local-6989586621679592632"><a href="#local-6989586621679592632"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a><span> </span><a href="#local-6989586621679592633"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592633"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679592633"><a href="#local-6989586621679592633"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679592632"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">]</span><span>
</span><a name="line-1327"></a><span>
</span><a name="line-1328"></a><span class="hs-identifier">findDupSigTvs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1329"></a><span class="hs-comment">-- If we have [...(x1,tv)...(x2,tv)...]</span><span>
</span><a name="line-1330"></a><span class="hs-comment">-- return (x1,x2) in the result list</span><span>
</span><a name="line-1331"></a><a name="findDupSigTvs"><a href="TcType.html#findDupSigTvs"><span class="hs-identifier">findDupSigTvs</span></a></a><span> </span><a name="local-6989586621679592634"><a href="#local-6989586621679592634"><span class="hs-identifier">prs</span></a></a><span>
</span><a name="line-1332"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><a href="#local-6989586621679592636"><span class="hs-identifier hs-var">mk_result_prs</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1333"></a><span>    </span><a href="ListSetOps.html#findDupsEq"><span class="hs-identifier hs-var">findDupsEq</span></a><span> </span><a href="#local-6989586621679592635"><span class="hs-identifier hs-var">eq_snd</span></a><span> </span><a href="#local-6989586621679592634"><span class="hs-identifier hs-var">prs</span></a><span>
</span><a name="line-1334"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1335"></a><span>    </span><a name="local-6989586621679592635"><a href="#local-6989586621679592635"><span class="hs-identifier">eq_snd</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679592637"><a href="#local-6989586621679592637"><span class="hs-identifier">tv1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679592638"><a href="#local-6989586621679592638"><span class="hs-identifier">tv2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592637"><span class="hs-identifier hs-var">tv1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679592638"><span class="hs-identifier hs-var">tv2</span></a><span>
</span><a name="line-1336"></a><span>    </span><a name="local-6989586621679592636"><a href="#local-6989586621679592636"><span class="hs-identifier">mk_result_prs</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679592639"><a href="#local-6989586621679592639"><span class="hs-identifier">n1</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3A%7C"><span class="hs-operator hs-var">:|</span></a><span> </span><a name="local-6989586621679592640"><a href="#local-6989586621679592640"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679592641"><a href="#local-6989586621679592641"><span class="hs-identifier">n2</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592639"><span class="hs-identifier hs-var">n1</span></a><span class="hs-special">,</span><a href="#local-6989586621679592641"><span class="hs-identifier hs-var">n2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592640"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-1337"></a><span>
</span><a name="line-1338"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Tau, sigma and rho}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1345"></a><span>
</span><a name="line-1346"></a><span class="hs-identifier">mkSigmaTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVarBinder"><span class="hs-identifier hs-type">TyVarBinder</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1347"></a><a name="mkSigmaTy"><a href="TcType.html#mkSigmaTy"><span class="hs-identifier">mkSigmaTy</span></a></a><span> </span><a name="local-6989586621679592642"><a href="#local-6989586621679592642"><span class="hs-identifier">bndrs</span></a></a><span> </span><a name="local-6989586621679592643"><a href="#local-6989586621679592643"><span class="hs-identifier">theta</span></a></a><span> </span><a name="local-6989586621679592644"><a href="#local-6989586621679592644"><span class="hs-identifier">tau</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a><span> </span><a href="#local-6989586621679592642"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a><span> </span><a href="#local-6989586621679592643"><span class="hs-identifier hs-var">theta</span></a><span> </span><a href="#local-6989586621679592644"><span class="hs-identifier hs-var">tau</span></a><span class="hs-special">)</span><span>
</span><a name="line-1348"></a><span>
</span><a name="line-1349"></a><span class="hs-comment">-- | Make a sigma ty where all type variables are 'Inferred'. That is,</span><span>
</span><a name="line-1350"></a><span class="hs-comment">-- they cannot be used with visible type application.</span><span>
</span><a name="line-1351"></a><span class="hs-identifier">mkInfSigmaTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1352"></a><a name="mkInfSigmaTy"><a href="TcType.html#mkInfSigmaTy"><span class="hs-identifier">mkInfSigmaTy</span></a></a><span> </span><a name="local-6989586621679592645"><a href="#local-6989586621679592645"><span class="hs-identifier">tyvars</span></a></a><span> </span><a name="local-6989586621679592646"><a href="#local-6989586621679592646"><span class="hs-identifier">theta</span></a></a><span> </span><a name="local-6989586621679592647"><a href="#local-6989586621679592647"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#mkSigmaTy"><span class="hs-identifier hs-var">mkSigmaTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTyVarBinders"><span class="hs-identifier hs-var">mkTyVarBinders</span></a><span> </span><a href="Var.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a><span> </span><a href="#local-6989586621679592645"><span class="hs-identifier hs-var">tyvars</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592646"><span class="hs-identifier hs-var">theta</span></a><span> </span><a href="#local-6989586621679592647"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1353"></a><span>
</span><a name="line-1354"></a><span class="hs-comment">-- | Make a sigma ty where all type variables are &quot;specified&quot;. That is,</span><span>
</span><a name="line-1355"></a><span class="hs-comment">-- they can be used with visible type application</span><span>
</span><a name="line-1356"></a><span class="hs-identifier">mkSpecSigmaTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1357"></a><a name="mkSpecSigmaTy"><a href="TcType.html#mkSpecSigmaTy"><span class="hs-identifier">mkSpecSigmaTy</span></a></a><span> </span><a name="local-6989586621679592648"><a href="#local-6989586621679592648"><span class="hs-identifier">tyvars</span></a></a><span> </span><a name="local-6989586621679592649"><a href="#local-6989586621679592649"><span class="hs-identifier">preds</span></a></a><span> </span><a name="local-6989586621679592650"><a href="#local-6989586621679592650"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#mkSigmaTy"><span class="hs-identifier hs-var">mkSigmaTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTyVarBinders"><span class="hs-identifier hs-var">mkTyVarBinders</span></a><span> </span><a href="Var.html#Specified"><span class="hs-identifier hs-var">Specified</span></a><span> </span><a href="#local-6989586621679592648"><span class="hs-identifier hs-var">tyvars</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592649"><span class="hs-identifier hs-var">preds</span></a><span> </span><a href="#local-6989586621679592650"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1358"></a><span>
</span><a name="line-1359"></a><span class="hs-identifier">mkPhiTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1360"></a><a name="mkPhiTy"><a href="TcType.html#mkPhiTy"><span class="hs-identifier">mkPhiTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkFunTys"><span class="hs-identifier hs-var">mkFunTys</span></a><span>
</span><a name="line-1361"></a><span>
</span><a name="line-1362"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-1363"></a><span class="hs-identifier">getDFunTyKey</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-comment">-- Get some string from a type, to be used to</span><span>
</span><a name="line-1364"></a><span>                                </span><span class="hs-comment">-- construct a dictionary function name</span><span>
</span><a name="line-1365"></a><a name="getDFunTyKey"><a href="TcType.html#getDFunTyKey"><span class="hs-identifier">getDFunTyKey</span></a></a><span> </span><a name="local-6989586621679592651"><a href="#local-6989586621679592651"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592652"><a href="#local-6989586621679592652"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621679592651"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#getDFunTyKey"><span class="hs-identifier hs-var">getDFunTyKey</span></a><span> </span><a href="#local-6989586621679592652"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1366"></a><span class="hs-identifier">getDFunTyKey</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621679592653"><a href="#local-6989586621679592653"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-6989586621679592653"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1367"></a><span class="hs-identifier">getDFunTyKey</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621679592654"><a href="#local-6989586621679592654"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-6989586621679592654"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1368"></a><span class="hs-identifier">getDFunTyKey</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a name="local-6989586621679592655"><a href="#local-6989586621679592655"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#getDFunTyLitKey"><span class="hs-identifier hs-var">getDFunTyLitKey</span></a><span> </span><a href="#local-6989586621679592655"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1369"></a><span class="hs-identifier">getDFunTyKey</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621679592656"><a href="#local-6989586621679592656"><span class="hs-identifier">fun</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#getDFunTyKey"><span class="hs-identifier hs-var">getDFunTyKey</span></a><span> </span><a href="#local-6989586621679592656"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-1370"></a><span class="hs-identifier">getDFunTyKey</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span>
</span><a name="line-1371"></a><span class="hs-identifier">getDFunTyKey</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679592657"><a href="#local-6989586621679592657"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#getDFunTyKey"><span class="hs-identifier hs-var">getDFunTyKey</span></a><span> </span><a href="#local-6989586621679592657"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-1372"></a><span class="hs-identifier">getDFunTyKey</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621679592658"><a href="#local-6989586621679592658"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#getDFunTyKey"><span class="hs-identifier hs-var">getDFunTyKey</span></a><span> </span><a href="#local-6989586621679592658"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1373"></a><span class="hs-identifier">getDFunTyKey</span><span> </span><a name="local-6989586621679592659"><a href="#local-6989586621679592659"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;getDFunTyKey&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592659"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-1374"></a><span>
</span><a name="line-1375"></a><span class="hs-identifier">getDFunTyLitKey</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyLit"><span class="hs-identifier hs-type">TyLit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span>
</span><a name="line-1376"></a><a name="getDFunTyLitKey"><a href="TcType.html#getDFunTyLitKey"><span class="hs-identifier">getDFunTyLitKey</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#NumTyLit"><span class="hs-identifier hs-var">NumTyLit</span></a><span> </span><a name="local-6989586621679592660"><a href="#local-6989586621679592660"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#mkOccName"><span class="hs-identifier hs-var">mkOccName</span></a><span> </span><a href="OccName.html#varName"><span class="hs-identifier hs-var">Name</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">varName</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679592660"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1377"></a><span class="hs-identifier">getDFunTyLitKey</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#StrTyLit"><span class="hs-identifier hs-var">StrTyLit</span></a><span> </span><a name="local-6989586621679592661"><a href="#local-6989586621679592661"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#mkOccName"><span class="hs-identifier hs-var">mkOccName</span></a><span> </span><a href="OccName.html#varName"><span class="hs-identifier hs-var">Name</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">varName</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679592661"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- hm</span><span>
</span><a name="line-1378"></a><span>
</span><a name="line-1379"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-1380"></a><span class="hs-identifier">mkNakedTyConApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1381"></a><span class="hs-comment">-- Builds a TyConApp</span><span>
</span><a name="line-1382"></a><span class="hs-comment">--   * without being strict in TyCon,</span><span>
</span><a name="line-1383"></a><span class="hs-comment">--   * without satisfying the invariants of TyConApp</span><span>
</span><a name="line-1384"></a><span class="hs-comment">-- A subsequent zonking will establish the invariants</span><span>
</span><a name="line-1385"></a><span class="hs-comment">-- See Note [Type-checking inside the knot] in TcHsType</span><span>
</span><a name="line-1386"></a><a name="mkNakedTyConApp"><a href="TcType.html#mkNakedTyConApp"><span class="hs-identifier">mkNakedTyConApp</span></a></a><span> </span><a name="local-6989586621679592662"><a href="#local-6989586621679592662"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679592663"><a href="#local-6989586621679592663"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="#local-6989586621679592662"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679592663"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1387"></a><span>
</span><a name="line-1388"></a><span class="hs-identifier">mkNakedAppTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1389"></a><span class="hs-comment">-- See Note [Type-checking inside the knot] in TcHsType</span><span>
</span><a name="line-1390"></a><a name="mkNakedAppTys"><a href="TcType.html#mkNakedAppTys"><span class="hs-identifier">mkNakedAppTys</span></a></a><span> </span><a name="local-6989586621679592664"><a href="#local-6989586621679592664"><span class="hs-identifier">ty1</span></a></a><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592664"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1391"></a><span class="hs-identifier">mkNakedAppTys</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621679592665"><a href="#local-6989586621679592665"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679592666"><a href="#local-6989586621679592666"><span class="hs-identifier">tys1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679592667"><a href="#local-6989586621679592667"><span class="hs-identifier">tys2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#mkNakedTyConApp"><span class="hs-identifier hs-var">mkNakedTyConApp</span></a><span> </span><a href="#local-6989586621679592665"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592666"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679592667"><span class="hs-identifier hs-var">tys2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1392"></a><span class="hs-identifier">mkNakedAppTys</span><span> </span><a name="local-6989586621679592668"><a href="#local-6989586621679592668"><span class="hs-identifier">ty1</span></a></a><span>                </span><a name="local-6989586621679592669"><a href="#local-6989586621679592669"><span class="hs-identifier">tys2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a><span> </span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a href="#local-6989586621679592668"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679592669"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-1393"></a><span>
</span><a name="line-1394"></a><span class="hs-identifier">mkNakedAppTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1395"></a><span class="hs-comment">-- See Note [Type-checking inside the knot] in TcHsType</span><span>
</span><a name="line-1396"></a><a name="mkNakedAppTy"><a href="TcType.html#mkNakedAppTy"><span class="hs-identifier">mkNakedAppTy</span></a></a><span> </span><a name="local-6989586621679592670"><a href="#local-6989586621679592670"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679592671"><a href="#local-6989586621679592671"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#mkNakedAppTys"><span class="hs-identifier hs-var">mkNakedAppTys</span></a><span> </span><a href="#local-6989586621679592670"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679592671"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span>
</span><a name="line-1397"></a><span>
</span><a name="line-1398"></a><span class="hs-identifier">mkNakedCastTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1399"></a><span class="hs-comment">-- Do /not/ attempt to get rid of the cast altogether,</span><span>
</span><a name="line-1400"></a><span class="hs-comment">-- even if it is Refl: see Note [The well-kinded type invariant]</span><span>
</span><a name="line-1401"></a><span class="hs-comment">-- Even doing (t |&gt; co1) |&gt; co2  ---&gt;  t |&gt; (co1;co2)</span><span>
</span><a name="line-1402"></a><span class="hs-comment">-- does not seem worth the bother</span><span>
</span><a name="line-1403"></a><span class="hs-comment">--</span><span>
</span><a name="line-1404"></a><span class="hs-comment">-- NB: zonking will get rid of these casts, because it uses mkCastTy</span><span>
</span><a name="line-1405"></a><span class="hs-comment">--</span><span>
</span><a name="line-1406"></a><span class="hs-comment">-- In fact the calls to mkNakedCastTy ar pretty few and far between.</span><span>
</span><a name="line-1407"></a><a name="mkNakedCastTy"><a href="TcType.html#mkNakedCastTy"><span class="hs-identifier">mkNakedCastTy</span></a></a><span> </span><a name="local-6989586621679592672"><a href="#local-6989586621679592672"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679592673"><a href="#local-6989586621679592673"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a href="#local-6989586621679592672"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679592673"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1408"></a><span>
</span><a name="line-1409"></a><span class="hs-comment">{- Note [The well-kinded type invariant]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
During type inference, we maintain the invariant that

   INVARIANT: every type is well-kinded /without/ zonking

and in particular that typeKind does not fail (as it can for
ill-kinded types).

Now suppose we are kind-checking the type (a Int), where (a :: kappa).
Then in tcInferApps we'll run out of binders on a's kind, so
we'll call matchExpectedFunKind, and unify
   kappa := kappa1 -&gt; kappa2,  with evidence co :: kappa ~ (kappa1 ~ kappa2)
That evidence is actually Refl, but we must not discard the cast to
form the result type
   ((a::kappa) (Int::*))
bacause that does not satisfy the invariant, and crashes TypeKind.  This
caused Trac #14174 and #14520.

Solution: make mkNakedCastTy use an actual CastTy, without optimising
for Refl. Now everything is well-kinded.  The CastTy will be removed
later, when we zonk.  Still, it's distressingly delicate.

NB: mkNakedCastTy is only called in two places:
    in tcInferApps and in checkExpectedResultKind.
    See Note [The tcType invariant] in TcHsType.
-}</span><span>
</span><a name="line-1436"></a><span>
</span><a name="line-1437"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Expanding and splitting}
*                                                                      *
************************************************************************

These tcSplit functions are like their non-Tc analogues, but
        *) they do not look through newtypes

However, they are non-monadic and do not follow through mutable type
variables.  It's up to you to make sure this doesn't matter.
-}</span><span>
</span><a name="line-1450"></a><span>
</span><a name="line-1451"></a><span class="hs-comment">-- | Splits a forall type into a list of 'TyBinder's and the inner type.</span><span>
</span><a name="line-1452"></a><span class="hs-comment">-- Always succeeds, even if it returns an empty list.</span><span>
</span><a name="line-1453"></a><span class="hs-identifier">tcSplitPiTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1454"></a><a name="tcSplitPiTys"><a href="TcType.html#tcSplitPiTys"><span class="hs-identifier">tcSplitPiTys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitPiTys"><span class="hs-identifier hs-var">splitPiTys</span></a><span>
</span><a name="line-1455"></a><span>
</span><a name="line-1456"></a><span class="hs-comment">-- | Splits a type into a TyBinder and a body, if possible. Panics otherwise</span><span>
</span><a name="line-1457"></a><span class="hs-identifier">tcSplitPiTy_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1458"></a><a name="tcSplitPiTy_maybe"><a href="TcType.html#tcSplitPiTy_maybe"><span class="hs-identifier">tcSplitPiTy_maybe</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitPiTy_maybe"><span class="hs-identifier hs-var">splitPiTy_maybe</span></a><span>
</span><a name="line-1459"></a><span>
</span><a name="line-1460"></a><span class="hs-identifier">tcSplitForAllTy_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TyVarBinder"><span class="hs-identifier hs-type">TyVarBinder</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1461"></a><a name="tcSplitForAllTy_maybe"><a href="TcType.html#tcSplitForAllTy_maybe"><span class="hs-identifier">tcSplitForAllTy_maybe</span></a></a><span> </span><a name="local-6989586621679592674"><a href="#local-6989586621679592674"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592675"><a href="#local-6989586621679592675"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592674"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitForAllTy_maybe"><span class="hs-identifier hs-var">tcSplitForAllTy_maybe</span></a><span> </span><a href="#local-6989586621679592675"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1462"></a><span class="hs-identifier">tcSplitForAllTy_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><a name="local-6989586621679592676"><a href="#local-6989586621679592676"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679592677"><a href="#local-6989586621679592677"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592676"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592677"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1463"></a><span class="hs-identifier">tcSplitForAllTy_maybe</span><span> </span><span class="hs-identifier">_</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1464"></a><span>
</span><a name="line-1465"></a><span class="hs-comment">-- | Like 'tcSplitPiTys', but splits off only named binders, returning</span><span>
</span><a name="line-1466"></a><span class="hs-comment">-- just the tycovars.</span><span>
</span><a name="line-1467"></a><span class="hs-identifier">tcSplitForAllTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1468"></a><a name="tcSplitForAllTys"><a href="TcType.html#tcSplitForAllTys"><span class="hs-identifier">tcSplitForAllTys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitForAllTys"><span class="hs-identifier hs-var">splitForAllTys</span></a><span>
</span><a name="line-1469"></a><span>
</span><a name="line-1470"></a><span class="hs-comment">-- | Like 'tcSplitForAllTys', but splits off only named binders.</span><span>
</span><a name="line-1471"></a><span class="hs-identifier">tcSplitForAllTyVarBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVarBinder"><span class="hs-identifier hs-type">TyVarBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1472"></a><a name="tcSplitForAllTyVarBndrs"><a href="TcType.html#tcSplitForAllTyVarBndrs"><span class="hs-identifier">tcSplitForAllTyVarBndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitForAllTyVarBndrs"><span class="hs-identifier hs-var">splitForAllTyVarBndrs</span></a><span>
</span><a name="line-1473"></a><span>
</span><a name="line-1474"></a><span class="hs-comment">-- | Is this a ForAllTy with a named binder?</span><span>
</span><a name="line-1475"></a><span class="hs-identifier">tcIsForAllTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1476"></a><a name="tcIsForAllTy"><a href="TcType.html#tcIsForAllTy"><span class="hs-identifier">tcIsForAllTy</span></a></a><span> </span><a name="local-6989586621679592678"><a href="#local-6989586621679592678"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592679"><a href="#local-6989586621679592679"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592678"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcIsForAllTy"><span class="hs-identifier hs-var">tcIsForAllTy</span></a><span> </span><a href="#local-6989586621679592679"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1477"></a><span class="hs-identifier">tcIsForAllTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1478"></a><span class="hs-identifier">tcIsForAllTy</span><span> </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1479"></a><span>
</span><a name="line-1480"></a><span class="hs-identifier">tcSplitPredFunTy_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1481"></a><span class="hs-comment">-- Split off the first predicate argument from a type</span><span>
</span><a name="line-1482"></a><a name="tcSplitPredFunTy_maybe"><a href="TcType.html#tcSplitPredFunTy_maybe"><span class="hs-identifier">tcSplitPredFunTy_maybe</span></a></a><span> </span><a name="local-6989586621679592680"><a href="#local-6989586621679592680"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1483"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592681"><a href="#local-6989586621679592681"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592680"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitPredFunTy_maybe"><span class="hs-identifier hs-var">tcSplitPredFunTy_maybe</span></a><span> </span><a href="#local-6989586621679592681"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1484"></a><span class="hs-identifier">tcSplitPredFunTy_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679592682"><a href="#local-6989586621679592682"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679592683"><a href="#local-6989586621679592683"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1485"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-6989586621679592682"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592682"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592683"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-1486"></a><span class="hs-identifier">tcSplitPredFunTy_maybe</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1487"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1488"></a><span>
</span><a name="line-1489"></a><span class="hs-identifier">tcSplitPhiTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1490"></a><a name="tcSplitPhiTy"><a href="TcType.html#tcSplitPhiTy"><span class="hs-identifier">tcSplitPhiTy</span></a></a><span> </span><a name="local-6989586621679592684"><a href="#local-6989586621679592684"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1491"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592685"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621679592684"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1492"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1493"></a><span>    </span><a name="local-6989586621679592685"><a href="#local-6989586621679592685"><span class="hs-identifier">split</span></a></a><span> </span><a name="local-6989586621679592686"><a href="#local-6989586621679592686"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679592687"><a href="#local-6989586621679592687"><span class="hs-identifier">ts</span></a></a><span>
</span><a name="line-1494"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcSplitPredFunTy_maybe"><span class="hs-identifier hs-var">tcSplitPredFunTy_maybe</span></a><span> </span><a href="#local-6989586621679592686"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1495"></a><span>          </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679592688"><a href="#local-6989586621679592688"><span class="hs-identifier">pred</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592689"><a href="#local-6989586621679592689"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592685"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621679592689"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592688"><span class="hs-identifier hs-var">pred</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679592687"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1496"></a><span>          </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="#local-6989586621679592687"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592686"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1497"></a><span>
</span><a name="line-1498"></a><span class="hs-comment">-- | Split a sigma type into its parts.</span><span>
</span><a name="line-1499"></a><span class="hs-identifier">tcSplitSigmaTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1500"></a><a name="tcSplitSigmaTy"><a href="TcType.html#tcSplitSigmaTy"><span class="hs-identifier">tcSplitSigmaTy</span></a></a><span> </span><a name="local-6989586621679592690"><a href="#local-6989586621679592690"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcSplitForAllTys"><span class="hs-identifier hs-var">tcSplitForAllTys</span></a><span> </span><a href="#local-6989586621679592690"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1501"></a><span>                        </span><span class="hs-special">(</span><a name="local-6989586621679592691"><a href="#local-6989586621679592691"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592692"><a href="#local-6989586621679592692"><span class="hs-identifier">rho</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcSplitPhiTy"><span class="hs-identifier hs-var">tcSplitPhiTy</span></a><span> </span><a href="#local-6989586621679592692"><span class="hs-identifier hs-var">rho</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1502"></a><span>                                        </span><span class="hs-special">(</span><a name="local-6989586621679592693"><a href="#local-6989586621679592693"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592694"><a href="#local-6989586621679592694"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592691"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592693"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592694"><span class="hs-identifier hs-var">tau</span></a><span class="hs-special">)</span><span>
</span><a name="line-1503"></a><span>
</span><a name="line-1504"></a><span class="hs-comment">-- | Split a sigma type into its parts, going underneath as many @ForAllTy@s</span><span>
</span><a name="line-1505"></a><span class="hs-comment">-- as possible. For example, given this type synonym:</span><span>
</span><a name="line-1506"></a><span class="hs-comment">--</span><span>
</span><a name="line-1507"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-1508"></a><span class="hs-comment">-- type Traversal s t a b = forall f. Applicative f =&gt; (a -&gt; f b) -&gt; s -&gt; f t</span><span>
</span><a name="line-1509"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-1510"></a><span class="hs-comment">--</span><span>
</span><a name="line-1511"></a><span class="hs-comment">-- if you called @tcSplitSigmaTy@ on this type:</span><span>
</span><a name="line-1512"></a><span class="hs-comment">--</span><span>
</span><a name="line-1513"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-1514"></a><span class="hs-comment">-- forall s t a b. Each s t a b =&gt; Traversal s t a b</span><span>
</span><a name="line-1515"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-1516"></a><span class="hs-comment">--</span><span>
</span><a name="line-1517"></a><span class="hs-comment">-- then it would return @([s,t,a,b], [Each s t a b], Traversal s t a b)@. But</span><span>
</span><a name="line-1518"></a><span class="hs-comment">-- if you instead called @tcSplitNestedSigmaTys@ on the type, it would return</span><span>
</span><a name="line-1519"></a><span class="hs-comment">-- @([s,t,a,b,f], [Each s t a b, Applicative f], (a -&gt; f b) -&gt; s -&gt; f t)@.</span><span>
</span><a name="line-1520"></a><span class="hs-identifier">tcSplitNestedSigmaTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1521"></a><span class="hs-comment">-- NB: This is basically a pure version of deeplyInstantiate (from Inst) that</span><span>
</span><a name="line-1522"></a><span class="hs-comment">-- doesn't compute an HsWrapper.</span><span>
</span><a name="line-1523"></a><a name="tcSplitNestedSigmaTys"><a href="TcType.html#tcSplitNestedSigmaTys"><span class="hs-identifier">tcSplitNestedSigmaTys</span></a></a><span> </span><a name="local-6989586621679592695"><a href="#local-6989586621679592695"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1524"></a><span>    </span><span class="hs-comment">-- If there's a forall, split it apart and try splitting the rho type</span><span>
</span><a name="line-1525"></a><span>    </span><span class="hs-comment">-- underneath it.</span><span>
</span><a name="line-1526"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679592696"><a href="#local-6989586621679592696"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592697"><a href="#local-6989586621679592697"><span class="hs-identifier">tvs1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592698"><a href="#local-6989586621679592698"><span class="hs-identifier">theta1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592699"><a href="#local-6989586621679592699"><span class="hs-identifier">rho1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#tcDeepSplitSigmaTy_maybe"><span class="hs-identifier hs-var">tcDeepSplitSigmaTy_maybe</span></a><span> </span><a href="#local-6989586621679592695"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1527"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679592700"><a href="#local-6989586621679592700"><span class="hs-identifier">tvs2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592701"><a href="#local-6989586621679592701"><span class="hs-identifier">theta2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592702"><a href="#local-6989586621679592702"><span class="hs-identifier">rho2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitNestedSigmaTys"><span class="hs-identifier hs-var">tcSplitNestedSigmaTys</span></a><span> </span><a href="#local-6989586621679592699"><span class="hs-identifier hs-var">rho1</span></a><span>
</span><a name="line-1528"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592697"><span class="hs-identifier hs-var">tvs1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679592700"><span class="hs-identifier hs-var">tvs2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592698"><span class="hs-identifier hs-var">theta1</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679592701"><span class="hs-identifier hs-var">theta2</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkFunTys"><span class="hs-identifier hs-var">mkFunTys</span></a><span> </span><a href="#local-6989586621679592696"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="#local-6989586621679592702"><span class="hs-identifier hs-var">rho2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1529"></a><span>    </span><span class="hs-comment">-- If there's no forall, we're done.</span><span>
</span><a name="line-1530"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592695"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1531"></a><span>
</span><a name="line-1532"></a><span class="hs-comment">-----------------------</span><span>
</span><a name="line-1533"></a><span class="hs-identifier">tcDeepSplitSigmaTy_maybe</span><span>
</span><a name="line-1534"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a><span class="hs-special">)</span><span>
</span><a name="line-1535"></a><span class="hs-comment">-- Looks for a *non-trivial* quantified type, under zero or more function arrows</span><span>
</span><a name="line-1536"></a><span class="hs-comment">-- By &quot;non-trivial&quot; we mean either tyvars or constraints are non-empty</span><span>
</span><a name="line-1537"></a><span>
</span><a name="line-1538"></a><a name="tcDeepSplitSigmaTy_maybe"><a href="TcType.html#tcDeepSplitSigmaTy_maybe"><span class="hs-identifier">tcDeepSplitSigmaTy_maybe</span></a></a><span> </span><a name="local-6989586621679592703"><a href="#local-6989586621679592703"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1539"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679592704"><a href="#local-6989586621679592704"><span class="hs-identifier">arg_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592705"><a href="#local-6989586621679592705"><span class="hs-identifier">res_ty</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#tcSplitFunTy_maybe"><span class="hs-identifier hs-var">tcSplitFunTy_maybe</span></a><span> </span><a href="#local-6989586621679592703"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1540"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679592706"><a href="#local-6989586621679592706"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592707"><a href="#local-6989586621679592707"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592708"><a href="#local-6989586621679592708"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592709"><a href="#local-6989586621679592709"><span class="hs-identifier">rho</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#tcDeepSplitSigmaTy_maybe"><span class="hs-identifier hs-var">tcDeepSplitSigmaTy_maybe</span></a><span> </span><a href="#local-6989586621679592705"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-1541"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592704"><span class="hs-identifier hs-var">arg_ty</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679592706"><span class="hs-identifier hs-var">arg_tys</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592707"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592708"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592709"><span class="hs-identifier hs-var">rho</span></a><span class="hs-special">)</span><span>
</span><a name="line-1542"></a><span>
</span><a name="line-1543"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679592710"><a href="#local-6989586621679592710"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592711"><a href="#local-6989586621679592711"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592712"><a href="#local-6989586621679592712"><span class="hs-identifier">rho</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a><span> </span><a href="#local-6989586621679592703"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1544"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679592710"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679592711"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">)</span><span>
</span><a name="line-1545"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592710"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592711"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592712"><span class="hs-identifier hs-var">rho</span></a><span class="hs-special">)</span><span>
</span><a name="line-1546"></a><span>
</span><a name="line-1547"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1548"></a><span>
</span><a name="line-1549"></a><span class="hs-comment">-----------------------</span><span>
</span><a name="line-1550"></a><span class="hs-identifier">tcTyConAppTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-1551"></a><a name="tcTyConAppTyCon"><a href="TcType.html#tcTyConAppTyCon"><span class="hs-identifier">tcTyConAppTyCon</span></a></a><span> </span><a name="local-6989586621679592713"><a href="#local-6989586621679592713"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1552"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcTyConAppTyCon_maybe"><span class="hs-identifier hs-var">tcTyConAppTyCon_maybe</span></a><span> </span><a href="#local-6989586621679592713"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1553"></a><span>      </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592714"><a href="#local-6989586621679592714"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592714"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1554"></a><span>      </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tcTyConAppTyCon&quot;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#pprType"><span class="hs-identifier hs-var">pprType</span></a><span> </span><a href="#local-6989586621679592713"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1555"></a><span>
</span><a name="line-1556"></a><span class="hs-comment">-- | Like 'tcRepSplitTyConApp_maybe', but only returns the 'TyCon'.</span><span>
</span><a name="line-1557"></a><span class="hs-identifier">tcTyConAppTyCon_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-1558"></a><a name="tcTyConAppTyCon_maybe"><a href="TcType.html#tcTyConAppTyCon_maybe"><span class="hs-identifier">tcTyConAppTyCon_maybe</span></a></a><span> </span><a name="local-6989586621679592715"><a href="#local-6989586621679592715"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1559"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592716"><a href="#local-6989586621679592716"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592715"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcTyConAppTyCon_maybe"><span class="hs-identifier hs-var">tcTyConAppTyCon_maybe</span></a><span> </span><a href="#local-6989586621679592716"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1560"></a><span class="hs-identifier">tcTyConAppTyCon_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621679592717"><a href="#local-6989586621679592717"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1561"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679592717"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1562"></a><span class="hs-identifier">tcTyConAppTyCon_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1563"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span>
</span><a name="line-1564"></a><span class="hs-identifier">tcTyConAppTyCon_maybe</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1565"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1566"></a><span>
</span><a name="line-1567"></a><span class="hs-identifier">tcTyConAppArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-1568"></a><a name="tcTyConAppArgs"><a href="TcType.html#tcTyConAppArgs"><span class="hs-identifier">tcTyConAppArgs</span></a></a><span> </span><a name="local-6989586621679592718"><a href="#local-6989586621679592718"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679592718"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1569"></a><span>                        </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679592719"><a href="#local-6989586621679592719"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592719"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1570"></a><span>                        </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tcTyConAppArgs&quot;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#pprType"><span class="hs-identifier hs-var">pprType</span></a><span> </span><a href="#local-6989586621679592718"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1571"></a><span>
</span><a name="line-1572"></a><span class="hs-identifier">tcSplitTyConApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1573"></a><a name="tcSplitTyConApp"><a href="TcType.html#tcSplitTyConApp"><span class="hs-identifier">tcSplitTyConApp</span></a></a><span> </span><a name="local-6989586621679592720"><a href="#local-6989586621679592720"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679592720"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1574"></a><span>                        </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592721"><a href="#local-6989586621679592721"><span class="hs-identifier">stuff</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592721"><span class="hs-identifier hs-var">stuff</span></a><span>
</span><a name="line-1575"></a><span>                        </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tcSplitTyConApp&quot;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#pprType"><span class="hs-identifier hs-var">pprType</span></a><span> </span><a href="#local-6989586621679592720"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1576"></a><span>
</span><a name="line-1577"></a><span class="hs-comment">-- | Like 'tcRepSplitTyConApp_maybe', but returns 'Nothing' if,</span><span>
</span><a name="line-1578"></a><span class="hs-comment">--</span><span>
</span><a name="line-1579"></a><span class="hs-comment">-- 1. the type is structurally not a type constructor application, or</span><span>
</span><a name="line-1580"></a><span class="hs-comment">--</span><span>
</span><a name="line-1581"></a><span class="hs-comment">-- 2. the type is a function type (e.g. application of 'funTyCon'), but we</span><span>
</span><a name="line-1582"></a><span class="hs-comment">--    currently don't even enough information to fully determine its RuntimeRep</span><span>
</span><a name="line-1583"></a><span class="hs-comment">--    variables. For instance, @FunTy (a :: k) Int@.</span><span>
</span><a name="line-1584"></a><span class="hs-comment">--</span><span>
</span><a name="line-1585"></a><span class="hs-comment">-- By contrast 'tcRepSplitTyConApp_maybe' panics in the second case.</span><span>
</span><a name="line-1586"></a><span class="hs-comment">--</span><span>
</span><a name="line-1587"></a><span class="hs-comment">-- The behavior here is needed during canonicalization; see Note [FunTy and</span><span>
</span><a name="line-1588"></a><span class="hs-comment">-- decomposing tycon applications] in TcCanonical for details.</span><span>
</span><a name="line-1589"></a><span class="hs-identifier">tcRepSplitTyConApp_maybe'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1590"></a><a name="tcRepSplitTyConApp_maybe%27"><a href="TcType.html#tcRepSplitTyConApp_maybe%27"><span class="hs-identifier">tcRepSplitTyConApp_maybe'</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621679592722"><a href="#local-6989586621679592722"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679592723"><a href="#local-6989586621679592723"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592722"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592723"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1591"></a><span class="hs-identifier">tcRepSplitTyConApp_maybe'</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679592724"><a href="#local-6989586621679592724"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679592725"><a href="#local-6989586621679592725"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1592"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592726"><a href="#local-6989586621679592726"><span class="hs-identifier">arg_rep</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#getRuntimeRep_maybe"><span class="hs-identifier hs-var">getRuntimeRep_maybe</span></a><span> </span><a href="#local-6989586621679592724"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1593"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592727"><a href="#local-6989586621679592727"><span class="hs-identifier">res_rep</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#getRuntimeRep_maybe"><span class="hs-identifier hs-var">getRuntimeRep_maybe</span></a><span> </span><a href="#local-6989586621679592725"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-1594"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679592726"><span class="hs-identifier hs-var">arg_rep</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592727"><span class="hs-identifier hs-var">res_rep</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592724"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592725"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1595"></a><span class="hs-identifier">tcRepSplitTyConApp_maybe'</span><span> </span><span class="hs-identifier">_</span><span>                          </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1596"></a><span>
</span><a name="line-1597"></a><span>
</span><a name="line-1598"></a><span class="hs-comment">-----------------------</span><span>
</span><a name="line-1599"></a><span class="hs-identifier">tcSplitFunTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1600"></a><a name="tcSplitFunTys"><a href="TcType.html#tcSplitFunTys"><span class="hs-identifier">tcSplitFunTys</span></a></a><span> </span><a name="local-6989586621679592728"><a href="#local-6989586621679592728"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcSplitFunTy_maybe"><span class="hs-identifier hs-var">tcSplitFunTy_maybe</span></a><span> </span><a href="#local-6989586621679592728"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1601"></a><span>                        </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592728"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1602"></a><span>                        </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679592729"><a href="#local-6989586621679592729"><span class="hs-identifier">arg</span></a></a><span class="hs-special">,</span><a name="local-6989586621679592730"><a href="#local-6989586621679592730"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592729"><span class="hs-identifier hs-var">arg</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679592731"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592732"><span class="hs-identifier hs-var">res'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1603"></a><span>                                       </span><span class="hs-keyword">where</span><span>
</span><a name="line-1604"></a><span>                                          </span><span class="hs-special">(</span><a name="local-6989586621679592731"><a href="#local-6989586621679592731"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><a name="local-6989586621679592732"><a href="#local-6989586621679592732"><span class="hs-identifier">res'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a><span> </span><a href="#local-6989586621679592730"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-1605"></a><span>
</span><a name="line-1606"></a><span class="hs-identifier">tcSplitFunTy_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1607"></a><a name="tcSplitFunTy_maybe"><a href="TcType.html#tcSplitFunTy_maybe"><span class="hs-identifier">tcSplitFunTy_maybe</span></a></a><span> </span><a name="local-6989586621679592733"><a href="#local-6989586621679592733"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592734"><a href="#local-6989586621679592734"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592733"><span class="hs-identifier hs-var">ty</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitFunTy_maybe"><span class="hs-identifier hs-var">tcSplitFunTy_maybe</span></a><span> </span><a href="#local-6989586621679592734"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1608"></a><span class="hs-identifier">tcSplitFunTy_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679592735"><a href="#local-6989586621679592735"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679592736"><a href="#local-6989586621679592736"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-6989586621679592735"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592735"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592736"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-1609"></a><span class="hs-identifier">tcSplitFunTy_maybe</span><span> </span><span class="hs-identifier">_</span><span>                                    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1610"></a><span>        </span><span class="hs-comment">-- Note the typeKind guard</span><span>
</span><a name="line-1611"></a><span>        </span><span class="hs-comment">-- Consider     (?x::Int) =&gt; Bool</span><span>
</span><a name="line-1612"></a><span>        </span><span class="hs-comment">-- We don't want to treat this as a function type!</span><span>
</span><a name="line-1613"></a><span>        </span><span class="hs-comment">-- A concrete example is test tc230:</span><span>
</span><a name="line-1614"></a><span>        </span><span class="hs-comment">--      f :: () -&gt; (?p :: ()) =&gt; () -&gt; ()</span><span>
</span><a name="line-1615"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-1616"></a><span>        </span><span class="hs-comment">--      g = f () ()</span><span>
</span><a name="line-1617"></a><span>
</span><a name="line-1618"></a><span class="hs-identifier">tcSplitFunTysN</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span>                      </span><span class="hs-comment">-- N: Number of desired args</span><span>
</span><a name="line-1619"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a><span>
</span><a name="line-1620"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span>               </span><span class="hs-comment">-- Number of missing arrows</span><span>
</span><a name="line-1621"></a><span>                        </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- Arg types (always N types)</span><span>
</span><a name="line-1622"></a><span>                         </span><a href="TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- The rest of the type</span><span>
</span><a name="line-1623"></a><span class="hs-comment">-- ^ Split off exactly the specified number argument types</span><span>
</span><a name="line-1624"></a><span class="hs-comment">-- Returns</span><span>
</span><a name="line-1625"></a><span class="hs-comment">--  (Left m) if there are 'm' missing arrows in the type</span><span>
</span><a name="line-1626"></a><span class="hs-comment">--  (Right (tys,res)) if the type looks like t1 -&gt; ... -&gt; tn -&gt; res</span><span>
</span><a name="line-1627"></a><a name="tcSplitFunTysN"><a href="TcType.html#tcSplitFunTysN"><span class="hs-identifier">tcSplitFunTysN</span></a></a><span> </span><a name="local-6989586621679592737"><a href="#local-6989586621679592737"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679592738"><a href="#local-6989586621679592738"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1628"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679592737"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1629"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592738"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1630"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679592739"><a href="#local-6989586621679592739"><span class="hs-identifier">arg</span></a></a><span class="hs-special">,</span><a name="local-6989586621679592740"><a href="#local-6989586621679592740"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#tcSplitFunTy_maybe"><span class="hs-identifier hs-var">tcSplitFunTy_maybe</span></a><span> </span><a href="#local-6989586621679592738"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1631"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcSplitFunTysN"><span class="hs-identifier hs-var">tcSplitFunTysN</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592737"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592740"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1632"></a><span>     </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><a name="local-6989586621679592741"><a href="#local-6989586621679592741"><span class="hs-identifier">m</span></a></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><a href="#local-6989586621679592741"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-1633"></a><span>     </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679592742"><a href="#local-6989586621679592742"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><a name="local-6989586621679592743"><a href="#local-6989586621679592743"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592739"><span class="hs-identifier hs-var">arg</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679592742"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592743"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span>
</span><a name="line-1634"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1635"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><a href="#local-6989586621679592737"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1636"></a><span>
</span><a name="line-1637"></a><span class="hs-identifier">tcSplitFunTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1638"></a><a name="tcSplitFunTy"><a href="TcType.html#tcSplitFunTy"><span class="hs-identifier">tcSplitFunTy</span></a></a><span>  </span><a name="local-6989586621679592744"><a href="#local-6989586621679592744"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Maybes.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a><span> </span><span class="hs-string">&quot;tcSplitFunTy&quot;</span><span> </span><span class="hs-special">(</span><a href="TcType.html#tcSplitFunTy_maybe"><span class="hs-identifier hs-var">tcSplitFunTy_maybe</span></a><span> </span><a href="#local-6989586621679592744"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1639"></a><span>
</span><a name="line-1640"></a><span class="hs-identifier">tcFunArgTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1641"></a><a name="tcFunArgTy"><a href="TcType.html#tcFunArgTy"><span class="hs-identifier">tcFunArgTy</span></a></a><span>    </span><a name="local-6989586621679592745"><a href="#local-6989586621679592745"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#tcSplitFunTy"><span class="hs-identifier hs-var">tcSplitFunTy</span></a><span> </span><a href="#local-6989586621679592745"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1642"></a><span>
</span><a name="line-1643"></a><span class="hs-identifier">tcFunResultTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1644"></a><a name="tcFunResultTy"><a href="TcType.html#tcFunResultTy"><span class="hs-identifier">tcFunResultTy</span></a></a><span> </span><a name="local-6989586621679592746"><a href="#local-6989586621679592746"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#tcSplitFunTy"><span class="hs-identifier hs-var">tcSplitFunTy</span></a><span> </span><a href="#local-6989586621679592746"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1645"></a><span>
</span><a name="line-1646"></a><span class="hs-comment">-- | Strips off n *visible* arguments and returns the resulting type</span><span>
</span><a name="line-1647"></a><span class="hs-identifier">tcFunResultTyN</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1648"></a><a name="tcFunResultTyN"><a href="TcType.html#tcFunResultTyN"><span class="hs-identifier">tcFunResultTyN</span></a></a><span> </span><a name="local-6989586621679592747"><a href="#local-6989586621679592747"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679592748"><a href="#local-6989586621679592748"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1649"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679592749"><a href="#local-6989586621679592749"><span class="hs-identifier">res_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#tcSplitFunTysN"><span class="hs-identifier hs-var">tcSplitFunTysN</span></a><span> </span><a href="#local-6989586621679592747"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679592748"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1650"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592749"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-1651"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1652"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tcFunResultTyN&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592747"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592748"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1653"></a><span>
</span><a name="line-1654"></a><span class="hs-comment">-----------------------</span><span>
</span><a name="line-1655"></a><span class="hs-identifier">tcSplitAppTy_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1656"></a><a name="tcSplitAppTy_maybe"><a href="TcType.html#tcSplitAppTy_maybe"><span class="hs-identifier">tcSplitAppTy_maybe</span></a></a><span> </span><a name="local-6989586621679592750"><a href="#local-6989586621679592750"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592751"><a href="#local-6989586621679592751"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592750"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitAppTy_maybe"><span class="hs-identifier hs-var">tcSplitAppTy_maybe</span></a><span> </span><a href="#local-6989586621679592751"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1657"></a><span class="hs-identifier">tcSplitAppTy_maybe</span><span> </span><a name="local-6989586621679592752"><a href="#local-6989586621679592752"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tcRepSplitAppTy_maybe"><span class="hs-identifier hs-var">tcRepSplitAppTy_maybe</span></a><span> </span><a href="#local-6989586621679592752"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1658"></a><span>
</span><a name="line-1659"></a><span class="hs-identifier">tcSplitAppTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1660"></a><a name="tcSplitAppTy"><a href="TcType.html#tcSplitAppTy"><span class="hs-identifier">tcSplitAppTy</span></a></a><span> </span><a name="local-6989586621679592753"><a href="#local-6989586621679592753"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcSplitAppTy_maybe"><span class="hs-identifier hs-var">tcSplitAppTy_maybe</span></a><span> </span><a href="#local-6989586621679592753"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1661"></a><span>                    </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592754"><a href="#local-6989586621679592754"><span class="hs-identifier">stuff</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592754"><span class="hs-identifier hs-var">stuff</span></a><span>
</span><a name="line-1662"></a><span>                    </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tcSplitAppTy&quot;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#pprType"><span class="hs-identifier hs-var">pprType</span></a><span> </span><a href="#local-6989586621679592753"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1663"></a><span>
</span><a name="line-1664"></a><span class="hs-identifier">tcSplitAppTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1665"></a><a name="tcSplitAppTys"><a href="TcType.html#tcSplitAppTys"><span class="hs-identifier">tcSplitAppTys</span></a></a><span> </span><a name="local-6989586621679592755"><a href="#local-6989586621679592755"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1666"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592756"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592755"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1667"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1668"></a><span>    </span><a name="local-6989586621679592756"><a href="#local-6989586621679592756"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679592757"><a href="#local-6989586621679592757"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679592758"><a href="#local-6989586621679592758"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcSplitAppTy_maybe"><span class="hs-identifier hs-var">tcSplitAppTy_maybe</span></a><span> </span><a href="#local-6989586621679592757"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1669"></a><span>                   </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679592759"><a href="#local-6989586621679592759"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592760"><a href="#local-6989586621679592760"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592756"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592759"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592760"><span class="hs-identifier hs-var">arg</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679592758"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-1670"></a><span>                   </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592757"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><a href="#local-6989586621679592758"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-1671"></a><span>
</span><a name="line-1672"></a><span class="hs-comment">-- | Returns the number of arguments in the given type, without</span><span>
</span><a name="line-1673"></a><span class="hs-comment">-- looking through synonyms. This is used only for error reporting.</span><span>
</span><a name="line-1674"></a><span class="hs-comment">-- We don't look through synonyms because of #11313.</span><span>
</span><a name="line-1675"></a><span class="hs-identifier">tcRepGetNumAppTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span>
</span><a name="line-1676"></a><a name="tcRepGetNumAppTys"><a href="TcType.html#tcRepGetNumAppTys"><span class="hs-identifier">tcRepGetNumAppTys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Type.html#repSplitAppTys"><span class="hs-identifier hs-var">repSplitAppTys</span></a><span>
</span><a name="line-1677"></a><span>
</span><a name="line-1678"></a><span class="hs-comment">-----------------------</span><span>
</span><a name="line-1679"></a><span class="hs-comment">-- | If the type is a tyvar, possibly under a cast, returns it, along</span><span>
</span><a name="line-1680"></a><span class="hs-comment">-- with the coercion. Thus, the co is :: kind tv ~N kind type</span><span>
</span><a name="line-1681"></a><span class="hs-identifier">tcGetCastedTyVar_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a><span class="hs-special">)</span><span>
</span><a name="line-1682"></a><a name="tcGetCastedTyVar_maybe"><a href="TcType.html#tcGetCastedTyVar_maybe"><span class="hs-identifier">tcGetCastedTyVar_maybe</span></a></a><span> </span><a name="local-6989586621679592761"><a href="#local-6989586621679592761"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592762"><a href="#local-6989586621679592762"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592761"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcGetCastedTyVar_maybe"><span class="hs-identifier hs-var">tcGetCastedTyVar_maybe</span></a><span> </span><a href="#local-6989586621679592762"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1683"></a><span class="hs-identifier">tcGetCastedTyVar_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621679592763"><a href="#local-6989586621679592763"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679592764"><a href="#local-6989586621679592764"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592763"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592764"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1684"></a><span class="hs-identifier">tcGetCastedTyVar_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621679592765"><a href="#local-6989586621679592765"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592765"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679592765"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1685"></a><span class="hs-identifier">tcGetCastedTyVar_maybe</span><span> </span><span class="hs-identifier">_</span><span>                        </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1686"></a><span>
</span><a name="line-1687"></a><span class="hs-identifier">tcGetTyVar_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>
</span><a name="line-1688"></a><a name="tcGetTyVar_maybe"><a href="TcType.html#tcGetTyVar_maybe"><span class="hs-identifier">tcGetTyVar_maybe</span></a></a><span> </span><a name="local-6989586621679592766"><a href="#local-6989586621679592766"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592767"><a href="#local-6989586621679592767"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592766"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcGetTyVar_maybe"><span class="hs-identifier hs-var">tcGetTyVar_maybe</span></a><span> </span><a href="#local-6989586621679592767"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1689"></a><span class="hs-identifier">tcGetTyVar_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621679592768"><a href="#local-6989586621679592768"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679592768"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1690"></a><span class="hs-identifier">tcGetTyVar_maybe</span><span> </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1691"></a><span>
</span><a name="line-1692"></a><span class="hs-identifier">tcGetTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>
</span><a name="line-1693"></a><a name="tcGetTyVar"><a href="TcType.html#tcGetTyVar"><span class="hs-identifier">tcGetTyVar</span></a></a><span> </span><a name="local-6989586621679592769"><a href="#local-6989586621679592769"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-6989586621679592770"><a href="#local-6989586621679592770"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1694"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcGetTyVar_maybe"><span class="hs-identifier hs-var">tcGetTyVar_maybe</span></a><span> </span><a href="#local-6989586621679592770"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1695"></a><span>     </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592771"><a href="#local-6989586621679592771"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592771"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1696"></a><span>     </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><a href="#local-6989586621679592769"><span class="hs-identifier hs-var">msg</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592770"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1697"></a><span>
</span><a name="line-1698"></a><span class="hs-identifier">tcIsTyVarTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1699"></a><a name="tcIsTyVarTy"><a href="TcType.html#tcIsTyVarTy"><span class="hs-identifier">tcIsTyVarTy</span></a></a><span> </span><a name="local-6989586621679592772"><a href="#local-6989586621679592772"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592773"><a href="#local-6989586621679592773"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592772"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcIsTyVarTy"><span class="hs-identifier hs-var">tcIsTyVarTy</span></a><span> </span><a href="#local-6989586621679592773"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1700"></a><span class="hs-identifier">tcIsTyVarTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621679592774"><a href="#local-6989586621679592774"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcIsTyVarTy"><span class="hs-identifier hs-var">tcIsTyVarTy</span></a><span> </span><a href="#local-6989586621679592774"><span class="hs-identifier hs-var">ty</span></a><span>  </span><span class="hs-comment">-- look through casts, as</span><span>
</span><a name="line-1701"></a><span>                                            </span><span class="hs-comment">-- this is only used for</span><span>
</span><a name="line-1702"></a><span>                                            </span><span class="hs-comment">-- e.g., FlexibleContexts</span><span>
</span><a name="line-1703"></a><span class="hs-identifier">tcIsTyVarTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1704"></a><span class="hs-identifier">tcIsTyVarTy</span><span> </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1705"></a><span>
</span><a name="line-1706"></a><span class="hs-comment">-----------------------</span><span>
</span><a name="line-1707"></a><span class="hs-identifier">tcSplitDFunTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1708"></a><span class="hs-comment">-- Split the type of a dictionary function</span><span>
</span><a name="line-1709"></a><span class="hs-comment">-- We don't use tcSplitSigmaTy,  because a DFun may (with NDP)</span><span>
</span><a name="line-1710"></a><span class="hs-comment">-- have non-Pred arguments, such as</span><span>
</span><a name="line-1711"></a><span class="hs-comment">--     df :: forall m. (forall b. Eq b =&gt; Eq (m b)) -&gt; C m</span><span>
</span><a name="line-1712"></a><span class="hs-comment">--</span><span>
</span><a name="line-1713"></a><span class="hs-comment">-- Also NB splitFunTys, not tcSplitFunTys;</span><span>
</span><a name="line-1714"></a><span class="hs-comment">-- the latter  specifically stops at PredTy arguments,</span><span>
</span><a name="line-1715"></a><span class="hs-comment">-- and we don't want to do that here</span><span>
</span><a name="line-1716"></a><a name="tcSplitDFunTy"><a href="TcType.html#tcSplitDFunTy"><span class="hs-identifier">tcSplitDFunTy</span></a></a><span> </span><a name="local-6989586621679592775"><a href="#local-6989586621679592775"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1717"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcSplitForAllTys"><span class="hs-identifier hs-var">tcSplitForAllTys</span></a><span> </span><a href="#local-6989586621679592775"><span class="hs-identifier hs-var">ty</span></a><span>   </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679592776"><a href="#local-6989586621679592776"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592777"><a href="#local-6989586621679592777"><span class="hs-identifier">rho</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1718"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitFunTys"><span class="hs-identifier hs-var">splitFunTys</span></a><span> </span><a href="#local-6989586621679592777"><span class="hs-identifier hs-var">rho</span></a><span>       </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679592778"><a href="#local-6989586621679592778"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592779"><a href="#local-6989586621679592779"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1719"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcSplitDFunHead"><span class="hs-identifier hs-var">tcSplitDFunHead</span></a><span> </span><a href="#local-6989586621679592779"><span class="hs-identifier hs-var">tau</span></a><span>   </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679592780"><a href="#local-6989586621679592780"><span class="hs-identifier">clas</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592781"><a href="#local-6989586621679592781"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1720"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621679592776"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592778"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592780"><span class="hs-identifier hs-var">clas</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592781"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1721"></a><span>
</span><a name="line-1722"></a><span class="hs-identifier">tcSplitDFunHead</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1723"></a><a name="tcSplitDFunHead"><a href="TcType.html#tcSplitDFunHead"><span class="hs-identifier">tcSplitDFunHead</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#getClassPredTys"><span class="hs-identifier hs-var">getClassPredTys</span></a><span>
</span><a name="line-1724"></a><span>
</span><a name="line-1725"></a><span class="hs-identifier">tcSplitMethodTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1726"></a><span class="hs-comment">-- A class method (selector) always has a type like</span><span>
</span><a name="line-1727"></a><span class="hs-comment">--   forall as. C as =&gt; blah</span><span>
</span><a name="line-1728"></a><span class="hs-comment">-- So if the class looks like</span><span>
</span><a name="line-1729"></a><span class="hs-comment">--   class C a where</span><span>
</span><a name="line-1730"></a><span class="hs-comment">--     op :: forall b. (Eq a, Ix b) =&gt; a -&gt; b</span><span>
</span><a name="line-1731"></a><span class="hs-comment">-- the class method type looks like</span><span>
</span><a name="line-1732"></a><span class="hs-comment">--  op :: forall a. C a =&gt; forall b. (Eq a, Ix b) =&gt; a -&gt; b</span><span>
</span><a name="line-1733"></a><span class="hs-comment">--</span><span>
</span><a name="line-1734"></a><span class="hs-comment">-- tcSplitMethodTy just peels off the outer forall and</span><span>
</span><a name="line-1735"></a><span class="hs-comment">-- that first predicate</span><span>
</span><a name="line-1736"></a><a name="tcSplitMethodTy"><a href="TcType.html#tcSplitMethodTy"><span class="hs-identifier">tcSplitMethodTy</span></a></a><span> </span><a name="local-6989586621679592782"><a href="#local-6989586621679592782"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1737"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679592783"><a href="#local-6989586621679592783"><span class="hs-identifier">sel_tyvars</span></a></a><span class="hs-special">,</span><a name="local-6989586621679592784"><a href="#local-6989586621679592784"><span class="hs-identifier">sel_rho</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#tcSplitForAllTys"><span class="hs-identifier hs-var">tcSplitForAllTys</span></a><span> </span><a href="#local-6989586621679592782"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1738"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679592785"><a href="#local-6989586621679592785"><span class="hs-identifier">first_pred</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592786"><a href="#local-6989586621679592786"><span class="hs-identifier">local_meth_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#tcSplitPredFunTy_maybe"><span class="hs-identifier hs-var">tcSplitPredFunTy_maybe</span></a><span> </span><a href="#local-6989586621679592784"><span class="hs-identifier hs-var">sel_rho</span></a><span>
</span><a name="line-1739"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592783"><span class="hs-identifier hs-var">sel_tyvars</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592785"><span class="hs-identifier hs-var">first_pred</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592786"><span class="hs-identifier hs-var">local_meth_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1740"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1741"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tcSplitMethodTy&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592782"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1742"></a><span>
</span><a name="line-1743"></a><span>
</span><a name="line-1744"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
            Type equalities
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-1749"></a><span>
</span><a name="line-1750"></a><span class="hs-identifier">tcEqKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1751"></a><a name="tcEqKind"><a href="TcType.html#tcEqKind"><span class="hs-identifier">tcEqKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcEqType"><span class="hs-identifier hs-var">tcEqType</span></a><span>
</span><a name="line-1752"></a><span>
</span><a name="line-1753"></a><span class="hs-identifier">tcEqType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1754"></a><span class="hs-comment">-- tcEqType is a proper implements the same Note [Non-trivial definitional</span><span>
</span><a name="line-1755"></a><span class="hs-comment">-- equality] (in TyCoRep) as `eqType`, but Type.eqType believes (* ==</span><span>
</span><a name="line-1756"></a><span class="hs-comment">-- Constraint), and that is NOT what we want in the type checker!</span><span>
</span><a name="line-1757"></a><a name="tcEqType"><a href="TcType.html#tcEqType"><span class="hs-identifier">tcEqType</span></a></a><span> </span><a name="local-6989586621679592787"><a href="#local-6989586621679592787"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679592788"><a href="#local-6989586621679592788"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-1758"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#tc_eq_type"><span class="hs-identifier hs-var">tc_eq_type</span></a><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592789"><span class="hs-identifier hs-var">ki1</span></a><span> </span><a href="#local-6989586621679592790"><span class="hs-identifier hs-var">ki2</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-1759"></a><span>    </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#tc_eq_type"><span class="hs-identifier hs-var">tc_eq_type</span></a><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592787"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679592788"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1760"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1761"></a><span>    </span><a name="local-6989586621679592789"><a href="#local-6989586621679592789"><span class="hs-identifier">ki1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679592787"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1762"></a><span>    </span><a name="local-6989586621679592790"><a href="#local-6989586621679592790"><span class="hs-identifier">ki2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679592788"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1763"></a><span>
</span><a name="line-1764"></a><span class="hs-comment">-- | Just like 'tcEqType', but will return True for types of different kinds</span><span>
</span><a name="line-1765"></a><span class="hs-comment">-- as long as their non-coercion structure is identical.</span><span>
</span><a name="line-1766"></a><span class="hs-identifier">tcEqTypeNoKindCheck</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1767"></a><a name="tcEqTypeNoKindCheck"><a href="TcType.html#tcEqTypeNoKindCheck"><span class="hs-identifier">tcEqTypeNoKindCheck</span></a></a><span> </span><a name="local-6989586621679592791"><a href="#local-6989586621679592791"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679592792"><a href="#local-6989586621679592792"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-1768"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcType.html#tc_eq_type"><span class="hs-identifier hs-var">tc_eq_type</span></a><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592791"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679592792"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1769"></a><span>
</span><a name="line-1770"></a><span class="hs-comment">-- | Like 'tcEqType', but returns information about whether the difference</span><span>
</span><a name="line-1771"></a><span class="hs-comment">-- is visible in the case of a mismatch.</span><span>
</span><a name="line-1772"></a><span class="hs-comment">-- @Nothing@    : the types are equal</span><span>
</span><a name="line-1773"></a><span class="hs-comment">-- @Just True@  : the types differ, and the point of difference is visible</span><span>
</span><a name="line-1774"></a><span class="hs-comment">-- @Just False@ : the types differ, and the point of difference is invisible</span><span>
</span><a name="line-1775"></a><span class="hs-identifier">tcEqTypeVis</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1776"></a><a name="tcEqTypeVis"><a href="TcType.html#tcEqTypeVis"><span class="hs-identifier">tcEqTypeVis</span></a></a><span> </span><a name="local-6989586621679592793"><a href="#local-6989586621679592793"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679592794"><a href="#local-6989586621679592794"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-1777"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tc_eq_type"><span class="hs-identifier hs-var">tc_eq_type</span></a><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592793"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679592794"><span class="hs-identifier hs-var">ty2</span></a><span> </span><a href="TcType.html#%3C%21%3E"><span class="hs-operator hs-var">&lt;!&gt;</span></a><span> </span><a href="#local-6989586621679592797"><span class="hs-identifier hs-var">invis</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#tc_eq_type"><span class="hs-identifier hs-var">tc_eq_type</span></a><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592795"><span class="hs-identifier hs-var">ki1</span></a><span> </span><a href="#local-6989586621679592796"><span class="hs-identifier hs-var">ki2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1778"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1779"></a><span>    </span><a name="local-6989586621679592795"><a href="#local-6989586621679592795"><span class="hs-identifier">ki1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679592793"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1780"></a><span>    </span><a name="local-6989586621679592796"><a href="#local-6989586621679592796"><span class="hs-identifier">ki2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679592794"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1781"></a><span>
</span><a name="line-1782"></a><span>      </span><span class="hs-comment">-- convert Just True to Just False</span><span>
</span><a name="line-1783"></a><span>    </span><span class="hs-identifier">invis</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1784"></a><span>    </span><a name="local-6989586621679592797"><a href="#local-6989586621679592797"><span class="hs-identifier">invis</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1785"></a><span>
</span><a name="line-1786"></a><span class="hs-special">(</span><span class="hs-operator">&lt;!&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1787"></a><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>        </span><a name="%3C%21%3E"><a href="TcType.html#%3C%21%3E"><span class="hs-operator">&lt;!&gt;</span></a></a><span> </span><a name="local-6989586621679592798"><a href="#local-6989586621679592798"><span class="hs-identifier">x</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592798"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1788"></a><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>      </span><span class="hs-operator">&lt;!&gt;</span><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1789"></a><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592799"><a href="#local-6989586621679592799"><span class="hs-identifier">_vis</span></a></a><span>      </span><span class="hs-operator">&lt;!&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1790"></a><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592800"><a href="#local-6989586621679592800"><span class="hs-identifier">vis</span></a></a><span>       </span><span class="hs-operator">&lt;!&gt;</span><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679592800"><span class="hs-identifier hs-var">vis</span></a><span>
</span><a name="line-1791"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-operator">&lt;!&gt;</span><span>
</span><a name="line-1792"></a><span>
</span><a name="line-1793"></a><span class="hs-comment">-- | Real worker for 'tcEqType'. No kind check!</span><span>
</span><a name="line-1794"></a><span class="hs-identifier">tc_eq_type</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ @tcView@, if you want unwrapping</span><span>
</span><a name="line-1795"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1796"></a><a name="tc_eq_type"><a href="TcType.html#tc_eq_type"><span class="hs-identifier">tc_eq_type</span></a></a><span> </span><a name="local-6989586621679592801"><a href="#local-6989586621679592801"><span class="hs-identifier">view_fun</span></a></a><span> </span><a name="local-6989586621679592802"><a href="#local-6989586621679592802"><span class="hs-identifier">orig_ty1</span></a></a><span> </span><a name="local-6989586621679592803"><a href="#local-6989586621679592803"><span class="hs-identifier">orig_ty2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679592808"><span class="hs-identifier hs-var">orig_env</span></a><span> </span><a href="#local-6989586621679592802"><span class="hs-identifier hs-var">orig_ty1</span></a><span> </span><a href="#local-6989586621679592803"><span class="hs-identifier hs-var">orig_ty2</span></a><span>
</span><a name="line-1797"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1798"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1799"></a><span>    </span><a name="local-6989586621679592804"><a href="#local-6989586621679592804"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679592810"><a href="#local-6989586621679592810"><span class="hs-identifier">vis</span></a></a><span> </span><a name="local-6989586621679592811"><a href="#local-6989586621679592811"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679592812"><a href="#local-6989586621679592812"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679592813"><a href="#local-6989586621679592813"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592814"><a href="#local-6989586621679592814"><span class="hs-identifier">t1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679592801"><span class="hs-identifier hs-var">view_fun</span></a><span> </span><a href="#local-6989586621679592812"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592810"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592811"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592814"><span class="hs-identifier hs-var">t1'</span></a><span> </span><a href="#local-6989586621679592813"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1800"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592815"><a href="#local-6989586621679592815"><span class="hs-identifier">vis</span></a></a><span> </span><a name="local-6989586621679592816"><a href="#local-6989586621679592816"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679592817"><a href="#local-6989586621679592817"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679592818"><a href="#local-6989586621679592818"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592819"><a href="#local-6989586621679592819"><span class="hs-identifier">t2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679592801"><span class="hs-identifier hs-var">view_fun</span></a><span> </span><a href="#local-6989586621679592818"><span class="hs-identifier hs-var">t2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592815"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592816"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592817"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621679592819"><span class="hs-identifier hs-var">t2'</span></a><span>
</span><a name="line-1801"></a><span>
</span><a name="line-1802"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592820"><a href="#local-6989586621679592820"><span class="hs-identifier">vis</span></a></a><span> </span><a name="local-6989586621679592821"><a href="#local-6989586621679592821"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621679592822"><a href="#local-6989586621679592822"><span class="hs-identifier">tv1</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621679592823"><a href="#local-6989586621679592823"><span class="hs-identifier">tv2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1803"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592807"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621679592820"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="VarEnv.html#rnOccL"><span class="hs-identifier hs-var">rnOccL</span></a><span> </span><a href="#local-6989586621679592821"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592822"><span class="hs-identifier hs-var">tv1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="VarEnv.html#rnOccR"><span class="hs-identifier hs-var">rnOccR</span></a><span> </span><a href="#local-6989586621679592821"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592823"><span class="hs-identifier hs-var">tv2</span></a><span>
</span><a name="line-1804"></a><span>
</span><a name="line-1805"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592824"><a href="#local-6989586621679592824"><span class="hs-identifier">vis</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a name="local-6989586621679592825"><a href="#local-6989586621679592825"><span class="hs-identifier">lit1</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a name="local-6989586621679592826"><a href="#local-6989586621679592826"><span class="hs-identifier">lit2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1806"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592807"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621679592824"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679592825"><span class="hs-identifier hs-var">lit1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679592826"><span class="hs-identifier hs-var">lit2</span></a><span>
</span><a name="line-1807"></a><span>
</span><a name="line-1808"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592827"><a href="#local-6989586621679592827"><span class="hs-identifier">vis</span></a></a><span> </span><a name="local-6989586621679592828"><a href="#local-6989586621679592828"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TvBndr"><span class="hs-identifier hs-var">TvBndr</span></a><span> </span><a name="local-6989586621679592829"><a href="#local-6989586621679592829"><span class="hs-identifier">tv1</span></a></a><span> </span><a name="local-6989586621679592830"><a href="#local-6989586621679592830"><span class="hs-identifier">vis1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679592831"><a href="#local-6989586621679592831"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1809"></a><span>               </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TvBndr"><span class="hs-identifier hs-var">TvBndr</span></a><span> </span><a name="local-6989586621679592832"><a href="#local-6989586621679592832"><span class="hs-identifier">tv2</span></a></a><span> </span><a name="local-6989586621679592833"><a href="#local-6989586621679592833"><span class="hs-identifier">vis2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679592834"><a href="#local-6989586621679592834"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1810"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#isVisibleArgFlag"><span class="hs-identifier hs-var">isVisibleArgFlag</span></a><span> </span><a href="#local-6989586621679592830"><span class="hs-identifier hs-var">vis1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592828"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679592829"><span class="hs-identifier hs-var">tv1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679592832"><span class="hs-identifier hs-var">tv2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1811"></a><span>          </span><a href="TcType.html#%3C%21%3E"><span class="hs-operator hs-var">&lt;!&gt;</span></a><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592827"><span class="hs-identifier hs-var">vis</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#rnBndr2"><span class="hs-identifier hs-var">rnBndr2</span></a><span> </span><a href="#local-6989586621679592828"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592829"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-6989586621679592832"><span class="hs-identifier hs-var">tv2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592831"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679592834"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1812"></a><span>          </span><a href="TcType.html#%3C%21%3E"><span class="hs-operator hs-var">&lt;!&gt;</span></a><span> </span><a href="#local-6989586621679592807"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621679592827"><span class="hs-identifier hs-var">vis</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592830"><span class="hs-identifier hs-var">vis1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679592833"><span class="hs-identifier hs-var">vis2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1813"></a><span>    </span><span class="hs-comment">-- Make sure we handle all FunTy cases since falling through to the</span><span>
</span><a name="line-1814"></a><span>    </span><span class="hs-comment">-- AppTy case means that tcRepSplitAppTy_maybe may see an unzonked</span><span>
</span><a name="line-1815"></a><span>    </span><span class="hs-comment">-- kind variable, which causes things to blow up.</span><span>
</span><a name="line-1816"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592835"><a href="#local-6989586621679592835"><span class="hs-identifier">vis</span></a></a><span> </span><a name="local-6989586621679592836"><a href="#local-6989586621679592836"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679592837"><a href="#local-6989586621679592837"><span class="hs-identifier">arg1</span></a></a><span> </span><a name="local-6989586621679592838"><a href="#local-6989586621679592838"><span class="hs-identifier">res1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679592839"><a href="#local-6989586621679592839"><span class="hs-identifier">arg2</span></a></a><span> </span><a name="local-6989586621679592840"><a href="#local-6989586621679592840"><span class="hs-identifier">res2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1817"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592835"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592836"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592837"><span class="hs-identifier hs-var">arg1</span></a><span> </span><a href="#local-6989586621679592839"><span class="hs-identifier hs-var">arg2</span></a><span> </span><a href="TcType.html#%3C%21%3E"><span class="hs-operator hs-var">&lt;!&gt;</span></a><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592835"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592836"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592838"><span class="hs-identifier hs-var">res1</span></a><span> </span><a href="#local-6989586621679592840"><span class="hs-identifier hs-var">res2</span></a><span>
</span><a name="line-1818"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592841"><a href="#local-6989586621679592841"><span class="hs-identifier">vis</span></a></a><span> </span><a name="local-6989586621679592842"><a href="#local-6989586621679592842"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679592843"><a href="#local-6989586621679592843"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679592844"><a href="#local-6989586621679592844"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679592845"><a href="#local-6989586621679592845"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1819"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592809"><span class="hs-identifier hs-var">eqFunTy</span></a><span> </span><a href="#local-6989586621679592841"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592842"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592844"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621679592845"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621679592843"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1820"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592846"><a href="#local-6989586621679592846"><span class="hs-identifier">vis</span></a></a><span> </span><a name="local-6989586621679592847"><a href="#local-6989586621679592847"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679592848"><a href="#local-6989586621679592848"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679592849"><a href="#local-6989586621679592849"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679592850"><a href="#local-6989586621679592850"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1821"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592809"><span class="hs-identifier hs-var">eqFunTy</span></a><span> </span><a href="#local-6989586621679592846"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592847"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592848"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621679592849"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621679592850"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1822"></a><span>
</span><a name="line-1823"></a><span>      </span><span class="hs-comment">-- See Note [Equality on AppTys] in Type</span><span>
</span><a name="line-1824"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592851"><a href="#local-6989586621679592851"><span class="hs-identifier">vis</span></a></a><span> </span><a name="local-6989586621679592852"><a href="#local-6989586621679592852"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621679592853"><a href="#local-6989586621679592853"><span class="hs-identifier">s1</span></a></a><span> </span><a name="local-6989586621679592854"><a href="#local-6989586621679592854"><span class="hs-identifier">t1</span></a></a><span class="hs-special">)</span><span>        </span><a name="local-6989586621679592855"><a href="#local-6989586621679592855"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-1825"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679592856"><a href="#local-6989586621679592856"><span class="hs-identifier">s2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592857"><a href="#local-6989586621679592857"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcRepSplitAppTy_maybe"><span class="hs-identifier hs-var">tcRepSplitAppTy_maybe</span></a><span> </span><a href="#local-6989586621679592855"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1826"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592851"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592852"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592853"><span class="hs-identifier hs-var">s1</span></a><span> </span><a href="#local-6989586621679592856"><span class="hs-identifier hs-var">s2</span></a><span> </span><a href="TcType.html#%3C%21%3E"><span class="hs-operator hs-var">&lt;!&gt;</span></a><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592851"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592852"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592854"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621679592857"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1827"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592858"><a href="#local-6989586621679592858"><span class="hs-identifier">vis</span></a></a><span> </span><a name="local-6989586621679592859"><a href="#local-6989586621679592859"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679592860"><a href="#local-6989586621679592860"><span class="hs-identifier">ty1</span></a></a><span>                  </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621679592861"><a href="#local-6989586621679592861"><span class="hs-identifier">s2</span></a></a><span> </span><a name="local-6989586621679592862"><a href="#local-6989586621679592862"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1828"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679592863"><a href="#local-6989586621679592863"><span class="hs-identifier">s1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592864"><a href="#local-6989586621679592864"><span class="hs-identifier">t1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcRepSplitAppTy_maybe"><span class="hs-identifier hs-var">tcRepSplitAppTy_maybe</span></a><span> </span><a href="#local-6989586621679592860"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1829"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592858"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592859"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592863"><span class="hs-identifier hs-var">s1</span></a><span> </span><a href="#local-6989586621679592861"><span class="hs-identifier hs-var">s2</span></a><span> </span><a href="TcType.html#%3C%21%3E"><span class="hs-operator hs-var">&lt;!&gt;</span></a><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592858"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592859"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592864"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621679592862"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1830"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592865"><a href="#local-6989586621679592865"><span class="hs-identifier">vis</span></a></a><span> </span><a name="local-6989586621679592866"><a href="#local-6989586621679592866"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621679592867"><a href="#local-6989586621679592867"><span class="hs-identifier">tc1</span></a></a><span> </span><a name="local-6989586621679592868"><a href="#local-6989586621679592868"><span class="hs-identifier">ts1</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621679592869"><a href="#local-6989586621679592869"><span class="hs-identifier">tc2</span></a></a><span> </span><a name="local-6989586621679592870"><a href="#local-6989586621679592870"><span class="hs-identifier">ts2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1831"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592807"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621679592865"><span class="hs-identifier hs-var">vis</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592867"><span class="hs-identifier hs-var">tc1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679592869"><span class="hs-identifier hs-var">tc2</span></a><span class="hs-special">)</span><span> </span><a href="TcType.html#%3C%21%3E"><span class="hs-operator hs-var">&lt;!&gt;</span></a><span> </span><a href="#local-6989586621679592805"><span class="hs-identifier hs-var">gos</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592806"><span class="hs-identifier hs-var">tc_vis</span></a><span> </span><a href="#local-6989586621679592865"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592867"><span class="hs-identifier hs-var">tc1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592866"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592868"><span class="hs-identifier hs-var">ts1</span></a><span> </span><a href="#local-6989586621679592870"><span class="hs-identifier hs-var">ts2</span></a><span>
</span><a name="line-1832"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592871"><a href="#local-6989586621679592871"><span class="hs-identifier">vis</span></a></a><span> </span><a name="local-6989586621679592872"><a href="#local-6989586621679592872"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621679592873"><a href="#local-6989586621679592873"><span class="hs-identifier">t1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>        </span><a name="local-6989586621679592874"><a href="#local-6989586621679592874"><span class="hs-identifier">t2</span></a></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592871"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592872"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592873"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621679592874"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1833"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592875"><a href="#local-6989586621679592875"><span class="hs-identifier">vis</span></a></a><span> </span><a name="local-6989586621679592876"><a href="#local-6989586621679592876"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679592877"><a href="#local-6989586621679592877"><span class="hs-identifier">t1</span></a></a><span>                   </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621679592878"><a href="#local-6989586621679592878"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592875"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592876"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592877"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621679592878"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1834"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1835"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679592879"><a href="#local-6989586621679592879"><span class="hs-identifier">vis</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier">_</span><span>                    </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679592879"><span class="hs-identifier hs-var">vis</span></a><span>
</span><a name="line-1836"></a><span>
</span><a name="line-1837"></a><span>    </span><a name="local-6989586621679592805"><a href="#local-6989586621679592805"><span class="hs-identifier">gos</span></a></a><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1838"></a><span>    </span><span class="hs-identifier">gos</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679592880"><a href="#local-6989586621679592880"><span class="hs-identifier">v</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679592881"><a href="#local-6989586621679592881"><span class="hs-identifier">vs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679592882"><a href="#local-6989586621679592882"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679592883"><a href="#local-6989586621679592883"><span class="hs-identifier">t1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679592884"><a href="#local-6989586621679592884"><span class="hs-identifier">ts1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679592885"><a href="#local-6989586621679592885"><span class="hs-identifier">t2</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679592886"><a href="#local-6989586621679592886"><span class="hs-identifier">ts2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592880"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679592882"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592883"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621679592885"><span class="hs-identifier hs-var">t2</span></a><span> </span><a href="TcType.html#%3C%21%3E"><span class="hs-operator hs-var">&lt;!&gt;</span></a><span> </span><a href="#local-6989586621679592805"><span class="hs-identifier hs-var">gos</span></a><span> </span><a href="#local-6989586621679592881"><span class="hs-identifier hs-var">vs</span></a><span> </span><a href="#local-6989586621679592882"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592884"><span class="hs-identifier hs-var">ts1</span></a><span> </span><a href="#local-6989586621679592886"><span class="hs-identifier hs-var">ts2</span></a><span>
</span><a name="line-1839"></a><span>    </span><span class="hs-identifier">gos</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679592887"><a href="#local-6989586621679592887"><span class="hs-identifier">v</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier">_</span><span>        </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679592887"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1840"></a><span>    </span><span class="hs-identifier">gos</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier">_</span><span>        </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;tc_eq_type&quot;</span><span>
</span><a name="line-1841"></a><span>
</span><a name="line-1842"></a><span>    </span><span class="hs-identifier">tc_vis</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">]</span><span>
</span><a name="line-1843"></a><span>    </span><a name="local-6989586621679592806"><a href="#local-6989586621679592806"><span class="hs-identifier">tc_vis</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a name="local-6989586621679592888"><a href="#local-6989586621679592888"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592890"><span class="hs-identifier hs-var">viss</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1844"></a><span>       </span><span class="hs-comment">-- the repeat True is necessary because tycons can legitimately</span><span>
</span><a name="line-1845"></a><span>       </span><span class="hs-comment">-- be oversaturated</span><span>
</span><a name="line-1846"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1847"></a><span>        </span><a name="local-6989586621679592889"><a href="#local-6989586621679592889"><span class="hs-identifier">bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConBinders</span><span> </span><a href="#local-6989586621679592888"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1848"></a><span>        </span><a name="local-6989586621679592890"><a href="#local-6989586621679592890"><span class="hs-identifier">viss</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TyCon.html#isVisibleTyConBinder"><span class="hs-identifier hs-var">isVisibleTyConBinder</span></a><span> </span><a href="#local-6989586621679592889"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-1849"></a><span>    </span><span class="hs-identifier">tc_vis</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>  </span><span class="hs-comment">-- if we're not in a visible context, our args</span><span>
</span><a name="line-1850"></a><span>                                   </span><span class="hs-comment">-- aren't either</span><span>
</span><a name="line-1851"></a><span>
</span><a name="line-1852"></a><span>    </span><span class="hs-identifier">check</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1853"></a><span>    </span><a name="local-6989586621679592807"><a href="#local-6989586621679592807"><span class="hs-identifier">check</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1854"></a><span>    </span><span class="hs-identifier">check</span><span> </span><a name="local-6989586621679592891"><a href="#local-6989586621679592891"><span class="hs-identifier">vis</span></a></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679592891"><span class="hs-identifier hs-var">vis</span></a><span>
</span><a name="line-1855"></a><span>
</span><a name="line-1856"></a><span>    </span><a name="local-6989586621679592808"><a href="#local-6989586621679592808"><span class="hs-identifier">orig_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkRnEnv2"><span class="hs-identifier hs-var">mkRnEnv2</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679592802"><span class="hs-identifier hs-var">orig_ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592803"><span class="hs-identifier hs-var">orig_ty2</span></a><span class="hs-special">]</span><span>
</span><a name="line-1857"></a><span>
</span><a name="line-1858"></a><span>    </span><span class="hs-comment">-- @eqFunTy arg res ty@ is True when @ty@ equals @FunTy arg res@. This is</span><span>
</span><a name="line-1859"></a><span>    </span><span class="hs-comment">-- sometimes hard to know directly because @ty@ might have some casts</span><span>
</span><a name="line-1860"></a><span>    </span><span class="hs-comment">-- obscuring the FunTy. And 'splitAppTy' is difficult because we can't</span><span>
</span><a name="line-1861"></a><span>    </span><span class="hs-comment">-- always extract a RuntimeRep (see Note [xyz]) if the kind of the arg or</span><span>
</span><a name="line-1862"></a><span>    </span><span class="hs-comment">-- res is unzonked/unflattened. Thus this function, which handles this</span><span>
</span><a name="line-1863"></a><span>    </span><span class="hs-comment">-- corner case.</span><span>
</span><a name="line-1864"></a><span>    </span><span class="hs-identifier">eqFunTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1865"></a><span>    </span><a name="local-6989586621679592809"><a href="#local-6989586621679592809"><span class="hs-identifier">eqFunTy</span></a></a><span> </span><a name="local-6989586621679592892"><a href="#local-6989586621679592892"><span class="hs-identifier">vis</span></a></a><span> </span><a name="local-6989586621679592893"><a href="#local-6989586621679592893"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679592894"><a href="#local-6989586621679592894"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679592895"><a href="#local-6989586621679592895"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679592896"><a href="#local-6989586621679592896"><span class="hs-identifier">arg'</span></a></a><span> </span><a name="local-6989586621679592897"><a href="#local-6989586621679592897"><span class="hs-identifier">res'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1866"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592892"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592893"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592894"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621679592896"><span class="hs-identifier hs-var">arg'</span></a><span> </span><a href="TcType.html#%3C%21%3E"><span class="hs-operator hs-var">&lt;!&gt;</span></a><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592892"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592893"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592895"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621679592897"><span class="hs-identifier hs-var">res'</span></a><span>
</span><a name="line-1867"></a><span>    </span><span class="hs-identifier">eqFunTy</span><span> </span><a name="local-6989586621679592898"><a href="#local-6989586621679592898"><span class="hs-identifier">vis</span></a></a><span> </span><a name="local-6989586621679592899"><a href="#local-6989586621679592899"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679592900"><a href="#local-6989586621679592900"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679592901"><a href="#local-6989586621679592901"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-6989586621679592902"><a href="#local-6989586621679592902"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1868"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679592912"><a href="#local-6989586621679592912"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679592913"><a href="#local-6989586621679592913"><span class="hs-identifier">arg'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592914"><a href="#local-6989586621679592914"><span class="hs-identifier">res'</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679592903"><span class="hs-identifier hs-var">get_args</span></a><span> </span><a href="#local-6989586621679592902"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1869"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592912"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span>
</span><a name="line-1870"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592898"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592899"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592900"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621679592913"><span class="hs-identifier hs-var">arg'</span></a><span> </span><a href="TcType.html#%3C%21%3E"><span class="hs-operator hs-var">&lt;!&gt;</span></a><span> </span><a href="#local-6989586621679592804"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592898"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621679592899"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679592901"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621679592914"><span class="hs-identifier hs-var">res'</span></a><span>
</span><a name="line-1871"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1872"></a><span>        </span><span class="hs-identifier">get_args</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1873"></a><span>        </span><a name="local-6989586621679592903"><a href="#local-6989586621679592903"><span class="hs-identifier">get_args</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621679592904"><a href="#local-6989586621679592904"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679592905"><a href="#local-6989586621679592905"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>       </span><a name="local-6989586621679592906"><a href="#local-6989586621679592906"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592903"><span class="hs-identifier hs-var">get_args</span></a><span> </span><a href="#local-6989586621679592904"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592905"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679592906"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-1874"></a><span>        </span><span class="hs-identifier">get_args</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621679592907"><a href="#local-6989586621679592907"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><a name="local-6989586621679592908"><a href="#local-6989586621679592908"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592903"><span class="hs-identifier hs-var">get_args</span></a><span> </span><a href="#local-6989586621679592907"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679592908"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1875"></a><span>        </span><span class="hs-identifier">get_args</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621679592909"><a href="#local-6989586621679592909"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679592910"><a href="#local-6989586621679592910"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679592911"><a href="#local-6989586621679592911"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592909"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592910"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679592911"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-1876"></a><span>        </span><span class="hs-identifier">get_args</span><span> </span><span class="hs-identifier">_</span><span>                 </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1877"></a><span>    </span><span class="hs-identifier">eqFunTy</span><span> </span><a name="local-6989586621679592915"><a href="#local-6989586621679592915"><span class="hs-identifier">vis</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1878"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679592915"><span class="hs-identifier hs-var">vis</span></a><span>
</span><a name="line-1879"></a><span>
</span><a name="line-1880"></a><span class="hs-comment">-- | Like 'pickyEqTypeVis', but returns a Bool for convenience</span><span>
</span><a name="line-1881"></a><span class="hs-identifier">pickyEqType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1882"></a><span class="hs-comment">-- Check when two types _look_ the same, _including_ synonyms.</span><span>
</span><a name="line-1883"></a><span class="hs-comment">-- So (pickyEqType String [Char]) returns False</span><span>
</span><a name="line-1884"></a><span class="hs-comment">-- This ignores kinds and coercions, because this is used only for printing.</span><span>
</span><a name="line-1885"></a><a name="pickyEqType"><a href="TcType.html#pickyEqType"><span class="hs-identifier">pickyEqType</span></a></a><span> </span><a name="local-6989586621679592916"><a href="#local-6989586621679592916"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679592917"><a href="#local-6989586621679592917"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-1886"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1887"></a><span>    </span><a href="TcType.html#tc_eq_type"><span class="hs-identifier hs-var">tc_eq_type</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592916"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679592917"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1888"></a><span>
</span><a name="line-1889"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                       Predicate types
*                                                                      *
************************************************************************

Deconstructors and tests on predicate types

Note [Kind polymorphic type classes]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    class C f where...   -- C :: forall k. k -&gt; Constraint
    g :: forall (f::*). C f =&gt; f -&gt; f

Here the (C f) in the signature is really (C * f), and we
don't want to complain that the * isn't a type variable!
-}</span><span>
</span><a name="line-1905"></a><span>
</span><a name="line-1906"></a><span class="hs-identifier">isTyVarClassPred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1907"></a><a name="isTyVarClassPred"><a href="TcType.html#isTyVarClassPred"><span class="hs-identifier">isTyVarClassPred</span></a></a><span> </span><a name="local-6989586621679592918"><a href="#local-6989586621679592918"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#getClassPredTys_maybe"><span class="hs-identifier hs-var">getClassPredTys_maybe</span></a><span> </span><a href="#local-6989586621679592918"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1908"></a><span>    </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679592919"><a href="#local-6989586621679592919"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><a href="Type.html#isTyVarTy"><span class="hs-identifier hs-var">isTyVarTy</span></a><span> </span><a href="#local-6989586621679592919"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1909"></a><span>    </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1910"></a><span>
</span><a name="line-1911"></a><span class="hs-comment">-------------------------</span><span>
</span><a name="line-1912"></a><span class="hs-identifier">checkValidClsArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#KindOrType"><span class="hs-identifier hs-type">KindOrType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1913"></a><span class="hs-comment">-- If the Bool is True (flexible contexts), return True (i.e. ok)</span><span>
</span><a name="line-1914"></a><span class="hs-comment">-- Otherwise, check that the type (not kind) args are all headed by a tyvar</span><span>
</span><a name="line-1915"></a><span class="hs-comment">--   E.g. (Eq a) accepted, (Eq (f a)) accepted, but (Eq Int) rejected</span><span>
</span><a name="line-1916"></a><span class="hs-comment">-- This function is here rather than in TcValidity because it is</span><span>
</span><a name="line-1917"></a><span class="hs-comment">-- called from TcSimplify, which itself is imported by TcValidity</span><span>
</span><a name="line-1918"></a><a name="checkValidClsArgs"><a href="TcType.html#checkValidClsArgs"><span class="hs-identifier">checkValidClsArgs</span></a></a><span> </span><a name="local-6989586621679592920"><a href="#local-6989586621679592920"><span class="hs-identifier">flexible_contexts</span></a></a><span> </span><a name="local-6989586621679592921"><a href="#local-6989586621679592921"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621679592922"><a href="#local-6989586621679592922"><span class="hs-identifier">kts</span></a></a><span>
</span><a name="line-1919"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679592920"><span class="hs-identifier hs-var">flexible_contexts</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1920"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><a href="TcType.html#hasTyVarHead"><span class="hs-identifier hs-var">hasTyVarHead</span></a><span> </span><a href="#local-6989586621679592923"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1921"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1922"></a><span>    </span><a name="local-6989586621679592923"><a href="#local-6989586621679592923"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#filterOutInvisibleTypes"><span class="hs-identifier hs-var">filterOutInvisibleTypes</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">classTyCon</span><span> </span><a href="#local-6989586621679592921"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592922"><span class="hs-identifier hs-var">kts</span></a><span>
</span><a name="line-1923"></a><span>
</span><a name="line-1924"></a><span class="hs-identifier">hasTyVarHead</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1925"></a><span class="hs-comment">-- Returns true of (a t1 .. tn), where 'a' is a type variable</span><span>
</span><a name="line-1926"></a><a name="hasTyVarHead"><a href="TcType.html#hasTyVarHead"><span class="hs-identifier">hasTyVarHead</span></a></a><span> </span><a name="local-6989586621679592924"><a href="#local-6989586621679592924"><span class="hs-identifier">ty</span></a></a><span>                 </span><span class="hs-comment">-- Haskell 98 allows predicates of form</span><span>
</span><a name="line-1927"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcType.html#tcIsTyVarTy"><span class="hs-identifier hs-var">tcIsTyVarTy</span></a><span> </span><a href="#local-6989586621679592924"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>       </span><span class="hs-comment">--      C (a ty1 .. tyn)</span><span>
</span><a name="line-1928"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                   </span><span class="hs-comment">-- where a is a type variable</span><span>
</span><a name="line-1929"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcSplitAppTy_maybe"><span class="hs-identifier hs-var">tcSplitAppTy_maybe</span></a><span> </span><a href="#local-6989586621679592924"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1930"></a><span>       </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679592925"><a href="#local-6989586621679592925"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#hasTyVarHead"><span class="hs-identifier hs-var">hasTyVarHead</span></a><span> </span><a href="#local-6989586621679592925"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1931"></a><span>       </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1932"></a><span>
</span><a name="line-1933"></a><span class="hs-identifier">evVarPred_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span>
</span><a name="line-1934"></a><a name="evVarPred_maybe"><a href="TcType.html#evVarPred_maybe"><span class="hs-identifier">evVarPred_maybe</span></a></a><span> </span><a name="local-6989586621679592926"><a href="#local-6989586621679592926"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-6989586621679592927"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679592927"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1935"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679592927"><a href="#local-6989586621679592927"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679592926"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1936"></a><span>
</span><a name="line-1937"></a><span class="hs-identifier">evVarPred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span>
</span><a name="line-1938"></a><a name="evVarPred"><a href="TcType.html#evVarPred"><span class="hs-identifier">evVarPred</span></a></a><span> </span><a name="local-6989586621679592928"><a href="#local-6989586621679592928"><span class="hs-identifier">var</span></a></a><span>
</span><a name="line-1939"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a><span>
</span><a name="line-1940"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#evVarPred_maybe"><span class="hs-identifier hs-var">evVarPred_maybe</span></a><span> </span><a href="#local-6989586621679592928"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1941"></a><span>      </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592929"><a href="#local-6989586621679592929"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592929"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-1942"></a><span>      </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tcEvVarPred&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679592928"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679592928"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1943"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1944"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679592928"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-1945"></a><span>
</span><a name="line-1946"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-1947"></a><span class="hs-comment">-- | When inferring types, should we quantify over a given predicate?</span><span>
</span><a name="line-1948"></a><span class="hs-comment">-- Generally true of classes; generally false of equality constraints.</span><span>
</span><a name="line-1949"></a><span class="hs-comment">-- Equality constraints that mention quantified type variables and</span><span>
</span><a name="line-1950"></a><span class="hs-comment">-- implicit variables complicate the story. See Notes</span><span>
</span><a name="line-1951"></a><span class="hs-comment">-- [Inheriting implicit parameters] and [Quantifying over equality constraints]</span><span>
</span><a name="line-1952"></a><span class="hs-identifier">pickQuantifiablePreds</span><span>
</span><a name="line-1953"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a><span>           </span><span class="hs-comment">-- Quantifying over these</span><span>
</span><a name="line-1954"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span>        </span><span class="hs-comment">-- Proposed constraints to quantify</span><span>
</span><a name="line-1955"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span>        </span><span class="hs-comment">-- A subset that we can actually quantify</span><span>
</span><a name="line-1956"></a><span class="hs-comment">-- This function decides whether a particular constraint should be</span><span>
</span><a name="line-1957"></a><span class="hs-comment">-- quantified over, given the type variables that are being quantified</span><span>
</span><a name="line-1958"></a><a name="pickQuantifiablePreds"><a href="TcType.html#pickQuantifiablePreds"><span class="hs-identifier">pickQuantifiablePreds</span></a></a><span> </span><a name="local-6989586621679592930"><a href="#local-6989586621679592930"><span class="hs-identifier">qtvs</span></a></a><span> </span><a name="local-6989586621679592931"><a href="#local-6989586621679592931"><span class="hs-identifier">theta</span></a></a><span>
</span><a name="line-1959"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679592950"><a href="#local-6989586621679592950"><span class="hs-identifier">flex_ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-keyword">in</span><span>  </span><span class="hs-comment">-- Quantify over non-tyvar constraints, even without</span><span>
</span><a name="line-1960"></a><span>                             </span><span class="hs-comment">-- -XFlexibleContexts: see Trac #10608, #10351</span><span>
</span><a name="line-1961"></a><span>         </span><span class="hs-comment">-- flex_ctxt &lt;- xoptM Opt_FlexibleContexts</span><span>
</span><a name="line-1962"></a><span>    </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592932"><span class="hs-identifier hs-var">pick_me</span></a><span> </span><a href="#local-6989586621679592950"><span class="hs-identifier hs-var">flex_ctxt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592931"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-1963"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1964"></a><span>    </span><a name="local-6989586621679592932"><a href="#local-6989586621679592932"><span class="hs-identifier">pick_me</span></a></a><span> </span><a name="local-6989586621679592935"><a href="#local-6989586621679592935"><span class="hs-identifier">flex_ctxt</span></a></a><span> </span><a name="local-6989586621679592936"><a href="#local-6989586621679592936"><span class="hs-identifier">pred</span></a></a><span>
</span><a name="line-1965"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a><span> </span><a href="#local-6989586621679592936"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1966"></a><span>
</span><a name="line-1967"></a><span>          </span><a href="Type.html#ClassPred"><span class="hs-identifier hs-var">ClassPred</span></a><span> </span><a name="local-6989586621679592937"><a href="#local-6989586621679592937"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621679592938"><a href="#local-6989586621679592938"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1968"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#isCallStackPred"><span class="hs-identifier hs-var">isCallStackPred</span></a><span> </span><a href="#local-6989586621679592937"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-6989586621679592938"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1969"></a><span>              </span><span class="hs-comment">-- NEVER infer a CallStack constraint</span><span>
</span><a name="line-1970"></a><span>              </span><span class="hs-comment">-- Otherwise, we let the constraints bubble up to be</span><span>
</span><a name="line-1971"></a><span>              </span><span class="hs-comment">-- solved from the outer context, or be defaulted when we</span><span>
</span><a name="line-1972"></a><span>              </span><span class="hs-comment">-- reach the top-level.</span><span>
</span><a name="line-1973"></a><span>              </span><span class="hs-comment">-- see Note [Overview of implicit CallStacks]</span><span>
</span><a name="line-1974"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1975"></a><span>
</span><a name="line-1976"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isIPClass"><span class="hs-identifier hs-var">isIPClass</span></a><span> </span><a href="#local-6989586621679592937"><span class="hs-identifier hs-var">cls</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-comment">-- See note [Inheriting implicit parameters]</span><span>
</span><a name="line-1977"></a><span>
</span><a name="line-1978"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1979"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592933"><span class="hs-identifier hs-var">pick_cls_pred</span></a><span> </span><a href="#local-6989586621679592935"><span class="hs-identifier hs-var">flex_ctxt</span></a><span> </span><a href="#local-6989586621679592937"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-6989586621679592938"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1980"></a><span>
</span><a name="line-1981"></a><span>          </span><a href="Type.html#EqPred"><span class="hs-identifier hs-var">EqPred</span></a><span> </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span> </span><a name="local-6989586621679592939"><a href="#local-6989586621679592939"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679592940"><a href="#local-6989586621679592940"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592933"><span class="hs-identifier hs-var">pick_cls_pred</span></a><span> </span><a href="#local-6989586621679592935"><span class="hs-identifier hs-var">flex_ctxt</span></a><span> </span><a href="TysWiredIn.html#coercibleClass"><span class="hs-identifier hs-var">coercibleClass</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679592939"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592940"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span>
</span><a name="line-1982"></a><span>            </span><span class="hs-comment">-- representational equality is like a class constraint</span><span>
</span><a name="line-1983"></a><span>
</span><a name="line-1984"></a><span>          </span><a href="Type.html#EqPred"><span class="hs-identifier hs-var">EqPred</span></a><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span> </span><a name="local-6989586621679592941"><a href="#local-6989586621679592941"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679592942"><a href="#local-6989586621679592942"><span class="hs-identifier">ty2</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679592934"><span class="hs-identifier hs-var">quant_fun</span></a><span> </span><a href="#local-6989586621679592941"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679592934"><span class="hs-identifier hs-var">quant_fun</span></a><span> </span><a href="#local-6989586621679592942"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1985"></a><span>          </span><a href="Type.html#IrredPred"><span class="hs-identifier hs-var">IrredPred</span></a><span> </span><a name="local-6989586621679592943"><a href="#local-6989586621679592943"><span class="hs-identifier">ty</span></a></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-6989586621679592943"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#intersectsVarSet"><span class="hs-identifier hs-var">intersectsVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592930"><span class="hs-identifier hs-var">qtvs</span></a><span>
</span><a name="line-1986"></a><span>
</span><a name="line-1987"></a><span>    </span><a name="local-6989586621679592933"><a href="#local-6989586621679592933"><span class="hs-identifier">pick_cls_pred</span></a></a><span> </span><a name="local-6989586621679592944"><a href="#local-6989586621679592944"><span class="hs-identifier">flex_ctxt</span></a></a><span> </span><a name="local-6989586621679592945"><a href="#local-6989586621679592945"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621679592946"><a href="#local-6989586621679592946"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1988"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-6989586621679592946"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#intersectsVarSet"><span class="hs-identifier hs-var">intersectsVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592930"><span class="hs-identifier hs-var">qtvs</span></a><span>
</span><a name="line-1989"></a><span>        </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="TcType.html#checkValidClsArgs"><span class="hs-identifier hs-var">checkValidClsArgs</span></a><span> </span><a href="#local-6989586621679592944"><span class="hs-identifier hs-var">flex_ctxt</span></a><span> </span><a href="#local-6989586621679592945"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-6989586621679592946"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1990"></a><span>           </span><span class="hs-comment">-- Only quantify over predicates that checkValidType</span><span>
</span><a name="line-1991"></a><span>           </span><span class="hs-comment">-- will pass!  See Trac #10351.</span><span>
</span><a name="line-1992"></a><span>
</span><a name="line-1993"></a><span>    </span><span class="hs-comment">-- See Note [Quantifying over equality constraints]</span><span>
</span><a name="line-1994"></a><span>    </span><a name="local-6989586621679592934"><a href="#local-6989586621679592934"><span class="hs-identifier">quant_fun</span></a></a><span> </span><a name="local-6989586621679592947"><a href="#local-6989586621679592947"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1995"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679592947"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1996"></a><span>          </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679592948"><a href="#local-6989586621679592948"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592949"><a href="#local-6989586621679592949"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a><span> </span><a href="#local-6989586621679592948"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1997"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-6989586621679592949"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#intersectsVarSet"><span class="hs-identifier hs-var">intersectsVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592930"><span class="hs-identifier hs-var">qtvs</span></a><span>
</span><a name="line-1998"></a><span>          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1999"></a><span>
</span><a name="line-2000"></a><span class="hs-identifier">pickCapturedPreds</span><span>
</span><a name="line-2001"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a><span>           </span><span class="hs-comment">-- Quantifying over these</span><span>
</span><a name="line-2002"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span>        </span><span class="hs-comment">-- Proposed constraints to quantify</span><span>
</span><a name="line-2003"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span>        </span><span class="hs-comment">-- A subset that we can actually quantify</span><span>
</span><a name="line-2004"></a><span class="hs-comment">-- A simpler version of pickQuantifiablePreds, used to winnow down</span><span>
</span><a name="line-2005"></a><span class="hs-comment">-- the inferred constraints of a group of bindings, into those for</span><span>
</span><a name="line-2006"></a><span class="hs-comment">-- one particular identifier</span><span>
</span><a name="line-2007"></a><a name="pickCapturedPreds"><a href="TcType.html#pickCapturedPreds"><span class="hs-identifier">pickCapturedPreds</span></a></a><span> </span><a name="local-6989586621679592951"><a href="#local-6989586621679592951"><span class="hs-identifier">qtvs</span></a></a><span> </span><a name="local-6989586621679592952"><a href="#local-6989586621679592952"><span class="hs-identifier">theta</span></a></a><span>
</span><a name="line-2008"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="#local-6989586621679592953"><span class="hs-identifier hs-var">captured</span></a><span> </span><a href="#local-6989586621679592952"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-2009"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2010"></a><span>    </span><a name="local-6989586621679592953"><a href="#local-6989586621679592953"><span class="hs-identifier">captured</span></a></a><span> </span><a name="local-6989586621679592954"><a href="#local-6989586621679592954"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isIPPred"><span class="hs-identifier hs-var">isIPPred</span></a><span> </span><a href="#local-6989586621679592954"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-6989586621679592954"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#intersectsVarSet"><span class="hs-identifier hs-var">intersectsVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592951"><span class="hs-identifier hs-var">qtvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2011"></a><span>
</span><a name="line-2012"></a><span>
</span><a name="line-2013"></a><span class="hs-comment">-- Superclasses</span><span>
</span><a name="line-2014"></a><span>
</span><a name="line-2015"></a><span class="hs-keyword">type</span><span> </span><a name="PredWithSCs"><a href="TcType.html#PredWithSCs"><span class="hs-identifier">PredWithSCs</span></a></a><span> </span><a name="local-6989586621679592391"><a href="#local-6989586621679592391"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592391"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-2016"></a><span>
</span><a name="line-2017"></a><span class="hs-identifier">mkMinimalBySCs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679592405"><a href="#local-6989586621679592405"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592405"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679592405"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679592405"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-2018"></a><span class="hs-comment">-- Remove predicates that</span><span>
</span><a name="line-2019"></a><span class="hs-comment">--</span><span>
</span><a name="line-2020"></a><span class="hs-comment">--   - are the same as another predicate</span><span>
</span><a name="line-2021"></a><span class="hs-comment">--</span><span>
</span><a name="line-2022"></a><span class="hs-comment">--   - can be deduced from another by superclasses,</span><span>
</span><a name="line-2023"></a><span class="hs-comment">--</span><span>
</span><a name="line-2024"></a><span class="hs-comment">--   - are a reflexive equality (e.g  * ~ *)</span><span>
</span><a name="line-2025"></a><span class="hs-comment">--     (see Note [Remove redundant provided dicts] in PatSyn)</span><span>
</span><a name="line-2026"></a><span class="hs-comment">--</span><span>
</span><a name="line-2027"></a><span class="hs-comment">-- The result is a subset of the input.</span><span>
</span><a name="line-2028"></a><span class="hs-comment">-- The 'a' is just paired up with the PredType;</span><span>
</span><a name="line-2029"></a><span class="hs-comment">--   typically it might be a dictionary Id</span><span>
</span><a name="line-2030"></a><a name="mkMinimalBySCs"><a href="TcType.html#mkMinimalBySCs"><span class="hs-identifier">mkMinimalBySCs</span></a></a><span> </span><a name="local-6989586621679592955"><a href="#local-6989586621679592955"><span class="hs-identifier">get_pred</span></a></a><span> </span><a name="local-6989586621679592956"><a href="#local-6989586621679592956"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592958"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592957"><span class="hs-identifier hs-var">preds_with_scs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2031"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2032"></a><span>   </span><span class="hs-identifier">preds_with_scs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcType.html#PredWithSCs"><span class="hs-identifier hs-type">PredWithSCs</span></a><span> </span><a href="#local-6989586621679592405"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-2033"></a><span>   </span><a name="local-6989586621679592957"><a href="#local-6989586621679592957"><span class="hs-identifier">preds_with_scs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592961"><span class="hs-identifier hs-var">pred</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592961"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="TcType.html#transSuperClasses"><span class="hs-identifier hs-var">transSuperClasses</span></a><span> </span><a href="#local-6989586621679592961"><span class="hs-identifier hs-var">pred</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592960"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-2034"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679592960"><a href="#local-6989586621679592960"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679592956"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-2035"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679592961"><a href="#local-6989586621679592961"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592955"><span class="hs-identifier hs-var">get_pred</span></a><span> </span><a href="#local-6989586621679592960"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2036"></a><span>
</span><a name="line-2037"></a><span>   </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcType.html#PredWithSCs"><span class="hs-identifier hs-type">PredWithSCs</span></a><span> </span><a href="#local-6989586621679592405"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- Work list</span><span>
</span><a name="line-2038"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#PredWithSCs"><span class="hs-identifier hs-type">PredWithSCs</span></a><span> </span><a href="#local-6989586621679592405"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- Accumulating result</span><span>
</span><a name="line-2039"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679592405"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-2040"></a><span>   </span><a name="local-6989586621679592958"><a href="#local-6989586621679592958"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679592962"><a href="#local-6989586621679592962"><span class="hs-identifier">min_preds</span></a></a><span>
</span><a name="line-2041"></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Util.html#thdOf3"><span class="hs-identifier hs-var">thdOf3</span></a><span> </span><a href="#local-6989586621679592962"><span class="hs-identifier hs-var">min_preds</span></a><span class="hs-special">)</span><span>
</span><a name="line-2042"></a><span>       </span><span class="hs-comment">-- The 'reverse' isn't strictly necessary, but it</span><span>
</span><a name="line-2043"></a><span>       </span><span class="hs-comment">-- means that the results are returned in the same</span><span>
</span><a name="line-2044"></a><span>       </span><span class="hs-comment">-- order as the input, which is generally saner</span><span>
</span><a name="line-2045"></a><span>   </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679592963"><a href="#local-6989586621679592963"><span class="hs-identifier">work_item</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679592964"><a href="#local-6989586621679592964"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679592965"><a href="#local-6989586621679592965"><span class="hs-identifier">work_list</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679592966"><a href="#local-6989586621679592966"><span class="hs-identifier">min_preds</span></a></a><span>
</span><a name="line-2046"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#EqPred"><span class="hs-identifier hs-var">EqPred</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679592967"><a href="#local-6989586621679592967"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679592968"><a href="#local-6989586621679592968"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a><span> </span><a href="#local-6989586621679592964"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-2047"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679592967"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">`</span><a href="TcType.html#tcEqType"><span class="hs-identifier hs-var">tcEqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592968"><span class="hs-identifier hs-var">t2</span></a><span>   </span><span class="hs-comment">-- See Note [Discard reflexive equalities]</span><span>
</span><a name="line-2048"></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592958"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592965"><span class="hs-identifier hs-var">work_list</span></a><span> </span><a href="#local-6989586621679592966"><span class="hs-identifier hs-var">min_preds</span></a><span>
</span><a name="line-2049"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679592964"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621679592959"><span class="hs-identifier hs-var">in_cloud</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592965"><span class="hs-identifier hs-var">work_list</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679592964"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621679592959"><span class="hs-identifier hs-var">in_cloud</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592966"><span class="hs-identifier hs-var">min_preds</span></a><span>
</span><a name="line-2050"></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592958"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592965"><span class="hs-identifier hs-var">work_list</span></a><span> </span><a href="#local-6989586621679592966"><span class="hs-identifier hs-var">min_preds</span></a><span>
</span><a name="line-2051"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2052"></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592958"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592965"><span class="hs-identifier hs-var">work_list</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592963"><span class="hs-identifier hs-var">work_item</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679592966"><span class="hs-identifier hs-var">min_preds</span></a><span class="hs-special">)</span><span>
</span><a name="line-2053"></a><span>
</span><a name="line-2054"></a><span>   </span><span class="hs-identifier">in_cloud</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#PredWithSCs"><span class="hs-identifier hs-type">PredWithSCs</span></a><span> </span><a href="#local-6989586621679592405"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2055"></a><span>   </span><a name="local-6989586621679592959"><a href="#local-6989586621679592959"><span class="hs-identifier">in_cloud</span></a></a><span> </span><a name="local-6989586621679592969"><a href="#local-6989586621679592969"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679592970"><a href="#local-6989586621679592970"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#or"><span class="hs-identifier hs-var">or</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679592969"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="TcType.html#tcEqType"><span class="hs-identifier hs-var">tcEqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592972"><span class="hs-identifier hs-var">p'</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679592971"><a href="#local-6989586621679592971"><span class="hs-identifier">scs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679592970"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679592972"><a href="#local-6989586621679592972"><span class="hs-identifier">p'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679592971"><span class="hs-identifier hs-var">scs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2056"></a><span>
</span><a name="line-2057"></a><span class="hs-identifier">transSuperClasses</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span>
</span><a name="line-2058"></a><span class="hs-comment">-- (transSuperClasses p) returns (p's superclasses) not including p</span><span>
</span><a name="line-2059"></a><span class="hs-comment">-- Stop if you encounter the same class again</span><span>
</span><a name="line-2060"></a><span class="hs-comment">-- See Note [Expanding superclasses]</span><span>
</span><a name="line-2061"></a><a name="transSuperClasses"><a href="TcType.html#transSuperClasses"><span class="hs-identifier">transSuperClasses</span></a></a><span> </span><a name="local-6989586621679592973"><a href="#local-6989586621679592973"><span class="hs-identifier">p</span></a></a><span>
</span><a name="line-2062"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592974"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span> </span><a href="#local-6989586621679592973"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-2063"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2064"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span>
</span><a name="line-2065"></a><span>    </span><a name="local-6989586621679592974"><a href="#local-6989586621679592974"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679592975"><a href="#local-6989586621679592975"><span class="hs-identifier">rec_clss</span></a></a><span> </span><a name="local-6989586621679592976"><a href="#local-6989586621679592976"><span class="hs-identifier">p</span></a></a><span>
</span><a name="line-2066"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#ClassPred"><span class="hs-identifier hs-var">ClassPred</span></a><span> </span><a name="local-6989586621679592977"><a href="#local-6989586621679592977"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621679592978"><a href="#local-6989586621679592978"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a><span> </span><a href="#local-6989586621679592976"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-2067"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679592979"><a href="#local-6989586621679592979"><span class="hs-identifier">cls_nm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">className</span><span> </span><a href="#local-6989586621679592977"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-2068"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592979"><span class="hs-identifier hs-var">cls_nm</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592975"><span class="hs-identifier hs-var">rec_clss</span></a><span class="hs-special">)</span><span>
</span><a name="line-2069"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679592980"><a href="#local-6989586621679592980"><span class="hs-identifier">rec_clss'</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isCTupleClass"><span class="hs-identifier hs-var">isCTupleClass</span></a><span> </span><a href="#local-6989586621679592977"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592975"><span class="hs-identifier hs-var">rec_clss</span></a><span>
</span><a name="line-2070"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679592975"><span class="hs-identifier hs-var">rec_clss</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#extendNameSet"><span class="hs-identifier hs-var">extendNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592979"><span class="hs-identifier hs-var">cls_nm</span></a><span>
</span><a name="line-2071"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679592982"><span class="hs-identifier hs-var">p'</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679592981"><a href="#local-6989586621679592981"><span class="hs-identifier">sc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#immSuperClasses"><span class="hs-identifier hs-var">immSuperClasses</span></a><span> </span><a href="#local-6989586621679592977"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-6989586621679592978"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2072"></a><span>              </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679592982"><a href="#local-6989586621679592982"><span class="hs-identifier">p'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679592981"><span class="hs-identifier hs-var">sc</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679592974"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679592980"><span class="hs-identifier hs-var">rec_clss'</span></a><span> </span><a href="#local-6989586621679592981"><span class="hs-identifier hs-var">sc</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2073"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2074"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2075"></a><span>
</span><a name="line-2076"></a><span class="hs-identifier">immSuperClasses</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span>
</span><a name="line-2077"></a><a name="immSuperClasses"><a href="TcType.html#immSuperClasses"><span class="hs-identifier">immSuperClasses</span></a></a><span> </span><a name="local-6989586621679592983"><a href="#local-6989586621679592983"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621679592984"><a href="#local-6989586621679592984"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-2078"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span> </span><a href="#local-6989586621679592985"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><a href="#local-6989586621679592984"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679592986"><span class="hs-identifier hs-var">sc_theta</span></a><span>
</span><a name="line-2079"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2080"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679592985"><a href="#local-6989586621679592985"><span class="hs-identifier">tyvars</span></a></a><span class="hs-special">,</span><a name="local-6989586621679592986"><a href="#local-6989586621679592986"><span class="hs-identifier">sc_theta</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Class.html#classBigSig"><span class="hs-identifier hs-var">classBigSig</span></a><span> </span><a href="#local-6989586621679592983"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-2081"></a><span>
</span><a name="line-2082"></a><span class="hs-identifier">isImprovementPred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2083"></a><span class="hs-comment">-- Either it's an equality, or has some functional dependency</span><span>
</span><a name="line-2084"></a><a name="isImprovementPred"><a href="TcType.html#isImprovementPred"><span class="hs-identifier">isImprovementPred</span></a></a><span> </span><a name="local-6989586621679592987"><a href="#local-6989586621679592987"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2085"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a><span> </span><a href="#local-6989586621679592987"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2086"></a><span>      </span><a href="Type.html#EqPred"><span class="hs-identifier hs-var">EqPred</span></a><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span> </span><a name="local-6989586621679592988"><a href="#local-6989586621679592988"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679592989"><a href="#local-6989586621679592989"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679592988"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">`</span><a href="TcType.html#tcEqType"><span class="hs-identifier hs-var">tcEqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679592989"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2087"></a><span>      </span><a href="Type.html#EqPred"><span class="hs-identifier hs-var">EqPred</span></a><span> </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2088"></a><span>      </span><a href="Type.html#ClassPred"><span class="hs-identifier hs-var">ClassPred</span></a><span> </span><a name="local-6989586621679592990"><a href="#local-6989586621679592990"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#classHasFds"><span class="hs-identifier hs-var">classHasFds</span></a><span> </span><a href="#local-6989586621679592990"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-2089"></a><span>      </span><a href="Type.html#IrredPred"><span class="hs-identifier hs-var">IrredPred</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-comment">-- Might have equalities after reduction?</span><span>
</span><a name="line-2090"></a><span>
</span><a name="line-2091"></a><span class="hs-comment">{- Note [Expanding superclasses]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we expand superclasses, we use the following algorithm:

expand( so_far, pred ) returns the transitive superclasses of pred,
                               not including pred itself
 1. If pred is not a class constraint, return empty set
       Otherwise pred = C ts
 2. If C is in so_far, return empty set (breaks loops)
 3. Find the immediate superclasses constraints of (C ts)
 4. For each such sc_pred, return (sc_pred : expand( so_far+C, D ss )

Notice that

 * With normal Haskell-98 classes, the loop-detector will never bite,
   so we'll get all the superclasses.

 * Since there is only a finite number of distinct classes, expansion
   must terminate.

 * The loop breaking is a bit conservative. Notably, a tuple class
   could contain many times without threatening termination:
      (Eq a, (Ord a, Ix a))
   And this is try of any class that we can statically guarantee
   as non-recursive (in some sense).  For now, we just make a special
   case for tuples.  Something better would be cool.

See also TcTyDecls.checkClassCycles.

Note [Inheriting implicit parameters]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this:

        f x = (x::Int) + ?y

where f is *not* a top-level binding.
From the RHS of f we'll get the constraint (?y::Int).
There are two types we might infer for f:

        f :: Int -&gt; Int

(so we get ?y from the context of f's definition), or

        f :: (?y::Int) =&gt; Int -&gt; Int

At first you might think the first was better, because then
?y behaves like a free variable of the definition, rather than
having to be passed at each call site.  But of course, the WHOLE
IDEA is that ?y should be passed at each call site (that's what
dynamic binding means) so we'd better infer the second.

BOTTOM LINE: when *inferring types* you must quantify over implicit
parameters, *even if* they don't mention the bound type variables.
Reason: because implicit parameters, uniquely, have local instance
declarations. See pickQuantifiablePreds.

Note [Quantifying over equality constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Should we quantify over an equality constraint (s ~ t)?  In general, we don't.
Doing so may simply postpone a type error from the function definition site to
its call site.  (At worst, imagine (Int ~ Bool)).

However, consider this
         forall a. (F [a] ~ Int) =&gt; blah
Should we quantify over the (F [a] ~ Int).  Perhaps yes, because at the call
site we will know 'a', and perhaps we have instance  F [Bool] = Int.
So we *do* quantify over a type-family equality where the arguments mention
the quantified variables.

************************************************************************
*                                                                      *
\subsection{Predicates}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2166"></a><span>
</span><a name="line-2167"></a><span class="hs-identifier">isSigmaTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2168"></a><span class="hs-comment">-- isSigmaTy returns true of any qualified type.  It doesn't</span><span>
</span><a name="line-2169"></a><span class="hs-comment">-- *necessarily* have any foralls.  E.g</span><span>
</span><a name="line-2170"></a><span class="hs-comment">--        f :: (?x::Int) =&gt; Int -&gt; Int</span><span>
</span><a name="line-2171"></a><a name="isSigmaTy"><a href="TcType.html#isSigmaTy"><span class="hs-identifier">isSigmaTy</span></a></a><span> </span><a name="local-6989586621679592991"><a href="#local-6989586621679592991"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592992"><a href="#local-6989586621679592992"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592991"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#isSigmaTy"><span class="hs-identifier hs-var">isSigmaTy</span></a><span> </span><a href="#local-6989586621679592992"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-2172"></a><span class="hs-identifier">isSigmaTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2173"></a><span class="hs-identifier">isSigmaTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679592993"><a href="#local-6989586621679592993"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-6989586621679592993"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-2174"></a><span class="hs-identifier">isSigmaTy</span><span> </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2175"></a><span>
</span><a name="line-2176"></a><span class="hs-identifier">isRhoTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>   </span><span class="hs-comment">-- True of TcRhoTypes; see Note [TcRhoType]</span><span>
</span><a name="line-2177"></a><a name="isRhoTy"><a href="TcType.html#isRhoTy"><span class="hs-identifier">isRhoTy</span></a></a><span> </span><a name="local-6989586621679592994"><a href="#local-6989586621679592994"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679592995"><a href="#local-6989586621679592995"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592994"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#isRhoTy"><span class="hs-identifier hs-var">isRhoTy</span></a><span> </span><a href="#local-6989586621679592995"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-2178"></a><span class="hs-identifier">isRhoTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2179"></a><span class="hs-identifier">isRhoTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679592996"><a href="#local-6989586621679592996"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679592997"><a href="#local-6989586621679592997"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-6989586621679592996"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="TcType.html#isRhoTy"><span class="hs-identifier hs-var">isRhoTy</span></a><span> </span><a href="#local-6989586621679592997"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-2180"></a><span class="hs-identifier">isRhoTy</span><span> </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2181"></a><span>
</span><a name="line-2182"></a><span class="hs-comment">-- | Like 'isRhoTy', but also says 'True' for 'Infer' types</span><span>
</span><a name="line-2183"></a><span class="hs-identifier">isRhoExpTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2184"></a><a name="isRhoExpTy"><a href="TcType.html#isRhoExpTy"><span class="hs-identifier">isRhoExpTy</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#Check"><span class="hs-identifier hs-var">Check</span></a><span> </span><a name="local-6989586621679592998"><a href="#local-6989586621679592998"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#isRhoTy"><span class="hs-identifier hs-var">isRhoTy</span></a><span> </span><a href="#local-6989586621679592998"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2185"></a><span class="hs-identifier">isRhoExpTy</span><span> </span><span class="hs-special">(</span><a href="TcType.html#Infer"><span class="hs-identifier hs-var">Infer</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2186"></a><span>
</span><a name="line-2187"></a><span class="hs-identifier">isOverloadedTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2188"></a><span class="hs-comment">-- Yes for a type of a function that might require evidence-passing</span><span>
</span><a name="line-2189"></a><span class="hs-comment">-- Used only by bindLocalMethods</span><span>
</span><a name="line-2190"></a><a name="isOverloadedTy"><a href="TcType.html#isOverloadedTy"><span class="hs-identifier">isOverloadedTy</span></a></a><span> </span><a name="local-6989586621679592999"><a href="#local-6989586621679592999"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679593000"><a href="#local-6989586621679593000"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679592999"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#isOverloadedTy"><span class="hs-identifier hs-var">isOverloadedTy</span></a><span> </span><a href="#local-6989586621679593000"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-2191"></a><span class="hs-identifier">isOverloadedTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><a name="local-6989586621679593001"><a href="#local-6989586621679593001"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#isOverloadedTy"><span class="hs-identifier hs-var">isOverloadedTy</span></a><span> </span><a href="#local-6989586621679593001"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2192"></a><span class="hs-identifier">isOverloadedTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679593002"><a href="#local-6989586621679593002"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-6989586621679593002"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-2193"></a><span class="hs-identifier">isOverloadedTy</span><span> </span><span class="hs-identifier">_</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2194"></a><span>
</span><a name="line-2195"></a><span class="hs-identifier">isFloatTy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isDoubleTy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isIntegerTy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isIntTy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isWordTy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isBoolTy</span><span class="hs-special">,</span><span>
</span><a name="line-2196"></a><span>    </span><span class="hs-identifier">isUnitTy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isCharTy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isAnyTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2197"></a><a name="isFloatTy"><a href="TcType.html#isFloatTy"><span class="hs-identifier">isFloatTy</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#is_tc"><span class="hs-identifier hs-var">is_tc</span></a><span> </span><a href="PrelNames.html#floatTyConKey"><span class="hs-identifier hs-var">floatTyConKey</span></a><span>
</span><a name="line-2198"></a><a name="isDoubleTy"><a href="TcType.html#isDoubleTy"><span class="hs-identifier">isDoubleTy</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#is_tc"><span class="hs-identifier hs-var">is_tc</span></a><span> </span><a href="PrelNames.html#doubleTyConKey"><span class="hs-identifier hs-var">doubleTyConKey</span></a><span>
</span><a name="line-2199"></a><a name="isIntegerTy"><a href="TcType.html#isIntegerTy"><span class="hs-identifier">isIntegerTy</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#is_tc"><span class="hs-identifier hs-var">is_tc</span></a><span> </span><a href="PrelNames.html#integerTyConKey"><span class="hs-identifier hs-var">integerTyConKey</span></a><span>
</span><a name="line-2200"></a><a name="isIntTy"><a href="TcType.html#isIntTy"><span class="hs-identifier">isIntTy</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#is_tc"><span class="hs-identifier hs-var">is_tc</span></a><span> </span><a href="PrelNames.html#intTyConKey"><span class="hs-identifier hs-var">intTyConKey</span></a><span>
</span><a name="line-2201"></a><a name="isWordTy"><a href="TcType.html#isWordTy"><span class="hs-identifier">isWordTy</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#is_tc"><span class="hs-identifier hs-var">is_tc</span></a><span> </span><a href="PrelNames.html#wordTyConKey"><span class="hs-identifier hs-var">wordTyConKey</span></a><span>
</span><a name="line-2202"></a><a name="isBoolTy"><a href="TcType.html#isBoolTy"><span class="hs-identifier">isBoolTy</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#is_tc"><span class="hs-identifier hs-var">is_tc</span></a><span> </span><a href="PrelNames.html#boolTyConKey"><span class="hs-identifier hs-var">boolTyConKey</span></a><span>
</span><a name="line-2203"></a><a name="isUnitTy"><a href="TcType.html#isUnitTy"><span class="hs-identifier">isUnitTy</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#is_tc"><span class="hs-identifier hs-var">is_tc</span></a><span> </span><a href="TysWiredIn.html#unitTyConKey"><span class="hs-identifier hs-var">unitTyConKey</span></a><span>
</span><a name="line-2204"></a><a name="isCharTy"><a href="TcType.html#isCharTy"><span class="hs-identifier">isCharTy</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#is_tc"><span class="hs-identifier hs-var">is_tc</span></a><span> </span><a href="PrelNames.html#charTyConKey"><span class="hs-identifier hs-var">charTyConKey</span></a><span>
</span><a name="line-2205"></a><a name="isAnyTy"><a href="TcType.html#isAnyTy"><span class="hs-identifier">isAnyTy</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#is_tc"><span class="hs-identifier hs-var">is_tc</span></a><span> </span><a href="PrelNames.html#anyTyConKey"><span class="hs-identifier hs-var">anyTyConKey</span></a><span>
</span><a name="line-2206"></a><span>
</span><a name="line-2207"></a><span class="hs-comment">-- | Does a type represent a floating-point number?</span><span>
</span><a name="line-2208"></a><span class="hs-identifier">isFloatingTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2209"></a><a name="isFloatingTy"><a href="TcType.html#isFloatingTy"><span class="hs-identifier">isFloatingTy</span></a></a><span> </span><a name="local-6989586621679593003"><a href="#local-6989586621679593003"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#isFloatTy"><span class="hs-identifier hs-var">isFloatTy</span></a><span> </span><a href="#local-6989586621679593003"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="TcType.html#isDoubleTy"><span class="hs-identifier hs-var">isDoubleTy</span></a><span> </span><a href="#local-6989586621679593003"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2210"></a><span>
</span><a name="line-2211"></a><span class="hs-comment">-- | Is a type 'String'?</span><span>
</span><a name="line-2212"></a><span class="hs-identifier">isStringTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2213"></a><a name="isStringTy"><a href="TcType.html#isStringTy"><span class="hs-identifier">isStringTy</span></a></a><span> </span><a name="local-6989586621679593004"><a href="#local-6989586621679593004"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2214"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679593004"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2215"></a><span>      </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679593005"><a href="#local-6989586621679593005"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679593006"><a href="#local-6989586621679593006"><span class="hs-identifier">arg_ty</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679593005"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="TysWiredIn.html#listTyCon"><span class="hs-identifier hs-var">listTyCon</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="TcType.html#isCharTy"><span class="hs-identifier hs-var">isCharTy</span></a><span> </span><a href="#local-6989586621679593006"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-2216"></a><span>      </span><span class="hs-identifier">_</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2217"></a><span>
</span><a name="line-2218"></a><span class="hs-comment">-- | Is a type a 'CallStack'?</span><span>
</span><a name="line-2219"></a><span class="hs-identifier">isCallStackTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2220"></a><a name="isCallStackTy"><a href="TcType.html#isCallStackTy"><span class="hs-identifier">isCallStackTy</span></a></a><span> </span><a name="local-6989586621679593007"><a href="#local-6989586621679593007"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2221"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679593008"><a href="#local-6989586621679593008"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a><span> </span><a href="#local-6989586621679593007"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2222"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593008"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#callStackTyConKey"><span class="hs-identifier hs-var">callStackTyConKey</span></a><span>
</span><a name="line-2223"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2224"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2225"></a><span>
</span><a name="line-2226"></a><span class="hs-comment">-- | Is a 'PredType' a 'CallStack' implicit parameter?</span><span>
</span><a name="line-2227"></a><span class="hs-comment">--</span><span>
</span><a name="line-2228"></a><span class="hs-comment">-- If so, return the name of the parameter.</span><span>
</span><a name="line-2229"></a><span class="hs-identifier">isCallStackPred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>
</span><a name="line-2230"></a><a name="isCallStackPred"><a href="TcType.html#isCallStackPred"><span class="hs-identifier">isCallStackPred</span></a></a><span> </span><a name="local-6989586621679593009"><a href="#local-6989586621679593009"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621679593010"><a href="#local-6989586621679593010"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-2231"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679593011"><a href="#local-6989586621679593011"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679593012"><a href="#local-6989586621679593012"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679593010"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2232"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Type.html#isIPClass"><span class="hs-identifier hs-var">isIPClass</span></a><span> </span><a href="#local-6989586621679593009"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-2233"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcType.html#isCallStackTy"><span class="hs-identifier hs-var">isCallStackTy</span></a><span> </span><a href="#local-6989586621679593012"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-2234"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isStrLitTy"><span class="hs-identifier hs-var">isStrLitTy</span></a><span> </span><a href="#local-6989586621679593011"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-2235"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2236"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-2237"></a><span>
</span><a name="line-2238"></a><span class="hs-identifier">hasIPPred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2239"></a><a name="hasIPPred"><a href="TcType.html#hasIPPred"><span class="hs-identifier">hasIPPred</span></a></a><span> </span><a name="local-6989586621679593013"><a href="#local-6989586621679593013"><span class="hs-identifier">pred</span></a></a><span>
</span><a name="line-2240"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a><span> </span><a href="#local-6989586621679593013"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2241"></a><span>      </span><a href="Type.html#ClassPred"><span class="hs-identifier hs-var">ClassPred</span></a><span> </span><a name="local-6989586621679593014"><a href="#local-6989586621679593014"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621679593015"><a href="#local-6989586621679593015"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-2242"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isIPClass"><span class="hs-identifier hs-var">isIPClass</span></a><span>     </span><a href="#local-6989586621679593014"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2243"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isCTupleClass"><span class="hs-identifier hs-var">isCTupleClass</span></a><span> </span><a href="#local-6989586621679593014"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><a href="TcType.html#hasIPPred"><span class="hs-identifier hs-var">hasIPPred</span></a><span> </span><a href="#local-6989586621679593015"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2244"></a><span>      </span><a name="local-6989586621679593016"><a href="#local-6989586621679593016"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2245"></a><span>
</span><a name="line-2246"></a><span class="hs-identifier">is_tc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2247"></a><span class="hs-comment">-- Newtypes are opaque to this</span><span>
</span><a name="line-2248"></a><a name="is_tc"><a href="TcType.html#is_tc"><span class="hs-identifier">is_tc</span></a></a><span> </span><a name="local-6989586621679593017"><a href="#local-6989586621679593017"><span class="hs-identifier">uniq</span></a></a><span> </span><a name="local-6989586621679593018"><a href="#local-6989586621679593018"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679593018"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2249"></a><span>                        </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679593019"><a href="#local-6989586621679593019"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679593017"><span class="hs-identifier hs-var">uniq</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621679593019"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2250"></a><span>                        </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2251"></a><span>
</span><a name="line-2252"></a><span class="hs-comment">-- | Does the given tyvar appear at the head of a chain of applications</span><span>
</span><a name="line-2253"></a><span class="hs-comment">--     (a t1 ... tn)</span><span>
</span><a name="line-2254"></a><span class="hs-identifier">isTyVarHead</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2255"></a><a name="isTyVarHead"><a href="TcType.html#isTyVarHead"><span class="hs-identifier">isTyVarHead</span></a></a><span> </span><a name="local-6989586621679593020"><a href="#local-6989586621679593020"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621679593021"><a href="#local-6989586621679593021"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593020"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679593021"><span class="hs-identifier hs-var">tv'</span></a><span>
</span><a name="line-2256"></a><span class="hs-identifier">isTyVarHead</span><span> </span><a name="local-6989586621679593022"><a href="#local-6989586621679593022"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621679593023"><a href="#local-6989586621679593023"><span class="hs-identifier">fun</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#isTyVarHead"><span class="hs-identifier hs-var">isTyVarHead</span></a><span> </span><a href="#local-6989586621679593022"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679593023"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-2257"></a><span class="hs-identifier">isTyVarHead</span><span> </span><a name="local-6989586621679593024"><a href="#local-6989586621679593024"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621679593025"><a href="#local-6989586621679593025"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#isTyVarHead"><span class="hs-identifier hs-var">isTyVarHead</span></a><span> </span><a href="#local-6989586621679593024"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679593025"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2258"></a><span class="hs-identifier">isTyVarHead</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2259"></a><span class="hs-identifier">isTyVarHead</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2260"></a><span class="hs-identifier">isTyVarHead</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2261"></a><span class="hs-identifier">isTyVarHead</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2262"></a><span class="hs-identifier">isTyVarHead</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2263"></a><span>
</span><a name="line-2264"></a><span class="hs-comment">-- | Is the equality</span><span>
</span><a name="line-2265"></a><span class="hs-comment">--        a ~r ...a....</span><span>
</span><a name="line-2266"></a><span class="hs-comment">-- definitely insoluble or not?</span><span>
</span><a name="line-2267"></a><span class="hs-comment">--      a ~r Maybe a      -- Definitely insoluble</span><span>
</span><a name="line-2268"></a><span class="hs-comment">--      a ~N ...(F a)...  -- Not definitely insoluble</span><span>
</span><a name="line-2269"></a><span class="hs-comment">--                        -- Perhaps (F a) reduces to Int</span><span>
</span><a name="line-2270"></a><span class="hs-comment">--      a ~R ...(N a)...  -- Not definitely insoluble</span><span>
</span><a name="line-2271"></a><span class="hs-comment">--                        -- Perhaps newtype N a = MkN Int</span><span>
</span><a name="line-2272"></a><span class="hs-comment">-- See Note [Occurs check error] in</span><span>
</span><a name="line-2273"></a><span class="hs-comment">-- TcCanonical for the motivation for this function.</span><span>
</span><a name="line-2274"></a><span class="hs-identifier">isInsolubleOccursCheck</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Type.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2275"></a><a name="isInsolubleOccursCheck"><a href="TcType.html#isInsolubleOccursCheck"><span class="hs-identifier">isInsolubleOccursCheck</span></a></a><span> </span><a name="local-6989586621679593026"><a href="#local-6989586621679593026"><span class="hs-identifier">eq_rel</span></a></a><span> </span><a name="local-6989586621679593027"><a href="#local-6989586621679593027"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679593028"><a href="#local-6989586621679593028"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2276"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593029"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593028"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2277"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2278"></a><span>    </span><a name="local-6989586621679593029"><a href="#local-6989586621679593029"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679593031"><a href="#local-6989586621679593031"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679593032"><a href="#local-6989586621679593032"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679593031"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593029"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593032"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-2279"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621679593033"><a href="#local-6989586621679593033"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593027"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679593033"><span class="hs-identifier hs-var">tv'</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679593029"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679593033"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2280"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2281"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621679593034"><a href="#local-6989586621679593034"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679593035"><a href="#local-6989586621679593035"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679593026"><span class="hs-identifier hs-var">eq_rel</span></a><span> </span><span class="hs-keyword">of</span><span>  </span><span class="hs-comment">-- See Note [AppTy and ReprEq]</span><span>
</span><a name="line-2282"></a><span>                         </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679593029"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593034"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679593029"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593035"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2283"></a><span>                         </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679593029"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593034"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-2284"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679593036"><a href="#local-6989586621679593036"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679593037"><a href="#local-6989586621679593037"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593029"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593036"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679593029"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593037"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2285"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TvBndr"><span class="hs-identifier hs-var">TvBndr</span></a><span> </span><a name="local-6989586621679593038"><a href="#local-6989586621679593038"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679593039"><a href="#local-6989586621679593039"><span class="hs-identifier">inner_ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2286"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679593038"><span class="hs-identifier hs-var">tv'</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679593027"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2287"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593029"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679593038"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679593029"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593039"><span class="hs-identifier hs-var">inner_ty</span></a><span>
</span><a name="line-2288"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621679593040"><a href="#local-6989586621679593040"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593029"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593040"><span class="hs-identifier hs-var">ty</span></a><span>   </span><span class="hs-comment">-- ToDo: what about the coercion</span><span>
</span><a name="line-2289"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>   </span><span class="hs-comment">-- ToDo: what about the coercion</span><span>
</span><a name="line-2290"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621679593041"><a href="#local-6989586621679593041"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679593042"><a href="#local-6989586621679593042"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2291"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isGenerativeTyCon"><span class="hs-identifier hs-var">isGenerativeTyCon</span></a><span> </span><a href="#local-6989586621679593041"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679593030"><span class="hs-identifier hs-var">role</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><a href="#local-6989586621679593029"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593042"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2292"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><a href="#local-6989586621679593029"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#drop"><span class="hs-identifier hs-var">drop</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConArity</span><span> </span><a href="#local-6989586621679593041"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679593042"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-2293"></a><span>         </span><span class="hs-comment">-- (a ~ F b a), where F has arity 1,</span><span>
</span><a name="line-2294"></a><span>         </span><span class="hs-comment">-- has an insoluble occurs check</span><span>
</span><a name="line-2295"></a><span>
</span><a name="line-2296"></a><span>    </span><a name="local-6989586621679593030"><a href="#local-6989586621679593030"><span class="hs-identifier">role</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a><span> </span><a href="#local-6989586621679593026"><span class="hs-identifier hs-var">eq_rel</span></a><span>
</span><a name="line-2297"></a><span>
</span><a name="line-2298"></a><span class="hs-comment">{- Note [AppTy and ReprEq]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider   a ~R# b a
           a ~R# a b

The former is /not/ a definite error; we might instantiate 'b' with Id
   newtype Id a = MkId a
but the latter /is/ a definite error.

On the other hand, with nominal equality, both are definite errors
-}</span><span>
</span><a name="line-2309"></a><span>
</span><a name="line-2310"></a><span class="hs-identifier">isRigidTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2311"></a><a name="isRigidTy"><a href="TcType.html#isRigidTy"><span class="hs-identifier">isRigidTy</span></a></a><span> </span><a name="local-6989586621679593043"><a href="#local-6989586621679593043"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2312"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679593044"><a href="#local-6989586621679593044"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679593043"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#isGenerativeTyCon"><span class="hs-identifier hs-var">isGenerativeTyCon</span></a><span> </span><a href="#local-6989586621679593044"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>
</span><a name="line-2313"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#tcSplitAppTy_maybe"><span class="hs-identifier hs-var">tcSplitAppTy_maybe</span></a><span> </span><a href="#local-6989586621679593043"><span class="hs-identifier hs-var">ty</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2314"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isForAllTy"><span class="hs-identifier hs-var">isForAllTy</span></a><span> </span><a href="#local-6989586621679593043"><span class="hs-identifier hs-var">ty</span></a><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2315"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2316"></a><span>
</span><a name="line-2317"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Transformation of Types to TcTypes}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2324"></a><span>
</span><a name="line-2325"></a><span class="hs-identifier">toTcType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-2326"></a><span class="hs-comment">-- The constraint solver expects EvVars to have TcType, in which the</span><span>
</span><a name="line-2327"></a><span class="hs-comment">-- free type variables are TcTyVars. So we convert from Type to TcType here</span><span>
</span><a name="line-2328"></a><span class="hs-comment">-- A bit tiresome; but one day I expect the two types to be entirely separate</span><span>
</span><a name="line-2329"></a><span class="hs-comment">-- in which case we'll definitely need to do this</span><span>
</span><a name="line-2330"></a><a name="toTcType"><a href="TcType.html#toTcType"><span class="hs-identifier">toTcType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runIdentity</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="TcType.html#to_tc_type"><span class="hs-identifier hs-var">to_tc_type</span></a><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span>
</span><a name="line-2331"></a><span>
</span><a name="line-2332"></a><span class="hs-identifier">toTcTypeBag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span> </span><span class="hs-comment">-- All TyVars are transformed to TcTyVars</span><span>
</span><a name="line-2333"></a><a name="toTcTypeBag"><a href="TcType.html#toTcTypeBag"><span class="hs-identifier">toTcTypeBag</span></a></a><span> </span><a name="local-6989586621679593045"><a href="#local-6989586621679593045"><span class="hs-identifier">evvars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#mapBag"><span class="hs-identifier hs-var">mapBag</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679593046"><a href="#local-6989586621679593046"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#setTyVarKind"><span class="hs-identifier hs-var">setTyVarKind</span></a><span> </span><a href="#local-6989586621679593046"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#toTcType"><span class="hs-identifier hs-var">toTcType</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679593046"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679593045"><span class="hs-identifier hs-var">evvars</span></a><span>
</span><a name="line-2334"></a><span>
</span><a name="line-2335"></a><span class="hs-identifier">to_tc_mapper</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Type.html#TyCoMapper"><span class="hs-identifier hs-type">TyCoMapper</span></a><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.Identity.html#Identity"><span class="hs-identifier hs-type">Identity</span></a><span>
</span><a name="line-2336"></a><a name="to_tc_mapper"><a href="TcType.html#to_tc_mapper"><span class="hs-identifier">to_tc_mapper</span></a></a><span>
</span><a name="line-2337"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#TyCoMapper"><span class="hs-identifier hs-var">TyCoMapper</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcm_smart</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>   </span><span class="hs-comment">-- more efficient not to use smart ctors</span><span>
</span><a name="line-2338"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_tyvar</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593047"><span class="hs-identifier hs-var">tyvar</span></a><span>
</span><a name="line-2339"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_covar</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593048"><span class="hs-identifier hs-var">covar</span></a><span>
</span><a name="line-2340"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_hole</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593049"><span class="hs-identifier hs-var">hole</span></a><span>
</span><a name="line-2341"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_tybinder</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593050"><span class="hs-identifier hs-var">tybinder</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2342"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2343"></a><span>    </span><span class="hs-identifier">tyvar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.Identity.html#Identity"><span class="hs-identifier hs-type">Identity</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2344"></a><span>    </span><a name="local-6989586621679593047"><a href="#local-6989586621679593047"><span class="hs-identifier">tyvar</span></a></a><span> </span><a name="local-6989586621679593051"><a href="#local-6989586621679593051"><span class="hs-identifier">ftvs</span></a></a><span> </span><a name="local-6989586621679593052"><a href="#local-6989586621679593052"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-2345"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679593053"><a href="#local-6989586621679593053"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="VarSet.html#lookupVarSet"><span class="hs-identifier hs-var">lookupVarSet</span></a><span> </span><a href="#local-6989586621679593051"><span class="hs-identifier hs-var">ftvs</span></a><span> </span><a href="#local-6989586621679593052"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a href="#local-6989586621679593053"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-2346"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a><span> </span><a href="#local-6989586621679593052"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Var.html#updateTyVarKindM"><span class="hs-identifier hs-var">updateTyVarKindM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#to_tc_type"><span class="hs-identifier hs-var">to_tc_type</span></a><span> </span><a href="#local-6989586621679593051"><span class="hs-identifier hs-var">ftvs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679593052"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2347"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2348"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679593054"><a href="#local-6989586621679593054"><span class="hs-identifier">kind'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#to_tc_type"><span class="hs-identifier hs-var">to_tc_type</span></a><span> </span><a href="#local-6989586621679593051"><span class="hs-identifier hs-var">ftvs</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679593052"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2349"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a><span> </span><a href="#local-6989586621679593052"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679593054"><span class="hs-identifier hs-var">kind'</span></a><span> </span><a href="TcType.html#vanillaSkolemTv"><span class="hs-identifier hs-var">vanillaSkolemTv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2350"></a><span>
</span><a name="line-2351"></a><span>    </span><span class="hs-identifier">covar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.Identity.html#Identity"><span class="hs-identifier hs-type">Identity</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-2352"></a><span>    </span><a name="local-6989586621679593048"><a href="#local-6989586621679593048"><span class="hs-identifier">covar</span></a></a><span> </span><a name="local-6989586621679593055"><a href="#local-6989586621679593055"><span class="hs-identifier">ftvs</span></a></a><span> </span><a name="local-6989586621679593056"><a href="#local-6989586621679593056"><span class="hs-identifier">cv</span></a></a><span>
</span><a name="line-2353"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679593057"><a href="#local-6989586621679593057"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="VarSet.html#lookupVarSet"><span class="hs-identifier hs-var">lookupVarSet</span></a><span> </span><a href="#local-6989586621679593055"><span class="hs-identifier hs-var">ftvs</span></a><span> </span><a href="#local-6989586621679593056"><span class="hs-identifier hs-var">cv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a href="#local-6989586621679593057"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-2354"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="Var.html#updateVarTypeM"><span class="hs-identifier hs-var">updateVarTypeM</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#to_tc_type"><span class="hs-identifier hs-var">to_tc_type</span></a><span> </span><a href="#local-6989586621679593055"><span class="hs-identifier hs-var">ftvs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679593056"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-2355"></a><span>
</span><a name="line-2356"></a><span>    </span><span class="hs-identifier">hole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.Identity.html#Identity"><span class="hs-identifier hs-type">Identity</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-2357"></a><span>    </span><a name="local-6989586621679593049"><a href="#local-6989586621679593049"><span class="hs-identifier">hole</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679593058"><a href="#local-6989586621679593058"><span class="hs-identifier">hole</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;toTcType: found a coercion hole&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679593058"><span class="hs-identifier hs-var">hole</span></a><span class="hs-special">)</span><span>
</span><a name="line-2358"></a><span>
</span><a name="line-2359"></a><span>    </span><span class="hs-identifier">tybinder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#ArgFlag"><span class="hs-identifier hs-type">ArgFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.Identity.html#Identity"><span class="hs-identifier hs-type">Identity</span></a><span> </span><span class="hs-special">(</span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-2360"></a><span>    </span><a name="local-6989586621679593050"><a href="#local-6989586621679593050"><span class="hs-identifier">tybinder</span></a></a><span> </span><a name="local-6989586621679593059"><a href="#local-6989586621679593059"><span class="hs-identifier">ftvs</span></a></a><span> </span><a name="local-6989586621679593060"><a href="#local-6989586621679593060"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679593061"><a href="#local-6989586621679593061"><span class="hs-identifier">_vis</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679593062"><a href="#local-6989586621679593062"><span class="hs-identifier">kind'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#to_tc_type"><span class="hs-identifier hs-var">to_tc_type</span></a><span> </span><a href="#local-6989586621679593059"><span class="hs-identifier hs-var">ftvs</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679593060"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2361"></a><span>                               </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679593063"><a href="#local-6989586621679593063"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a><span> </span><a href="#local-6989586621679593060"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679593062"><span class="hs-identifier hs-var">kind'</span></a><span>
</span><a name="line-2362"></a><span>                                                     </span><a href="TcType.html#vanillaSkolemTv"><span class="hs-identifier hs-var">vanillaSkolemTv</span></a><span>
</span><a name="line-2363"></a><span>                               </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679593059"><span class="hs-identifier hs-var">ftvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#extendVarSet"><span class="hs-identifier hs-var">extendVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679593063"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679593063"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2364"></a><span>
</span><a name="line-2365"></a><span class="hs-identifier">to_tc_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.Identity.html#Identity"><span class="hs-identifier hs-type">Identity</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-2366"></a><a name="to_tc_type"><a href="TcType.html#to_tc_type"><span class="hs-identifier">to_tc_type</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mapType"><span class="hs-identifier hs-var">mapType</span></a><span> </span><a href="TcType.html#to_tc_mapper"><span class="hs-identifier hs-var">to_tc_mapper</span></a><span>
</span><a name="line-2367"></a><span>
</span><a name="line-2368"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Misc}
*                                                                      *
************************************************************************

Note [Visible type application]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
GHC implements a generalisation of the algorithm described in the
&quot;Visible Type Application&quot; paper (available from
http://www.cis.upenn.edu/~sweirich/publications.html). A key part
of that algorithm is to distinguish user-specified variables from inferred
variables. For example, the following should typecheck:

  f :: forall a b. a -&gt; b -&gt; b
  f = const id

  g = const id

  x = f @Int @Bool 5 False
  y = g 5 @Bool False

The idea is that we wish to allow visible type application when we are
instantiating a specified, fixed variable. In practice, specified, fixed
variables are either written in a type signature (or
annotation), OR are imported from another module. (We could do better here,
for example by doing SCC analysis on parts of a module and considering any
type from outside one's SCC to be fully specified, but this is very confusing to
users. The simple rule above is much more straightforward and predictable.)

So, both of f's quantified variables are specified and may be instantiated.
But g has no type signature, so only id's variable is specified (because id
is imported). We write the type of g as forall {a}. a -&gt; forall b. b -&gt; b.
Note that the a is in braces, meaning it cannot be instantiated with
visible type application.

Tracking specified vs. inferred variables is done conveniently by a field
in TyBinder.

-}</span><span>
</span><a name="line-2409"></a><span>
</span><a name="line-2410"></a><span class="hs-identifier">deNoteType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2411"></a><span class="hs-comment">-- Remove all *outermost* type synonyms and other notes</span><span>
</span><a name="line-2412"></a><a name="deNoteType"><a href="TcType.html#deNoteType"><span class="hs-identifier">deNoteType</span></a></a><span> </span><a name="local-6989586621679593064"><a href="#local-6989586621679593064"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679593065"><a href="#local-6989586621679593065"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621679593064"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#deNoteType"><span class="hs-identifier hs-var">deNoteType</span></a><span> </span><a href="#local-6989586621679593065"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-2413"></a><span class="hs-identifier">deNoteType</span><span> </span><a name="local-6989586621679593066"><a href="#local-6989586621679593066"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593066"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2414"></a><span>
</span><a name="line-2415"></a><span class="hs-comment">{-
Find the free tycons and classes of a type.  This is used in the front
end of the compiler.
-}</span><span>
</span><a name="line-2419"></a><span>
</span><a name="line-2420"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[TysWiredIn-ext-type]{External types}
*                                                                      *
************************************************************************

The compiler's foreign function interface supports the passing of a
restricted set of types as arguments and results (the restricting factor
being the )
-}</span><span>
</span><a name="line-2431"></a><span>
</span><a name="line-2432"></a><span class="hs-identifier">tcSplitIOType_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-2433"></a><span class="hs-comment">-- (tcSplitIOType_maybe t) returns Just (IO,t',co)</span><span>
</span><a name="line-2434"></a><span class="hs-comment">--              if co : t ~ IO t'</span><span>
</span><a name="line-2435"></a><span class="hs-comment">--              returns Nothing otherwise</span><span>
</span><a name="line-2436"></a><a name="tcSplitIOType_maybe"><a href="TcType.html#tcSplitIOType_maybe"><span class="hs-identifier">tcSplitIOType_maybe</span></a></a><span> </span><a name="local-6989586621679593067"><a href="#local-6989586621679593067"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2437"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679593067"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2438"></a><span>        </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679593068"><a href="#local-6989586621679593068"><span class="hs-identifier">io_tycon</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679593069"><a href="#local-6989586621679593069"><span class="hs-identifier">io_res_ty</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2439"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679593068"><span class="hs-identifier hs-var">io_tycon</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#ioTyConKey"><span class="hs-identifier hs-var">ioTyConKey</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2440"></a><span>            </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679593068"><span class="hs-identifier hs-var">io_tycon</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679593069"><span class="hs-identifier hs-var">io_res_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2441"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2442"></a><span>            </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-2443"></a><span>
</span><a name="line-2444"></a><span class="hs-identifier">isFFITy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2445"></a><span class="hs-comment">-- True for any TyCon that can possibly be an arg or result of an FFI call</span><span>
</span><a name="line-2446"></a><a name="isFFITy"><a href="TcType.html#isFFITy"><span class="hs-identifier">isFFITy</span></a></a><span> </span><a name="local-6989586621679593070"><a href="#local-6989586621679593070"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#isValid"><span class="hs-identifier hs-var">isValid</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#checkRepTyCon"><span class="hs-identifier hs-var">checkRepTyCon</span></a><span> </span><a href="TcType.html#legalFFITyCon"><span class="hs-identifier hs-var">legalFFITyCon</span></a><span> </span><a href="#local-6989586621679593070"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2447"></a><span>
</span><a name="line-2448"></a><span class="hs-identifier">isFFIArgumentTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ForeignCall.html#Safety"><span class="hs-identifier hs-type">Safety</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2449"></a><span class="hs-comment">-- Checks for valid argument type for a 'foreign import'</span><span>
</span><a name="line-2450"></a><a name="isFFIArgumentTy"><a href="TcType.html#isFFIArgumentTy"><span class="hs-identifier">isFFIArgumentTy</span></a></a><span> </span><a name="local-6989586621679593071"><a href="#local-6989586621679593071"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679593072"><a href="#local-6989586621679593072"><span class="hs-identifier">safety</span></a></a><span> </span><a name="local-6989586621679593073"><a href="#local-6989586621679593073"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2451"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#checkRepTyCon"><span class="hs-identifier hs-var">checkRepTyCon</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#legalOutgoingTyCon"><span class="hs-identifier hs-var">legalOutgoingTyCon</span></a><span> </span><a href="#local-6989586621679593071"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679593072"><span class="hs-identifier hs-var">safety</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679593073"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2452"></a><span>
</span><a name="line-2453"></a><span class="hs-identifier">isFFIExternalTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2454"></a><span class="hs-comment">-- Types that are allowed as arguments of a 'foreign export'</span><span>
</span><a name="line-2455"></a><a name="isFFIExternalTy"><a href="TcType.html#isFFIExternalTy"><span class="hs-identifier">isFFIExternalTy</span></a></a><span> </span><a name="local-6989586621679593074"><a href="#local-6989586621679593074"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#checkRepTyCon"><span class="hs-identifier hs-var">checkRepTyCon</span></a><span> </span><a href="TcType.html#legalFEArgTyCon"><span class="hs-identifier hs-var">legalFEArgTyCon</span></a><span> </span><a href="#local-6989586621679593074"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2456"></a><span>
</span><a name="line-2457"></a><span class="hs-identifier">isFFIImportResultTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2458"></a><a name="isFFIImportResultTy"><a href="TcType.html#isFFIImportResultTy"><span class="hs-identifier">isFFIImportResultTy</span></a></a><span> </span><a name="local-6989586621679593075"><a href="#local-6989586621679593075"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679593076"><a href="#local-6989586621679593076"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2459"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#checkRepTyCon"><span class="hs-identifier hs-var">checkRepTyCon</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#legalFIResultTyCon"><span class="hs-identifier hs-var">legalFIResultTyCon</span></a><span> </span><a href="#local-6989586621679593075"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679593076"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2460"></a><span>
</span><a name="line-2461"></a><span class="hs-identifier">isFFIExportResultTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2462"></a><a name="isFFIExportResultTy"><a href="TcType.html#isFFIExportResultTy"><span class="hs-identifier">isFFIExportResultTy</span></a></a><span> </span><a name="local-6989586621679593077"><a href="#local-6989586621679593077"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#checkRepTyCon"><span class="hs-identifier hs-var">checkRepTyCon</span></a><span> </span><a href="TcType.html#legalFEResultTyCon"><span class="hs-identifier hs-var">legalFEResultTyCon</span></a><span> </span><a href="#local-6989586621679593077"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2463"></a><span>
</span><a name="line-2464"></a><span class="hs-identifier">isFFIDynTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2465"></a><span class="hs-comment">-- The type in a foreign import dynamic must be Ptr, FunPtr, or a newtype of</span><span>
</span><a name="line-2466"></a><span class="hs-comment">-- either, and the wrapped function type must be equal to the given type.</span><span>
</span><a name="line-2467"></a><span class="hs-comment">-- We assume that all types have been run through normaliseFfiType, so we don't</span><span>
</span><a name="line-2468"></a><span class="hs-comment">-- need to worry about expanding newtypes here.</span><span>
</span><a name="line-2469"></a><a name="isFFIDynTy"><a href="TcType.html#isFFIDynTy"><span class="hs-identifier">isFFIDynTy</span></a></a><span> </span><a name="local-6989586621679593078"><a href="#local-6989586621679593078"><span class="hs-identifier">expected</span></a></a><span> </span><a name="local-6989586621679593079"><a href="#local-6989586621679593079"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2470"></a><span>    </span><span class="hs-comment">-- Note [Foreign import dynamic]</span><span>
</span><a name="line-2471"></a><span>    </span><span class="hs-comment">-- In the example below, expected would be 'CInt -&gt; IO ()', while ty would</span><span>
</span><a name="line-2472"></a><span>    </span><span class="hs-comment">-- be 'FunPtr (CDouble -&gt; IO ())'.</span><span>
</span><a name="line-2473"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679593080"><a href="#local-6989586621679593080"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679593081"><a href="#local-6989586621679593081"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679593079"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2474"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tyConUnique</span><span> </span><a href="#local-6989586621679593080"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><a href="PrelNames.html#ptrTyConKey"><span class="hs-identifier hs-var">ptrTyConKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#funPtrTyConKey"><span class="hs-identifier hs-var">funPtrTyConKey</span></a><span class="hs-special">]</span><span>
</span><a name="line-2475"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span> </span><a href="#local-6989586621679593081"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621679593078"><span class="hs-identifier hs-var">expected</span></a><span>
</span><a name="line-2476"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-2477"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2478"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Expected: Ptr/FunPtr&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#pprParendType"><span class="hs-identifier hs-var">pprParendType</span></a><span> </span><a href="#local-6989586621679593078"><span class="hs-identifier hs-var">expected</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span>
</span><a name="line-2479"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;  Actual:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679593079"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2480"></a><span>
</span><a name="line-2481"></a><span class="hs-identifier">isFFILabelTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2482"></a><span class="hs-comment">-- The type of a foreign label must be Ptr, FunPtr, or a newtype of either.</span><span>
</span><a name="line-2483"></a><a name="isFFILabelTy"><a href="TcType.html#isFFILabelTy"><span class="hs-identifier">isFFILabelTy</span></a></a><span> </span><a name="local-6989586621679593082"><a href="#local-6989586621679593082"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#checkRepTyCon"><span class="hs-identifier hs-var">checkRepTyCon</span></a><span> </span><a href="#local-6989586621679593083"><span class="hs-identifier hs-var">ok</span></a><span> </span><a href="#local-6989586621679593082"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2484"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2485"></a><span>    </span><a name="local-6989586621679593083"><a href="#local-6989586621679593083"><span class="hs-identifier">ok</span></a></a><span> </span><a name="local-6989586621679593084"><a href="#local-6989586621679593084"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679593084"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#funPtrTyConKey"><span class="hs-identifier hs-var">funPtrTyConKey</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679593084"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#ptrTyConKey"><span class="hs-identifier hs-var">ptrTyConKey</span></a><span>
</span><a name="line-2486"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-2487"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2488"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;A foreign-imported address (via &amp;foo) must have type (Ptr a) or (FunPtr a)&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2489"></a><span>
</span><a name="line-2490"></a><span class="hs-identifier">isFFIPrimArgumentTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2491"></a><span class="hs-comment">-- Checks for valid argument type for a 'foreign import prim'</span><span>
</span><a name="line-2492"></a><span class="hs-comment">-- Currently they must all be simple unlifted types, or the well-known type</span><span>
</span><a name="line-2493"></a><span class="hs-comment">-- Any, which can be used to pass the address to a Haskell object on the heap to</span><span>
</span><a name="line-2494"></a><span class="hs-comment">-- the foreign function.</span><span>
</span><a name="line-2495"></a><a name="isFFIPrimArgumentTy"><a href="TcType.html#isFFIPrimArgumentTy"><span class="hs-identifier">isFFIPrimArgumentTy</span></a></a><span> </span><a name="local-6989586621679593085"><a href="#local-6989586621679593085"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679593086"><a href="#local-6989586621679593086"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2496"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcType.html#isAnyTy"><span class="hs-identifier hs-var">isAnyTy</span></a><span> </span><a href="#local-6989586621679593086"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-2497"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#checkRepTyCon"><span class="hs-identifier hs-var">checkRepTyCon</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#legalFIPrimArgTyCon"><span class="hs-identifier hs-var">legalFIPrimArgTyCon</span></a><span> </span><a href="#local-6989586621679593085"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679593086"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2498"></a><span>
</span><a name="line-2499"></a><span class="hs-identifier">isFFIPrimResultTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2500"></a><span class="hs-comment">-- Checks for valid result type for a 'foreign import prim' Currently</span><span>
</span><a name="line-2501"></a><span class="hs-comment">-- it must be an unlifted type, including unboxed tuples, unboxed</span><span>
</span><a name="line-2502"></a><span class="hs-comment">-- sums, or the well-known type Any.</span><span>
</span><a name="line-2503"></a><a name="isFFIPrimResultTy"><a href="TcType.html#isFFIPrimResultTy"><span class="hs-identifier">isFFIPrimResultTy</span></a></a><span> </span><a name="local-6989586621679593087"><a href="#local-6989586621679593087"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679593088"><a href="#local-6989586621679593088"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2504"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcType.html#isAnyTy"><span class="hs-identifier hs-var">isAnyTy</span></a><span> </span><a href="#local-6989586621679593088"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-2505"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#checkRepTyCon"><span class="hs-identifier hs-var">checkRepTyCon</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#legalFIPrimResultTyCon"><span class="hs-identifier hs-var">legalFIPrimResultTyCon</span></a><span> </span><a href="#local-6989586621679593087"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679593088"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2506"></a><span>
</span><a name="line-2507"></a><span class="hs-identifier">isFunPtrTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2508"></a><a name="isFunPtrTy"><a href="TcType.html#isFunPtrTy"><span class="hs-identifier">isFunPtrTy</span></a></a><span> </span><a name="local-6989586621679593089"><a href="#local-6989586621679593089"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2509"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679593090"><a href="#local-6989586621679593090"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679593089"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2510"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593090"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#funPtrTyConKey"><span class="hs-identifier hs-var">funPtrTyConKey</span></a><span>
</span><a name="line-2511"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2512"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2513"></a><span>
</span><a name="line-2514"></a><span class="hs-comment">-- normaliseFfiType gets run before checkRepTyCon, so we don't</span><span>
</span><a name="line-2515"></a><span class="hs-comment">-- need to worry about looking through newtypes or type functions</span><span>
</span><a name="line-2516"></a><span class="hs-comment">-- here; that's already been taken care of.</span><span>
</span><a name="line-2517"></a><span class="hs-identifier">checkRepTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2518"></a><a name="checkRepTyCon"><a href="TcType.html#checkRepTyCon"><span class="hs-identifier">checkRepTyCon</span></a></a><span> </span><a name="local-6989586621679593091"><a href="#local-6989586621679593091"><span class="hs-identifier">check_tc</span></a></a><span> </span><a name="local-6989586621679593092"><a href="#local-6989586621679593092"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2519"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621679593092"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2520"></a><span>      </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679593098"><a href="#local-6989586621679593098"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679593099"><a href="#local-6989586621679593099"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2521"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a><span> </span><a href="#local-6989586621679593098"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><a href="#local-6989586621679593093"><span class="hs-identifier hs-var">msg</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679593094"><span class="hs-identifier hs-var">mk_nt_reason</span></a><span> </span><a href="#local-6989586621679593098"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679593099"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="#local-6989586621679593095"><span class="hs-identifier hs-var">nt_fix</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2522"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679593091"><span class="hs-identifier hs-var">check_tc</span></a><span> </span><a href="#local-6989586621679593098"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2523"></a><span>                             </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-2524"></a><span>                             </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><a name="local-6989586621679593100"><a href="#local-6989586621679593100"><span class="hs-identifier">extra</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679593093"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="#local-6989586621679593100"><span class="hs-identifier hs-var">extra</span></a><span class="hs-special">)</span><span>
</span><a name="line-2525"></a><span>      </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679593092"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is not a data type&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2526"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2527"></a><span>    </span><a name="local-6989586621679593093"><a href="#local-6989586621679593093"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679593092"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;cannot be marshalled in a foreign call&quot;</span><span>
</span><a name="line-2528"></a><span>    </span><a name="local-6989586621679593094"><a href="#local-6989586621679593094"><span class="hs-identifier">mk_nt_reason</span></a></a><span> </span><a name="local-6989586621679593096"><a href="#local-6989586621679593096"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679593097"><a href="#local-6989586621679593097"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-2529"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679593097"><span class="hs-identifier hs-var">tys</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;because its data constructor is not in scope&quot;</span><span>
</span><a name="line-2530"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;because the data constructor for&quot;</span><span>
</span><a name="line-2531"></a><span>                    </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679593096"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is not in scope&quot;</span><span>
</span><a name="line-2532"></a><span>    </span><a name="local-6989586621679593095"><a href="#local-6989586621679593095"><span class="hs-identifier">nt_fix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Possible fix: import the data constructor to bring it into scope&quot;</span><span>
</span><a name="line-2533"></a><span>
</span><a name="line-2534"></a><span class="hs-comment">{-
Note [Foreign import dynamic]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A dynamic stub must be of the form 'FunPtr ft -&gt; ft' where ft is any foreign
type.  Similarly, a wrapper stub must be of the form 'ft -&gt; IO (FunPtr ft)'.

We use isFFIDynTy to check whether a signature is well-formed. For example,
given a (illegal) declaration like:

foreign import ccall &quot;dynamic&quot;
  foo :: FunPtr (CDouble -&gt; IO ()) -&gt; CInt -&gt; IO ()

isFFIDynTy will compare the 'FunPtr' type 'CDouble -&gt; IO ()' with the curried
result type 'CInt -&gt; IO ()', and return False, as they are not equal.


----------------------------------------------
These chaps do the work; they are not exported
----------------------------------------------
-}</span><span>
</span><a name="line-2554"></a><span>
</span><a name="line-2555"></a><span class="hs-identifier">legalFEArgTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2556"></a><a name="legalFEArgTyCon"><a href="TcType.html#legalFEArgTyCon"><span class="hs-identifier">legalFEArgTyCon</span></a></a><span> </span><a name="local-6989586621679593101"><a href="#local-6989586621679593101"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-2557"></a><span>  </span><span class="hs-comment">-- It's illegal to make foreign exports that take unboxed</span><span>
</span><a name="line-2558"></a><span>  </span><span class="hs-comment">-- arguments.  The RTS API currently can't invoke such things.  --SDM 7/2000</span><span>
</span><a name="line-2559"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#boxedMarshalableTyCon"><span class="hs-identifier hs-var">boxedMarshalableTyCon</span></a><span> </span><a href="#local-6989586621679593101"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2560"></a><span>
</span><a name="line-2561"></a><span class="hs-identifier">legalFIResultTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2562"></a><a name="legalFIResultTyCon"><a href="TcType.html#legalFIResultTyCon"><span class="hs-identifier">legalFIResultTyCon</span></a></a><span> </span><a name="local-6989586621679593102"><a href="#local-6989586621679593102"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679593103"><a href="#local-6989586621679593103"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-2563"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679593103"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="TysWiredIn.html#unitTyCon"><span class="hs-identifier hs-var">unitTyCon</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-2564"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#marshalableTyCon"><span class="hs-identifier hs-var">marshalableTyCon</span></a><span> </span><a href="#local-6989586621679593102"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679593103"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2565"></a><span>
</span><a name="line-2566"></a><span class="hs-identifier">legalFEResultTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2567"></a><a name="legalFEResultTyCon"><a href="TcType.html#legalFEResultTyCon"><span class="hs-identifier">legalFEResultTyCon</span></a></a><span> </span><a name="local-6989586621679593104"><a href="#local-6989586621679593104"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-2568"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679593104"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="TysWiredIn.html#unitTyCon"><span class="hs-identifier hs-var">unitTyCon</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-2569"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#boxedMarshalableTyCon"><span class="hs-identifier hs-var">boxedMarshalableTyCon</span></a><span> </span><a href="#local-6989586621679593104"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2570"></a><span>
</span><a name="line-2571"></a><span class="hs-identifier">legalOutgoingTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ForeignCall.html#Safety"><span class="hs-identifier hs-type">Safety</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2572"></a><span class="hs-comment">-- Checks validity of types going from Haskell -&gt; external world</span><span>
</span><a name="line-2573"></a><a name="legalOutgoingTyCon"><a href="TcType.html#legalOutgoingTyCon"><span class="hs-identifier">legalOutgoingTyCon</span></a></a><span> </span><a name="local-6989586621679593105"><a href="#local-6989586621679593105"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679593106"><a href="#local-6989586621679593106"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-2574"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#marshalableTyCon"><span class="hs-identifier hs-var">marshalableTyCon</span></a><span> </span><a href="#local-6989586621679593105"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679593106"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2575"></a><span>
</span><a name="line-2576"></a><span class="hs-identifier">legalFFITyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2577"></a><span class="hs-comment">-- True for any TyCon that can possibly be an arg or result of an FFI call</span><span>
</span><a name="line-2578"></a><a name="legalFFITyCon"><a href="TcType.html#legalFFITyCon"><span class="hs-identifier">legalFFITyCon</span></a></a><span> </span><a name="local-6989586621679593107"><a href="#local-6989586621679593107"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-2579"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isUnliftedTyCon"><span class="hs-identifier hs-var">isUnliftedTyCon</span></a><span> </span><a href="#local-6989586621679593107"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-2580"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679593107"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="TysWiredIn.html#unitTyCon"><span class="hs-identifier hs-var">unitTyCon</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-2581"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#boxedMarshalableTyCon"><span class="hs-identifier hs-var">boxedMarshalableTyCon</span></a><span> </span><a href="#local-6989586621679593107"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2582"></a><span>
</span><a name="line-2583"></a><span class="hs-identifier">marshalableTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2584"></a><a name="marshalableTyCon"><a href="TcType.html#marshalableTyCon"><span class="hs-identifier">marshalableTyCon</span></a></a><span> </span><a name="local-6989586621679593108"><a href="#local-6989586621679593108"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679593109"><a href="#local-6989586621679593109"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-2585"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isUnliftedTyCon"><span class="hs-identifier hs-var">isUnliftedTyCon</span></a><span> </span><a href="#local-6989586621679593109"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2586"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#isUnboxedTupleTyCon"><span class="hs-identifier hs-var">isUnboxedTupleTyCon</span></a><span> </span><a href="#local-6989586621679593109"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="TyCon.html#isUnboxedSumTyCon"><span class="hs-identifier hs-var">isUnboxedSumTyCon</span></a><span> </span><a href="#local-6989586621679593109"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2587"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-special">(</span><a href="RepType.html#tyConPrimRep"><span class="hs-identifier hs-var">tyConPrimRep</span></a><span> </span><a href="#local-6989586621679593109"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Note [Marshalling void]</span><span>
</span><a name="line-2588"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#validIfUnliftedFFITypes"><span class="hs-identifier hs-var">validIfUnliftedFFITypes</span></a><span> </span><a href="#local-6989586621679593108"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2589"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2590"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#boxedMarshalableTyCon"><span class="hs-identifier hs-var">boxedMarshalableTyCon</span></a><span> </span><a href="#local-6989586621679593109"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2591"></a><span>
</span><a name="line-2592"></a><span class="hs-identifier">boxedMarshalableTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2593"></a><a name="boxedMarshalableTyCon"><a href="TcType.html#boxedMarshalableTyCon"><span class="hs-identifier">boxedMarshalableTyCon</span></a></a><span> </span><a name="local-6989586621679593110"><a href="#local-6989586621679593110"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-2594"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621679593110"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelNames.html#intTyConKey"><span class="hs-identifier hs-var">intTyConKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#int8TyConKey"><span class="hs-identifier hs-var">int8TyConKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#int16TyConKey"><span class="hs-identifier hs-var">int16TyConKey</span></a><span>
</span><a name="line-2595"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#int32TyConKey"><span class="hs-identifier hs-var">int32TyConKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#int64TyConKey"><span class="hs-identifier hs-var">int64TyConKey</span></a><span>
</span><a name="line-2596"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#wordTyConKey"><span class="hs-identifier hs-var">wordTyConKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#word8TyConKey"><span class="hs-identifier hs-var">word8TyConKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#word16TyConKey"><span class="hs-identifier hs-var">word16TyConKey</span></a><span>
</span><a name="line-2597"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#word32TyConKey"><span class="hs-identifier hs-var">word32TyConKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#word64TyConKey"><span class="hs-identifier hs-var">word64TyConKey</span></a><span>
</span><a name="line-2598"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#floatTyConKey"><span class="hs-identifier hs-var">floatTyConKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#doubleTyConKey"><span class="hs-identifier hs-var">doubleTyConKey</span></a><span>
</span><a name="line-2599"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#ptrTyConKey"><span class="hs-identifier hs-var">ptrTyConKey</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#funPtrTyConKey"><span class="hs-identifier hs-var">funPtrTyConKey</span></a><span>
</span><a name="line-2600"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#charTyConKey"><span class="hs-identifier hs-var">charTyConKey</span></a><span>
</span><a name="line-2601"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#stablePtrTyConKey"><span class="hs-identifier hs-var">stablePtrTyConKey</span></a><span>
</span><a name="line-2602"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#boolTyConKey"><span class="hs-identifier hs-var">boolTyConKey</span></a><span>
</span><a name="line-2603"></a><span>                         </span><span class="hs-special">]</span><span>
</span><a name="line-2604"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-2605"></a><span>
</span><a name="line-2606"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-2607"></a><span>
</span><a name="line-2608"></a><span class="hs-identifier">legalFIPrimArgTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2609"></a><span class="hs-comment">-- Check args of 'foreign import prim', only allow simple unlifted types.</span><span>
</span><a name="line-2610"></a><span class="hs-comment">-- Strictly speaking it is unnecessary to ban unboxed tuples and sums here since</span><span>
</span><a name="line-2611"></a><span class="hs-comment">-- currently they're of the wrong kind to use in function args anyway.</span><span>
</span><a name="line-2612"></a><a name="legalFIPrimArgTyCon"><a href="TcType.html#legalFIPrimArgTyCon"><span class="hs-identifier">legalFIPrimArgTyCon</span></a></a><span> </span><a name="local-6989586621679593111"><a href="#local-6989586621679593111"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679593112"><a href="#local-6989586621679593112"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-2613"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isUnliftedTyCon"><span class="hs-identifier hs-var">isUnliftedTyCon</span></a><span> </span><a href="#local-6989586621679593112"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2614"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#isUnboxedTupleTyCon"><span class="hs-identifier hs-var">isUnboxedTupleTyCon</span></a><span> </span><a href="#local-6989586621679593112"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="TyCon.html#isUnboxedSumTyCon"><span class="hs-identifier hs-var">isUnboxedSumTyCon</span></a><span> </span><a href="#local-6989586621679593112"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2615"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#validIfUnliftedFFITypes"><span class="hs-identifier hs-var">validIfUnliftedFFITypes</span></a><span> </span><a href="#local-6989586621679593111"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2616"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2617"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><a href="TcType.html#unlifted_only"><span class="hs-identifier hs-var">unlifted_only</span></a><span>
</span><a name="line-2618"></a><span>
</span><a name="line-2619"></a><span class="hs-identifier">legalFIPrimResultTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2620"></a><span class="hs-comment">-- Check result type of 'foreign import prim'. Allow simple unlifted</span><span>
</span><a name="line-2621"></a><span class="hs-comment">-- types and also unboxed tuple and sum result types.</span><span>
</span><a name="line-2622"></a><a name="legalFIPrimResultTyCon"><a href="TcType.html#legalFIPrimResultTyCon"><span class="hs-identifier">legalFIPrimResultTyCon</span></a></a><span> </span><a name="local-6989586621679593113"><a href="#local-6989586621679593113"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679593114"><a href="#local-6989586621679593114"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-2623"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isUnliftedTyCon"><span class="hs-identifier hs-var">isUnliftedTyCon</span></a><span> </span><a href="#local-6989586621679593114"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2624"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TyCon.html#isUnboxedTupleTyCon"><span class="hs-identifier hs-var">isUnboxedTupleTyCon</span></a><span> </span><a href="#local-6989586621679593114"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="TyCon.html#isUnboxedSumTyCon"><span class="hs-identifier hs-var">isUnboxedSumTyCon</span></a><span> </span><a href="#local-6989586621679593114"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2625"></a><span>     </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-special">(</span><a href="RepType.html#tyConPrimRep"><span class="hs-identifier hs-var">tyConPrimRep</span></a><span> </span><a href="#local-6989586621679593114"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Note [Marshalling void]</span><span>
</span><a name="line-2626"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#validIfUnliftedFFITypes"><span class="hs-identifier hs-var">validIfUnliftedFFITypes</span></a><span> </span><a href="#local-6989586621679593113"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2627"></a><span>
</span><a name="line-2628"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2629"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><a href="TcType.html#unlifted_only"><span class="hs-identifier hs-var">unlifted_only</span></a><span>
</span><a name="line-2630"></a><span>
</span><a name="line-2631"></a><span class="hs-identifier">unlifted_only</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ErrUtils.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a><span>
</span><a name="line-2632"></a><a name="unlifted_only"><a href="TcType.html#unlifted_only"><span class="hs-identifier">unlifted_only</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;foreign import prim only accepts simple unlifted types&quot;</span><span>
</span><a name="line-2633"></a><span>
</span><a name="line-2634"></a><span class="hs-identifier">validIfUnliftedFFITypes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#Validity"><span class="hs-identifier hs-type">Validity</span></a><span>
</span><a name="line-2635"></a><a name="validIfUnliftedFFITypes"><a href="TcType.html#validIfUnliftedFFITypes"><span class="hs-identifier">validIfUnliftedFFITypes</span></a></a><span> </span><a name="local-6989586621679593115"><a href="#local-6989586621679593115"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-2636"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a><span> </span><a href="../ghc-boot-th-8.5/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#UnliftedFFITypes"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">UnliftedFFITypes</span></a><span> </span><a href="#local-6989586621679593115"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="ErrUtils.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a><span>
</span><a name="line-2637"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;To marshal unlifted types, use UnliftedFFITypes&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2638"></a><span>
</span><a name="line-2639"></a><span class="hs-comment">{-
Note [Marshalling void]
~~~~~~~~~~~~~~~~~~~~~~~
We don't treat State# (whose PrimRep is VoidRep) as marshalable.
In turn that means you can't write
        foreign import foo :: Int -&gt; State# RealWorld

Reason: the back end falls over with panic &quot;primRepHint:VoidRep&quot;;
        and there is no compelling reason to permit it
-}</span><span>
</span><a name="line-2649"></a><span>
</span><a name="line-2650"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        The &quot;Paterson size&quot; of a type
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2657"></a><span>
</span><a name="line-2658"></a><span class="hs-comment">{-
Note [Paterson conditions on PredTypes]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We are considering whether *class* constraints terminate
(see Note [Paterson conditions]). Precisely, the Paterson conditions
would have us check that &quot;the constraint has fewer constructors and variables
(taken together and counting repetitions) than the head.&quot;.

However, we can be a bit more refined by looking at which kind of constraint
this actually is. There are two main tricks:

 1. It seems like it should be OK not to count the tuple type constructor
    for a PredType like (Show a, Eq a) :: Constraint, since we don't
    count the &quot;implicit&quot; tuple in the ThetaType itself.

    In fact, the Paterson test just checks *each component* of the top level
    ThetaType against the size bound, one at a time. By analogy, it should be
    OK to return the size of the *largest* tuple component as the size of the
    whole tuple.

 2. Once we get into an implicit parameter or equality we
    can't get back to a class constraint, so it's safe
    to say &quot;size 0&quot;.  See Trac #4200.

NB: we don't want to detect PredTypes in sizeType (and then call
sizePred on them), or we might get an infinite loop if that PredType
is irreducible. See Trac #5581.
-}</span><span>
</span><a name="line-2686"></a><span>
</span><a name="line-2687"></a><span class="hs-keyword">type</span><span> </span><a name="TypeSize"><a href="TcType.html#TypeSize"><span class="hs-identifier">TypeSize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#IntWithInf"><span class="hs-identifier hs-type">IntWithInf</span></a><span>
</span><a name="line-2688"></a><span>
</span><a name="line-2689"></a><span class="hs-identifier">sizeType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TypeSize"><span class="hs-identifier hs-type">TypeSize</span></a><span>
</span><a name="line-2690"></a><span class="hs-comment">-- Size of a type: the number of variables and constructors</span><span>
</span><a name="line-2691"></a><span class="hs-comment">-- Ignore kinds altogether</span><span>
</span><a name="line-2692"></a><a name="sizeType"><a href="TcType.html#sizeType"><span class="hs-identifier">sizeType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593116"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-2693"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2694"></a><span>    </span><a name="local-6989586621679593116"><a href="#local-6989586621679593116"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679593117"><a href="#local-6989586621679593117"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679593118"><a href="#local-6989586621679593118"><span class="hs-identifier">exp_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621679593117"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593116"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593118"><span class="hs-identifier hs-var">exp_ty</span></a><span>
</span><a name="line-2695"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-2696"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621679593119"><a href="#local-6989586621679593119"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679593120"><a href="#local-6989586621679593120"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2697"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a><span> </span><a href="#local-6989586621679593119"><span class="hs-identifier hs-var">tc</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#infinity"><span class="hs-identifier hs-var">infinity</span></a><span>  </span><span class="hs-comment">-- Type-family applications can</span><span>
</span><a name="line-2698"></a><span>                                             </span><span class="hs-comment">-- expand to any arbitrary size</span><span>
</span><a name="line-2699"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#sizeTypes"><span class="hs-identifier hs-var">sizeTypes</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#filterOutInvisibleTypes"><span class="hs-identifier hs-var">filterOutInvisibleTypes</span></a><span> </span><a href="#local-6989586621679593119"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679593120"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-2700"></a><span>                                   </span><span class="hs-comment">-- Why filter out invisible args?  I suppose any</span><span>
</span><a name="line-2701"></a><span>                                   </span><span class="hs-comment">-- size ordering is sound, but why is this better?</span><span>
</span><a name="line-2702"></a><span>                                   </span><span class="hs-comment">-- I came across this when investigating #14010.</span><span>
</span><a name="line-2703"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-2704"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679593121"><a href="#local-6989586621679593121"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679593122"><a href="#local-6989586621679593122"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593116"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593121"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><a href="#local-6989586621679593116"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593122"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-2705"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621679593123"><a href="#local-6989586621679593123"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621679593124"><a href="#local-6989586621679593124"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593116"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593123"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><a href="#local-6989586621679593116"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593124"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2706"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TvBndr"><span class="hs-identifier hs-var">TvBndr</span></a><span> </span><a name="local-6989586621679593125"><a href="#local-6989586621679593125"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679593126"><a href="#local-6989586621679593126"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679593127"><a href="#local-6989586621679593127"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2707"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isVisibleArgFlag"><span class="hs-identifier hs-var">isVisibleArgFlag</span></a><span> </span><a href="#local-6989586621679593126"><span class="hs-identifier hs-var">vis</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593116"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679593125"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><a href="#local-6989586621679593116"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593127"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-2708"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593116"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593127"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-2709"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621679593128"><a href="#local-6989586621679593128"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593116"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679593128"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2710"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2711"></a><span>
</span><a name="line-2712"></a><span class="hs-identifier">sizeTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TypeSize"><span class="hs-identifier hs-type">TypeSize</span></a><span>
</span><a name="line-2713"></a><a name="sizeTypes"><a href="TcType.html#sizeTypes"><span class="hs-identifier">sizeTypes</span></a></a><span> </span><a name="local-6989586621679593129"><a href="#local-6989586621679593129"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TcType.html#sizeType"><span class="hs-identifier hs-var">sizeType</span></a><span> </span><a href="#local-6989586621679593129"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-2714"></a><span>
</span><a name="line-2715"></a><span class="hs-comment">-----------------------------------------------------------------------------------</span><span>
</span><a name="line-2716"></a><span class="hs-comment">-----------------------------------------------------------------------------------</span><span>
</span><a name="line-2717"></a><span class="hs-comment">-----------------------</span><span>
</span><a name="line-2718"></a><span class="hs-comment">-- | For every arg a tycon can take, the returned list says True if the argument</span><span>
</span><a name="line-2719"></a><span class="hs-comment">-- is taken visibly, and False otherwise. Ends with an infinite tail of Trues to</span><span>
</span><a name="line-2720"></a><span class="hs-comment">-- allow for oversaturation.</span><span>
</span><a name="line-2721"></a><span class="hs-identifier">tcTyConVisibilities</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">]</span><span>
</span><a name="line-2722"></a><a name="tcTyConVisibilities"><a href="TcType.html#tcTyConVisibilities"><span class="hs-identifier">tcTyConVisibilities</span></a></a><span> </span><a name="local-6989586621679593130"><a href="#local-6989586621679593130"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679593131"><span class="hs-identifier hs-var">tc_binder_viss</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679593132"><span class="hs-identifier hs-var">tc_return_kind_viss</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2723"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2724"></a><span>    </span><a name="local-6989586621679593131"><a href="#local-6989586621679593131"><span class="hs-identifier">tc_binder_viss</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TyCon.html#isVisibleTyConBinder"><span class="hs-identifier hs-var">isVisibleTyConBinder</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConBinders</span><span> </span><a href="#local-6989586621679593130"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2725"></a><span>    </span><a name="local-6989586621679593132"><a href="#local-6989586621679593132"><span class="hs-identifier">tc_return_kind_viss</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="TyCoRep.html#isVisibleBinder"><span class="hs-identifier hs-var">isVisibleBinder</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcType.html#tcSplitPiTys"><span class="hs-identifier hs-var">tcSplitPiTys</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConResKind</span><span> </span><a href="#local-6989586621679593130"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2726"></a><span>
</span><a name="line-2727"></a><span class="hs-comment">-- | If the tycon is applied to the types, is the next argument visible?</span><span>
</span><a name="line-2728"></a><span class="hs-identifier">isNextTyConArgVisible</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2729"></a><a name="isNextTyConArgVisible"><a href="TcType.html#isNextTyConArgVisible"><span class="hs-identifier">isNextTyConArgVisible</span></a></a><span> </span><a name="local-6989586621679593133"><a href="#local-6989586621679593133"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679593134"><a href="#local-6989586621679593134"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-2730"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcTyConVisibilities"><span class="hs-identifier hs-var">tcTyConVisibilities</span></a><span> </span><a href="#local-6989586621679593133"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#getNth"><span class="hs-identifier hs-var">getNth</span></a><span class="hs-special">`</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621679593134"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2731"></a><span>
</span><a name="line-2732"></a><span class="hs-comment">-- | Should this type be applied to a visible argument?</span><span>
</span><a name="line-2733"></a><span class="hs-identifier">isNextArgVisible</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2734"></a><a name="isNextArgVisible"><a href="TcType.html#isNextArgVisible"><span class="hs-identifier">isNextArgVisible</span></a></a><span> </span><a name="local-6989586621679593135"><a href="#local-6989586621679593135"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2735"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679593136"><a href="#local-6989586621679593136"><span class="hs-identifier">bndr</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcType.html#tcSplitPiTy_maybe"><span class="hs-identifier hs-var">tcSplitPiTy_maybe</span></a><span> </span><a href="#local-6989586621679593135"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#isVisibleBinder"><span class="hs-identifier hs-var">isVisibleBinder</span></a><span> </span><a href="#local-6989586621679593136"><span class="hs-identifier hs-var">bndr</span></a><span>
</span><a name="line-2736"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2737"></a><span>    </span><span class="hs-comment">-- this second case might happen if, say, we have an unzonked TauTv.</span><span>
</span><a name="line-2738"></a><span>    </span><span class="hs-comment">-- But TauTvs can't range over types that take invisible arguments</span><span>
</span><a name="line-2739"></a></pre></body></html>