<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998


Monadic type operations

This module contains monadic operations over types that contain
mutable type variables
-}</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-pragma">{-# LANGUAGE CPP, TupleSections, MultiWayIf #-}</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TcMType</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-15"></a><span>  </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTauType"><span class="hs-identifier hs-type">TcTauType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyVarSet"><span class="hs-identifier hs-type">TcTyVarSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><a name="line-18"></a><span>  </span><span class="hs-comment">-- Creating new mutable type variables</span><span>
</span><a name="line-19"></a><span>  </span><a href="TcMType.html#newFlexiTyVar"><span class="hs-identifier hs-var">newFlexiTyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>  </span><a href="TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a><span class="hs-special">,</span><span>              </span><span class="hs-comment">-- Kind -&gt; TcM TcType</span><span>
</span><a name="line-21"></a><span>  </span><a href="TcMType.html#newFlexiTyVarTys"><span class="hs-identifier hs-var">newFlexiTyVarTys</span></a><span class="hs-special">,</span><span>             </span><span class="hs-comment">-- Int -&gt; Kind -&gt; TcM [TcType]</span><span>
</span><a name="line-22"></a><span>  </span><a href="TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier hs-var">newOpenFlexiTyVarTy</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>  </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#newMetaKindVars"><span class="hs-identifier hs-var">newMetaKindVars</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#newMetaTyVarTyAtLevel"><span class="hs-identifier hs-var">newMetaTyVarTyAtLevel</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>  </span><a href="TcMType.html#cloneMetaTyVar"><span class="hs-identifier hs-var">cloneMetaTyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>  </span><a href="TcMType.html#newFmvTyVar"><span class="hs-identifier hs-var">newFmvTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#newFskTyVar"><span class="hs-identifier hs-var">newFskTyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span>  </span><a href="TcMType.html#readMetaTyVar"><span class="hs-identifier hs-var">readMetaTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#writeMetaTyVar"><span class="hs-identifier hs-var">writeMetaTyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>  </span><a href="TcMType.html#newMetaDetails"><span class="hs-identifier hs-var">newMetaDetails</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#isFilledMetaTyVar"><span class="hs-identifier hs-var">isFilledMetaTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#isUnfilledMetaTyVar"><span class="hs-identifier hs-var">isUnfilledMetaTyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><a name="line-31"></a><span>  </span><span class="hs-comment">-- Expected types</span><span>
</span><a name="line-32"></a><span>  </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>  </span><a href="TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>  </span><a href="TcMType.html#newInferExpType"><span class="hs-identifier hs-var">newInferExpType</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#newInferExpTypeInst"><span class="hs-identifier hs-var">newInferExpTypeInst</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#newInferExpTypeNoInst"><span class="hs-identifier hs-var">newInferExpTypeNoInst</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>  </span><a href="TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#readExpType_maybe"><span class="hs-identifier hs-var">readExpType_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>  </span><a href="TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#checkingExpType_maybe"><span class="hs-identifier hs-var">checkingExpType_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#checkingExpType"><span class="hs-identifier hs-var">checkingExpType</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>  </span><a href="TcMType.html#tauifyExpType"><span class="hs-identifier hs-var">tauifyExpType</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#inferResultToType"><span class="hs-identifier hs-var">inferResultToType</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><a name="line-40"></a><span>  </span><span class="hs-comment">-- Creating fresh type variables for pm checking</span><span>
</span><a name="line-41"></a><span>  </span><a href="TcMType.html#genInstSkolTyVarsX"><span class="hs-identifier hs-var">genInstSkolTyVarsX</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><a name="line-44"></a><span>  </span><span class="hs-comment">-- Creating new evidence variables</span><span>
</span><a name="line-45"></a><span>  </span><a href="TcMType.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#newEvVars"><span class="hs-identifier hs-var">newEvVars</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#newDict"><span class="hs-identifier hs-var">newDict</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>  </span><a href="TcMType.html#newWanted"><span class="hs-identifier hs-var">newWanted</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#newWanteds"><span class="hs-identifier hs-var">newWanteds</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#cloneWanted"><span class="hs-identifier hs-var">cloneWanted</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#cloneWC"><span class="hs-identifier hs-var">cloneWC</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>  </span><a href="TcMType.html#emitWanted"><span class="hs-identifier hs-var">emitWanted</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#emitWantedEq"><span class="hs-identifier hs-var">emitWantedEq</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#emitWantedEvVar"><span class="hs-identifier hs-var">emitWantedEvVar</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#emitWantedEvVars"><span class="hs-identifier hs-var">emitWantedEvVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>  </span><a href="TcRnMonad.html#newTcEvBinds"><span class="hs-identifier hs-var">newTcEvBinds</span></a><span class="hs-special">,</span><span> </span><a href="TcRnMonad.html#addTcEvBind"><span class="hs-identifier hs-var">addTcEvBind</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span>  </span><a href="TcMType.html#newCoercionHole"><span class="hs-identifier hs-var">newCoercionHole</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#fillCoercionHole"><span class="hs-identifier hs-var">fillCoercionHole</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#isFilledCoercionHole"><span class="hs-identifier hs-var">isFilledCoercionHole</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>  </span><a href="TcMType.html#unpackCoercionHole"><span class="hs-identifier hs-var">unpackCoercionHole</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#unpackCoercionHole_maybe"><span class="hs-identifier hs-var">unpackCoercionHole_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>  </span><a href="TcMType.html#checkCoercionHole"><span class="hs-identifier hs-var">checkCoercionHole</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><a name="line-55"></a><span>  </span><span class="hs-comment">-- Instantiation</span><span>
</span><a name="line-56"></a><span>  </span><a href="TcMType.html#newMetaTyVars"><span class="hs-identifier hs-var">newMetaTyVars</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#newMetaTyVarX"><span class="hs-identifier hs-var">newMetaTyVarX</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#newMetaTyVarsX"><span class="hs-identifier hs-var">newMetaTyVarsX</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>  </span><a href="TcMType.html#newMetaSigTyVars"><span class="hs-identifier hs-var">newMetaSigTyVars</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#newMetaSigTyVarX"><span class="hs-identifier hs-var">newMetaSigTyVarX</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>  </span><a href="TcMType.html#newSigTyVar"><span class="hs-identifier hs-var">newSigTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#newWildCardX"><span class="hs-identifier hs-var">newWildCardX</span></a><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>  </span><a href="TcMType.html#tcInstType"><span class="hs-identifier hs-var">tcInstType</span></a><span class="hs-special">,</span><span>
</span><a name="line-60"></a><span>  </span><a href="TcMType.html#tcInstSkolTyVars"><span class="hs-identifier hs-var">tcInstSkolTyVars</span></a><span class="hs-special">,</span><a href="TcMType.html#tcInstSkolTyVarsX"><span class="hs-identifier hs-var">tcInstSkolTyVarsX</span></a><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>  </span><a href="TcMType.html#tcInstSuperSkolTyVarsX"><span class="hs-identifier hs-var">tcInstSuperSkolTyVarsX</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>  </span><a href="TcMType.html#tcSkolDFunType"><span class="hs-identifier hs-var">tcSkolDFunType</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#tcSuperSkolTyVars"><span class="hs-identifier hs-var">tcSuperSkolTyVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span>  </span><a href="TcMType.html#instSkolTyCoVars"><span class="hs-identifier hs-var">instSkolTyCoVars</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#freshenTyVarBndrs"><span class="hs-identifier hs-var">freshenTyVarBndrs</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#freshenCoVarBndrsX"><span class="hs-identifier hs-var">freshenCoVarBndrsX</span></a><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span>  </span><span class="hs-comment">--------------------------------</span><span>
</span><a name="line-67"></a><span>  </span><span class="hs-comment">-- Zonking and tidying</span><span>
</span><a name="line-68"></a><span>  </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#zonkTidyOrigin"><span class="hs-identifier hs-var">zonkTidyOrigin</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>  </span><a href="TcMType.html#tidyEvVar"><span class="hs-identifier hs-var">tidyEvVar</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#tidyCt"><span class="hs-identifier hs-var">tidyCt</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#tidySkolemInfo"><span class="hs-identifier hs-var">tidySkolemInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>  </span><a href="TcMType.html#skolemiseRuntimeUnk"><span class="hs-identifier hs-var">skolemiseRuntimeUnk</span></a><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>  </span><a href="TcMType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#zonkTcTyVars"><span class="hs-identifier hs-var">zonkTcTyVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-72"></a><span>  </span><a href="TcMType.html#zonkTcTyVarToTyVar"><span class="hs-identifier hs-var">zonkTcTyVarToTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#zonkSigTyVarPairs"><span class="hs-identifier hs-var">zonkSigTyVarPairs</span></a><span class="hs-special">,</span><span>
</span><a name="line-73"></a><span>  </span><a href="TcMType.html#zonkTyCoVarsAndFV"><span class="hs-identifier hs-var">zonkTyCoVarsAndFV</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#zonkTcTypeAndFV"><span class="hs-identifier hs-var">zonkTcTypeAndFV</span></a><span class="hs-special">,</span><span>
</span><a name="line-74"></a><span>  </span><a href="TcMType.html#zonkTyCoVarsAndFVList"><span class="hs-identifier hs-var">zonkTyCoVarsAndFVList</span></a><span class="hs-special">,</span><span>
</span><a name="line-75"></a><span>  </span><a href="TcMType.html#zonkTcTypeAndSplitDepVars"><span class="hs-identifier hs-var">zonkTcTypeAndSplitDepVars</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#zonkTcTypesAndSplitDepVars"><span class="hs-identifier hs-var">zonkTcTypesAndSplitDepVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-76"></a><span>  </span><a href="TcMType.html#zonkQuantifiedTyVar"><span class="hs-identifier hs-var">zonkQuantifiedTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#defaultTyVar"><span class="hs-identifier hs-var">defaultTyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-77"></a><span>  </span><a href="TcMType.html#quantifyTyVars"><span class="hs-identifier hs-var">quantifyTyVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-78"></a><span>  </span><a href="TcMType.html#zonkTcTyCoVarBndr"><span class="hs-identifier hs-var">zonkTcTyCoVarBndr</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#zonkTcTyVarBinder"><span class="hs-identifier hs-var">zonkTcTyVarBinder</span></a><span class="hs-special">,</span><span>
</span><a name="line-79"></a><span>  </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#zonkTcTypes"><span class="hs-identifier hs-var">zonkTcTypes</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#zonkCo"><span class="hs-identifier hs-var">zonkCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-80"></a><span>  </span><a href="TcMType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">zonkTyCoVarKind</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#zonkTcTypeMapper"><span class="hs-identifier hs-var">zonkTcTypeMapper</span></a><span class="hs-special">,</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span>  </span><a href="TcMType.html#zonkEvVar"><span class="hs-identifier hs-var">zonkEvVar</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#zonkWC"><span class="hs-identifier hs-var">zonkWC</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#zonkSimples"><span class="hs-identifier hs-var">zonkSimples</span></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>  </span><a href="TcMType.html#zonkId"><span class="hs-identifier hs-var">zonkId</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#zonkCoVar"><span class="hs-identifier hs-var">zonkCoVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-84"></a><span>  </span><a href="TcMType.html#zonkCt"><span class="hs-identifier hs-var">zonkCt</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#zonkSkolemInfo"><span class="hs-identifier hs-var">zonkSkolemInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span>  </span><a href="TcMType.html#tcGetGlobalTyCoVars"><span class="hs-identifier hs-var">tcGetGlobalTyCoVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span>  </span><span class="hs-comment">------------------------------</span><span>
</span><a name="line-89"></a><span>  </span><span class="hs-comment">-- Levity polymorphism</span><span>
</span><a name="line-90"></a><span>  </span><a href="TcMType.html#ensureNotLevPoly"><span class="hs-identifier hs-var">ensureNotLevPoly</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#checkForLevPoly"><span class="hs-identifier hs-var">checkForLevPoly</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#checkForLevPolyX"><span class="hs-identifier hs-var">checkForLevPolyX</span></a><span class="hs-special">,</span><span> </span><a href="TcMType.html#formatLevPolyErr"><span class="hs-identifier hs-var">formatLevPolyErr</span></a><span>
</span><a name="line-91"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- friends:</span><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span> </span><a href="TyCoRep.html"><span class="hs-identifier">TyCoRep</span></a><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span> </span><a href="TcType.html"><span class="hs-identifier">TcType</span></a><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span> </span><a href="Kind.html"><span class="hs-identifier">Kind</span></a><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span> </span><a href="Coercion.html"><span class="hs-identifier">Coercion</span></a><span>
</span><a name="line-103"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-104"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-comment">-- others:</span><span>
</span><a name="line-107"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>        </span><span class="hs-comment">-- TcType, amongst others</span><span>
</span><a name="line-108"></a><span class="hs-keyword">import</span><span> </span><a href="TcEvidence.html"><span class="hs-identifier">TcEvidence</span></a><span>
</span><a name="line-109"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span>
</span><a name="line-110"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-111"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-112"></a><span class="hs-keyword">import</span><span> </span><a href="TysWiredIn.html"><span class="hs-identifier">TysWiredIn</span></a><span>
</span><a name="line-113"></a><span class="hs-keyword">import</span><span> </span><a href="TysPrim.html"><span class="hs-identifier">TysPrim</span></a><span>
</span><a name="line-114"></a><span class="hs-keyword">import</span><span> </span><a href="VarEnv.html"><span class="hs-identifier">VarEnv</span></a><span>
</span><a name="line-115"></a><span class="hs-keyword">import</span><span> </span><a href="NameEnv.html"><span class="hs-identifier">NameEnv</span></a><span>
</span><a name="line-116"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span>
</span><a name="line-117"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-118"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-119"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-120"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-121"></a><span class="hs-keyword">import</span><span> </span><a href="Bag.html"><span class="hs-identifier">Bag</span></a><span>
</span><a name="line-122"></a><span class="hs-keyword">import</span><span> </span><a href="Pair.html"><span class="hs-identifier">Pair</span></a><span>
</span><a name="line-123"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSet.html"><span class="hs-identifier">UniqSet</span></a><span>
</span><a name="line-124"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../ghc-boot-8.5/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">LanguageExtensions</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-127"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>
</span><a name="line-128"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span></a><span>        </span><span class="hs-special">(</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapAccumL"><span class="hs-identifier hs-var">mapAccumL</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-129"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Arrow.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Arrow</span></a><span>    </span><span class="hs-special">(</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Arrow.html#second"><span class="hs-identifier hs-var">second</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Kind variables
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-identifier">mkKindName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-140"></a><a name="mkKindName"><a href="TcMType.html#mkKindName"><span class="hs-identifier">mkKindName</span></a></a><span> </span><a name="local-6989586621679808176"><a href="#local-6989586621679808176"><span class="hs-identifier">unique</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#mkSystemName"><span class="hs-identifier hs-var">mkSystemName</span></a><span> </span><a href="#local-6989586621679808176"><span class="hs-identifier hs-var">unique</span></a><span> </span><a href="TcMType.html#kind_var_occ"><span class="hs-identifier hs-var">kind_var_occ</span></a><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-identifier">kind_var_occ</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-comment">-- Just one for all MetaKindVars</span><span>
</span><a name="line-143"></a><span>                        </span><span class="hs-comment">-- They may be jiggled by tidying</span><span>
</span><a name="line-144"></a><a name="kind_var_occ"><a href="TcMType.html#kind_var_occ"><span class="hs-identifier">kind_var_occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#mkOccName"><span class="hs-identifier hs-var">mkOccName</span></a><span> </span><a href="OccName.html#tvName"><span class="hs-identifier hs-var">tvName</span></a><span> </span><span class="hs-string">&quot;k&quot;</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-identifier">newMetaKindVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>
</span><a name="line-147"></a><a name="newMetaKindVar"><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier">newMetaKindVar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808177"><a href="#local-6989586621679808177"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-148"></a><span>                    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808178"><a href="#local-6989586621679808178"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaDetails"><span class="hs-identifier hs-var">newMetaDetails</span></a><span> </span><a href="TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a><span>
</span><a name="line-149"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808179"><a href="#local-6989586621679808179"><span class="hs-identifier">kv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#mkKindName"><span class="hs-identifier hs-var">mkKindName</span></a><span> </span><a href="#local-6989586621679808177"><span class="hs-identifier hs-var">uniq</span></a><span class="hs-special">)</span><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span> </span><a href="#local-6989586621679808178"><span class="hs-identifier hs-var">details</span></a><span>
</span><a name="line-150"></a><span>                    </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-6989586621679808179"><span class="hs-identifier hs-var">kv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-identifier">newMetaKindVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span class="hs-special">]</span><span>
</span><a name="line-153"></a><a name="newMetaKindVars"><a href="TcMType.html#newMetaKindVars"><span class="hs-identifier">newMetaKindVars</span></a></a><span> </span><a name="local-6989586621679808180"><a href="#local-6989586621679808180"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Util.html#nOfThem"><span class="hs-identifier hs-var">nOfThem</span></a><span> </span><a href="#local-6989586621679808180"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
     Evidence variables; range over constraints we can abstract over
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-identifier">newEvVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-164"></a><a name="newEvVars"><a href="TcMType.html#newEvVars"><span class="hs-identifier">newEvVars</span></a></a><span> </span><a name="local-6989586621679808181"><a href="#local-6989586621679808181"><span class="hs-identifier">theta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a><span> </span><a href="#local-6989586621679808181"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-identifier">newEvVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621679808174"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-6989586621679808175"><span class="hs-identifier hs-type">lcl</span></a><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span>
</span><a name="line-169"></a><span class="hs-comment">-- Creates new *rigid* variables for predicates</span><span>
</span><a name="line-170"></a><a name="newEvVar"><a href="TcMType.html#newEvVar"><span class="hs-identifier">newEvVar</span></a></a><span> </span><a name="local-6989586621679808182"><a href="#local-6989586621679808182"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808183"><a href="#local-6989586621679808183"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newSysName"><span class="hs-identifier hs-var">newSysName</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#predTypeOccName"><span class="hs-identifier hs-var">predTypeOccName</span></a><span> </span><a href="#local-6989586621679808182"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>                 </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#mkLocalIdOrCoVar"><span class="hs-identifier hs-var">mkLocalIdOrCoVar</span></a><span> </span><a href="#local-6989586621679808183"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679808182"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-identifier">newWanted</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcRnTypes.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span>
</span><a name="line-174"></a><span class="hs-comment">-- Deals with both equality and non-equality predicates</span><span>
</span><a name="line-175"></a><a name="newWanted"><a href="TcMType.html#newWanted"><span class="hs-identifier">newWanted</span></a></a><span> </span><a name="local-6989586621679808184"><a href="#local-6989586621679808184"><span class="hs-identifier">orig</span></a></a><span> </span><a name="local-6989586621679808185"><a href="#local-6989586621679808185"><span class="hs-identifier">t_or_k</span></a></a><span> </span><a name="local-6989586621679808186"><a href="#local-6989586621679808186"><span class="hs-identifier">pty</span></a></a><span>
</span><a name="line-176"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679808187"><a href="#local-6989586621679808187"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getCtLocM"><span class="hs-identifier hs-var">getCtLocM</span></a><span> </span><a href="#local-6989586621679808184"><span class="hs-identifier hs-var">orig</span></a><span> </span><a href="#local-6989586621679808185"><span class="hs-identifier hs-var">t_or_k</span></a><span>
</span><a name="line-177"></a><span>       </span><a name="local-6989586621679808188"><a href="#local-6989586621679808188"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Type.html#isEqPred"><span class="hs-identifier hs-var">isEqPred</span></a><span> </span><a href="#local-6989586621679808186"><span class="hs-identifier hs-var">pty</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="TcRnTypes.html#HoleDest"><span class="hs-identifier hs-var">HoleDest</span></a><span>  </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcMType.html#newCoercionHole"><span class="hs-identifier hs-var">newCoercionHole</span></a><span> </span><a href="#local-6989586621679808186"><span class="hs-identifier hs-var">pty</span></a><span>
</span><a name="line-178"></a><span>                            </span><span class="hs-keyword">else</span><span> </span><a href="TcRnTypes.html#EvVarDest"><span class="hs-identifier hs-var">EvVarDest</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcMType.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a><span> </span><a href="#local-6989586621679808186"><span class="hs-identifier hs-var">pty</span></a><span>
</span><a name="line-179"></a><span>       </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_dest</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808188"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-180"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808186"><span class="hs-identifier hs-var">pty</span></a><span>
</span><a name="line-181"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_nosh</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a><span>
</span><a name="line-182"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808187"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span class="hs-identifier">newWanteds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">]</span><span>
</span><a name="line-185"></a><a name="newWanteds"><a href="TcMType.html#newWanteds"><span class="hs-identifier">newWanteds</span></a></a><span> </span><a name="local-6989586621679808189"><a href="#local-6989586621679808189"><span class="hs-identifier">orig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#newWanted"><span class="hs-identifier hs-var">newWanted</span></a><span> </span><a href="#local-6989586621679808189"><span class="hs-identifier hs-var">orig</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-identifier">cloneWanted</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span>
</span><a name="line-188"></a><a name="cloneWanted"><a href="TcMType.html#cloneWanted"><span class="hs-identifier">cloneWanted</span></a></a><span> </span><a name="local-6989586621679808190"><a href="#local-6989586621679808190"><span class="hs-identifier">ct</span></a></a><span>
</span><a name="line-189"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#newWanted"><span class="hs-identifier hs-var">newWanted</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvOrigin"><span class="hs-identifier hs-var">ctEvOrigin</span></a><span> </span><a href="#local-6989586621679808191"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a><span> </span><a href="#local-6989586621679808191"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-191"></a><span>    </span><a name="local-6989586621679808191"><a href="#local-6989586621679808191"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span> </span><a href="#local-6989586621679808190"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-192"></a><span>
</span><a name="line-193"></a><span class="hs-identifier">cloneWC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span>
</span><a name="line-194"></a><a name="cloneWC"><a href="TcMType.html#cloneWC"><span class="hs-identifier">cloneWC</span></a></a><span> </span><a name="local-6989586621679808192"><a href="#local-6989586621679808192"><span class="hs-identifier">wc</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808193"><a href="#local-6989586621679808193"><span class="hs-identifier">simples</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808194"><a href="#local-6989586621679808194"><span class="hs-identifier">implics</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808202"><a href="#local-6989586621679808202"><span class="hs-identifier">simples'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Bag.html#mapBagM"><span class="hs-identifier hs-var">mapBagM</span></a><span> </span><a href="#local-6989586621679808195"><span class="hs-identifier hs-var">clone_one</span></a><span> </span><a href="#local-6989586621679808193"><span class="hs-identifier hs-var">simples</span></a><span>
</span><a name="line-196"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808203"><a href="#local-6989586621679808203"><span class="hs-identifier">implics'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Bag.html#mapBagM"><span class="hs-identifier hs-var">mapBagM</span></a><span> </span><a href="#local-6989586621679808196"><span class="hs-identifier hs-var">clone_implic</span></a><span> </span><a href="#local-6989586621679808194"><span class="hs-identifier hs-var">implics</span></a><span>
</span><a name="line-197"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808192"><span class="hs-identifier hs-var">wc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808202"><span class="hs-identifier hs-var">simples'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808203"><span class="hs-identifier hs-var">implics'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-198"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-199"></a><span>    </span><a name="local-6989586621679808195"><a href="#local-6989586621679808195"><span class="hs-identifier">clone_one</span></a></a><span> </span><a name="local-6989586621679808197"><a href="#local-6989586621679808197"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808198"><a href="#local-6989586621679808198"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#cloneWanted"><span class="hs-identifier hs-var">cloneWanted</span></a><span> </span><a href="#local-6989586621679808197"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a><span> </span><a href="#local-6989586621679808198"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span>    </span><a name="local-6989586621679808196"><a href="#local-6989586621679808196"><span class="hs-identifier">clone_implic</span></a></a><span> </span><a name="local-6989586621679808199"><a href="#local-6989586621679808199"><span class="hs-identifier">implic</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#Implic"><span class="hs-identifier hs-var">Implic</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_wanted</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808200"><a href="#local-6989586621679808200"><span class="hs-identifier">inner_wanted</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808201"><a href="#local-6989586621679808201"><span class="hs-identifier">inner_wanted'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#cloneWC"><span class="hs-identifier hs-var">cloneWC</span></a><span> </span><a href="#local-6989586621679808200"><span class="hs-identifier hs-var">inner_wanted</span></a><span>
</span><a name="line-203"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808199"><span class="hs-identifier hs-var">implic</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_wanted</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808201"><span class="hs-identifier hs-var">inner_wanted'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span class="hs-comment">-- | Emits a new Wanted. Deals with both equalities and non-equalities.</span><span>
</span><a name="line-206"></a><span class="hs-identifier">emitWanted</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcEvidence.html#EvExpr"><span class="hs-identifier hs-type">EvExpr</span></a><span>
</span><a name="line-207"></a><a name="emitWanted"><a href="TcMType.html#emitWanted"><span class="hs-identifier">emitWanted</span></a></a><span> </span><a name="local-6989586621679808204"><a href="#local-6989586621679808204"><span class="hs-identifier">origin</span></a></a><span> </span><a name="local-6989586621679808205"><a href="#local-6989586621679808205"><span class="hs-identifier">pty</span></a></a><span>
</span><a name="line-208"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808206"><a href="#local-6989586621679808206"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newWanted"><span class="hs-identifier hs-var">newWanted</span></a><span> </span><a href="#local-6989586621679808204"><span class="hs-identifier hs-var">origin</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621679808205"><span class="hs-identifier hs-var">pty</span></a><span>
</span><a name="line-209"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#emitSimple"><span class="hs-identifier hs-var">emitSimple</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a><span> </span><a href="#local-6989586621679808206"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-210"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnTypes.html#ctEvExpr"><span class="hs-identifier hs-var">ctEvExpr</span></a><span> </span><a href="#local-6989586621679808206"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-comment">-- | Emits a new equality constraint</span><span>
</span><a name="line-213"></a><span class="hs-identifier">emitWantedEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-214"></a><a name="emitWantedEq"><a href="TcMType.html#emitWantedEq"><span class="hs-identifier">emitWantedEq</span></a></a><span> </span><a name="local-6989586621679808207"><a href="#local-6989586621679808207"><span class="hs-identifier">origin</span></a></a><span> </span><a name="local-6989586621679808208"><a href="#local-6989586621679808208"><span class="hs-identifier">t_or_k</span></a></a><span> </span><a name="local-6989586621679808209"><a href="#local-6989586621679808209"><span class="hs-identifier">role</span></a></a><span> </span><a name="local-6989586621679808210"><a href="#local-6989586621679808210"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679808211"><a href="#local-6989586621679808211"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-215"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808213"><a href="#local-6989586621679808213"><span class="hs-identifier">hole</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newCoercionHole"><span class="hs-identifier hs-var">newCoercionHole</span></a><span> </span><a href="#local-6989586621679808212"><span class="hs-identifier hs-var">pty</span></a><span>
</span><a name="line-216"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808214"><a href="#local-6989586621679808214"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getCtLocM"><span class="hs-identifier hs-var">getCtLocM</span></a><span> </span><a href="#local-6989586621679808207"><span class="hs-identifier hs-var">origin</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679808208"><span class="hs-identifier hs-var">t_or_k</span></a><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#emitSimple"><span class="hs-identifier hs-var">emitSimple</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-218"></a><span>         </span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808212"><span class="hs-identifier hs-var">pty</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_dest</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#HoleDest"><span class="hs-identifier hs-var">HoleDest</span></a><span> </span><a href="#local-6989586621679808213"><span class="hs-identifier hs-var">hole</span></a><span>
</span><a name="line-219"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_nosh</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808214"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-220"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a><span> </span><a href="#local-6989586621679808213"><span class="hs-identifier hs-var">hole</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-221"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-222"></a><span>    </span><a name="local-6989586621679808212"><a href="#local-6989586621679808212"><span class="hs-identifier">pty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a><span> </span><a href="#local-6989586621679808209"><span class="hs-identifier hs-var">role</span></a><span> </span><a href="#local-6989586621679808210"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679808211"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span class="hs-comment">-- | Creates a new EvVar and immediately emits it as a Wanted.</span><span>
</span><a name="line-225"></a><span class="hs-comment">-- No equality predicates here.</span><span>
</span><a name="line-226"></a><span class="hs-identifier">emitWantedEvVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span>
</span><a name="line-227"></a><a name="emitWantedEvVar"><a href="TcMType.html#emitWantedEvVar"><span class="hs-identifier">emitWantedEvVar</span></a></a><span> </span><a name="local-6989586621679808215"><a href="#local-6989586621679808215"><span class="hs-identifier">origin</span></a></a><span> </span><a name="local-6989586621679808216"><a href="#local-6989586621679808216"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-228"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808217"><a href="#local-6989586621679808217"><span class="hs-identifier">new_cv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a><span> </span><a href="#local-6989586621679808216"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-229"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808218"><a href="#local-6989586621679808218"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getCtLocM"><span class="hs-identifier hs-var">getCtLocM</span></a><span> </span><a href="#local-6989586621679808215"><span class="hs-identifier hs-var">origin</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-230"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808219"><a href="#local-6989586621679808219"><span class="hs-identifier">ctev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_dest</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#EvVarDest"><span class="hs-identifier hs-var">EvVarDest</span></a><span> </span><a href="#local-6989586621679808217"><span class="hs-identifier hs-var">new_cv</span></a><span>
</span><a name="line-231"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808216"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-232"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_nosh</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a><span>
</span><a name="line-233"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_loc</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808218"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-234"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#emitSimple"><span class="hs-identifier hs-var">emitSimple</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a><span> </span><a href="#local-6989586621679808219"><span class="hs-identifier hs-var">ctev</span></a><span>
</span><a name="line-235"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679808217"><span class="hs-identifier hs-var">new_cv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-identifier">emitWantedEvVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-238"></a><a name="emitWantedEvVars"><a href="TcMType.html#emitWantedEvVars"><span class="hs-identifier">emitWantedEvVars</span></a></a><span> </span><a name="local-6989586621679808220"><a href="#local-6989586621679808220"><span class="hs-identifier">orig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#emitWantedEvVar"><span class="hs-identifier hs-var">emitWantedEvVar</span></a><span> </span><a href="#local-6989586621679808220"><span class="hs-identifier hs-var">orig</span></a><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>
</span><a name="line-240"></a><span class="hs-identifier">newDict</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Var.html#DictId"><span class="hs-identifier hs-type">DictId</span></a><span>
</span><a name="line-241"></a><a name="newDict"><a href="TcMType.html#newDict"><span class="hs-identifier">newDict</span></a></a><span> </span><a name="local-6989586621679808221"><a href="#local-6989586621679808221"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621679808222"><a href="#local-6989586621679808222"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-242"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808223"><a href="#local-6989586621679808223"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newSysName"><span class="hs-identifier hs-var">newSysName</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#mkDictOcc"><span class="hs-identifier hs-var">mkDictOcc</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-6989586621679808221"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-243"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a><span> </span><a href="#local-6989586621679808223"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a><span> </span><a href="#local-6989586621679808221"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-6989586621679808222"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span class="hs-identifier">predTypeOccName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span>
</span><a name="line-246"></a><a name="predTypeOccName"><a href="TcMType.html#predTypeOccName"><span class="hs-identifier">predTypeOccName</span></a></a><span> </span><a name="local-6989586621679808224"><a href="#local-6989586621679808224"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a><span> </span><a href="#local-6989586621679808224"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-247"></a><span>    </span><a href="Type.html#ClassPred"><span class="hs-identifier hs-var">ClassPred</span></a><span> </span><a name="local-6989586621679808225"><a href="#local-6989586621679808225"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#mkDictOcc"><span class="hs-identifier hs-var">mkDictOcc</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-6989586621679808225"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span>
</span><a name="line-248"></a><span>    </span><a href="Type.html#EqPred"><span class="hs-identifier hs-var">EqPred</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;co&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span>    </span><a href="Type.html#IrredPred"><span class="hs-identifier hs-var">IrredPred</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;irred&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Coercion holes
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-identifier">newCoercionHole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a><span>
</span><a name="line-260"></a><a name="newCoercionHole"><a href="TcMType.html#newCoercionHole"><span class="hs-identifier">newCoercionHole</span></a></a><span> </span><a name="local-6989586621679808226"><a href="#local-6989586621679808226"><span class="hs-identifier">pred_ty</span></a></a><span>
</span><a name="line-261"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808227"><a href="#local-6989586621679808227"><span class="hs-identifier">co_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a><span> </span><a href="#local-6989586621679808226"><span class="hs-identifier hs-var">pred_ty</span></a><span>
</span><a name="line-262"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;New coercion hole:&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808227"><span class="hs-identifier hs-var">co_var</span></a><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808228"><a href="#local-6989586621679808228"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-264"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-var">CoercionHole</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ch_co_var</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808227"><span class="hs-identifier hs-var">co_var</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ch_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808228"><span class="hs-identifier hs-var">ref</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span class="hs-comment">-- | Put a value in a coercion hole</span><span>
</span><a name="line-267"></a><span class="hs-identifier">fillCoercionHole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-268"></a><a name="fillCoercionHole"><a href="TcMType.html#fillCoercionHole"><span class="hs-identifier">fillCoercionHole</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-var">CoercionHole</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ch_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808229"><a href="#local-6989586621679808229"><span class="hs-identifier">ref</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ch_co_var</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808230"><a href="#local-6989586621679808230"><span class="hs-identifier">cv</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679808231"><a href="#local-6989586621679808231"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-269"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-270"></a><span class="hs-cpp">#if defined(DEBUG)</span><span>
</span><a name="line-271"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">cts</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">readTcRef</span><span> </span><span class="hs-identifier">ref</span><span>
</span><a name="line-272"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">whenIsJust</span><span> </span><span class="hs-identifier">cts</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">old_co</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-273"></a><span>         </span><span class="hs-identifier">pprPanic</span><span> </span><span class="hs-string">&quot;Filling a filled coercion hole&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">cv</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">co</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">old_co</span><span class="hs-special">)</span><span>
</span><a name="line-274"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-275"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Filling coercion hole&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808230"><span class="hs-identifier hs-var">cv</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;:=&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808231"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-276"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a><span> </span><a href="#local-6989586621679808229"><span class="hs-identifier hs-var">ref</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679808231"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-comment">-- | Is a coercion hole filled in?</span><span>
</span><a name="line-279"></a><span class="hs-identifier">isFilledCoercionHole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-280"></a><a name="isFilledCoercionHole"><a href="TcMType.html#isFilledCoercionHole"><span class="hs-identifier">isFilledCoercionHole</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-var">CoercionHole</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ch_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808232"><a href="#local-6989586621679808232"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-6989586621679808232"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span class="hs-comment">-- | Retrieve the contents of a coercion hole. Panics if the hole</span><span>
</span><a name="line-283"></a><span class="hs-comment">-- is unfilled</span><span>
</span><a name="line-284"></a><span class="hs-identifier">unpackCoercionHole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-285"></a><a name="unpackCoercionHole"><a href="TcMType.html#unpackCoercionHole"><span class="hs-identifier">unpackCoercionHole</span></a></a><span> </span><a name="local-6989586621679808233"><a href="#local-6989586621679808233"><span class="hs-identifier">hole</span></a></a><span>
</span><a name="line-286"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808234"><a href="#local-6989586621679808234"><span class="hs-identifier">contents</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#unpackCoercionHole_maybe"><span class="hs-identifier hs-var">unpackCoercionHole_maybe</span></a><span> </span><a href="#local-6989586621679808233"><span class="hs-identifier hs-var">hole</span></a><span>
</span><a name="line-287"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679808234"><span class="hs-identifier hs-var">contents</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-288"></a><span>           </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679808235"><a href="#local-6989586621679808235"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679808235"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-289"></a><span>           </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;Unfilled coercion hole&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808233"><span class="hs-identifier hs-var">hole</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span class="hs-comment">-- | Retrieve the contents of a coercion hole, if it is filled</span><span>
</span><a name="line-292"></a><span class="hs-identifier">unpackCoercionHole_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-293"></a><a name="unpackCoercionHole_maybe"><a href="TcMType.html#unpackCoercionHole_maybe"><span class="hs-identifier">unpackCoercionHole_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-var">CoercionHole</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ch_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808236"><a href="#local-6989586621679808236"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-6989586621679808236"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span class="hs-comment">-- | Check that a coercion is appropriate for filling a hole. (The hole</span><span>
</span><a name="line-296"></a><span class="hs-comment">-- itself is needed only for printing. NB: This must be /lazy/ in the coercion,</span><span>
</span><a name="line-297"></a><span class="hs-comment">-- as it's used in TcHsSyn in the presence of knots.</span><span>
</span><a name="line-298"></a><span class="hs-comment">-- Always returns the checked coercion, but this return value is necessary</span><span>
</span><a name="line-299"></a><span class="hs-comment">-- so that the input coercion is forced only when the output is forced.</span><span>
</span><a name="line-300"></a><span class="hs-identifier">checkCoercionHole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-301"></a><a name="checkCoercionHole"><a href="TcMType.html#checkCoercionHole"><span class="hs-identifier">checkCoercionHole</span></a></a><span> </span><a name="local-6989586621679808237"><a href="#local-6989586621679808237"><span class="hs-identifier">cv</span></a></a><span> </span><a name="local-6989586621679808238"><a href="#local-6989586621679808238"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-302"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a><span>
</span><a name="line-303"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808247"><a href="#local-6989586621679808247"><span class="hs-identifier">cv_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679808237"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span>
</span><a name="line-304"></a><span>                  </span><span class="hs-comment">-- co is already zonked, but cv might not be</span><span>
</span><a name="line-305"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-306"></a><span>         </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">ok</span></a><span> </span><span class="hs-identifier">cv_ty</span><span>
</span><a name="line-307"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;Bad coercion hole&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span>
</span><a name="line-308"></a><span>                   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">cv</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">colon</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">t1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">t2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">role</span><span>
</span><a name="line-309"></a><span>                                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">cv_ty</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-310"></a><span>         </span><a href="#local-6989586621679808238"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-311"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-312"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679808238"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-313"></a><span>
</span><a name="line-314"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-315"></a><span>    </span><span class="hs-special">(</span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679808239"><a href="#local-6989586621679808239"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679808240"><a href="#local-6989586621679808240"><span class="hs-identifier">t2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808241"><a href="#local-6989586621679808241"><span class="hs-identifier">role</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#coercionKindRole"><span class="hs-identifier hs-var">coercionKindRole</span></a><span> </span><a href="#local-6989586621679808238"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-316"></a><span>    </span><a name="local-6989586621679808242"><a href="#local-6989586621679808242"><span class="hs-identifier">ok</span></a></a><span> </span><a name="local-6989586621679808243"><a href="#local-6989586621679808243"><span class="hs-identifier">cv_ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#EqPred"><span class="hs-identifier hs-var">EqPred</span></a><span> </span><a name="local-6989586621679808244"><a href="#local-6989586621679808244"><span class="hs-identifier">cv_rel</span></a></a><span> </span><a name="local-6989586621679808245"><a href="#local-6989586621679808245"><span class="hs-identifier">cv_t1</span></a></a><span> </span><a name="local-6989586621679808246"><a href="#local-6989586621679808246"><span class="hs-identifier">cv_t2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a><span> </span><a href="#local-6989586621679808243"><span class="hs-identifier hs-var">cv_ty</span></a><span>
</span><a name="line-317"></a><span>             </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621679808239"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679808245"><span class="hs-identifier hs-var">cv_t1</span></a><span>
</span><a name="line-318"></a><span>             </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679808240"><span class="hs-identifier hs-var">t2</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679808246"><span class="hs-identifier hs-var">cv_t2</span></a><span>
</span><a name="line-319"></a><span>             </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679808241"><span class="hs-identifier hs-var">role</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Type.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a><span> </span><a href="#local-6989586621679808244"><span class="hs-identifier hs-var">cv_rel</span></a><span>
</span><a name="line-320"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-321"></a><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><span class="hs-comment">{-
************************************************************************
*
    Expected types
*
************************************************************************

Note [ExpType]
~~~~~~~~~~~~~~

An ExpType is used as the &quot;expected type&quot; when type-checking an expression.
An ExpType can hold a &quot;hole&quot; that can be filled in by the type-checker.
This allows us to have one tcExpr that works in both checking mode and
synthesis mode (that is, bidirectional type-checking). Previously, this
was achieved by using ordinary unification variables, but we don't need
or want that generality. (For example, #11397 was caused by doing the
wrong thing with unification variables.) Instead, we observe that these
holes should

1. never be nested
2. never appear as the type of a variable
3. be used linearly (never be duplicated)

By defining ExpType, separately from Type, we can achieve goals 1 and 2
statically.

See also [wiki:Typechecking]

Note [TcLevel of ExpType]
~~~~~~~~~~~~~~~~~~~~~~~~~
Consider

  data G a where
    MkG :: G Bool

  foo MkG = True

This is a classic untouchable-variable / ambiguous GADT return type
scenario. But, with ExpTypes, we'll be inferring the type of the RHS.
And, because there is only one branch of the case, we won't trigger
Note [Case branches must never infer a non-tau type] of TcMatches.
We thus must track a TcLevel in an Inferring ExpType. If we try to
fill the ExpType and find that the TcLevels don't work out, we
fill the ExpType with a tau-tv at the low TcLevel, hopefully to
be worked out later by some means. This is triggered in
test gadt/gadt-escape1.

-}</span><span>
</span><a name="line-371"></a><span>
</span><a name="line-372"></a><span class="hs-comment">-- actual data definition is in TcType</span><span>
</span><a name="line-373"></a><span>
</span><a name="line-374"></a><span class="hs-comment">-- | Make an 'ExpType' suitable for inferring a type of kind * or #.</span><span>
</span><a name="line-375"></a><span class="hs-identifier">newInferExpTypeNoInst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a><span>
</span><a name="line-376"></a><a name="newInferExpTypeNoInst"><a href="TcMType.html#newInferExpTypeNoInst"><span class="hs-identifier">newInferExpTypeNoInst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#newInferExpType"><span class="hs-identifier hs-var">newInferExpType</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span class="hs-identifier">newInferExpTypeInst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a><span>
</span><a name="line-379"></a><a name="newInferExpTypeInst"><a href="TcMType.html#newInferExpTypeInst"><span class="hs-identifier">newInferExpTypeInst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#newInferExpType"><span class="hs-identifier hs-var">newInferExpType</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-380"></a><span>
</span><a name="line-381"></a><span class="hs-identifier">newInferExpType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span>
</span><a name="line-382"></a><a name="newInferExpType"><a href="TcMType.html#newInferExpType"><span class="hs-identifier">newInferExpType</span></a></a><span> </span><a name="local-6989586621679808248"><a href="#local-6989586621679808248"><span class="hs-identifier">inst</span></a></a><span>
</span><a name="line-383"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808249"><a href="#local-6989586621679808249"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-384"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808250"><a href="#local-6989586621679808250"><span class="hs-identifier">tclvl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a><span>
</span><a name="line-385"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;newOpenInferExpType&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808249"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808248"><span class="hs-identifier hs-var">inst</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808250"><span class="hs-identifier hs-var">tclvl</span></a><span class="hs-special">)</span><span>
</span><a name="line-386"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808251"><a href="#local-6989586621679808251"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-387"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#Infer"><span class="hs-identifier hs-var">Infer</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#IR"><span class="hs-identifier hs-var">IR</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ir_uniq</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808249"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ir_lvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808250"><span class="hs-identifier hs-var">tclvl</span></a><span>
</span><a name="line-388"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ir_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808251"><span class="hs-identifier hs-var">ref</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ir_inst</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808248"><span class="hs-identifier hs-var">inst</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-389"></a><span>
</span><a name="line-390"></a><span class="hs-comment">-- | Extract a type out of an ExpType, if one exists. But one should always</span><span>
</span><a name="line-391"></a><span class="hs-comment">-- exist. Unless you're quite sure you know what you're doing.</span><span>
</span><a name="line-392"></a><span class="hs-identifier">readExpType_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">)</span><span>
</span><a name="line-393"></a><a name="readExpType_maybe"><a href="TcMType.html#readExpType_maybe"><span class="hs-identifier">readExpType_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#Check"><span class="hs-identifier hs-var">Check</span></a><span> </span><a name="local-6989586621679808252"><a href="#local-6989586621679808252"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679808252"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-394"></a><span class="hs-identifier">readExpType_maybe</span><span> </span><span class="hs-special">(</span><a href="TcType.html#Infer"><span class="hs-identifier hs-var">Infer</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#IR"><span class="hs-identifier hs-var">IR</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ir_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808253"><a href="#local-6989586621679808253"><span class="hs-identifier">ref</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a><span> </span><a href="#local-6989586621679808253"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-395"></a><span>
</span><a name="line-396"></a><span class="hs-comment">-- | Extract a type out of an ExpType. Otherwise, panics.</span><span>
</span><a name="line-397"></a><span class="hs-identifier">readExpType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-398"></a><a name="readExpType"><a href="TcMType.html#readExpType"><span class="hs-identifier">readExpType</span></a></a><span> </span><a name="local-6989586621679808254"><a href="#local-6989586621679808254"><span class="hs-identifier">exp_ty</span></a></a><span>
</span><a name="line-399"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808255"><a href="#local-6989586621679808255"><span class="hs-identifier">mb_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#readExpType_maybe"><span class="hs-identifier hs-var">readExpType_maybe</span></a><span> </span><a href="#local-6989586621679808254"><span class="hs-identifier hs-var">exp_ty</span></a><span>
</span><a name="line-400"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679808255"><span class="hs-identifier hs-var">mb_ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-401"></a><span>           </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679808256"><a href="#local-6989586621679808256"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679808256"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-402"></a><span>           </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;Unknown expected type&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808254"><span class="hs-identifier hs-var">exp_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-403"></a><span>
</span><a name="line-404"></a><span class="hs-comment">-- | Returns the expected type when in checking mode.</span><span>
</span><a name="line-405"></a><span class="hs-identifier">checkingExpType_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-406"></a><a name="checkingExpType_maybe"><a href="TcMType.html#checkingExpType_maybe"><span class="hs-identifier">checkingExpType_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#Check"><span class="hs-identifier hs-var">Check</span></a><span> </span><a name="local-6989586621679808257"><a href="#local-6989586621679808257"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679808257"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-407"></a><span class="hs-identifier">checkingExpType_maybe</span><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-408"></a><span>
</span><a name="line-409"></a><span class="hs-comment">-- | Returns the expected type when in checking mode. Panics if in inference</span><span>
</span><a name="line-410"></a><span class="hs-comment">-- mode.</span><span>
</span><a name="line-411"></a><span class="hs-identifier">checkingExpType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-412"></a><a name="checkingExpType"><a href="TcMType.html#checkingExpType"><span class="hs-identifier">checkingExpType</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">(</span><a href="TcType.html#Check"><span class="hs-identifier hs-var">Check</span></a><span> </span><a name="local-6989586621679808258"><a href="#local-6989586621679808258"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808258"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-413"></a><span class="hs-identifier">checkingExpType</span><span> </span><a name="local-6989586621679808259"><a href="#local-6989586621679808259"><span class="hs-identifier">err</span></a></a><span> </span><a name="local-6989586621679808260"><a href="#local-6989586621679808260"><span class="hs-identifier">et</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;checkingExpType&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679808259"><span class="hs-identifier hs-var">err</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808260"><span class="hs-identifier hs-var">et</span></a><span class="hs-special">)</span><span>
</span><a name="line-414"></a><span>
</span><a name="line-415"></a><span class="hs-identifier">tauifyExpType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span>
</span><a name="line-416"></a><span class="hs-comment">-- ^ Turn a (Infer hole) type into a (Check alpha),</span><span>
</span><a name="line-417"></a><span class="hs-comment">-- where alpha is a fresh unification variable</span><span>
</span><a name="line-418"></a><a name="tauifyExpType"><a href="TcMType.html#tauifyExpType"><span class="hs-identifier">tauifyExpType</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#Check"><span class="hs-identifier hs-var">Check</span></a><span> </span><a name="local-6989586621679808261"><a href="#local-6989586621679808261"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#Check"><span class="hs-identifier hs-var">Check</span></a><span> </span><a href="#local-6989586621679808261"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- No-op for (Check ty)</span><span>
</span><a name="line-419"></a><span class="hs-identifier">tauifyExpType</span><span> </span><span class="hs-special">(</span><a href="TcType.html#Infer"><span class="hs-identifier hs-var">Infer</span></a><span> </span><a name="local-6989586621679808262"><a href="#local-6989586621679808262"><span class="hs-identifier">inf_res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808263"><a href="#local-6989586621679808263"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#inferResultToType"><span class="hs-identifier hs-var">inferResultToType</span></a><span> </span><a href="#local-6989586621679808262"><span class="hs-identifier hs-var">inf_res</span></a><span>
</span><a name="line-420"></a><span>                                   </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#Check"><span class="hs-identifier hs-var">Check</span></a><span> </span><a href="#local-6989586621679808263"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-421"></a><span>
</span><a name="line-422"></a><span class="hs-comment">-- | Extracts the expected type if there is one, or generates a new</span><span>
</span><a name="line-423"></a><span class="hs-comment">-- TauTv if there isn't.</span><span>
</span><a name="line-424"></a><span class="hs-identifier">expTypeToType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-425"></a><a name="expTypeToType"><a href="TcMType.html#expTypeToType"><span class="hs-identifier">expTypeToType</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#Check"><span class="hs-identifier hs-var">Check</span></a><span> </span><a name="local-6989586621679808264"><a href="#local-6989586621679808264"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679808264"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-426"></a><span class="hs-identifier">expTypeToType</span><span> </span><span class="hs-special">(</span><a href="TcType.html#Infer"><span class="hs-identifier hs-var">Infer</span></a><span> </span><a name="local-6989586621679808265"><a href="#local-6989586621679808265"><span class="hs-identifier">inf_res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#inferResultToType"><span class="hs-identifier hs-var">inferResultToType</span></a><span> </span><a href="#local-6989586621679808265"><span class="hs-identifier hs-var">inf_res</span></a><span>
</span><a name="line-427"></a><span>
</span><a name="line-428"></a><span class="hs-identifier">inferResultToType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#InferResult"><span class="hs-identifier hs-type">InferResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-429"></a><a name="inferResultToType"><a href="TcMType.html#inferResultToType"><span class="hs-identifier">inferResultToType</span></a></a><span> </span><span class="hs-special">(</span><a href="TcType.html#IR"><span class="hs-identifier hs-var">IR</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ir_uniq</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808266"><a href="#local-6989586621679808266"><span class="hs-identifier">u</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ir_lvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808267"><a href="#local-6989586621679808267"><span class="hs-identifier">tc_lvl</span></a></a><span>
</span><a name="line-430"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ir_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808268"><a href="#local-6989586621679808268"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808269"><a href="#local-6989586621679808269"><span class="hs-identifier">rr</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaTyVarTyAtLevel"><span class="hs-identifier hs-var">newMetaTyVarTyAtLevel</span></a><span> </span><a href="#local-6989586621679808267"><span class="hs-identifier hs-var">tc_lvl</span></a><span> </span><a href="TysWiredIn.html#runtimeRepTy"><span class="hs-identifier hs-var">runtimeRepTy</span></a><span>
</span><a name="line-432"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808270"><a href="#local-6989586621679808270"><span class="hs-identifier">tau</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaTyVarTyAtLevel"><span class="hs-identifier hs-var">newMetaTyVarTyAtLevel</span></a><span> </span><a href="#local-6989586621679808267"><span class="hs-identifier hs-var">tc_lvl</span></a><span> </span><span class="hs-special">(</span><a href="TysPrim.html#tYPE"><span class="hs-identifier hs-var">tYPE</span></a><span> </span><a href="#local-6989586621679808269"><span class="hs-identifier hs-var">rr</span></a><span class="hs-special">)</span><span>
</span><a name="line-433"></a><span>             </span><span class="hs-comment">-- See Note [TcLevel of ExpType]</span><span>
</span><a name="line-434"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="IOEnv.html#writeMutVar"><span class="hs-identifier hs-var">writeMutVar</span></a><span> </span><a href="#local-6989586621679808268"><span class="hs-identifier hs-var">ref</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679808270"><span class="hs-identifier hs-var">tau</span></a><span class="hs-special">)</span><span>
</span><a name="line-435"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Forcing ExpType to be monomorphic:&quot;</span><span>
</span><a name="line-436"></a><span>                 </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808266"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;:=&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808270"><span class="hs-identifier hs-var">tau</span></a><span class="hs-special">)</span><span>
</span><a name="line-437"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679808270"><span class="hs-identifier hs-var">tau</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-438"></a><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
        SkolemTvs (immutable)
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-445"></a><span>
</span><a name="line-446"></a><span class="hs-identifier">tcInstType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-447"></a><span>                   </span><span class="hs-comment">-- ^ How to instantiate the type variables</span><span>
</span><a name="line-448"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>                                            </span><span class="hs-comment">-- ^ Type to instantiate</span><span>
</span><a name="line-449"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ Result</span><span>
</span><a name="line-450"></a><span>                </span><span class="hs-comment">-- (type vars, preds (incl equalities), rho)</span><span>
</span><a name="line-451"></a><a name="tcInstType"><a href="TcMType.html#tcInstType"><span class="hs-identifier">tcInstType</span></a></a><span> </span><a name="local-6989586621679808271"><a href="#local-6989586621679808271"><span class="hs-identifier">inst_tyvars</span></a></a><span> </span><a name="local-6989586621679808272"><a href="#local-6989586621679808272"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-452"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcSplitForAllTys"><span class="hs-identifier hs-var">tcSplitForAllTys</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621679808272"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-453"></a><span>        </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>    </span><a name="local-6989586621679808273"><a href="#local-6989586621679808273"><span class="hs-identifier">rho</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span>     </span><span class="hs-comment">-- There may be overloading despite no type variables;</span><span>
</span><a name="line-454"></a><span>                                </span><span class="hs-comment">--      (?x :: Int) =&gt; Int -&gt; Int</span><span>
</span><a name="line-455"></a><span>                                </span><span class="hs-special">(</span><a name="local-6989586621679808274"><a href="#local-6989586621679808274"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808275"><a href="#local-6989586621679808275"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitPhiTy"><span class="hs-identifier hs-var">tcSplitPhiTy</span></a><span> </span><a href="#local-6989586621679808273"><span class="hs-identifier hs-var">rho</span></a><span>
</span><a name="line-456"></a><span>                            </span><span class="hs-keyword">in</span><span>
</span><a name="line-457"></a><span>                            </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808274"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808275"><span class="hs-identifier hs-var">tau</span></a><span class="hs-special">)</span><span>
</span><a name="line-458"></a><span>
</span><a name="line-459"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679808276"><a href="#local-6989586621679808276"><span class="hs-identifier">tyvars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808277"><a href="#local-6989586621679808277"><span class="hs-identifier">rho</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679808278"><a href="#local-6989586621679808278"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808279"><a href="#local-6989586621679808279"><span class="hs-identifier">tyvars'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679808271"><span class="hs-identifier hs-var">inst_tyvars</span></a><span> </span><a href="#local-6989586621679808276"><span class="hs-identifier hs-var">tyvars</span></a><span>
</span><a name="line-460"></a><span>                            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679808280"><a href="#local-6989586621679808280"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808281"><a href="#local-6989586621679808281"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcSplitPhiTy"><span class="hs-identifier hs-var">tcSplitPhiTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTyAddInScope"><span class="hs-identifier hs-var">substTyAddInScope</span></a><span> </span><a href="#local-6989586621679808278"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679808277"><span class="hs-identifier hs-var">rho</span></a><span class="hs-special">)</span><span>
</span><a name="line-461"></a><span>                                  </span><a name="local-6989586621679808282"><a href="#local-6989586621679808282"><span class="hs-identifier">tv_prs</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a><span> </span><a href="#local-6989586621679808276"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679808279"><span class="hs-identifier hs-var">tyvars'</span></a><span>
</span><a name="line-462"></a><span>                            </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808282"><span class="hs-identifier hs-var">tv_prs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808280"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808281"><span class="hs-identifier hs-var">tau</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-463"></a><span>
</span><a name="line-464"></a><span class="hs-identifier">tcSkolDFunType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#DFunId"><span class="hs-identifier hs-type">DFunId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">)</span><span>
</span><a name="line-465"></a><span class="hs-comment">-- Instantiate a type signature with skolem constants.</span><span>
</span><a name="line-466"></a><span class="hs-comment">-- We could give them fresh names, but no need to do so</span><span>
</span><a name="line-467"></a><a name="tcSkolDFunType"><a href="TcMType.html#tcSkolDFunType"><span class="hs-identifier">tcSkolDFunType</span></a></a><span> </span><a name="local-6989586621679808283"><a href="#local-6989586621679808283"><span class="hs-identifier">dfun</span></a></a><span>
</span><a name="line-468"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679808284"><a href="#local-6989586621679808284"><span class="hs-identifier">tv_prs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808285"><a href="#local-6989586621679808285"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808286"><a href="#local-6989586621679808286"><span class="hs-identifier">tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#tcInstType"><span class="hs-identifier hs-var">tcInstType</span></a><span> </span><a href="TcMType.html#tcInstSuperSkolTyVars"><span class="hs-identifier hs-var">tcInstSuperSkolTyVars</span></a><span> </span><a href="#local-6989586621679808283"><span class="hs-identifier hs-var">dfun</span></a><span>
</span><a name="line-469"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="#local-6989586621679808284"><span class="hs-identifier hs-var">tv_prs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808285"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808286"><span class="hs-identifier hs-var">tau</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-470"></a><span>
</span><a name="line-471"></a><span class="hs-identifier">tcSuperSkolTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-472"></a><span class="hs-comment">-- Make skolem constants, but do *not* give them new names, as above</span><span>
</span><a name="line-473"></a><span class="hs-comment">-- Moreover, make them &quot;super skolems&quot;; see comments with superSkolemTv</span><span>
</span><a name="line-474"></a><span class="hs-comment">-- see Note [Kind substitution when instantiating]</span><span>
</span><a name="line-475"></a><span class="hs-comment">-- Precondition: tyvars should be ordered by scoping</span><span>
</span><a name="line-476"></a><a name="tcSuperSkolTyVars"><a href="TcMType.html#tcSuperSkolTyVars"><span class="hs-identifier">tcSuperSkolTyVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapAccumL"><span class="hs-identifier hs-var">mapAccumL</span></a><span> </span><a href="TcMType.html#tcSuperSkolTyVar"><span class="hs-identifier hs-var">tcSuperSkolTyVar</span></a><span> </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span>
</span><a name="line-477"></a><span>
</span><a name="line-478"></a><span class="hs-identifier">tcSuperSkolTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-479"></a><a name="tcSuperSkolTyVar"><a href="TcMType.html#tcSuperSkolTyVar"><span class="hs-identifier">tcSuperSkolTyVar</span></a></a><span> </span><a name="local-6989586621679808287"><a href="#local-6989586621679808287"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679808288"><a href="#local-6989586621679808288"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-480"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#extendTvSubstWithClone"><span class="hs-identifier hs-var">extendTvSubstWithClone</span></a><span> </span><a href="#local-6989586621679808287"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679808288"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679808290"><span class="hs-identifier hs-var">new_tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808290"><span class="hs-identifier hs-var">new_tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-481"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-482"></a><span>    </span><a name="local-6989586621679808289"><a href="#local-6989586621679808289"><span class="hs-identifier">kind</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a><span> </span><a href="#local-6989586621679808287"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679808288"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-483"></a><span>    </span><a name="local-6989586621679808290"><a href="#local-6989586621679808290"><span class="hs-identifier">new_tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a><span> </span><a href="#local-6989586621679808288"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808289"><span class="hs-identifier hs-var">kind</span></a><span> </span><a href="TcType.html#superSkolemTv"><span class="hs-identifier hs-var">superSkolemTv</span></a><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span class="hs-comment">-- | Given a list of @['TyVar']@, skolemize the type variables,</span><span>
</span><a name="line-486"></a><span class="hs-comment">-- returning a substitution mapping the original tyvars to the</span><span>
</span><a name="line-487"></a><span class="hs-comment">-- skolems, and the list of newly bound skolems.  See also</span><span>
</span><a name="line-488"></a><span class="hs-comment">-- tcInstSkolTyVars' for a precondition.  The resulting</span><span>
</span><a name="line-489"></a><span class="hs-comment">-- skolems are non-overlappable; see Note [Overlap and deriving]</span><span>
</span><a name="line-490"></a><span class="hs-comment">-- for an example where this matters.</span><span>
</span><a name="line-491"></a><span class="hs-identifier">tcInstSkolTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-492"></a><a name="tcInstSkolTyVars"><a href="TcMType.html#tcInstSkolTyVars"><span class="hs-identifier">tcInstSkolTyVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#tcInstSkolTyVarsX"><span class="hs-identifier hs-var">tcInstSkolTyVarsX</span></a><span> </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span>
</span><a name="line-493"></a><span>
</span><a name="line-494"></a><span class="hs-identifier">tcInstSkolTyVarsX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-495"></a><a name="tcInstSkolTyVarsX"><a href="TcMType.html#tcInstSkolTyVarsX"><span class="hs-identifier">tcInstSkolTyVarsX</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#tcInstSkolTyVars%27"><span class="hs-identifier hs-var">tcInstSkolTyVars'</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-496"></a><span>
</span><a name="line-497"></a><span class="hs-identifier">tcInstSuperSkolTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-498"></a><a name="tcInstSuperSkolTyVars"><a href="TcMType.html#tcInstSuperSkolTyVars"><span class="hs-identifier">tcInstSuperSkolTyVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#tcInstSuperSkolTyVarsX"><span class="hs-identifier hs-var">tcInstSuperSkolTyVarsX</span></a><span> </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span>
</span><a name="line-499"></a><span>
</span><a name="line-500"></a><span class="hs-identifier">tcInstSuperSkolTyVarsX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-501"></a><a name="tcInstSuperSkolTyVarsX"><a href="TcMType.html#tcInstSuperSkolTyVarsX"><span class="hs-identifier">tcInstSuperSkolTyVarsX</span></a></a><span> </span><a name="local-6989586621679808291"><a href="#local-6989586621679808291"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#tcInstSkolTyVars%27"><span class="hs-identifier hs-var">tcInstSkolTyVars'</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679808291"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-502"></a><span>
</span><a name="line-503"></a><span class="hs-identifier">tcInstSkolTyVars'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-504"></a><span class="hs-comment">-- Precondition: tyvars should be ordered (kind vars first)</span><span>
</span><a name="line-505"></a><span class="hs-comment">-- see Note [Kind substitution when instantiating]</span><span>
</span><a name="line-506"></a><span class="hs-comment">-- Get the location from the monad; this is a complete freshening operation</span><span>
</span><a name="line-507"></a><a name="tcInstSkolTyVars%27"><a href="TcMType.html#tcInstSkolTyVars%27"><span class="hs-identifier">tcInstSkolTyVars'</span></a></a><span> </span><a name="local-6989586621679808292"><a href="#local-6989586621679808292"><span class="hs-identifier">overlappable</span></a></a><span> </span><a name="local-6989586621679808293"><a href="#local-6989586621679808293"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679808294"><a href="#local-6989586621679808294"><span class="hs-identifier">tvs</span></a></a><span>
</span><a name="line-508"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808295"><a href="#local-6989586621679808295"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span>
</span><a name="line-509"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808296"><a href="#local-6989586621679808296"><span class="hs-identifier">lvl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a><span>
</span><a name="line-510"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#instSkolTyCoVarsX"><span class="hs-identifier hs-var">instSkolTyCoVarsX</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#mkTcSkolTyVar"><span class="hs-identifier hs-var">mkTcSkolTyVar</span></a><span> </span><a href="#local-6989586621679808296"><span class="hs-identifier hs-var">lvl</span></a><span> </span><a href="#local-6989586621679808295"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621679808292"><span class="hs-identifier hs-var">overlappable</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808293"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679808294"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-511"></a><span>
</span><a name="line-512"></a><span class="hs-identifier">mkTcSkolTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcMType.html#TcTyCoVarMaker"><span class="hs-identifier hs-type">TcTyCoVarMaker</span></a><span> </span><a href="#local-6989586621679808172"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-6989586621679808173"><span class="hs-identifier hs-type">lcl</span></a><span>
</span><a name="line-513"></a><a name="mkTcSkolTyVar"><a href="TcMType.html#mkTcSkolTyVar"><span class="hs-identifier">mkTcSkolTyVar</span></a></a><span> </span><a name="local-6989586621679808297"><a href="#local-6989586621679808297"><span class="hs-identifier">lvl</span></a></a><span> </span><a name="local-6989586621679808298"><a href="#local-6989586621679808298"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679808299"><a href="#local-6989586621679808299"><span class="hs-identifier">overlappable</span></a></a><span> </span><a name="local-6989586621679808300"><a href="#local-6989586621679808300"><span class="hs-identifier">old_name</span></a></a><span> </span><a name="local-6989586621679808301"><a href="#local-6989586621679808301"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-514"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808303"><a href="#local-6989586621679808303"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-515"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808304"><a href="#local-6989586621679808304"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a><span> </span><a href="#local-6989586621679808303"><span class="hs-identifier hs-var">uniq</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-6989586621679808300"><span class="hs-identifier hs-var">old_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808298"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-516"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><a href="#local-6989586621679808304"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679808301"><span class="hs-identifier hs-var">kind</span></a><span> </span><a href="#local-6989586621679808302"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-517"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-518"></a><span>    </span><a name="local-6989586621679808302"><a href="#local-6989586621679808302"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a><span> </span><a href="#local-6989586621679808297"><span class="hs-identifier hs-var">lvl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808299"><span class="hs-identifier hs-var">overlappable</span></a><span>
</span><a name="line-519"></a><span>              </span><span class="hs-comment">-- NB: skolems bump the level</span><span>
</span><a name="line-520"></a><span>
</span><a name="line-521"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-522"></a><span class="hs-identifier">freshenTyVarBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621679808170"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-6989586621679808171"><span class="hs-identifier hs-type">lcl</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-523"></a><span class="hs-comment">-- ^ Give fresh uniques to a bunch of TyVars, but they stay</span><span>
</span><a name="line-524"></a><span class="hs-comment">--   as TyVars, rather than becoming TcTyVars</span><span>
</span><a name="line-525"></a><span class="hs-comment">-- Used in FamInst.newFamInst, and Inst.newClsInst</span><span>
</span><a name="line-526"></a><a name="freshenTyVarBndrs"><a href="TcMType.html#freshenTyVarBndrs"><span class="hs-identifier">freshenTyVarBndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#instSkolTyCoVars"><span class="hs-identifier hs-var">instSkolTyCoVars</span></a><span> </span><a href="#local-6989586621679808305"><span class="hs-identifier hs-var">mk_tv</span></a><span>
</span><a name="line-527"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-528"></a><span>    </span><a name="local-6989586621679808305"><a href="#local-6989586621679808305"><span class="hs-identifier">mk_tv</span></a></a><span> </span><a name="local-6989586621679808306"><a href="#local-6989586621679808306"><span class="hs-identifier">old_name</span></a></a><span> </span><a name="local-6989586621679808307"><a href="#local-6989586621679808307"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-529"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808308"><a href="#local-6989586621679808308"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-530"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTyVar"><span class="hs-identifier hs-var">mkTyVar</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#setNameUnique"><span class="hs-identifier hs-var">setNameUnique</span></a><span> </span><a href="#local-6989586621679808306"><span class="hs-identifier hs-var">old_name</span></a><span> </span><a href="#local-6989586621679808308"><span class="hs-identifier hs-var">uniq</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808307"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-531"></a><span>
</span><a name="line-532"></a><span class="hs-identifier">freshenCoVarBndrsX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621679808168"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-6989586621679808169"><span class="hs-identifier hs-type">lcl</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-533"></a><span class="hs-comment">-- ^ Give fresh uniques to a bunch of CoVars</span><span>
</span><a name="line-534"></a><span class="hs-comment">-- Used in FamInst.newFamInst</span><span>
</span><a name="line-535"></a><a name="freshenCoVarBndrsX"><a href="TcMType.html#freshenCoVarBndrsX"><span class="hs-identifier">freshenCoVarBndrsX</span></a></a><span> </span><a name="local-6989586621679808309"><a href="#local-6989586621679808309"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#instSkolTyCoVarsX"><span class="hs-identifier hs-var">instSkolTyCoVarsX</span></a><span> </span><a href="#local-6989586621679808310"><span class="hs-identifier hs-var">mk_cv</span></a><span> </span><a href="#local-6989586621679808309"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-536"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-537"></a><span>    </span><a name="local-6989586621679808310"><a href="#local-6989586621679808310"><span class="hs-identifier">mk_cv</span></a></a><span> </span><a name="local-6989586621679808311"><a href="#local-6989586621679808311"><span class="hs-identifier">old_name</span></a></a><span> </span><a name="local-6989586621679808312"><a href="#local-6989586621679808312"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-538"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808313"><a href="#local-6989586621679808313"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-539"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkCoVar"><span class="hs-identifier hs-var">mkCoVar</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#setNameUnique"><span class="hs-identifier hs-var">setNameUnique</span></a><span> </span><a href="#local-6989586621679808311"><span class="hs-identifier hs-var">old_name</span></a><span> </span><a href="#local-6989586621679808313"><span class="hs-identifier hs-var">uniq</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808312"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-540"></a><span>
</span><a name="line-541"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-542"></a><span class="hs-keyword">type</span><span> </span><a name="TcTyCoVarMaker"><a href="TcMType.html#TcTyCoVarMaker"><span class="hs-identifier">TcTyCoVarMaker</span></a></a><span> </span><a name="local-6989586621679808156"><a href="#local-6989586621679808156"><span class="hs-identifier">gbl</span></a></a><span> </span><a name="local-6989586621679808157"><a href="#local-6989586621679808157"><span class="hs-identifier">lcl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621679808156"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-6989586621679808157"><span class="hs-identifier hs-type">lcl</span></a><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span>
</span><a name="line-543"></a><span>     </span><span class="hs-comment">-- The TcTyCoVarMaker should make a fresh Name, based on the old one</span><span>
</span><a name="line-544"></a><span>     </span><span class="hs-comment">-- Freshness is critical. See Note [Skolems in zonkSyntaxExpr] in TcHsSyn</span><span>
</span><a name="line-545"></a><span>
</span><a name="line-546"></a><span class="hs-identifier">instSkolTyCoVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcMType.html#TcTyCoVarMaker"><span class="hs-identifier hs-type">TcTyCoVarMaker</span></a><span> </span><a href="#local-6989586621679808166"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-6989586621679808167"><span class="hs-identifier hs-type">lcl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621679808166"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-6989586621679808167"><span class="hs-identifier hs-type">lcl</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-547"></a><a name="instSkolTyCoVars"><a href="TcMType.html#instSkolTyCoVars"><span class="hs-identifier">instSkolTyCoVars</span></a></a><span> </span><a name="local-6989586621679808314"><a href="#local-6989586621679808314"><span class="hs-identifier">mk_tcv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#instSkolTyCoVarsX"><span class="hs-identifier hs-var">instSkolTyCoVarsX</span></a><span> </span><a href="#local-6989586621679808314"><span class="hs-identifier hs-var">mk_tcv</span></a><span> </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span>
</span><a name="line-548"></a><span>
</span><a name="line-549"></a><span class="hs-identifier">instSkolTyCoVarsX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcMType.html#TcTyCoVarMaker"><span class="hs-identifier hs-type">TcTyCoVarMaker</span></a><span> </span><a href="#local-6989586621679808164"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-6989586621679808165"><span class="hs-identifier hs-type">lcl</span></a><span>
</span><a name="line-550"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621679808164"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-6989586621679808165"><span class="hs-identifier hs-type">lcl</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-551"></a><a name="instSkolTyCoVarsX"><a href="TcMType.html#instSkolTyCoVarsX"><span class="hs-identifier">instSkolTyCoVarsX</span></a></a><span> </span><a name="local-6989586621679808315"><a href="#local-6989586621679808315"><span class="hs-identifier">mk_tcv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MonadUtils.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#instSkolTyCoVarX"><span class="hs-identifier hs-var">instSkolTyCoVarX</span></a><span> </span><a href="#local-6989586621679808315"><span class="hs-identifier hs-var">mk_tcv</span></a><span class="hs-special">)</span><span>
</span><a name="line-552"></a><span>
</span><a name="line-553"></a><span class="hs-identifier">instSkolTyCoVarX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcMType.html#TcTyCoVarMaker"><span class="hs-identifier hs-type">TcTyCoVarMaker</span></a><span> </span><a href="#local-6989586621679808162"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-6989586621679808163"><span class="hs-identifier hs-type">lcl</span></a><span>
</span><a name="line-554"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621679808162"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-6989586621679808163"><span class="hs-identifier hs-type">lcl</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-555"></a><a name="instSkolTyCoVarX"><a href="TcMType.html#instSkolTyCoVarX"><span class="hs-identifier">instSkolTyCoVarX</span></a></a><span> </span><a name="local-6989586621679808316"><a href="#local-6989586621679808316"><span class="hs-identifier">mk_tcv</span></a></a><span> </span><a name="local-6989586621679808317"><a href="#local-6989586621679808317"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679808318"><a href="#local-6989586621679808318"><span class="hs-identifier">tycovar</span></a></a><span>
</span><a name="line-556"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808321"><a href="#local-6989586621679808321"><span class="hs-identifier">new_tcv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679808316"><span class="hs-identifier hs-var">mk_tcv</span></a><span> </span><a href="#local-6989586621679808319"><span class="hs-identifier hs-var">old_name</span></a><span> </span><a href="#local-6989586621679808320"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-557"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808322"><a href="#local-6989586621679808322"><span class="hs-identifier">subst1</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-6989586621679808321"><span class="hs-identifier hs-var">new_tcv</span></a><span>
</span><a name="line-558"></a><span>                     </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#extendTvSubstWithClone"><span class="hs-identifier hs-var">extendTvSubstWithClone</span></a><span> </span><a href="#local-6989586621679808317"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679808318"><span class="hs-identifier hs-var">tycovar</span></a><span> </span><a href="#local-6989586621679808321"><span class="hs-identifier hs-var">new_tcv</span></a><span>
</span><a name="line-559"></a><span>                     </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-560"></a><span>                     </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#extendCvSubstWithClone"><span class="hs-identifier hs-var">extendCvSubstWithClone</span></a><span> </span><a href="#local-6989586621679808317"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679808318"><span class="hs-identifier hs-var">tycovar</span></a><span> </span><a href="#local-6989586621679808321"><span class="hs-identifier hs-var">new_tcv</span></a><span>
</span><a name="line-561"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808322"><span class="hs-identifier hs-var">subst1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808321"><span class="hs-identifier hs-var">new_tcv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-562"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-563"></a><span>    </span><a name="local-6989586621679808319"><a href="#local-6989586621679808319"><span class="hs-identifier">old_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a><span> </span><a href="#local-6989586621679808318"><span class="hs-identifier hs-var">tycovar</span></a><span>
</span><a name="line-564"></a><span>    </span><a name="local-6989586621679808320"><a href="#local-6989586621679808320"><span class="hs-identifier">kind</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a><span> </span><a href="#local-6989586621679808317"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679808318"><span class="hs-identifier hs-var">tycovar</span></a><span class="hs-special">)</span><span>
</span><a name="line-565"></a><span>
</span><a name="line-566"></a><span class="hs-identifier">newFskTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>
</span><a name="line-567"></a><a name="newFskTyVar"><a href="TcMType.html#newFskTyVar"><span class="hs-identifier">newFskTyVar</span></a></a><span> </span><a name="local-6989586621679808323"><a href="#local-6989586621679808323"><span class="hs-identifier">fam_ty</span></a></a><span>
</span><a name="line-568"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808324"><a href="#local-6989586621679808324"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-569"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808325"><a href="#local-6989586621679808325"><span class="hs-identifier">ref</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a><span> </span><a href="TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a><span>
</span><a name="line-570"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808326"><a href="#local-6989586621679808326"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_info</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#FlatSkolTv"><span class="hs-identifier hs-var">FlatSkolTv</span></a><span>
</span><a name="line-571"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mtv_ref</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808325"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-572"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mtv_tclvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#fmvTcLevel"><span class="hs-identifier hs-var">fmvTcLevel</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-573"></a><span>             </span><a name="local-6989586621679808327"><a href="#local-6989586621679808327"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#mkMetaTyVarName"><span class="hs-identifier hs-var">mkMetaTyVarName</span></a><span> </span><a href="#local-6989586621679808324"><span class="hs-identifier hs-var">uniq</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;fsk&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-574"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><a href="#local-6989586621679808327"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679808323"><span class="hs-identifier hs-var">fam_ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808326"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-575"></a><span>
</span><a name="line-576"></a><span class="hs-comment">{-
Note [Kind substitution when instantiating]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we instantiate a bunch of kind and type variables, first we
expect them to be topologically sorted.
Then we have to instantiate the kind variables, build a substitution
from old variables to the new variables, then instantiate the type
variables substituting the original kind.

Exemple: If we want to instantiate
  [(k1 :: *), (k2 :: *), (a :: k1 -&gt; k2), (b :: k1)]
we want
  [(?k1 :: *), (?k2 :: *), (?a :: ?k1 -&gt; ?k2), (?b :: ?k1)]
instead of the buggous
  [(?k1 :: *), (?k2 :: *), (?a :: k1 -&gt; k2), (?b :: k1)]


************************************************************************
*                                                                      *
        MetaTvs (meta type variables; mutable)
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-599"></a><span>
</span><a name="line-600"></a><span class="hs-comment">-- a SigTv can unify with type *variables* only, including other SigTvs</span><span>
</span><a name="line-601"></a><span class="hs-comment">-- and skolems. Sometimes, they can unify with type variables that the</span><span>
</span><a name="line-602"></a><span class="hs-comment">-- user would rather keep distinct; see #11203 for an example.</span><span>
</span><a name="line-603"></a><span class="hs-comment">-- So, any client of this</span><span>
</span><a name="line-604"></a><span class="hs-comment">-- function needs to either allow the SigTvs to unify with each other</span><span>
</span><a name="line-605"></a><span class="hs-comment">-- (say, for pattern-bound scoped type variables), or check that they</span><span>
</span><a name="line-606"></a><span class="hs-comment">-- don't (say, with a call to findDubSigTvs).</span><span>
</span><a name="line-607"></a><span class="hs-identifier">newSigTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>
</span><a name="line-608"></a><a name="newSigTyVar"><a href="TcMType.html#newSigTyVar"><span class="hs-identifier">newSigTyVar</span></a></a><span> </span><a name="local-6989586621679808328"><a href="#local-6989586621679808328"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679808329"><a href="#local-6989586621679808329"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-609"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808330"><a href="#local-6989586621679808330"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaDetails"><span class="hs-identifier hs-var">newMetaDetails</span></a><span> </span><a href="TcType.html#SigTv"><span class="hs-identifier hs-var">SigTv</span></a><span>
</span><a name="line-610"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><a href="#local-6989586621679808328"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679808329"><span class="hs-identifier hs-var">kind</span></a><span> </span><a href="#local-6989586621679808330"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-611"></a><span>
</span><a name="line-612"></a><span class="hs-identifier">newFmvTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>
</span><a name="line-613"></a><span class="hs-comment">-- Very like newMetaTyVar, except sets mtv_tclvl to one less</span><span>
</span><a name="line-614"></a><span class="hs-comment">-- so that the fmv is untouchable.</span><span>
</span><a name="line-615"></a><a name="newFmvTyVar"><a href="TcMType.html#newFmvTyVar"><span class="hs-identifier">newFmvTyVar</span></a></a><span> </span><a name="local-6989586621679808331"><a href="#local-6989586621679808331"><span class="hs-identifier">fam_ty</span></a></a><span>
</span><a name="line-616"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808332"><a href="#local-6989586621679808332"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-617"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808333"><a href="#local-6989586621679808333"><span class="hs-identifier">ref</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a><span> </span><a href="TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a><span>
</span><a name="line-618"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808334"><a href="#local-6989586621679808334"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_info</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#FlatMetaTv"><span class="hs-identifier hs-var">FlatMetaTv</span></a><span>
</span><a name="line-619"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mtv_ref</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808333"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-620"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mtv_tclvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#fmvTcLevel"><span class="hs-identifier hs-var">fmvTcLevel</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-621"></a><span>             </span><a name="local-6989586621679808335"><a href="#local-6989586621679808335"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#mkMetaTyVarName"><span class="hs-identifier hs-var">mkMetaTyVarName</span></a><span> </span><a href="#local-6989586621679808332"><span class="hs-identifier hs-var">uniq</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;s&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-622"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><a href="#local-6989586621679808335"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679808331"><span class="hs-identifier hs-var">fam_ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808334"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-623"></a><span>
</span><a name="line-624"></a><span class="hs-identifier">newMetaDetails</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcTyVarDetails"><span class="hs-identifier hs-type">TcTyVarDetails</span></a><span>
</span><a name="line-625"></a><a name="newMetaDetails"><a href="TcMType.html#newMetaDetails"><span class="hs-identifier">newMetaDetails</span></a></a><span> </span><a name="local-6989586621679808336"><a href="#local-6989586621679808336"><span class="hs-identifier">info</span></a></a><span>
</span><a name="line-626"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808337"><a href="#local-6989586621679808337"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a><span> </span><a href="TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a><span>
</span><a name="line-627"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808338"><a href="#local-6989586621679808338"><span class="hs-identifier">tclvl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a><span>
</span><a name="line-628"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_info</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808336"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-629"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mtv_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808337"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-630"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mtv_tclvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808338"><span class="hs-identifier hs-var">tclvl</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-631"></a><span>
</span><a name="line-632"></a><span class="hs-identifier">cloneMetaTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>
</span><a name="line-633"></a><a name="cloneMetaTyVar"><a href="TcMType.html#cloneMetaTyVar"><span class="hs-identifier">cloneMetaTyVar</span></a></a><span> </span><a name="local-6989586621679808339"><a href="#local-6989586621679808339"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-634"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTcTyVar</span><span> </span><span class="hs-identifier">tv</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-635"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808340"><a href="#local-6989586621679808340"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-636"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808341"><a href="#local-6989586621679808341"><span class="hs-identifier">ref</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a><span> </span><a href="TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a><span>
</span><a name="line-637"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808342"><a href="#local-6989586621679808342"><span class="hs-identifier">name'</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#setNameUnique"><span class="hs-identifier hs-var">setNameUnique</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a><span> </span><a href="#local-6989586621679808339"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808340"><span class="hs-identifier hs-var">uniq</span></a><span>
</span><a name="line-638"></a><span>              </span><a name="local-6989586621679808343"><a href="#local-6989586621679808343"><span class="hs-identifier">details'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679808339"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-639"></a><span>                           </span><a name="local-6989586621679808344"><a href="#local-6989586621679808344"><span class="hs-identifier">details</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679808344"><span class="hs-identifier hs-var">details</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808341"><span class="hs-identifier hs-var">ref</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-640"></a><span>                           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;cloneMetaTyVar&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808339"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-641"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><a href="#local-6989586621679808342"><span class="hs-identifier hs-var">name'</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679808339"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808343"><span class="hs-identifier hs-var">details'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-642"></a><span>
</span><a name="line-643"></a><span class="hs-comment">-- Works for both type and kind variables</span><span>
</span><a name="line-644"></a><span class="hs-identifier">readMetaTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#MetaDetails"><span class="hs-identifier hs-type">MetaDetails</span></a><span>
</span><a name="line-645"></a><a name="readMetaTyVar"><a href="TcMType.html#readMetaTyVar"><span class="hs-identifier">readMetaTyVar</span></a></a><span> </span><a name="local-6989586621679808345"><a href="#local-6989586621679808345"><span class="hs-identifier">tyvar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isMetaTyVar</span><span> </span><span class="hs-identifier">tyvar</span><span class="hs-special">,</span><span> </span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-identifier">tyvar</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-646"></a><span>                      </span><a href="IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#metaTyVarRef"><span class="hs-identifier hs-var">metaTyVarRef</span></a><span> </span><a href="#local-6989586621679808345"><span class="hs-identifier hs-var">tyvar</span></a><span class="hs-special">)</span><span>
</span><a name="line-647"></a><span>
</span><a name="line-648"></a><span class="hs-identifier">isFilledMetaTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-649"></a><span class="hs-comment">-- True of a filled-in (Indirect) meta type variable</span><span>
</span><a name="line-650"></a><a name="isFilledMetaTyVar"><a href="TcMType.html#isFilledMetaTyVar"><span class="hs-identifier">isFilledMetaTyVar</span></a></a><span> </span><a name="local-6989586621679808346"><a href="#local-6989586621679808346"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-651"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808347"><a href="#local-6989586621679808347"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679808346"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-652"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808348"><a href="#local-6989586621679808348"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a><span> </span><a href="#local-6989586621679808347"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-653"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#isIndirect"><span class="hs-identifier hs-var">isIndirect</span></a><span> </span><a href="#local-6989586621679808348"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-654"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-655"></a><span>
</span><a name="line-656"></a><span class="hs-identifier">isUnfilledMetaTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-657"></a><span class="hs-comment">-- True of a un-filled-in (Flexi) meta type variable</span><span>
</span><a name="line-658"></a><a name="isUnfilledMetaTyVar"><a href="TcMType.html#isUnfilledMetaTyVar"><span class="hs-identifier">isUnfilledMetaTyVar</span></a></a><span> </span><a name="local-6989586621679808349"><a href="#local-6989586621679808349"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-659"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808350"><a href="#local-6989586621679808350"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679808349"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-660"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808351"><a href="#local-6989586621679808351"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a><span> </span><a href="#local-6989586621679808350"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-661"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#isFlexi"><span class="hs-identifier hs-var">isFlexi</span></a><span> </span><a href="#local-6989586621679808351"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-662"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-663"></a><span>
</span><a name="line-664"></a><span class="hs-comment">--------------------</span><span>
</span><a name="line-665"></a><span class="hs-comment">-- Works with both type and kind variables</span><span>
</span><a name="line-666"></a><span class="hs-identifier">writeMetaTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-667"></a><span class="hs-comment">-- Write into a currently-empty MetaTyVar</span><span>
</span><a name="line-668"></a><span>
</span><a name="line-669"></a><a name="writeMetaTyVar"><a href="TcMType.html#writeMetaTyVar"><span class="hs-identifier">writeMetaTyVar</span></a></a><span> </span><a name="local-6989586621679808352"><a href="#local-6989586621679808352"><span class="hs-identifier">tyvar</span></a></a><span> </span><a name="local-6989586621679808353"><a href="#local-6989586621679808353"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-670"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a><span>
</span><a name="line-671"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#writeMetaTyVarRef"><span class="hs-identifier hs-var">writeMetaTyVarRef</span></a><span> </span><a href="#local-6989586621679808352"><span class="hs-identifier hs-var">tyvar</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#metaTyVarRef"><span class="hs-identifier hs-var">metaTyVarRef</span></a><span> </span><a href="#local-6989586621679808352"><span class="hs-identifier hs-var">tyvar</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808353"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-672"></a><span>
</span><a name="line-673"></a><span class="hs-comment">-- Everything from here on only happens if DEBUG is on</span><span>
</span><a name="line-674"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a><span> </span><a href="#local-6989586621679808352"><span class="hs-identifier hs-var">tyvar</span></a><span class="hs-special">)</span><span>
</span><a name="line-675"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">WARN</span><span class="hs-special">(</span><span> </span><a href="Outputable.html#warnPprTrace"><span class="hs-identifier hs-var">True</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;Writing to non-tc tyvar&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tyvar</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-676"></a><span>    </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-677"></a><span>
</span><a name="line-678"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808354"><a href="#local-6989586621679808354"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679808352"><span class="hs-identifier hs-var">tyvar</span></a><span>
</span><a name="line-679"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#writeMetaTyVarRef"><span class="hs-identifier hs-var">writeMetaTyVarRef</span></a><span> </span><a href="#local-6989586621679808352"><span class="hs-identifier hs-var">tyvar</span></a><span> </span><a href="#local-6989586621679808354"><span class="hs-identifier hs-var">ref</span></a><span> </span><a href="#local-6989586621679808353"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-680"></a><span>
</span><a name="line-681"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-682"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">WARN</span><span class="hs-special">(</span><span> </span><a href="Outputable.html#warnPprTrace"><span class="hs-identifier hs-var">True</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;Writing to non-meta tyvar&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tyvar</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-683"></a><span>    </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-684"></a><span>
</span><a name="line-685"></a><span class="hs-comment">--------------------</span><span>
</span><a name="line-686"></a><span class="hs-identifier">writeMetaTyVarRef</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><a href="TcType.html#MetaDetails"><span class="hs-identifier hs-type">MetaDetails</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-687"></a><span class="hs-comment">-- Here the tyvar is for error checking only;</span><span>
</span><a name="line-688"></a><span class="hs-comment">-- the ref cell must be for the same tyvar</span><span>
</span><a name="line-689"></a><a name="writeMetaTyVarRef"><a href="TcMType.html#writeMetaTyVarRef"><span class="hs-identifier">writeMetaTyVarRef</span></a></a><span> </span><a name="local-6989586621679808355"><a href="#local-6989586621679808355"><span class="hs-identifier">tyvar</span></a></a><span> </span><a name="local-6989586621679808356"><a href="#local-6989586621679808356"><span class="hs-identifier">ref</span></a></a><span> </span><a name="local-6989586621679808357"><a href="#local-6989586621679808357"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-690"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a><span>
</span><a name="line-691"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;writeMetaTyVar&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808355"><span class="hs-identifier hs-var">tyvar</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679808355"><span class="hs-identifier hs-var">tyvar</span></a><span class="hs-special">)</span><span>
</span><a name="line-692"></a><span>                                   </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;:=&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808357"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-693"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a><span> </span><a href="#local-6989586621679808356"><span class="hs-identifier hs-var">ref</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#Indirect"><span class="hs-identifier hs-var">Indirect</span></a><span> </span><a href="#local-6989586621679808357"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-694"></a><span>
</span><a name="line-695"></a><span>  </span><span class="hs-comment">-- Everything from here on only happens if DEBUG is on</span><span>
</span><a name="line-696"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-697"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808366"><a href="#local-6989586621679808366"><span class="hs-identifier">meta_details</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a><span> </span><a href="#local-6989586621679808356"><span class="hs-identifier hs-var">ref</span></a><span class="hs-special">;</span><span>
</span><a name="line-698"></a><span>       </span><span class="hs-comment">-- Zonk kinds to allow the error check to work</span><span>
</span><a name="line-699"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808367"><a href="#local-6989586621679808367"><span class="hs-identifier">zonked_tv_kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621679808358"><span class="hs-identifier hs-var">tv_kind</span></a><span>
</span><a name="line-700"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808368"><a href="#local-6989586621679808368"><span class="hs-identifier">zonked_ty_kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621679808359"><span class="hs-identifier hs-var">ty_kind</span></a><span>
</span><a name="line-701"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808369"><a href="#local-6989586621679808369"><span class="hs-identifier">kind_check_ok</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-6989586621679808358"><span class="hs-identifier hs-var">tv_kind</span></a><span>  </span><span class="hs-comment">-- Don't check kinds for updates</span><span>
</span><a name="line-702"></a><span>                                               </span><span class="hs-comment">-- to coercion variables.  Why not??</span><span>
</span><a name="line-703"></a><span>                          </span><span class="hs-operator hs-var">||</span><span> </span><a href="Kind.html#isConstraintKind"><span class="hs-identifier hs-var">isConstraintKind</span></a><span> </span><a href="#local-6989586621679808367"><span class="hs-identifier hs-var">zonked_tv_kind</span></a><span>
</span><a name="line-704"></a><span>                          </span><span class="hs-operator hs-var">||</span><span> </span><a href="TcType.html#tcEqKind"><span class="hs-identifier hs-var">tcEqKind</span></a><span> </span><a href="#local-6989586621679808368"><span class="hs-identifier hs-var">zonked_ty_kind</span></a><span> </span><a href="#local-6989586621679808367"><span class="hs-identifier hs-var">zonked_tv_kind</span></a><span>
</span><a name="line-705"></a><span>             </span><span class="hs-comment">-- Hack alert! isConstraintKind: see TcHsType</span><span>
</span><a name="line-706"></a><span>             </span><span class="hs-comment">-- Note [Extra-constraint holes in partial type signatures]</span><span>
</span><a name="line-707"></a><span>
</span><a name="line-708"></a><span>             </span><a name="local-6989586621679808370"><a href="#local-6989586621679808370"><span class="hs-identifier">kind_msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Ill-kinded update to meta tyvar&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-709"></a><span>                           </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span>    </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808355"><span class="hs-identifier hs-var">tyvar</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;::&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808358"><span class="hs-identifier hs-var">tv_kind</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808367"><span class="hs-identifier hs-var">zonked_tv_kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-710"></a><span>                              </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;:=&quot;</span><span>
</span><a name="line-711"></a><span>                              </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808357"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;::&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808359"><span class="hs-identifier hs-var">ty_kind</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808368"><span class="hs-identifier hs-var">zonked_ty_kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-712"></a><span>
</span><a name="line-713"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;writeMetaTyVar&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808355"><span class="hs-identifier hs-var">tyvar</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;:=&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808357"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-714"></a><span>
</span><a name="line-715"></a><span>       </span><span class="hs-comment">-- Check for double updates</span><span>
</span><a name="line-716"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">MASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isFlexi</span><span> </span><span class="hs-identifier">meta_details</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">double_upd_msg</span><span> </span><span class="hs-identifier">meta_details</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-717"></a><span>
</span><a name="line-718"></a><span>       </span><span class="hs-comment">-- Check for level OK</span><span>
</span><a name="line-719"></a><span>       </span><span class="hs-comment">-- See Note [Level check when unifying]</span><span>
</span><a name="line-720"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">MASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">level_check_ok</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">level_check_msg</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-721"></a><span>
</span><a name="line-722"></a><span>       </span><span class="hs-comment">-- Check Kinds ok</span><span>
</span><a name="line-723"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">MASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">kind_check_ok</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808369"><span class="hs-identifier hs-var">kind_msg</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-724"></a><span>
</span><a name="line-725"></a><span>       </span><span class="hs-comment">-- Do the write</span><span>
</span><a name="line-726"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="IOEnv.html#writeMutVar"><span class="hs-identifier hs-var">writeMutVar</span></a><span> </span><a href="#local-6989586621679808356"><span class="hs-identifier hs-var">ref</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#Indirect"><span class="hs-identifier hs-var">Indirect</span></a><span> </span><a href="#local-6989586621679808357"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-727"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-728"></a><span>    </span><a name="local-6989586621679808358"><a href="#local-6989586621679808358"><span class="hs-identifier">tv_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679808355"><span class="hs-identifier hs-var">tyvar</span></a><span>
</span><a name="line-729"></a><span>    </span><a name="local-6989586621679808359"><a href="#local-6989586621679808359"><span class="hs-identifier">ty_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679808357"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-730"></a><span>
</span><a name="line-731"></a><span>    </span><a name="local-6989586621679808360"><a href="#local-6989586621679808360"><span class="hs-identifier">tv_lvl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcTyVarLevel"><span class="hs-identifier hs-var">tcTyVarLevel</span></a><span> </span><a href="#local-6989586621679808355"><span class="hs-identifier hs-var">tyvar</span></a><span>
</span><a name="line-732"></a><span>    </span><a name="local-6989586621679808361"><a href="#local-6989586621679808361"><span class="hs-identifier">ty_lvl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#tcTypeLevel"><span class="hs-identifier hs-var">tcTypeLevel</span></a><span> </span><a href="#local-6989586621679808357"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-733"></a><span>
</span><a name="line-734"></a><span>    </span><a name="local-6989586621679808362"><a href="#local-6989586621679808362"><span class="hs-identifier">level_check_ok</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#isFlattenTyVar"><span class="hs-identifier hs-var">isFlattenTyVar</span></a><span> </span><a href="#local-6989586621679808355"><span class="hs-identifier hs-var">tyvar</span></a><span>
</span><a name="line-735"></a><span>                  </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808361"><span class="hs-identifier hs-var">ty_lvl</span></a><span> </span><span class="hs-special">`</span><a href="TcType.html#strictlyDeeperThan"><span class="hs-identifier hs-var">strictlyDeeperThan</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679808360"><span class="hs-identifier hs-var">tv_lvl</span></a><span class="hs-special">)</span><span>
</span><a name="line-736"></a><span>    </span><a name="local-6989586621679808363"><a href="#local-6989586621679808363"><span class="hs-identifier">level_check_msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808361"><span class="hs-identifier hs-var">ty_lvl</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808360"><span class="hs-identifier hs-var">tv_lvl</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808355"><span class="hs-identifier hs-var">tyvar</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808357"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-737"></a><span>
</span><a name="line-738"></a><span>    </span><a name="local-6989586621679808364"><a href="#local-6989586621679808364"><span class="hs-identifier">double_upd_msg</span></a></a><span> </span><a name="local-6989586621679808365"><a href="#local-6989586621679808365"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Double update of meta tyvar&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-739"></a><span>                                </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808355"><span class="hs-identifier hs-var">tyvar</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808365"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span>
</span><a name="line-740"></a><span>
</span><a name="line-741"></a><span>
</span><a name="line-742"></a><span class="hs-comment">{- Note [Level check when unifying]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When unifying
     alpha:lvl := ty
we expect that the TcLevel of 'ty' will be &lt;= lvl.
However, during unflatting we do
     fuv:l := ty:(l+1)
which is usually wrong; hence the check isFmmvTyVar in level_check_ok.
See Note [TcLevel assignment] in TcType.
-}</span><span>
</span><a name="line-752"></a><span>
</span><a name="line-753"></a><span class="hs-comment">{-
% Generating fresh variables for pattern match check
-}</span><span>
</span><a name="line-756"></a><span>
</span><a name="line-757"></a><span class="hs-comment">-- UNINSTANTIATED VERSION OF tcInstSkolTyCoVars</span><span>
</span><a name="line-758"></a><span class="hs-identifier">genInstSkolTyVarsX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-759"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="#local-6989586621679808160"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-6989586621679808161"><span class="hs-identifier hs-type">lcl</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-760"></a><span class="hs-comment">-- Precondition: tyvars should be scoping-ordered</span><span>
</span><a name="line-761"></a><span class="hs-comment">-- see Note [Kind substitution when instantiating]</span><span>
</span><a name="line-762"></a><span class="hs-comment">-- Get the location from the monad; this is a complete freshening operation</span><span>
</span><a name="line-763"></a><a name="genInstSkolTyVarsX"><a href="TcMType.html#genInstSkolTyVarsX"><span class="hs-identifier">genInstSkolTyVarsX</span></a></a><span> </span><a name="local-6989586621679808371"><a href="#local-6989586621679808371"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679808372"><a href="#local-6989586621679808372"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679808373"><a href="#local-6989586621679808373"><span class="hs-identifier">tvs</span></a></a><span>
</span><a name="line-764"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#instSkolTyCoVarsX"><span class="hs-identifier hs-var">instSkolTyCoVarsX</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#mkTcSkolTyVar"><span class="hs-identifier hs-var">mkTcSkolTyVar</span></a><span> </span><a href="TcType.html#topTcLevel"><span class="hs-identifier hs-var">topTcLevel</span></a><span> </span><a href="#local-6989586621679808371"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808372"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679808373"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-765"></a><span>
</span><a name="line-766"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        MetaTvs: TauTvs
*                                                                      *
************************************************************************

Note [Never need to instantiate coercion variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
With coercion variables sloshing around in types, it might seem that we
sometimes need to instantiate coercion variables. This would be problematic,
because coercion variables inhabit unboxed equality (~#), and the constraint
solver thinks in terms only of boxed equality (~). The solution is that
we never need to instantiate coercion variables in the first place.

The tyvars that we need to instantiate come from the types of functions,
data constructors, and patterns. These will never be quantified over
coercion variables, except for the special case of the promoted Eq#. But,
that can't ever appear in user code, so we're safe!
-}</span><span>
</span><a name="line-786"></a><span>
</span><a name="line-787"></a><span class="hs-identifier">mkMetaTyVarName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-788"></a><span class="hs-comment">-- Makes a /System/ Name, which is eagerly eliminated by</span><span>
</span><a name="line-789"></a><span class="hs-comment">-- the unifier; see TcUnify.nicer_to_update_tv1, and</span><span>
</span><a name="line-790"></a><span class="hs-comment">-- TcCanonical.canEqTyVarTyVar (nicer_to_update_tv2)</span><span>
</span><a name="line-791"></a><a name="mkMetaTyVarName"><a href="TcMType.html#mkMetaTyVarName"><span class="hs-identifier">mkMetaTyVarName</span></a></a><span> </span><a name="local-6989586621679808374"><a href="#local-6989586621679808374"><span class="hs-identifier">uniq</span></a></a><span> </span><a name="local-6989586621679808375"><a href="#local-6989586621679808375"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#mkSystemName"><span class="hs-identifier hs-var">mkSystemName</span></a><span> </span><a href="#local-6989586621679808374"><span class="hs-identifier hs-var">uniq</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#mkTyVarOccFS"><span class="hs-identifier hs-var">mkTyVarOccFS</span></a><span> </span><a href="#local-6989586621679808375"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span>
</span><a name="line-792"></a><span>
</span><a name="line-793"></a><span class="hs-identifier">newAnonMetaTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>
</span><a name="line-794"></a><span class="hs-comment">-- Make a new meta tyvar out of thin air</span><span>
</span><a name="line-795"></a><a name="newAnonMetaTyVar"><a href="TcMType.html#newAnonMetaTyVar"><span class="hs-identifier">newAnonMetaTyVar</span></a></a><span> </span><a name="local-6989586621679808376"><a href="#local-6989586621679808376"><span class="hs-identifier">meta_info</span></a></a><span> </span><a name="local-6989586621679808377"><a href="#local-6989586621679808377"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-796"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808378"><a href="#local-6989586621679808378"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-797"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808379"><a href="#local-6989586621679808379"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#mkMetaTyVarName"><span class="hs-identifier hs-var">mkMetaTyVarName</span></a><span> </span><a href="#local-6989586621679808378"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-6989586621679808380"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-798"></a><span>              </span><a name="local-6989586621679808380"><a href="#local-6989586621679808380"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679808376"><span class="hs-identifier hs-var">meta_info</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-799"></a><span>                        </span><a href="TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;t&quot;</span><span>
</span><a name="line-800"></a><span>                        </span><a href="TcType.html#FlatMetaTv"><span class="hs-identifier hs-var">FlatMetaTv</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;fmv&quot;</span><span>
</span><a name="line-801"></a><span>                        </span><a href="TcType.html#FlatSkolTv"><span class="hs-identifier hs-var">FlatSkolTv</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;fsk&quot;</span><span>
</span><a name="line-802"></a><span>                        </span><a href="TcType.html#SigTv"><span class="hs-identifier hs-var">SigTv</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;a&quot;</span><span>
</span><a name="line-803"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808381"><a href="#local-6989586621679808381"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaDetails"><span class="hs-identifier hs-var">newMetaDetails</span></a><span> </span><a href="#local-6989586621679808376"><span class="hs-identifier hs-var">meta_info</span></a><span>
</span><a name="line-804"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><a href="#local-6989586621679808379"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679808377"><span class="hs-identifier hs-var">kind</span></a><span> </span><a href="#local-6989586621679808381"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-805"></a><span>
</span><a name="line-806"></a><span class="hs-identifier">cloneAnonMetaTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>
</span><a name="line-807"></a><span class="hs-comment">-- Same as newAnonMetaTyVar, but use a supplied TyVar as the source of the print-name</span><span>
</span><a name="line-808"></a><a name="cloneAnonMetaTyVar"><a href="TcMType.html#cloneAnonMetaTyVar"><span class="hs-identifier">cloneAnonMetaTyVar</span></a></a><span> </span><a name="local-6989586621679808382"><a href="#local-6989586621679808382"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621679808383"><a href="#local-6989586621679808383"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679808384"><a href="#local-6989586621679808384"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-809"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808385"><a href="#local-6989586621679808385"><span class="hs-identifier">uniq</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-810"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808386"><a href="#local-6989586621679808386"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newMetaDetails"><span class="hs-identifier hs-var">newMetaDetails</span></a><span> </span><a href="#local-6989586621679808382"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-811"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808387"><a href="#local-6989586621679808387"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#mkSystemName"><span class="hs-identifier hs-var">mkSystemName</span></a><span> </span><a href="#local-6989586621679808385"><span class="hs-identifier hs-var">uniq</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-6989586621679808383"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-812"></a><span>                       </span><span class="hs-comment">-- See Note [Name of an instantiated type variable]</span><span>
</span><a name="line-813"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><a href="#local-6989586621679808387"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679808384"><span class="hs-identifier hs-var">kind</span></a><span> </span><a href="#local-6989586621679808386"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-814"></a><span>
</span><a name="line-815"></a><span class="hs-comment">{- Note [Name of an instantiated type variable]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
At the moment we give a unification variable a System Name, which
influences the way it is tidied; see TypeRep.tidyTyVarBndr.
-}</span><span>
</span><a name="line-820"></a><span>
</span><a name="line-821"></a><span class="hs-identifier">newFlexiTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>
</span><a name="line-822"></a><a name="newFlexiTyVar"><a href="TcMType.html#newFlexiTyVar"><span class="hs-identifier">newFlexiTyVar</span></a></a><span> </span><a name="local-6989586621679808388"><a href="#local-6989586621679808388"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#newAnonMetaTyVar"><span class="hs-identifier hs-var">newAnonMetaTyVar</span></a><span> </span><a href="TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a><span> </span><a href="#local-6989586621679808388"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-823"></a><span>
</span><a name="line-824"></a><span class="hs-identifier">newFlexiTyVarTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-825"></a><a name="newFlexiTyVarTy"><a href="TcMType.html#newFlexiTyVarTy"><span class="hs-identifier">newFlexiTyVarTy</span></a></a><span> </span><a name="local-6989586621679808389"><a href="#local-6989586621679808389"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-826"></a><span>    </span><a name="local-6989586621679808390"><a href="#local-6989586621679808390"><span class="hs-identifier">tc_tyvar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newFlexiTyVar"><span class="hs-identifier hs-var">newFlexiTyVar</span></a><span> </span><a href="#local-6989586621679808389"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-827"></a><span>    </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-6989586621679808390"><span class="hs-identifier hs-var">tc_tyvar</span></a><span class="hs-special">)</span><span>
</span><a name="line-828"></a><span>
</span><a name="line-829"></a><span class="hs-identifier">newFlexiTyVarTys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span>
</span><a name="line-830"></a><a name="newFlexiTyVarTys"><a href="TcMType.html#newFlexiTyVarTys"><span class="hs-identifier">newFlexiTyVarTys</span></a></a><span> </span><a name="local-6989586621679808391"><a href="#local-6989586621679808391"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679808392"><a href="#local-6989586621679808392"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#nOfThem"><span class="hs-identifier hs-var">nOfThem</span></a><span> </span><a href="#local-6989586621679808391"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679808392"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-831"></a><span>
</span><a name="line-832"></a><span class="hs-identifier">newOpenTypeKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span>
</span><a name="line-833"></a><a name="newOpenTypeKind"><a href="TcMType.html#newOpenTypeKind"><span class="hs-identifier">newOpenTypeKind</span></a></a><span>
</span><a name="line-834"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808393"><a href="#local-6989586621679808393"><span class="hs-identifier">rr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a><span> </span><a href="TysWiredIn.html#runtimeRepTy"><span class="hs-identifier hs-var">runtimeRepTy</span></a><span>
</span><a name="line-835"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TysPrim.html#tYPE"><span class="hs-identifier hs-var">tYPE</span></a><span> </span><a href="#local-6989586621679808393"><span class="hs-identifier hs-var">rr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-836"></a><span>
</span><a name="line-837"></a><span class="hs-comment">-- | Create a tyvar that can be a lifted or unlifted type.</span><span>
</span><a name="line-838"></a><span class="hs-comment">-- Returns alpha :: TYPE kappa, where both alpha and kappa are fresh</span><span>
</span><a name="line-839"></a><span class="hs-identifier">newOpenFlexiTyVarTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-840"></a><a name="newOpenFlexiTyVarTy"><a href="TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier">newOpenFlexiTyVarTy</span></a></a><span>
</span><a name="line-841"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808394"><a href="#local-6989586621679808394"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a><span>
</span><a name="line-842"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a><span> </span><a href="#local-6989586621679808394"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-843"></a><span>
</span><a name="line-844"></a><span class="hs-identifier">newMetaSigTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-845"></a><a name="newMetaSigTyVars"><a href="TcMType.html#newMetaSigTyVars"><span class="hs-identifier">newMetaSigTyVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MonadUtils.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a><span> </span><a href="TcMType.html#newMetaSigTyVarX"><span class="hs-identifier hs-var">newMetaSigTyVarX</span></a><span> </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span>
</span><a name="line-846"></a><span>
</span><a name="line-847"></a><span class="hs-identifier">newMetaTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-848"></a><span class="hs-comment">-- Instantiate with META type variables</span><span>
</span><a name="line-849"></a><span class="hs-comment">-- Note that this works for a sequence of kind, type, and coercion variables</span><span>
</span><a name="line-850"></a><span class="hs-comment">-- variables.  Eg    [ (k:*), (a:k-&gt;k) ]</span><span>
</span><a name="line-851"></a><span class="hs-comment">--             Gives [ (k7:*), (a8:k7-&gt;k7) ]</span><span>
</span><a name="line-852"></a><a name="newMetaTyVars"><a href="TcMType.html#newMetaTyVars"><span class="hs-identifier">newMetaTyVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MonadUtils.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a><span> </span><a href="TcMType.html#newMetaTyVarX"><span class="hs-identifier hs-var">newMetaTyVarX</span></a><span> </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span>
</span><a name="line-853"></a><span>    </span><span class="hs-comment">-- emptyTCvSubst has an empty in-scope set, but that's fine here</span><span>
</span><a name="line-854"></a><span>    </span><span class="hs-comment">-- Since the tyvars are freshly made, they cannot possibly be</span><span>
</span><a name="line-855"></a><span>    </span><span class="hs-comment">-- captured by any existing for-alls.</span><span>
</span><a name="line-856"></a><span>
</span><a name="line-857"></a><span class="hs-identifier">newMetaTyVarX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-858"></a><span class="hs-comment">-- Make a new unification variable tyvar whose Name and Kind come from</span><span>
</span><a name="line-859"></a><span class="hs-comment">-- an existing TyVar. We substitute kind variables in the kind.</span><span>
</span><a name="line-860"></a><a name="newMetaTyVarX"><a href="TcMType.html#newMetaTyVarX"><span class="hs-identifier">newMetaTyVarX</span></a></a><span> </span><a name="local-6989586621679808395"><a href="#local-6989586621679808395"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679808396"><a href="#local-6989586621679808396"><span class="hs-identifier">tyvar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#new_meta_tv_x"><span class="hs-identifier hs-var">new_meta_tv_x</span></a><span> </span><a href="TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a><span> </span><a href="#local-6989586621679808395"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679808396"><span class="hs-identifier hs-var">tyvar</span></a><span>
</span><a name="line-861"></a><span>
</span><a name="line-862"></a><span class="hs-identifier">newMetaTyVarsX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-863"></a><span class="hs-comment">-- Just like newMetaTyVars, but start with an existing substitution.</span><span>
</span><a name="line-864"></a><a name="newMetaTyVarsX"><a href="TcMType.html#newMetaTyVarsX"><span class="hs-identifier">newMetaTyVarsX</span></a></a><span> </span><a name="local-6989586621679808397"><a href="#local-6989586621679808397"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MonadUtils.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a><span> </span><a href="TcMType.html#newMetaTyVarX"><span class="hs-identifier hs-var">newMetaTyVarX</span></a><span> </span><a href="#local-6989586621679808397"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-865"></a><span>
</span><a name="line-866"></a><span class="hs-identifier">newMetaSigTyVarX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-867"></a><span class="hs-comment">-- Just like newMetaTyVarX, but make a SigTv</span><span>
</span><a name="line-868"></a><a name="newMetaSigTyVarX"><a href="TcMType.html#newMetaSigTyVarX"><span class="hs-identifier">newMetaSigTyVarX</span></a></a><span> </span><a name="local-6989586621679808398"><a href="#local-6989586621679808398"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679808399"><a href="#local-6989586621679808399"><span class="hs-identifier">tyvar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#new_meta_tv_x"><span class="hs-identifier hs-var">new_meta_tv_x</span></a><span> </span><a href="TcType.html#SigTv"><span class="hs-identifier hs-var">SigTv</span></a><span> </span><a href="#local-6989586621679808398"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679808399"><span class="hs-identifier hs-var">tyvar</span></a><span>
</span><a name="line-869"></a><span>
</span><a name="line-870"></a><span class="hs-identifier">newWildCardX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-871"></a><a name="newWildCardX"><a href="TcMType.html#newWildCardX"><span class="hs-identifier">newWildCardX</span></a></a><span> </span><a name="local-6989586621679808400"><a href="#local-6989586621679808400"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679808401"><a href="#local-6989586621679808401"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-872"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808402"><a href="#local-6989586621679808402"><span class="hs-identifier">new_tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#newAnonMetaTyVar"><span class="hs-identifier hs-var">newAnonMetaTyVar</span></a><span> </span><a href="TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-6989586621679808400"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679808401"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-873"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#extendTvSubstWithClone"><span class="hs-identifier hs-var">extendTvSubstWithClone</span></a><span> </span><a href="#local-6989586621679808400"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679808401"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679808402"><span class="hs-identifier hs-var">new_tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808402"><span class="hs-identifier hs-var">new_tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-874"></a><span>
</span><a name="line-875"></a><span class="hs-identifier">new_meta_tv_x</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-876"></a><a name="new_meta_tv_x"><a href="TcMType.html#new_meta_tv_x"><span class="hs-identifier">new_meta_tv_x</span></a></a><span> </span><a name="local-6989586621679808403"><a href="#local-6989586621679808403"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621679808404"><a href="#local-6989586621679808404"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621679808405"><a href="#local-6989586621679808405"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-877"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808407"><a href="#local-6989586621679808407"><span class="hs-identifier">new_tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#cloneAnonMetaTyVar"><span class="hs-identifier hs-var">cloneAnonMetaTyVar</span></a><span> </span><a href="#local-6989586621679808403"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621679808405"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679808406"><span class="hs-identifier hs-var">substd_kind</span></a><span>
</span><a name="line-878"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808408"><a href="#local-6989586621679808408"><span class="hs-identifier">subst1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#extendTvSubstWithClone"><span class="hs-identifier hs-var">extendTvSubstWithClone</span></a><span> </span><a href="#local-6989586621679808404"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679808405"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679808407"><span class="hs-identifier hs-var">new_tv</span></a><span>
</span><a name="line-879"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808408"><span class="hs-identifier hs-var">subst1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808407"><span class="hs-identifier hs-var">new_tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-880"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-881"></a><span>    </span><a name="local-6989586621679808406"><a href="#local-6989586621679808406"><span class="hs-identifier">substd_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a><span> </span><a href="#local-6989586621679808404"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679808405"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-882"></a><span>      </span><span class="hs-comment">-- NOTE: Trac #12549 is fixed so we could use</span><span>
</span><a name="line-883"></a><span>      </span><span class="hs-comment">-- substTy here, but the tc_infer_args problem</span><span>
</span><a name="line-884"></a><span>      </span><span class="hs-comment">-- is not yet fixed so leaving as unchecked for now.</span><span>
</span><a name="line-885"></a><span>      </span><span class="hs-comment">-- OLD NOTE:</span><span>
</span><a name="line-886"></a><span>      </span><span class="hs-comment">-- Unchecked because we call newMetaTyVarX from</span><span>
</span><a name="line-887"></a><span>      </span><span class="hs-comment">-- tcInstBinder, which is called from tc_infer_args</span><span>
</span><a name="line-888"></a><span>      </span><span class="hs-comment">-- which does not yet take enough trouble to ensure</span><span>
</span><a name="line-889"></a><span>      </span><span class="hs-comment">-- the in-scope set is right; e.g. Trac #12785 trips</span><span>
</span><a name="line-890"></a><span>      </span><span class="hs-comment">-- if we use substTy here</span><span>
</span><a name="line-891"></a><span>
</span><a name="line-892"></a><span class="hs-identifier">newMetaTyVarTyAtLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-893"></a><a name="newMetaTyVarTyAtLevel"><a href="TcMType.html#newMetaTyVarTyAtLevel"><span class="hs-identifier">newMetaTyVarTyAtLevel</span></a></a><span> </span><a name="local-6989586621679808409"><a href="#local-6989586621679808409"><span class="hs-identifier">tc_lvl</span></a></a><span> </span><a name="local-6989586621679808410"><a href="#local-6989586621679808410"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-894"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808411"><a href="#local-6989586621679808411"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-895"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808412"><a href="#local-6989586621679808412"><span class="hs-identifier">ref</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a><span> </span><a href="TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a><span>
</span><a name="line-896"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808413"><a href="#local-6989586621679808413"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#mkMetaTyVarName"><span class="hs-identifier hs-var">mkMetaTyVarName</span></a><span> </span><a href="#local-6989586621679808411"><span class="hs-identifier hs-var">uniq</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;p&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-897"></a><span>              </span><a name="local-6989586621679808414"><a href="#local-6989586621679808414"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_info</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a><span>
</span><a name="line-898"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mtv_ref</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808412"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-899"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mtv_tclvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808409"><span class="hs-identifier hs-var">tc_lvl</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-900"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><a href="#local-6989586621679808413"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679808410"><span class="hs-identifier hs-var">kind</span></a><span> </span><a href="#local-6989586621679808414"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-901"></a><span>
</span><a name="line-902"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Quantification
*                                                                      *
************************************************************************

Note [quantifyTyVars]
~~~~~~~~~~~~~~~~~~~~~
quantifyTyVars is given the free vars of a type that we
are about to wrap in a forall.

It takes these free type/kind variables (partitioned into dependent and
non-dependent variables) and
  1. Zonks them and remove globals and covars
  2. Extends kvs1 with free kind vars in the kinds of tvs (removing globals)
  3. Calls zonkQuantifiedTyVar on each

Step (2) is often unimportant, because the kind variable is often
also free in the type.  Eg
     Typeable k (a::k)
has free vars {k,a}.  But the type (see Trac #7916)
    (f::k-&gt;*) (a::k)
has free vars {f,a}, but we must add 'k' as well! Hence step (3).

* This function distinguishes between dependent and non-dependent
  variables only to keep correct defaulting behavior with -XNoPolyKinds.
  With -XPolyKinds, it treats both classes of variables identically.

* quantifyTyVars never quantifies over
    - a coercion variable
    - a runtime-rep variable

Note [quantifyTyVars determinism]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The results of quantifyTyVars are wrapped in a forall and can end up in the
interface file. One such example is inferred type signatures. They also affect
the results of optimizations, for example worker-wrapper. This means that to
get deterministic builds quantifyTyVars needs to be deterministic.

To achieve this CandidatesQTvs is backed by deterministic sets which allows them
to be later converted to a list in a deterministic order.

For more information about deterministic sets see
Note [Deterministic UniqFM] in UniqDFM.
-}</span><span>
</span><a name="line-947"></a><span>
</span><a name="line-948"></a><span class="hs-identifier">quantifyTyVars</span><span>
</span><a name="line-949"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyCoVarSet"><span class="hs-identifier hs-type">TcTyCoVarSet</span></a><span>     </span><span class="hs-comment">-- Global tvs; already zonked</span><span>
</span><a name="line-950"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a><span>   </span><span class="hs-comment">-- See Note [Dependent type variables] in TcType</span><span>
</span><a name="line-951"></a><span>                      </span><span class="hs-comment">-- Already zonked</span><span>
</span><a name="line-952"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-953"></a><span class="hs-comment">-- See Note [quantifyTyVars]</span><span>
</span><a name="line-954"></a><span class="hs-comment">-- Can be given a mixture of TcTyVars and TyVars, in the case of</span><span>
</span><a name="line-955"></a><span class="hs-comment">--   associated type declarations. Also accepts covars, but *never* returns any.</span><span>
</span><a name="line-956"></a><span>
</span><a name="line-957"></a><a name="quantifyTyVars"><a href="TcMType.html#quantifyTyVars"><span class="hs-identifier">quantifyTyVars</span></a></a><span> </span><a name="local-6989586621679808415"><a href="#local-6989586621679808415"><span class="hs-identifier">gbl_tvs</span></a></a><span> </span><a name="local-6989586621679808416"><a href="#local-6989586621679808416"><span class="hs-identifier">dvs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcType.html#DV"><span class="hs-identifier hs-var">DV</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">dv_kvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808417"><a href="#local-6989586621679808417"><span class="hs-identifier">dep_tkvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dv_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808418"><a href="#local-6989586621679808418"><span class="hs-identifier">nondep_tkvs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-958"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;quantifyTyVars&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808416"><span class="hs-identifier hs-var">dvs</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808415"><span class="hs-identifier hs-var">gbl_tvs</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-959"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808424"><a href="#local-6989586621679808424"><span class="hs-identifier">dep_kvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#dVarSetElemsWellScoped"><span class="hs-identifier hs-var">dVarSetElemsWellScoped</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-960"></a><span>                       </span><a href="#local-6989586621679808417"><span class="hs-identifier hs-var">dep_tkvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#dVarSetMinusVarSet"><span class="hs-identifier hs-var">dVarSetMinusVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679808415"><span class="hs-identifier hs-var">gbl_tvs</span></a><span>
</span><a name="line-961"></a><span>                       </span><span class="hs-comment">-- dVarSetElemsWellScoped: put the kind variables into</span><span>
</span><a name="line-962"></a><span>                       </span><span class="hs-comment">--    well-scoped order.</span><span>
</span><a name="line-963"></a><span>                       </span><span class="hs-comment">--    E.g.  [k, (a::k)] not the other way roud</span><span>
</span><a name="line-964"></a><span>
</span><a name="line-965"></a><span>             </span><a name="local-6989586621679808425"><a href="#local-6989586621679808425"><span class="hs-identifier">nondep_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#dVarSetElems"><span class="hs-identifier hs-var">dVarSetElems</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-966"></a><span>                          </span><span class="hs-special">(</span><a href="#local-6989586621679808418"><span class="hs-identifier hs-var">nondep_tkvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#minusDVarSet"><span class="hs-identifier hs-var">minusDVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679808417"><span class="hs-identifier hs-var">dep_tkvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-967"></a><span>                           </span><span class="hs-special">`</span><a href="VarSet.html#dVarSetMinusVarSet"><span class="hs-identifier hs-var">dVarSetMinusVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679808415"><span class="hs-identifier hs-var">gbl_tvs</span></a><span>
</span><a name="line-968"></a><span>                 </span><span class="hs-comment">-- See Note [Dependent type variables] in TcType</span><span>
</span><a name="line-969"></a><span>                 </span><span class="hs-comment">-- The `minus` dep_tkvs removes any kind-level vars</span><span>
</span><a name="line-970"></a><span>                 </span><span class="hs-comment">--    e.g. T k (a::k)   Since k appear in a kind it'll</span><span>
</span><a name="line-971"></a><span>                 </span><span class="hs-comment">--    be in dv_kvs, and is dependent. So remove it from</span><span>
</span><a name="line-972"></a><span>                 </span><span class="hs-comment">--    dv_tvs which will also contain k</span><span>
</span><a name="line-973"></a><span>                 </span><span class="hs-comment">-- No worry about dependent covars here;</span><span>
</span><a name="line-974"></a><span>                 </span><span class="hs-comment">--    they are all in dep_tkvs</span><span>
</span><a name="line-975"></a><span>                 </span><span class="hs-comment">-- No worry about scoping, because these are all</span><span>
</span><a name="line-976"></a><span>                 </span><span class="hs-comment">--    type variables</span><span>
</span><a name="line-977"></a><span>                 </span><span class="hs-comment">-- NB kinds of tvs are zonked by zonkTyCoVarsAndFV</span><span>
</span><a name="line-978"></a><span>
</span><a name="line-979"></a><span>             </span><span class="hs-comment">-- In the non-PolyKinds case, default the kind variables</span><span>
</span><a name="line-980"></a><span>             </span><span class="hs-comment">-- to *, and zonk the tyvars as usual.  Notice that this</span><span>
</span><a name="line-981"></a><span>             </span><span class="hs-comment">-- may make quantifyTyVars return a shorter list</span><span>
</span><a name="line-982"></a><span>             </span><span class="hs-comment">-- than it was passed, but that's ok</span><span>
</span><a name="line-983"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808426"><a href="#local-6989586621679808426"><span class="hs-identifier">poly_kinds</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-th-8.5/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#PolyKinds"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">PolyKinds</span></a><span>
</span><a name="line-984"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808427"><a href="#local-6989586621679808427"><span class="hs-identifier">dep_kvs'</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MonadUtils.html#mapMaybeM"><span class="hs-identifier hs-var">mapMaybeM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808419"><span class="hs-identifier hs-var">zonk_quant</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679808426"><span class="hs-identifier hs-var">poly_kinds</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808424"><span class="hs-identifier hs-var">dep_kvs</span></a><span>
</span><a name="line-985"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808428"><a href="#local-6989586621679808428"><span class="hs-identifier">nondep_tvs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MonadUtils.html#mapMaybeM"><span class="hs-identifier hs-var">mapMaybeM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808419"><span class="hs-identifier hs-var">zonk_quant</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>            </span><a href="#local-6989586621679808425"><span class="hs-identifier hs-var">nondep_tvs</span></a><span>
</span><a name="line-986"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808429"><a href="#local-6989586621679808429"><span class="hs-identifier">final_qtvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808427"><span class="hs-identifier hs-var">dep_kvs'</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679808428"><span class="hs-identifier hs-var">nondep_tvs'</span></a><span>
</span><a name="line-987"></a><span>           </span><span class="hs-comment">-- Because of the order, any kind variables</span><span>
</span><a name="line-988"></a><span>           </span><span class="hs-comment">-- mentioned in the kinds of the nondep_tvs'</span><span>
</span><a name="line-989"></a><span>           </span><span class="hs-comment">-- now refer to the dep_kvs'</span><span>
</span><a name="line-990"></a><span>
</span><a name="line-991"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;quantifyTyVars&quot;</span><span>
</span><a name="line-992"></a><span>           </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;globals:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808415"><span class="hs-identifier hs-var">gbl_tvs</span></a><span>
</span><a name="line-993"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;nondep:&quot;</span><span>  </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a><span> </span><a href="#local-6989586621679808425"><span class="hs-identifier hs-var">nondep_tvs</span></a><span>
</span><a name="line-994"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;dep:&quot;</span><span>     </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a><span> </span><a href="#local-6989586621679808424"><span class="hs-identifier hs-var">dep_kvs</span></a><span>
</span><a name="line-995"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;dep_kvs'&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a><span> </span><a href="#local-6989586621679808427"><span class="hs-identifier hs-var">dep_kvs'</span></a><span>
</span><a name="line-996"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;nondep_tvs'&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a><span> </span><a href="#local-6989586621679808428"><span class="hs-identifier hs-var">nondep_tvs'</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-997"></a><span>
</span><a name="line-998"></a><span>       </span><span class="hs-comment">-- We should never quantify over coercion variables; check this</span><span>
</span><a name="line-999"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808430"><a href="#local-6989586621679808430"><span class="hs-identifier">co_vars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a><span> </span><a href="#local-6989586621679808429"><span class="hs-identifier hs-var">final_qtvs</span></a><span>
</span><a name="line-1000"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">MASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">co_vars</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">co_vars</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1001"></a><span>
</span><a name="line-1002"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679808429"><span class="hs-identifier hs-var">final_qtvs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1003"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1004"></a><span>    </span><span class="hs-comment">-- zonk_quant returns a tyvar if it should be quantified over;</span><span>
</span><a name="line-1005"></a><span>    </span><span class="hs-comment">-- otherwise, it returns Nothing. The latter case happens for</span><span>
</span><a name="line-1006"></a><span>    </span><span class="hs-comment">--    * Kind variables, with -XNoPolyKinds: don't quantify over these</span><span>
</span><a name="line-1007"></a><span>    </span><span class="hs-comment">--    * RuntimeRep variables: we never quantify over these</span><span>
</span><a name="line-1008"></a><span>    </span><a name="local-6989586621679808419"><a href="#local-6989586621679808419"><span class="hs-identifier">zonk_quant</span></a></a><span> </span><a name="local-6989586621679808420"><a href="#local-6989586621679808420"><span class="hs-identifier">default_kind</span></a></a><span> </span><a name="local-6989586621679808421"><a href="#local-6989586621679808421"><span class="hs-identifier">tkv</span></a></a><span>
</span><a name="line-1009"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a><span> </span><a href="#local-6989586621679808421"><span class="hs-identifier hs-var">tkv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1010"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679808421"><span class="hs-identifier hs-var">tkv</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- For associated types, we have the class variables</span><span>
</span><a name="line-1011"></a><span>                           </span><span class="hs-comment">-- in scope, and they are TyVars not TcTyVars</span><span>
</span><a name="line-1012"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1013"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808422"><a href="#local-6989586621679808422"><span class="hs-identifier">deflt_done</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#defaultTyVar"><span class="hs-identifier hs-var">defaultTyVar</span></a><span> </span><a href="#local-6989586621679808420"><span class="hs-identifier hs-var">default_kind</span></a><span> </span><a href="#local-6989586621679808421"><span class="hs-identifier hs-var">tkv</span></a><span>
</span><a name="line-1014"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679808422"><span class="hs-identifier hs-var">deflt_done</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1015"></a><span>               </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1016"></a><span>               </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808423"><a href="#local-6989586621679808423"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkQuantifiedTyVar"><span class="hs-identifier hs-var">zonkQuantifiedTyVar</span></a><span> </span><a href="#local-6989586621679808421"><span class="hs-identifier hs-var">tkv</span></a><span>
</span><a name="line-1017"></a><span>                           </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679808423"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1018"></a><span>
</span><a name="line-1019"></a><span class="hs-identifier">zonkQuantifiedTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>
</span><a name="line-1020"></a><span class="hs-comment">-- The quantified type variables often include meta type variables</span><span>
</span><a name="line-1021"></a><span class="hs-comment">-- we want to freeze them into ordinary type variables</span><span>
</span><a name="line-1022"></a><span class="hs-comment">-- The meta tyvar is updated to point to the new skolem TyVar.  Now any</span><span>
</span><a name="line-1023"></a><span class="hs-comment">-- bound occurrences of the original type variable will get zonked to</span><span>
</span><a name="line-1024"></a><span class="hs-comment">-- the immutable version.</span><span>
</span><a name="line-1025"></a><span class="hs-comment">--</span><span>
</span><a name="line-1026"></a><span class="hs-comment">-- We leave skolem TyVars alone; they are immutable.</span><span>
</span><a name="line-1027"></a><span class="hs-comment">--</span><span>
</span><a name="line-1028"></a><span class="hs-comment">-- This function is called on both kind and type variables,</span><span>
</span><a name="line-1029"></a><span class="hs-comment">-- but kind variables *only* if PolyKinds is on.</span><span>
</span><a name="line-1030"></a><span>
</span><a name="line-1031"></a><a name="zonkQuantifiedTyVar"><a href="TcMType.html#zonkQuantifiedTyVar"><span class="hs-identifier">zonkQuantifiedTyVar</span></a></a><span> </span><a name="local-6989586621679808431"><a href="#local-6989586621679808431"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1032"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679808431"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1033"></a><span>      </span><a href="TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808432"><a href="#local-6989586621679808432"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679808431"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1034"></a><span>                        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#setTyVarKind"><span class="hs-identifier hs-var">setTyVarKind</span></a><span> </span><a href="#local-6989586621679808431"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679808432"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1035"></a><span>        </span><span class="hs-comment">-- It might be a skolem type variable,</span><span>
</span><a name="line-1036"></a><span>        </span><span class="hs-comment">-- for example from a user type signature</span><span>
</span><a name="line-1037"></a><span>
</span><a name="line-1038"></a><span>      </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcMType.html#skolemiseUnboundMetaTyVar"><span class="hs-identifier hs-var">skolemiseUnboundMetaTyVar</span></a><span> </span><a href="#local-6989586621679808431"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1039"></a><span>
</span><a name="line-1040"></a><span>      </span><a name="local-6989586621679808433"><a href="#local-6989586621679808433"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;zonkQuantifiedTyVar&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808431"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- RuntimeUnk</span><span>
</span><a name="line-1041"></a><span>
</span><a name="line-1042"></a><span class="hs-identifier">defaultTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>      </span><span class="hs-comment">-- True &lt;=&gt; please default this kind variable to *</span><span>
</span><a name="line-1043"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>   </span><span class="hs-comment">-- If it's a MetaTyVar then it is unbound</span><span>
</span><a name="line-1044"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>  </span><span class="hs-comment">-- True &lt;=&gt; defaulted away altogether</span><span>
</span><a name="line-1045"></a><span>
</span><a name="line-1046"></a><a name="defaultTyVar"><a href="TcMType.html#defaultTyVar"><span class="hs-identifier">defaultTyVar</span></a></a><span> </span><a name="local-6989586621679808434"><a href="#local-6989586621679808434"><span class="hs-identifier">default_kind</span></a></a><span> </span><a name="local-6989586621679808435"><a href="#local-6989586621679808435"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1047"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a><span> </span><a href="#local-6989586621679808435"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1048"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1049"></a><span>
</span><a name="line-1050"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcType.html#isSigTyVar"><span class="hs-identifier hs-var">isSigTyVar</span></a><span> </span><a href="#local-6989586621679808435"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1051"></a><span>    </span><span class="hs-comment">-- Do not default SigTvs. Doing so would violate the invariants</span><span>
</span><a name="line-1052"></a><span>    </span><span class="hs-comment">-- on SigTvs; see Note [Signature skolems] in TcType.</span><span>
</span><a name="line-1053"></a><span>    </span><span class="hs-comment">-- Trac #13343 is an example; #14555 is another</span><span>
</span><a name="line-1054"></a><span>    </span><span class="hs-comment">-- See Note [Kind generalisation and SigTvs]</span><span>
</span><a name="line-1055"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1056"></a><span>
</span><a name="line-1057"></a><span>
</span><a name="line-1058"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isRuntimeRepVar"><span class="hs-identifier hs-var">isRuntimeRepVar</span></a><span> </span><a href="#local-6989586621679808435"><span class="hs-identifier hs-var">tv</span></a><span>  </span><span class="hs-comment">-- Do not quantify over a RuntimeRep var</span><span>
</span><a name="line-1059"></a><span>                        </span><span class="hs-comment">-- unless it is a SigTv, handled earlier</span><span>
</span><a name="line-1060"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Defaulting a RuntimeRep var to LiftedRep&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808435"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1061"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#writeMetaTyVar"><span class="hs-identifier hs-var">writeMetaTyVar</span></a><span> </span><a href="#local-6989586621679808435"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="TysWiredIn.html#liftedRepTy"><span class="hs-identifier hs-var">liftedRepTy</span></a><span>
</span><a name="line-1062"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1063"></a><span>
</span><a name="line-1064"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679808434"><span class="hs-identifier hs-var">default_kind</span></a><span>                 </span><span class="hs-comment">-- -XNoPolyKinds and this is a kind var</span><span>
</span><a name="line-1065"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="#local-6989586621679808436"><span class="hs-identifier hs-var">default_kind_var</span></a><span> </span><a href="#local-6989586621679808435"><span class="hs-identifier hs-var">tv</span></a><span>     </span><span class="hs-comment">-- so default it to * if possible</span><span>
</span><a name="line-1066"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1067"></a><span>
</span><a name="line-1068"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1069"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1070"></a><span>
</span><a name="line-1071"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1072"></a><span>    </span><span class="hs-identifier">default_kind_var</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1073"></a><span>       </span><span class="hs-comment">-- defaultKindVar is used exclusively with -XNoPolyKinds</span><span>
</span><a name="line-1074"></a><span>       </span><span class="hs-comment">-- See Note [Defaulting with -XNoPolyKinds]</span><span>
</span><a name="line-1075"></a><span>       </span><span class="hs-comment">-- It takes an (unconstrained) meta tyvar and defaults it.</span><span>
</span><a name="line-1076"></a><span>       </span><span class="hs-comment">-- Works only on vars of type *; for other kinds, it issues an error.</span><span>
</span><a name="line-1077"></a><span>    </span><a name="local-6989586621679808436"><a href="#local-6989586621679808436"><span class="hs-identifier">default_kind_var</span></a></a><span> </span><a name="local-6989586621679808437"><a href="#local-6989586621679808437"><span class="hs-identifier">kv</span></a></a><span>
</span><a name="line-1078"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="Kind.html#isStarKind"><span class="hs-identifier hs-var">isStarKind</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679808437"><span class="hs-identifier hs-var">kv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1079"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Defaulting a kind var to *&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808437"><span class="hs-identifier hs-var">kv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1080"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#writeMetaTyVar"><span class="hs-identifier hs-var">writeMetaTyVar</span></a><span> </span><a href="#local-6989586621679808437"><span class="hs-identifier hs-var">kv</span></a><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1081"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1082"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Cannot default kind variable&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808438"><span class="hs-identifier hs-var">kv'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1083"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;of kind:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679808438"><span class="hs-identifier hs-var">kv'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1084"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Perhaps enable PolyKinds or add a kind signature&quot;</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1085"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1086"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679808438"><a href="#local-6989586621679808438"><span class="hs-identifier">kv'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyOpenTyCoVar"><span class="hs-identifier hs-var">tidyOpenTyCoVar</span></a><span> </span><a href="VarEnv.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a><span> </span><a href="#local-6989586621679808437"><span class="hs-identifier hs-var">kv</span></a><span>
</span><a name="line-1087"></a><span>
</span><a name="line-1088"></a><span class="hs-identifier">skolemiseRuntimeUnk</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>
</span><a name="line-1089"></a><a name="skolemiseRuntimeUnk"><a href="TcMType.html#skolemiseRuntimeUnk"><span class="hs-identifier">skolemiseRuntimeUnk</span></a></a><span> </span><a name="local-6989586621679808439"><a href="#local-6989586621679808439"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1090"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#skolemise_tv"><span class="hs-identifier hs-var">skolemise_tv</span></a><span> </span><a href="#local-6989586621679808439"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="TcType.html#RuntimeUnk"><span class="hs-identifier hs-var">RuntimeUnk</span></a><span>
</span><a name="line-1091"></a><span>
</span><a name="line-1092"></a><span class="hs-identifier">skolemiseUnboundMetaTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>
</span><a name="line-1093"></a><a name="skolemiseUnboundMetaTyVar"><a href="TcMType.html#skolemiseUnboundMetaTyVar"><span class="hs-identifier">skolemiseUnboundMetaTyVar</span></a></a><span> </span><a name="local-6989586621679808440"><a href="#local-6989586621679808440"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1094"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#skolemise_tv"><span class="hs-identifier hs-var">skolemise_tv</span></a><span> </span><a href="#local-6989586621679808440"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#metaTyVarTcLevel"><span class="hs-identifier hs-var">metaTyVarTcLevel</span></a><span> </span><a href="#local-6989586621679808440"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1095"></a><span>
</span><a name="line-1096"></a><span class="hs-identifier">skolemise_tv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyVarDetails"><span class="hs-identifier hs-type">TcTyVarDetails</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>
</span><a name="line-1097"></a><span class="hs-comment">-- We have a Meta tyvar with a ref-cell inside it</span><span>
</span><a name="line-1098"></a><span class="hs-comment">-- Skolemise it, so that</span><span>
</span><a name="line-1099"></a><span class="hs-comment">--   we are totally out of Meta-tyvar-land</span><span>
</span><a name="line-1100"></a><span class="hs-comment">-- We create a skolem TyVar, not a regular TyVar</span><span>
</span><a name="line-1101"></a><span class="hs-comment">--   See Note [Zonking to Skolem]</span><span>
</span><a name="line-1102"></a><a name="skolemise_tv"><a href="TcMType.html#skolemise_tv"><span class="hs-identifier">skolemise_tv</span></a></a><span> </span><a name="local-6989586621679808441"><a href="#local-6989586621679808441"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679808442"><a href="#local-6989586621679808442"><span class="hs-identifier">details</span></a></a><span>
</span><a name="line-1103"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isMetaTyVar</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">,</span><span> </span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1104"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808443"><span class="hs-identifier hs-var">check_empty</span></a><span> </span><a href="#local-6989586621679808441"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1105"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808447"><a href="#local-6989586621679808447"><span class="hs-identifier">span</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span>    </span><span class="hs-comment">-- Get the location from &quot;here&quot;</span><span>
</span><a name="line-1106"></a><span>                                 </span><span class="hs-comment">-- ie where we are generalising</span><span>
</span><a name="line-1107"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808448"><a href="#local-6989586621679808448"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679808441"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1108"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808449"><a href="#local-6989586621679808449"><span class="hs-identifier">uniq</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621679808441"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1109"></a><span>                </span><span class="hs-comment">-- NB: Use same Unique as original tyvar. This is</span><span>
</span><a name="line-1110"></a><span>                </span><span class="hs-comment">-- important for TcHsType.splitTelescopeTvs to work properly</span><span>
</span><a name="line-1111"></a><span>
</span><a name="line-1112"></a><span>              </span><a name="local-6989586621679808450"><a href="#local-6989586621679808450"><span class="hs-identifier">tv_name</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-6989586621679808441"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1113"></a><span>              </span><a name="local-6989586621679808451"><a href="#local-6989586621679808451"><span class="hs-identifier">final_name</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a><span> </span><a href="#local-6989586621679808449"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-6989586621679808450"><span class="hs-identifier hs-var">tv_name</span></a><span> </span><a href="#local-6989586621679808447"><span class="hs-identifier hs-var">span</span></a><span>
</span><a name="line-1114"></a><span>              </span><a name="local-6989586621679808452"><a href="#local-6989586621679808452"><span class="hs-identifier">final_tv</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a><span> </span><a href="#local-6989586621679808451"><span class="hs-identifier hs-var">final_name</span></a><span> </span><a href="#local-6989586621679808448"><span class="hs-identifier hs-var">kind</span></a><span> </span><a href="#local-6989586621679808442"><span class="hs-identifier hs-var">details</span></a><span>
</span><a name="line-1115"></a><span>
</span><a name="line-1116"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Skolemising&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808441"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;:=&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808452"><span class="hs-identifier hs-var">final_tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1117"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#writeMetaTyVar"><span class="hs-identifier hs-var">writeMetaTyVar</span></a><span> </span><a href="#local-6989586621679808441"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-6989586621679808452"><span class="hs-identifier hs-var">final_tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1118"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679808452"><span class="hs-identifier hs-var">final_tv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1119"></a><span>
</span><a name="line-1120"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1121"></a><span>    </span><a name="local-6989586621679808443"><a href="#local-6989586621679808443"><span class="hs-identifier">check_empty</span></a></a><span> </span><a name="local-6989586621679808444"><a href="#local-6989586621679808444"><span class="hs-identifier">tv</span></a></a><span>       </span><span class="hs-comment">-- [Sept 04] Check for non-empty.</span><span>
</span><a name="line-1122"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>  </span><span class="hs-comment">-- See note [Silly Type Synonym]</span><span>
</span><a name="line-1123"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808445"><a href="#local-6989586621679808445"><span class="hs-identifier">cts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#readMetaTyVar"><span class="hs-identifier hs-var">readMetaTyVar</span></a><span> </span><a href="#local-6989586621679808444"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1124"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679808445"><span class="hs-identifier hs-var">cts</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1125"></a><span>               </span><a href="TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1126"></a><span>               </span><a href="TcType.html#Indirect"><span class="hs-identifier hs-var">Indirect</span></a><span> </span><a name="local-6989586621679808446"><a href="#local-6989586621679808446"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">WARN</span><span class="hs-special">(</span><span> </span><a href="Outputable.html#warnPprTrace"><span class="hs-identifier hs-var">True</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier hs-var">tv</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1127"></a><span>                              </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1128"></a><span>
</span><a name="line-1129"></a><span class="hs-comment">{- Note [Defaulting with -XNoPolyKinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider

  data Compose f g a = Mk (f (g a))

We infer

  Compose :: forall k1 k2. (k2 -&gt; *) -&gt; (k1 -&gt; k2) -&gt; k1 -&gt; *
  Mk :: forall k1 k2 (f :: k2 -&gt; *) (g :: k1 -&gt; k2) (a :: k1).
        f (g a) -&gt; Compose k1 k2 f g a

Now, in another module, we have -XNoPolyKinds -XDataKinds in effect.
What does 'Mk mean? Pre GHC-8.0 with -XNoPolyKinds,
we just defaulted all kind variables to *. But that's no good here,
because the kind variables in 'Mk aren't of kind *, so defaulting to *
is ill-kinded.

After some debate on #11334, we decided to issue an error in this case.
The code is in defaultKindVar.

Note [What is a meta variable?]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A &quot;meta type-variable&quot;, also know as a &quot;unification variable&quot; is a placeholder
introduced by the typechecker for an as-yet-unknown monotype.

For example, when we see a call `reverse (f xs)`, we know that we calling
    reverse :: forall a. [a] -&gt; [a]
So we know that the argument `f xs` must be a &quot;list of something&quot;. But what is
the &quot;something&quot;? We don't know until we explore the `f xs` a bit more. So we set
out what we do know at the call of `reverse` by instantiate its type with a fresh
meta tyvar, `alpha` say. So now the type of the argument `f xs`, and of the
result, is `[alpha]`. The unification variable `alpha` stands for the
as-yet-unknown type of the elements of the list.

As type inference progresses we may learn more about `alpha`. For example, suppose
`f` has the type
    f :: forall b. b -&gt; [Maybe b]
Then we instantiate `f`'s type with another fresh unification variable, say
`beta`; and equate `f`'s result type with reverse's argument type, thus
`[alpha] ~ [Maybe beta]`.

Now we can solve this equality to learn that `alpha ~ Maybe beta`, so we've
refined our knowledge about `alpha`. And so on.

If you found this Note useful, you may also want to have a look at
Section 5 of &quot;Practical type inference for higher rank types&quot; (Peyton Jones,
Vytiniotis, Weirich and Shields. J. Functional Programming. 2011).

Note [What is zonking?]
~~~~~~~~~~~~~~~~~~~~~~~
GHC relies heavily on mutability in the typechecker for efficient operation.
For this reason, throughout much of the type checking process meta type
variables (the MetaTv constructor of TcTyVarDetails) are represented by mutable
variables (known as TcRefs).

Zonking is the process of ripping out these mutable variables and replacing them
with a real Type. This involves traversing the entire type expression, but the
interesting part of replacing the mutable variables occurs in zonkTyVarOcc.

There are two ways to zonk a Type:

 * zonkTcTypeToType, which is intended to be used at the end of type-checking
   for the final zonk. It has to deal with unfilled metavars, either by filling
   it with a value like Any or failing (determined by the UnboundTyVarZonker
   used).

 * zonkTcType, which will happily ignore unfilled metavars. This is the
   appropriate function to use while in the middle of type-checking.

Note [Zonking to Skolem]
~~~~~~~~~~~~~~~~~~~~~~~~
We used to zonk quantified type variables to regular TyVars.  However, this
leads to problems.  Consider this program from the regression test suite:

  eval :: Int -&gt; String -&gt; String -&gt; String
  eval 0 root actual = evalRHS 0 root actual

  evalRHS :: Int -&gt; a
  evalRHS 0 root actual = eval 0 root actual

It leads to the deferral of an equality (wrapped in an implication constraint)

  forall a. () =&gt; ((String -&gt; String -&gt; String) ~ a)

which is propagated up to the toplevel (see TcSimplify.tcSimplifyInferCheck).
In the meantime `a' is zonked and quantified to form `evalRHS's signature.
This has the *side effect* of also zonking the `a' in the deferred equality
(which at this point is being handed around wrapped in an implication
constraint).

Finally, the equality (with the zonked `a') will be handed back to the
simplifier by TcRnDriver.tcRnSrcDecls calling TcSimplify.tcSimplifyTop.
If we zonk `a' with a regular type variable, we will have this regular type
variable now floating around in the simplifier, which in many places assumes to
only see proper TcTyVars.

We can avoid this problem by zonking with a skolem.  The skolem is rigid
(which we require for a quantified variable), but is still a TcTyVar that the
simplifier knows how to deal with.

Note [Silly Type Synonyms]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this:
        type C u a = u  -- Note 'a' unused

        foo :: (forall a. C u a -&gt; C u a) -&gt; u
        foo x = ...

        bar :: Num u =&gt; u
        bar = foo (\t -&gt; t + t)

* From the (\t -&gt; t+t) we get type  {Num d} =&gt;  d -&gt; d
  where d is fresh.

* Now unify with type of foo's arg, and we get:
        {Num (C d a)} =&gt;  C d a -&gt; C d a
  where a is fresh.

* Now abstract over the 'a', but float out the Num (C d a) constraint
  because it does not 'really' mention a.  (see exactTyVarsOfType)
  The arg to foo becomes
        \/\a -&gt; \t -&gt; t+t

* So we get a dict binding for Num (C d a), which is zonked to give
        a = ()
  [Note Sept 04: now that we are zonking quantified type variables
  on construction, the 'a' will be frozen as a regular tyvar on
  quantification, so the floated dict will still have type (C d a).
  Which renders this whole note moot; happily!]

* Then the \/\a abstraction has a zonked 'a' in it.

All very silly.   I think its harmless to ignore the problem.  We'll end up with
a \/\a in the final result but all the occurrences of a will be zonked to ()

************************************************************************
*                                                                      *
              Zonking types
*                                                                      *
************************************************************************

-}</span><span>
</span><a name="line-1272"></a><span>
</span><a name="line-1273"></a><span class="hs-comment">-- | @tcGetGlobalTyCoVars@ returns a fully-zonked set of *scoped* tyvars free in</span><span>
</span><a name="line-1274"></a><span class="hs-comment">-- the environment. To improve subsequent calls to the same function it writes</span><span>
</span><a name="line-1275"></a><span class="hs-comment">-- the zonked set back into the environment. Note that this returns all</span><span>
</span><a name="line-1276"></a><span class="hs-comment">-- variables free in anything (term-level or type-level) in scope. We thus</span><span>
</span><a name="line-1277"></a><span class="hs-comment">-- don't have to worry about clashes with things that are not in scope, because</span><span>
</span><a name="line-1278"></a><span class="hs-comment">-- if they are reachable, then they'll be returned here.</span><span>
</span><a name="line-1279"></a><span class="hs-identifier">tcGetGlobalTyCoVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcTyVarSet"><span class="hs-identifier hs-type">TcTyVarSet</span></a><span>
</span><a name="line-1280"></a><a name="tcGetGlobalTyCoVars"><a href="TcMType.html#tcGetGlobalTyCoVars"><span class="hs-identifier">tcGetGlobalTyCoVars</span></a></a><span>
</span><a name="line-1281"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-var">TcLclEnv</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">tcl_tyvars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808453"><a href="#local-6989586621679808453"><span class="hs-identifier">gtv_var</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a><span>
</span><a name="line-1282"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808454"><a href="#local-6989586621679808454"><span class="hs-identifier">gbl_tvs</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a><span> </span><a href="#local-6989586621679808453"><span class="hs-identifier hs-var">gtv_var</span></a><span>
</span><a name="line-1283"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808455"><a href="#local-6989586621679808455"><span class="hs-identifier">gbl_tvs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTyCoVarsAndFV"><span class="hs-identifier hs-var">zonkTyCoVarsAndFV</span></a><span> </span><a href="#local-6989586621679808454"><span class="hs-identifier hs-var">gbl_tvs</span></a><span>
</span><a name="line-1284"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="IOEnv.html#writeMutVar"><span class="hs-identifier hs-var">writeMutVar</span></a><span> </span><a href="#local-6989586621679808453"><span class="hs-identifier hs-var">gtv_var</span></a><span> </span><a href="#local-6989586621679808455"><span class="hs-identifier hs-var">gbl_tvs'</span></a><span>
</span><a name="line-1285"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679808455"><span class="hs-identifier hs-var">gbl_tvs'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1286"></a><span>
</span><a name="line-1287"></a><span class="hs-comment">-- | Zonk a type without using the smart constructors; the result type</span><span>
</span><a name="line-1288"></a><span class="hs-comment">-- is available for inspection within the type-checking knot.</span><span>
</span><a name="line-1289"></a><span class="hs-identifier">zonkTcTypeInKnot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-1290"></a><a name="zonkTcTypeInKnot"><a href="TcMType.html#zonkTcTypeInKnot"><span class="hs-identifier">zonkTcTypeInKnot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mapType"><span class="hs-identifier hs-var">mapType</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#zonkTcTypeMapper"><span class="hs-identifier hs-var">zonkTcTypeMapper</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcm_smart</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1291"></a><span>
</span><a name="line-1292"></a><span class="hs-identifier">zonkTcTypeAndFV</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="VarSet.html#DTyCoVarSet"><span class="hs-identifier hs-type">DTyCoVarSet</span></a><span>
</span><a name="line-1293"></a><span class="hs-comment">-- Zonk a type and take its free variables</span><span>
</span><a name="line-1294"></a><span class="hs-comment">-- With kind polymorphism it can be essential to zonk *first*</span><span>
</span><a name="line-1295"></a><span class="hs-comment">-- so that we find the right set of free variables.  Eg</span><span>
</span><a name="line-1296"></a><span class="hs-comment">--    forall k1. forall (a:k2). a</span><span>
</span><a name="line-1297"></a><span class="hs-comment">-- where k2:=k1 is in the substitution.  We don't want</span><span>
</span><a name="line-1298"></a><span class="hs-comment">-- k2 to look free in this type!</span><span>
</span><a name="line-1299"></a><span class="hs-comment">-- NB: This might be called from within the knot, so don't use</span><span>
</span><a name="line-1300"></a><span class="hs-comment">-- smart constructors. See Note [Type-checking inside the knot] in TcHsType</span><span>
</span><a name="line-1301"></a><a name="zonkTcTypeAndFV"><a href="TcMType.html#zonkTcTypeAndFV"><span class="hs-identifier">zonkTcTypeAndFV</span></a></a><span> </span><a name="local-6989586621679808456"><a href="#local-6989586621679808456"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1302"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeDSet"><span class="hs-identifier hs-var">tyCoVarsOfTypeDSet</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcMType.html#zonkTcTypeInKnot"><span class="hs-identifier hs-var">zonkTcTypeInKnot</span></a><span> </span><a href="#local-6989586621679808456"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1303"></a><span>
</span><a name="line-1304"></a><span class="hs-comment">-- | Zonk a type and call 'candidateQTyVarsOfType' on it.</span><span>
</span><a name="line-1305"></a><span class="hs-comment">-- Works within the knot.</span><span>
</span><a name="line-1306"></a><span class="hs-identifier">zonkTcTypeAndSplitDepVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a><span>
</span><a name="line-1307"></a><a name="zonkTcTypeAndSplitDepVars"><a href="TcMType.html#zonkTcTypeAndSplitDepVars"><span class="hs-identifier">zonkTcTypeAndSplitDepVars</span></a></a><span> </span><a name="local-6989586621679808457"><a href="#local-6989586621679808457"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1308"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#candidateQTyVarsOfType"><span class="hs-identifier hs-var">candidateQTyVarsOfType</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcMType.html#zonkTcTypeInKnot"><span class="hs-identifier hs-var">zonkTcTypeInKnot</span></a><span> </span><a href="#local-6989586621679808457"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1309"></a><span>
</span><a name="line-1310"></a><span class="hs-identifier">zonkTcTypesAndSplitDepVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a><span>
</span><a name="line-1311"></a><a name="zonkTcTypesAndSplitDepVars"><a href="TcMType.html#zonkTcTypesAndSplitDepVars"><span class="hs-identifier">zonkTcTypesAndSplitDepVars</span></a></a><span> </span><a name="local-6989586621679808458"><a href="#local-6989586621679808458"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1312"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#candidateQTyVarsOfTypes"><span class="hs-identifier hs-var">candidateQTyVarsOfTypes</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkTcTypeInKnot"><span class="hs-identifier hs-var">zonkTcTypeInKnot</span></a><span> </span><a href="#local-6989586621679808458"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1313"></a><span>
</span><a name="line-1314"></a><span class="hs-identifier">zonkTyCoVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-1315"></a><span class="hs-comment">-- Works on TyVars and TcTyVars</span><span>
</span><a name="line-1316"></a><a name="zonkTyCoVar"><a href="TcMType.html#zonkTyCoVar"><span class="hs-identifier">zonkTyCoVar</span></a></a><span> </span><a name="local-6989586621679808459"><a href="#local-6989586621679808459"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a><span> </span><a href="#local-6989586621679808459"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a><span> </span><a href="#local-6989586621679808459"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1317"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span>   </span><a href="#local-6989586621679808459"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcMType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">zonkTyCoVarKind</span></a><span> </span><a href="#local-6989586621679808459"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1318"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isCoVar</span><span> </span><span class="hs-identifier hs-var">tv</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><a href="Var.html#isCoVar"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1319"></a><span>                                </span><a href="Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcMType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">zonkTyCoVarKind</span></a><span> </span><a href="#local-6989586621679808459"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1320"></a><span>   </span><span class="hs-comment">-- Hackily, when typechecking type and class decls</span><span>
</span><a name="line-1321"></a><span>   </span><span class="hs-comment">-- we have TyVars in scopeadded (only) in</span><span>
</span><a name="line-1322"></a><span>   </span><span class="hs-comment">-- TcHsType.tcTyClTyVars, but it seems</span><span>
</span><a name="line-1323"></a><span>   </span><span class="hs-comment">-- painful to make them into TcTyVars there</span><span>
</span><a name="line-1324"></a><span>
</span><a name="line-1325"></a><span class="hs-identifier">zonkTyCoVarsAndFV</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span>
</span><a name="line-1326"></a><a name="zonkTyCoVarsAndFV"><a href="TcMType.html#zonkTyCoVarsAndFV"><span class="hs-identifier">zonkTyCoVarsAndFV</span></a></a><span> </span><a name="local-6989586621679808460"><a href="#local-6989586621679808460"><span class="hs-identifier">tycovars</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1327"></a><span>  </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkTyCoVar"><span class="hs-identifier hs-var">zonkTyCoVar</span></a><span> </span><span class="hs-special">(</span><a href="UniqSet.html#nonDetEltsUniqSet"><span class="hs-identifier hs-var">nonDetEltsUniqSet</span></a><span> </span><a href="#local-6989586621679808460"><span class="hs-identifier hs-var">tycovars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1328"></a><span>  </span><span class="hs-comment">-- It's OK to use nonDetEltsUniqSet here because we immediately forget about</span><span>
</span><a name="line-1329"></a><span>  </span><span class="hs-comment">-- the ordering by turning it into a nondeterministic set and the order</span><span>
</span><a name="line-1330"></a><span>  </span><span class="hs-comment">-- of zonking doesn't matter for determinism.</span><span>
</span><a name="line-1331"></a><span>
</span><a name="line-1332"></a><span class="hs-comment">-- Takes a list of TyCoVars, zonks them and returns a</span><span>
</span><a name="line-1333"></a><span class="hs-comment">-- deterministically ordered list of their free variables.</span><span>
</span><a name="line-1334"></a><span class="hs-identifier">zonkTyCoVarsAndFVList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-1335"></a><a name="zonkTyCoVarsAndFVList"><a href="TcMType.html#zonkTyCoVarsAndFVList"><span class="hs-identifier">zonkTyCoVarsAndFVList</span></a></a><span> </span><a name="local-6989586621679808461"><a href="#local-6989586621679808461"><span class="hs-identifier">tycovars</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1336"></a><span>  </span><a href="TyCoRep.html#tyCoVarsOfTypesList"><span class="hs-identifier hs-var">tyCoVarsOfTypesList</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkTyCoVar"><span class="hs-identifier hs-var">zonkTyCoVar</span></a><span> </span><a href="#local-6989586621679808461"><span class="hs-identifier hs-var">tycovars</span></a><span>
</span><a name="line-1337"></a><span>
</span><a name="line-1338"></a><span class="hs-identifier">zonkTcTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span>
</span><a name="line-1339"></a><a name="zonkTcTyVars"><a href="TcMType.html#zonkTcTyVars"><span class="hs-identifier">zonkTcTyVars</span></a></a><span> </span><a name="local-6989586621679808462"><a href="#local-6989586621679808462"><span class="hs-identifier">tyvars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a><span> </span><a href="#local-6989586621679808462"><span class="hs-identifier hs-var">tyvars</span></a><span>
</span><a name="line-1340"></a><span>
</span><a name="line-1341"></a><span class="hs-comment">-----------------  Types</span><span>
</span><a name="line-1342"></a><span class="hs-identifier">zonkTyCoVarKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span>
</span><a name="line-1343"></a><a name="zonkTyCoVarKind"><a href="TcMType.html#zonkTyCoVarKind"><span class="hs-identifier">zonkTyCoVarKind</span></a></a><span> </span><a name="local-6989586621679808463"><a href="#local-6989586621679808463"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808464"><a href="#local-6989586621679808464"><span class="hs-identifier">kind'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621679808463"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1344"></a><span>                        </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#setTyVarKind"><span class="hs-identifier hs-var">setTyVarKind</span></a><span> </span><a href="#local-6989586621679808463"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679808464"><span class="hs-identifier hs-var">kind'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1345"></a><span>
</span><a name="line-1346"></a><span class="hs-identifier">zonkTcTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">]</span><span>
</span><a name="line-1347"></a><a name="zonkTcTypes"><a href="TcMType.html#zonkTcTypes"><span class="hs-identifier">zonkTcTypes</span></a></a><span> </span><a name="local-6989586621679808465"><a href="#local-6989586621679808465"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621679808465"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1348"></a><span>
</span><a name="line-1349"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
              Zonking constraints
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1356"></a><span>
</span><a name="line-1357"></a><span class="hs-identifier">zonkImplication</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span>
</span><a name="line-1358"></a><a name="zonkImplication"><a href="TcMType.html#zonkImplication"><span class="hs-identifier">zonkImplication</span></a></a><span> </span><a name="local-6989586621679808466"><a href="#local-6989586621679808466"><span class="hs-identifier">implic</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#Implic"><span class="hs-identifier hs-var">Implic</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_skols</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808467"><a href="#local-6989586621679808467"><span class="hs-identifier">skols</span></a></a><span>
</span><a name="line-1359"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_given</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808468"><a href="#local-6989586621679808468"><span class="hs-identifier">given</span></a></a><span>
</span><a name="line-1360"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_wanted</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808469"><a href="#local-6989586621679808469"><span class="hs-identifier">wanted</span></a></a><span>
</span><a name="line-1361"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_info</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808470"><a href="#local-6989586621679808470"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1362"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808471"><a href="#local-6989586621679808471"><span class="hs-identifier">skols'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkTcTyCoVarBndr"><span class="hs-identifier hs-var">zonkTcTyCoVarBndr</span></a><span> </span><a href="#local-6989586621679808467"><span class="hs-identifier hs-var">skols</span></a><span>  </span><span class="hs-comment">-- Need to zonk their kinds!</span><span>
</span><a name="line-1363"></a><span>                                                  </span><span class="hs-comment">-- as Trac #7230 showed</span><span>
</span><a name="line-1364"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808472"><a href="#local-6989586621679808472"><span class="hs-identifier">given'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkEvVar"><span class="hs-identifier hs-var">zonkEvVar</span></a><span> </span><a href="#local-6989586621679808468"><span class="hs-identifier hs-var">given</span></a><span>
</span><a name="line-1365"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808473"><a href="#local-6989586621679808473"><span class="hs-identifier">info'</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkSkolemInfo"><span class="hs-identifier hs-var">zonkSkolemInfo</span></a><span> </span><a href="#local-6989586621679808470"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-1366"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808474"><a href="#local-6989586621679808474"><span class="hs-identifier">wanted'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkWCRec"><span class="hs-identifier hs-var">zonkWCRec</span></a><span> </span><a href="#local-6989586621679808469"><span class="hs-identifier hs-var">wanted</span></a><span>
</span><a name="line-1367"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808466"><span class="hs-identifier hs-var">implic</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_skols</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808471"><span class="hs-identifier hs-var">skols'</span></a><span>
</span><a name="line-1368"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_given</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808472"><span class="hs-identifier hs-var">given'</span></a><span>
</span><a name="line-1369"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_wanted</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808474"><span class="hs-identifier hs-var">wanted'</span></a><span>
</span><a name="line-1370"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_info</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808473"><span class="hs-identifier hs-var">info'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1371"></a><span>
</span><a name="line-1372"></a><span class="hs-identifier">zonkEvVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span>
</span><a name="line-1373"></a><a name="zonkEvVar"><a href="TcMType.html#zonkEvVar"><span class="hs-identifier">zonkEvVar</span></a></a><span> </span><a name="local-6989586621679808475"><a href="#local-6989586621679808475"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808476"><a href="#local-6989586621679808476"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679808475"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span>
</span><a name="line-1374"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#setVarType"><span class="hs-identifier hs-var">setVarType</span></a><span> </span><a href="#local-6989586621679808475"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679808476"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1375"></a><span>
</span><a name="line-1376"></a><span>
</span><a name="line-1377"></a><span class="hs-identifier">zonkWC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span>
</span><a name="line-1378"></a><a name="zonkWC"><a href="TcMType.html#zonkWC"><span class="hs-identifier">zonkWC</span></a></a><span> </span><a name="local-6989586621679808477"><a href="#local-6989586621679808477"><span class="hs-identifier">wc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#zonkWCRec"><span class="hs-identifier hs-var">zonkWCRec</span></a><span> </span><a href="#local-6989586621679808477"><span class="hs-identifier hs-var">wc</span></a><span>
</span><a name="line-1379"></a><span>
</span><a name="line-1380"></a><span class="hs-identifier">zonkWCRec</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span>
</span><a name="line-1381"></a><a name="zonkWCRec"><a href="TcMType.html#zonkWCRec"><span class="hs-identifier">zonkWCRec</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808478"><a href="#local-6989586621679808478"><span class="hs-identifier">simple</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808479"><a href="#local-6989586621679808479"><span class="hs-identifier">implic</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1382"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808480"><a href="#local-6989586621679808480"><span class="hs-identifier">simple'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkSimples"><span class="hs-identifier hs-var">zonkSimples</span></a><span> </span><a href="#local-6989586621679808478"><span class="hs-identifier hs-var">simple</span></a><span>
</span><a name="line-1383"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808481"><a href="#local-6989586621679808481"><span class="hs-identifier">implic'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Bag.html#mapBagM"><span class="hs-identifier hs-var">mapBagM</span></a><span> </span><a href="TcMType.html#zonkImplication"><span class="hs-identifier hs-var">zonkImplication</span></a><span> </span><a href="#local-6989586621679808479"><span class="hs-identifier hs-var">implic</span></a><span>
</span><a name="line-1384"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808480"><span class="hs-identifier hs-var">simple'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808481"><span class="hs-identifier hs-var">implic'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1385"></a><span>
</span><a name="line-1386"></a><span class="hs-identifier">zonkSimples</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-1387"></a><a name="zonkSimples"><a href="TcMType.html#zonkSimples"><span class="hs-identifier">zonkSimples</span></a></a><span> </span><a name="local-6989586621679808482"><a href="#local-6989586621679808482"><span class="hs-identifier">cts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808483"><a href="#local-6989586621679808483"><span class="hs-identifier">cts'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Bag.html#mapBagM"><span class="hs-identifier hs-var">mapBagM</span></a><span> </span><a href="TcMType.html#zonkCt%27"><span class="hs-identifier hs-var">zonkCt'</span></a><span> </span><a href="#local-6989586621679808482"><span class="hs-identifier hs-var">cts</span></a><span>
</span><a name="line-1388"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;zonkSimples done:&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808483"><span class="hs-identifier hs-var">cts'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1389"></a><span>                     </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679808483"><span class="hs-identifier hs-var">cts'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1390"></a><span>
</span><a name="line-1391"></a><span class="hs-identifier">zonkCt'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-1392"></a><a name="zonkCt%27"><a href="TcMType.html#zonkCt%27"><span class="hs-identifier">zonkCt'</span></a></a><span> </span><a name="local-6989586621679808484"><a href="#local-6989586621679808484"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#zonkCt"><span class="hs-identifier hs-var">zonkCt</span></a><span> </span><a href="#local-6989586621679808484"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-1393"></a><span>
</span><a name="line-1394"></a><span class="hs-comment">{- Note [zonkCt behaviour]
~~~~~~~~~~~~~~~~~~~~~~~~~~
zonkCt tries to maintain the canonical form of a Ct.  For example,
  - a CDictCan should stay a CDictCan;
  - a CTyEqCan should stay a CTyEqCan (if the LHS stays as a variable.).
  - a CHoleCan should stay a CHoleCan
  - a CIrredCan should stay a CIrredCan with its cc_insol flag intact

Why?, for example:
- For CDictCan, the @TcSimplify.expandSuperClasses@ step, which runs after the
  simple wanted and plugin loop, looks for @CDictCan@s. If a plugin is in use,
  constraints are zonked before being passed to the plugin. This means if we
  don't preserve a canonical form, @expandSuperClasses@ fails to expand
  superclasses. This is what happened in Trac #11525.

- For CHoleCan, once we forget that it's a hole, we can never recover that info.

- For CIrredCan we want to see if a constraint is insoluble with insolubleWC

NB: we do not expect to see any CFunEqCans, because zonkCt is only
called on unflattened constraints.

NB: Constraints are always re-flattened etc by the canonicaliser in
@TcCanonical@ even if they come in as CDictCan. Only canonical constraints that
are actually in the inert set carry all the guarantees. So it is okay if zonkCt
creates e.g. a CDictCan where the cc_tyars are /not/ function free.
-}</span><span>
</span><a name="line-1421"></a><span>
</span><a name="line-1422"></a><span class="hs-identifier">zonkCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-1423"></a><a name="zonkCt"><a href="TcMType.html#zonkCt"><span class="hs-identifier">zonkCt</span></a></a><span> </span><a name="local-6989586621679808485"><a href="#local-6989586621679808485"><span class="hs-identifier">ct</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CHoleCan"><span class="hs-identifier hs-var">CHoleCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808486"><a href="#local-6989586621679808486"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1424"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808487"><a href="#local-6989586621679808487"><span class="hs-identifier">ev'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkCtEvidence"><span class="hs-identifier hs-var">zonkCtEvidence</span></a><span> </span><a href="#local-6989586621679808486"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1425"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679808485"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808487"><span class="hs-identifier hs-var">ev'</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1426"></a><span>
</span><a name="line-1427"></a><span class="hs-identifier">zonkCt</span><span> </span><a name="local-6989586621679808488"><a href="#local-6989586621679808488"><span class="hs-identifier">ct</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808489"><a href="#local-6989586621679808489"><span class="hs-identifier">ev</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808490"><a href="#local-6989586621679808490"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1428"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808491"><a href="#local-6989586621679808491"><span class="hs-identifier">ev'</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkCtEvidence"><span class="hs-identifier hs-var">zonkCtEvidence</span></a><span> </span><a href="#local-6989586621679808489"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1429"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808492"><a href="#local-6989586621679808492"><span class="hs-identifier">args'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621679808490"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1430"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679808488"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808491"><span class="hs-identifier hs-var">ev'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808492"><span class="hs-identifier hs-var">args'</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1431"></a><span>
</span><a name="line-1432"></a><span class="hs-identifier">zonkCt</span><span> </span><a name="local-6989586621679808493"><a href="#local-6989586621679808493"><span class="hs-identifier">ct</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier hs-var">CTyEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808494"><a href="#local-6989586621679808494"><span class="hs-identifier">ev</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyvar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808495"><a href="#local-6989586621679808495"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808496"><a href="#local-6989586621679808496"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1433"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808497"><a href="#local-6989586621679808497"><span class="hs-identifier">ev'</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkCtEvidence"><span class="hs-identifier hs-var">zonkCtEvidence</span></a><span> </span><a href="#local-6989586621679808494"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1434"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679808498"><a href="#local-6989586621679808498"><span class="hs-identifier">tv_ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a><span> </span><a href="#local-6989586621679808495"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1435"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a><span> </span><a href="#local-6989586621679808498"><span class="hs-identifier hs-var">tv_ty'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1436"></a><span>           </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679808499"><a href="#local-6989586621679808499"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808500"><a href="#local-6989586621679808500"><span class="hs-identifier">rhs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621679808496"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1437"></a><span>                          </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679808493"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808497"><span class="hs-identifier hs-var">ev'</span></a><span>
</span><a name="line-1438"></a><span>                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyvar</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808499"><span class="hs-identifier hs-var">tv'</span></a><span>
</span><a name="line-1439"></a><span>                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_rhs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808500"><span class="hs-identifier hs-var">rhs'</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1440"></a><span>           </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a><span> </span><a href="#local-6989586621679808497"><span class="hs-identifier hs-var">ev'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1441"></a><span>
</span><a name="line-1442"></a><span class="hs-identifier">zonkCt</span><span> </span><a name="local-6989586621679808501"><a href="#local-6989586621679808501"><span class="hs-identifier">ct</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CIrredCan"><span class="hs-identifier hs-var">CIrredCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808502"><a href="#local-6989586621679808502"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Preserve the cc_insol flag</span><span>
</span><a name="line-1443"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808503"><a href="#local-6989586621679808503"><span class="hs-identifier">ev'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkCtEvidence"><span class="hs-identifier hs-var">zonkCtEvidence</span></a><span> </span><a href="#local-6989586621679808502"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1444"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808501"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808503"><span class="hs-identifier hs-var">ev'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1445"></a><span>
</span><a name="line-1446"></a><span class="hs-identifier">zonkCt</span><span> </span><a name="local-6989586621679808504"><a href="#local-6989586621679808504"><span class="hs-identifier">ct</span></a></a><span>
</span><a name="line-1447"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">isCFunEqCan</span><span> </span><span class="hs-identifier">ct</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1448"></a><span>  </span><span class="hs-comment">-- We do not expect to see any CFunEqCans, because zonkCt is only called on</span><span>
</span><a name="line-1449"></a><span>  </span><span class="hs-comment">-- unflattened constraints.</span><span>
</span><a name="line-1450"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808505"><a href="#local-6989586621679808505"><span class="hs-identifier">fl'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkCtEvidence"><span class="hs-identifier hs-var">zonkCtEvidence</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">cc_ev</span><span> </span><a href="#local-6989586621679808504"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-1451"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a><span> </span><a href="#local-6989586621679808505"><span class="hs-identifier hs-var">fl'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1452"></a><span>
</span><a name="line-1453"></a><span class="hs-identifier">zonkCtEvidence</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span>
</span><a name="line-1454"></a><a name="zonkCtEvidence"><a href="TcMType.html#zonkCtEvidence"><span class="hs-identifier">zonkCtEvidence</span></a></a><span> </span><a name="local-6989586621679808506"><a href="#local-6989586621679808506"><span class="hs-identifier">ctev</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CtGiven"><span class="hs-identifier hs-var">CtGiven</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808507"><a href="#local-6989586621679808507"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1455"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808508"><a href="#local-6989586621679808508"><span class="hs-identifier">pred'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621679808507"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-1456"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808506"><span class="hs-identifier hs-var">ctev</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808508"><span class="hs-identifier hs-var">pred'</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1457"></a><span class="hs-identifier">zonkCtEvidence</span><span> </span><a name="local-6989586621679808509"><a href="#local-6989586621679808509"><span class="hs-identifier">ctev</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808510"><a href="#local-6989586621679808510"><span class="hs-identifier">pred</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_dest</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808511"><a href="#local-6989586621679808511"><span class="hs-identifier">dest</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1458"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808512"><a href="#local-6989586621679808512"><span class="hs-identifier">pred'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621679808510"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-1459"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808513"><a href="#local-6989586621679808513"><span class="hs-identifier">dest'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679808511"><span class="hs-identifier hs-var">dest</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1460"></a><span>                       </span><a href="TcRnTypes.html#EvVarDest"><span class="hs-identifier hs-var">EvVarDest</span></a><span> </span><a name="local-6989586621679808514"><a href="#local-6989586621679808514"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#EvVarDest"><span class="hs-identifier hs-var">EvVarDest</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Var.html#setVarType"><span class="hs-identifier hs-var">setVarType</span></a><span> </span><a href="#local-6989586621679808514"><span class="hs-identifier hs-var">ev</span></a><span> </span><a href="#local-6989586621679808512"><span class="hs-identifier hs-var">pred'</span></a><span>
</span><a name="line-1461"></a><span>                         </span><span class="hs-comment">-- necessary in simplifyInfer</span><span>
</span><a name="line-1462"></a><span>                       </span><a href="TcRnTypes.html#HoleDest"><span class="hs-identifier hs-var">HoleDest</span></a><span> </span><a name="local-6989586621679808515"><a href="#local-6989586621679808515"><span class="hs-identifier">h</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#HoleDest"><span class="hs-identifier hs-var">HoleDest</span></a><span> </span><a href="#local-6989586621679808515"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-1463"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808509"><span class="hs-identifier hs-var">ctev</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808512"><span class="hs-identifier hs-var">pred'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_dest</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808513"><span class="hs-identifier hs-var">dest'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1464"></a><span class="hs-identifier">zonkCtEvidence</span><span> </span><a name="local-6989586621679808516"><a href="#local-6989586621679808516"><span class="hs-identifier">ctev</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CtDerived"><span class="hs-identifier hs-var">CtDerived</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808517"><a href="#local-6989586621679808517"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1465"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808518"><a href="#local-6989586621679808518"><span class="hs-identifier">pred'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621679808517"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-1466"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808516"><span class="hs-identifier hs-var">ctev</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808518"><span class="hs-identifier hs-var">pred'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1467"></a><span>
</span><a name="line-1468"></a><span class="hs-identifier">zonkSkolemInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span>
</span><a name="line-1469"></a><a name="zonkSkolemInfo"><a href="TcMType.html#zonkSkolemInfo"><span class="hs-identifier">zonkSkolemInfo</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#SigSkol"><span class="hs-identifier hs-var">SigSkol</span></a><span> </span><a name="local-6989586621679808519"><a href="#local-6989586621679808519"><span class="hs-identifier">cx</span></a></a><span> </span><a name="local-6989586621679808520"><a href="#local-6989586621679808520"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679808521"><a href="#local-6989586621679808521"><span class="hs-identifier">tv_prs</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808522"><a href="#local-6989586621679808522"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621679808520"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1470"></a><span>                                            </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#SigSkol"><span class="hs-identifier hs-var">SigSkol</span></a><span> </span><a href="#local-6989586621679808519"><span class="hs-identifier hs-var">cx</span></a><span> </span><a href="#local-6989586621679808522"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621679808521"><span class="hs-identifier hs-var">tv_prs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1471"></a><span class="hs-identifier">zonkSkolemInfo</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#InferSkol"><span class="hs-identifier hs-var">InferSkol</span></a><span> </span><a name="local-6989586621679808523"><a href="#local-6989586621679808523"><span class="hs-identifier">ntys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808528"><a href="#local-6989586621679808528"><span class="hs-identifier">ntys'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-6989586621679808524"><span class="hs-identifier hs-var">do_one</span></a><span> </span><a href="#local-6989586621679808523"><span class="hs-identifier hs-var">ntys</span></a><span>
</span><a name="line-1472"></a><span>                                     </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#InferSkol"><span class="hs-identifier hs-var">InferSkol</span></a><span> </span><a href="#local-6989586621679808528"><span class="hs-identifier hs-var">ntys'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1473"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1474"></a><span>    </span><a name="local-6989586621679808524"><a href="#local-6989586621679808524"><span class="hs-identifier">do_one</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679808525"><a href="#local-6989586621679808525"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808526"><a href="#local-6989586621679808526"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808527"><a href="#local-6989586621679808527"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621679808526"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808525"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808527"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1475"></a><span class="hs-identifier">zonkSkolemInfo</span><span> </span><a name="local-6989586621679808529"><a href="#local-6989586621679808529"><span class="hs-identifier">skol_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679808529"><span class="hs-identifier hs-var">skol_info</span></a><span>
</span><a name="line-1476"></a><span>
</span><a name="line-1477"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
\subsection{Zonking -- the main work-horses: zonkTcType, zonkTcTyVar}
*                                                                      *
*              For internal use only!                                  *
*                                                                      *
************************************************************************

-}</span><span>
</span><a name="line-1487"></a><span>
</span><a name="line-1488"></a><span class="hs-comment">-- zonkId is used *during* typechecking just to zonk the Id's type</span><span>
</span><a name="line-1489"></a><span class="hs-identifier">zonkId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span>
</span><a name="line-1490"></a><a name="zonkId"><a href="TcMType.html#zonkId"><span class="hs-identifier">zonkId</span></a></a><span> </span><a name="local-6989586621679808530"><a href="#local-6989586621679808530"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-1491"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808531"><a href="#local-6989586621679808531"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621679808530"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1492"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#setIdType"><span class="hs-identifier hs-var">Id</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">setIdType</span></a><span> </span><a href="#local-6989586621679808530"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621679808531"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1493"></a><span>
</span><a name="line-1494"></a><span class="hs-identifier">zonkCoVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span>
</span><a name="line-1495"></a><a name="zonkCoVar"><a href="TcMType.html#zonkCoVar"><span class="hs-identifier">zonkCoVar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#zonkId"><span class="hs-identifier hs-var">zonkId</span></a><span>
</span><a name="line-1496"></a><span>
</span><a name="line-1497"></a><span class="hs-comment">-- | A suitable TyCoMapper for zonking a type inside the knot, and</span><span>
</span><a name="line-1498"></a><span class="hs-comment">-- before all metavars are filled in.</span><span>
</span><a name="line-1499"></a><span class="hs-identifier">zonkTcTypeMapper</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Type.html#TyCoMapper"><span class="hs-identifier hs-type">TyCoMapper</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span>
</span><a name="line-1500"></a><a name="zonkTcTypeMapper"><a href="TcMType.html#zonkTcTypeMapper"><span class="hs-identifier">zonkTcTypeMapper</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#TyCoMapper"><span class="hs-identifier hs-var">TyCoMapper</span></a><span>
</span><a name="line-1501"></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcm_smart</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1502"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_tyvar</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><a href="TcMType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a><span>
</span><a name="line-1503"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_covar</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679808540"><a href="#local-6989586621679808540"><span class="hs-identifier">cv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcMType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">zonkTyCoVarKind</span></a><span> </span><a href="#local-6989586621679808540"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1504"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_hole</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808532"><span class="hs-identifier hs-var">hole</span></a><span>
</span><a name="line-1505"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_tybinder</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679808541"><a href="#local-6989586621679808541"><span class="hs-identifier">_env</span></a></a><span> </span><a name="local-6989586621679808542"><a href="#local-6989586621679808542"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679808543"><a href="#local-6989586621679808543"><span class="hs-identifier">_vis</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcMType.html#zonkTcTyCoVarBndr"><span class="hs-identifier hs-var">zonkTcTyCoVarBndr</span></a><span> </span><a href="#local-6989586621679808542"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1506"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1507"></a><span>    </span><span class="hs-identifier">hole</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1508"></a><span>    </span><a name="local-6989586621679808532"><a href="#local-6989586621679808532"><span class="hs-identifier">hole</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679808533"><a href="#local-6989586621679808533"><span class="hs-identifier">hole</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-var">CoercionHole</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ch_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808534"><a href="#local-6989586621679808534"><span class="hs-identifier">ref</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ch_co_var</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808535"><a href="#local-6989586621679808535"><span class="hs-identifier">cv</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1509"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808536"><a href="#local-6989586621679808536"><span class="hs-identifier">contents</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-6989586621679808534"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-1510"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679808536"><span class="hs-identifier hs-var">contents</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1511"></a><span>               </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679808537"><a href="#local-6989586621679808537"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808538"><a href="#local-6989586621679808538"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkCo"><span class="hs-identifier hs-var">zonkCo</span></a><span> </span><a href="#local-6989586621679808537"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1512"></a><span>                             </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#checkCoercionHole"><span class="hs-identifier hs-var">checkCoercionHole</span></a><span> </span><a href="#local-6989586621679808535"><span class="hs-identifier hs-var">cv</span></a><span> </span><a href="#local-6989586621679808538"><span class="hs-identifier hs-var">co'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1513"></a><span>               </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808539"><a href="#local-6989586621679808539"><span class="hs-identifier">cv'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkCoVar"><span class="hs-identifier hs-var">zonkCoVar</span></a><span> </span><a href="#local-6989586621679808535"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-1514"></a><span>                             </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TyCoRep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808533"><span class="hs-identifier hs-var">hole</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ch_co_var</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808539"><span class="hs-identifier hs-var">cv'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1515"></a><span>
</span><a name="line-1516"></a><span>
</span><a name="line-1517"></a><span class="hs-comment">-- For unbound, mutable tyvars, zonkType uses the function given to it</span><span>
</span><a name="line-1518"></a><span class="hs-comment">-- For tyvars bound at a for-all, zonkType zonks them to an immutable</span><span>
</span><a name="line-1519"></a><span class="hs-comment">--      type variable and zonks the kind too</span><span>
</span><a name="line-1520"></a><span class="hs-identifier">zonkTcType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-1521"></a><a name="zonkTcType"><a href="TcMType.html#zonkTcType"><span class="hs-identifier">zonkTcType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mapType"><span class="hs-identifier hs-var">mapType</span></a><span> </span><a href="TcMType.html#zonkTcTypeMapper"><span class="hs-identifier hs-var">zonkTcTypeMapper</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1522"></a><span>
</span><a name="line-1523"></a><span class="hs-comment">-- | &quot;Zonk&quot; a coercion -- really, just zonk any types in the coercion</span><span>
</span><a name="line-1524"></a><span class="hs-identifier">zonkCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1525"></a><a name="zonkCo"><a href="TcMType.html#zonkCo"><span class="hs-identifier">zonkCo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mapCoercion"><span class="hs-identifier hs-var">mapCoercion</span></a><span> </span><a href="TcMType.html#zonkTcTypeMapper"><span class="hs-identifier hs-var">zonkTcTypeMapper</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1526"></a><span>
</span><a name="line-1527"></a><span class="hs-identifier">zonkTcTyCoVarBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyCoVar"><span class="hs-identifier hs-type">TcTyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcTyCoVar"><span class="hs-identifier hs-type">TcTyCoVar</span></a><span>
</span><a name="line-1528"></a><span class="hs-comment">-- A tyvar binder is never a unification variable (MetaTv),</span><span>
</span><a name="line-1529"></a><span class="hs-comment">-- rather it is always a skolems.  BUT it may have a kind</span><span>
</span><a name="line-1530"></a><span class="hs-comment">-- that has not yet been zonked, and may include kind</span><span>
</span><a name="line-1531"></a><span class="hs-comment">-- unification variables.</span><span>
</span><a name="line-1532"></a><a name="zonkTcTyCoVarBndr"><a href="TcMType.html#zonkTcTyCoVarBndr"><span class="hs-identifier">zonkTcTyCoVarBndr</span></a></a><span> </span><a name="local-6989586621679808544"><a href="#local-6989586621679808544"><span class="hs-identifier">tyvar</span></a></a><span>
</span><a name="line-1533"></a><span>    </span><span class="hs-comment">-- can't use isCoVar, because it looks at a TyCon. Argh.</span><span>
</span><a name="line-1534"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isImmutableTyVar</span><span> </span><a href="TcType.html#isImmutableTyVar"><span class="hs-identifier hs-var">tyvar</span></a><span> </span><a href="TcType.html#isImmutableTyVar"><span class="hs-operator hs-var">||</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">not</span><span> </span><a href="#local-6989586621679808544"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier">tyvar</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pprTyVar</span><span> </span><span class="hs-identifier">tyvar</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1535"></a><span>    </span><a href="Var.html#updateTyVarKindM"><span class="hs-identifier hs-var">updateTyVarKindM</span></a><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621679808544"><span class="hs-identifier hs-var">tyvar</span></a><span>
</span><a name="line-1536"></a><span>
</span><a name="line-1537"></a><span class="hs-identifier">zonkTcTyVarBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVarBndr"><span class="hs-identifier hs-type">TyVarBndr</span></a><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><a href="#local-6989586621679808159"><span class="hs-identifier hs-type">vis</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TyVarBndr"><span class="hs-identifier hs-type">TyVarBndr</span></a><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><a href="#local-6989586621679808159"><span class="hs-identifier hs-type">vis</span></a><span class="hs-special">)</span><span>
</span><a name="line-1538"></a><a name="zonkTcTyVarBinder"><a href="TcMType.html#zonkTcTyVarBinder"><span class="hs-identifier">zonkTcTyVarBinder</span></a></a><span> </span><span class="hs-special">(</span><a href="Var.html#TvBndr"><span class="hs-identifier hs-var">TvBndr</span></a><span> </span><a name="local-6989586621679808545"><a href="#local-6989586621679808545"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679808546"><a href="#local-6989586621679808546"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1539"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808547"><a href="#local-6989586621679808547"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcTyCoVarBndr"><span class="hs-identifier hs-var">zonkTcTyCoVarBndr</span></a><span> </span><a href="#local-6989586621679808545"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1540"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TvBndr"><span class="hs-identifier hs-var">TvBndr</span></a><span> </span><a href="#local-6989586621679808547"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621679808546"><span class="hs-identifier hs-var">vis</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1541"></a><span>
</span><a name="line-1542"></a><span class="hs-identifier">zonkTcTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-1543"></a><span class="hs-comment">-- Simply look through all Flexis</span><span>
</span><a name="line-1544"></a><a name="zonkTcTyVar"><a href="TcMType.html#zonkTcTyVar"><span class="hs-identifier">zonkTcTyVar</span></a></a><span> </span><a name="local-6989586621679808548"><a href="#local-6989586621679808548"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1545"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTcTyVar"><span class="hs-identifier hs-var">isTcTyVar</span></a><span> </span><a href="#local-6989586621679808548"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1546"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a><span> </span><a href="#local-6989586621679808548"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1547"></a><span>      </span><a href="TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679808549"><span class="hs-identifier hs-var">zonk_kind_and_return</span></a><span>
</span><a name="line-1548"></a><span>      </span><a href="TcType.html#RuntimeUnk"><span class="hs-identifier hs-var">RuntimeUnk</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679808549"><span class="hs-identifier hs-var">zonk_kind_and_return</span></a><span>
</span><a name="line-1549"></a><span>      </span><a href="TcType.html#MetaTv"><span class="hs-identifier hs-var">MetaTv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808551"><a href="#local-6989586621679808551"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1550"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808552"><a href="#local-6989586621679808552"><span class="hs-identifier">cts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a><span> </span><a href="#local-6989586621679808551"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-1551"></a><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679808552"><span class="hs-identifier hs-var">cts</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1552"></a><span>                    </span><a href="TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679808549"><span class="hs-identifier hs-var">zonk_kind_and_return</span></a><span>
</span><a name="line-1553"></a><span>                    </span><a href="TcType.html#Indirect"><span class="hs-identifier hs-var">Indirect</span></a><span> </span><a name="local-6989586621679808553"><a href="#local-6989586621679808553"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621679808553"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1554"></a><span>
</span><a name="line-1555"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-comment">-- coercion variable</span><span>
</span><a name="line-1556"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808549"><span class="hs-identifier hs-var">zonk_kind_and_return</span></a><span>
</span><a name="line-1557"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1558"></a><span>    </span><a name="local-6989586621679808549"><a href="#local-6989586621679808549"><span class="hs-identifier">zonk_kind_and_return</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808550"><a href="#local-6989586621679808550"><span class="hs-identifier">z_tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">zonkTyCoVarKind</span></a><span> </span><a href="#local-6989586621679808548"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1559"></a><span>                              </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-6989586621679808550"><span class="hs-identifier hs-var">z_tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1560"></a><span>
</span><a name="line-1561"></a><span class="hs-comment">-- Variant that assumes that any result of zonking is still a TyVar.</span><span>
</span><a name="line-1562"></a><span class="hs-comment">-- Should be used only on skolems and SigTvs</span><span>
</span><a name="line-1563"></a><span class="hs-identifier">zonkTcTyVarToTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>
</span><a name="line-1564"></a><a name="zonkTcTyVarToTyVar"><a href="TcMType.html#zonkTcTyVarToTyVar"><span class="hs-identifier">zonkTcTyVarToTyVar</span></a></a><span> </span><a name="local-6989586621679808554"><a href="#local-6989586621679808554"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1565"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808555"><a href="#local-6989586621679808555"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a><span> </span><a href="#local-6989586621679808554"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1566"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808556"><a href="#local-6989586621679808556"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcType.html#tcGetTyVar_maybe"><span class="hs-identifier hs-var">tcGetTyVar_maybe</span></a><span> </span><a href="#local-6989586621679808555"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1567"></a><span>                     </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679808557"><a href="#local-6989586621679808557"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679808557"><span class="hs-identifier hs-var">tv'</span></a><span>
</span><a name="line-1568"></a><span>                     </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;zonkTcTyVarToTyVar&quot;</span><span>
</span><a name="line-1569"></a><span>                                          </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808554"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808555"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1570"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679808556"><span class="hs-identifier hs-var">tv'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1571"></a><span>
</span><a name="line-1572"></a><span class="hs-identifier">zonkSigTyVarPairs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1573"></a><a name="zonkSigTyVarPairs"><a href="TcMType.html#zonkSigTyVarPairs"><span class="hs-identifier">zonkSigTyVarPairs</span></a></a><span> </span><a name="local-6989586621679808558"><a href="#local-6989586621679808558"><span class="hs-identifier">prs</span></a></a><span>
</span><a name="line-1574"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-6989586621679808559"><span class="hs-identifier hs-var">do_one</span></a><span> </span><a href="#local-6989586621679808558"><span class="hs-identifier hs-var">prs</span></a><span>
</span><a name="line-1575"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1576"></a><span>    </span><a name="local-6989586621679808559"><a href="#local-6989586621679808559"><span class="hs-identifier">do_one</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679808560"><a href="#local-6989586621679808560"><span class="hs-identifier">nm</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808561"><a href="#local-6989586621679808561"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808562"><a href="#local-6989586621679808562"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcTyVarToTyVar"><span class="hs-identifier hs-var">zonkTcTyVarToTyVar</span></a><span> </span><a href="#local-6989586621679808561"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1577"></a><span>                         </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808560"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808562"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1578"></a><span>
</span><a name="line-1579"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                 Tidying
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1586"></a><span>
</span><a name="line-1587"></a><span class="hs-identifier">zonkTidyTcType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">)</span><span>
</span><a name="line-1588"></a><a name="zonkTidyTcType"><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier">zonkTidyTcType</span></a></a><span> </span><a name="local-6989586621679808563"><a href="#local-6989586621679808563"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679808564"><a href="#local-6989586621679808564"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808565"><a href="#local-6989586621679808565"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a><span> </span><a href="#local-6989586621679808564"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1589"></a><span>                           </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyOpenType"><span class="hs-identifier hs-var">tidyOpenType</span></a><span> </span><a href="#local-6989586621679808563"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679808565"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1590"></a><span>
</span><a name="line-1591"></a><span class="hs-identifier">zonkTidyOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span class="hs-special">)</span><span>
</span><a name="line-1592"></a><a name="zonkTidyOrigin"><a href="TcMType.html#zonkTidyOrigin"><span class="hs-identifier">zonkTidyOrigin</span></a></a><span> </span><a name="local-6989586621679808566"><a href="#local-6989586621679808566"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#GivenOrigin"><span class="hs-identifier hs-var">GivenOrigin</span></a><span> </span><a name="local-6989586621679808567"><a href="#local-6989586621679808567"><span class="hs-identifier">skol_info</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1593"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679808568"><a href="#local-6989586621679808568"><span class="hs-identifier">skol_info1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkSkolemInfo"><span class="hs-identifier hs-var">zonkSkolemInfo</span></a><span> </span><a href="#local-6989586621679808567"><span class="hs-identifier hs-var">skol_info</span></a><span>
</span><a name="line-1594"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679808569"><a href="#local-6989586621679808569"><span class="hs-identifier">skol_info2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#tidySkolemInfo"><span class="hs-identifier hs-var">tidySkolemInfo</span></a><span> </span><a href="#local-6989586621679808566"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679808568"><span class="hs-identifier hs-var">skol_info1</span></a><span>
</span><a name="line-1595"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808566"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#GivenOrigin"><span class="hs-identifier hs-var">GivenOrigin</span></a><span> </span><a href="#local-6989586621679808569"><span class="hs-identifier hs-var">skol_info2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1596"></a><span class="hs-identifier">zonkTidyOrigin</span><span> </span><a name="local-6989586621679808570"><a href="#local-6989586621679808570"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679808571"><a href="#local-6989586621679808571"><span class="hs-identifier">orig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#TypeEqOrigin"><span class="hs-identifier hs-var">TypeEqOrigin</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">uo_actual</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808572"><a href="#local-6989586621679808572"><span class="hs-identifier">act</span></a></a><span>
</span><a name="line-1597"></a><span>                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">uo_expected</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808573"><a href="#local-6989586621679808573"><span class="hs-identifier">exp</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1598"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679808574"><a href="#local-6989586621679808574"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808575"><a href="#local-6989586621679808575"><span class="hs-identifier">act'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span> </span><a href="#local-6989586621679808570"><span class="hs-identifier hs-var">env</span></a><span>  </span><a href="#local-6989586621679808572"><span class="hs-identifier hs-var">act</span></a><span>
</span><a name="line-1599"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679808576"><a href="#local-6989586621679808576"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808577"><a href="#local-6989586621679808577"><span class="hs-identifier">exp'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span> </span><a href="#local-6989586621679808574"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621679808573"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-1600"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621679808576"><span class="hs-identifier hs-var">env2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808571"><span class="hs-identifier hs-var">orig</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">uo_actual</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808575"><span class="hs-identifier hs-var">act'</span></a><span>
</span><a name="line-1601"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">uo_expected</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808577"><span class="hs-identifier hs-var">exp'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1602"></a><span class="hs-identifier">zonkTidyOrigin</span><span> </span><a name="local-6989586621679808578"><a href="#local-6989586621679808578"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#KindEqOrigin"><span class="hs-identifier hs-var">KindEqOrigin</span></a><span> </span><a name="local-6989586621679808579"><a href="#local-6989586621679808579"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679808580"><a href="#local-6989586621679808580"><span class="hs-identifier">m_ty2</span></a></a><span> </span><a name="local-6989586621679808581"><a href="#local-6989586621679808581"><span class="hs-identifier">orig</span></a></a><span> </span><a name="local-6989586621679808582"><a href="#local-6989586621679808582"><span class="hs-identifier">t_or_k</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1603"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679808583"><a href="#local-6989586621679808583"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808584"><a href="#local-6989586621679808584"><span class="hs-identifier">ty1'</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span> </span><a href="#local-6989586621679808578"><span class="hs-identifier hs-var">env</span></a><span>  </span><a href="#local-6989586621679808579"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1604"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679808586"><a href="#local-6989586621679808586"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808587"><a href="#local-6989586621679808587"><span class="hs-identifier">m_ty2'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679808580"><span class="hs-identifier hs-var">m_ty2</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1605"></a><span>                             </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679808585"><a href="#local-6989586621679808585"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Arrow.html#second"><span class="hs-identifier hs-var">second</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span> </span><a href="#local-6989586621679808583"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621679808585"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1606"></a><span>                             </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808583"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-1607"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679808588"><a href="#local-6989586621679808588"><span class="hs-identifier">env3</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808589"><a href="#local-6989586621679808589"><span class="hs-identifier">orig'</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyOrigin"><span class="hs-identifier hs-var">zonkTidyOrigin</span></a><span> </span><a href="#local-6989586621679808586"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621679808581"><span class="hs-identifier hs-var">orig</span></a><span>
</span><a name="line-1608"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808588"><span class="hs-identifier hs-var">env3</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#KindEqOrigin"><span class="hs-identifier hs-var">KindEqOrigin</span></a><span> </span><a href="#local-6989586621679808584"><span class="hs-identifier hs-var">ty1'</span></a><span> </span><a href="#local-6989586621679808587"><span class="hs-identifier hs-var">m_ty2'</span></a><span> </span><a href="#local-6989586621679808589"><span class="hs-identifier hs-var">orig'</span></a><span> </span><a href="#local-6989586621679808582"><span class="hs-identifier hs-var">t_or_k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1609"></a><span class="hs-identifier">zonkTidyOrigin</span><span> </span><a name="local-6989586621679808590"><a href="#local-6989586621679808590"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#FunDepOrigin1"><span class="hs-identifier hs-var">FunDepOrigin1</span></a><span> </span><a name="local-6989586621679808591"><a href="#local-6989586621679808591"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679808592"><a href="#local-6989586621679808592"><span class="hs-identifier">l1</span></a></a><span> </span><a name="local-6989586621679808593"><a href="#local-6989586621679808593"><span class="hs-identifier">p2</span></a></a><span> </span><a name="local-6989586621679808594"><a href="#local-6989586621679808594"><span class="hs-identifier">l2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1610"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679808595"><a href="#local-6989586621679808595"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808596"><a href="#local-6989586621679808596"><span class="hs-identifier">p1'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span> </span><a href="#local-6989586621679808590"><span class="hs-identifier hs-var">env</span></a><span>  </span><a href="#local-6989586621679808591"><span class="hs-identifier hs-var">p1</span></a><span>
</span><a name="line-1611"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679808597"><a href="#local-6989586621679808597"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808598"><a href="#local-6989586621679808598"><span class="hs-identifier">p2'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span> </span><a href="#local-6989586621679808595"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621679808593"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-1612"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808597"><span class="hs-identifier hs-var">env2</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#FunDepOrigin1"><span class="hs-identifier hs-var">FunDepOrigin1</span></a><span> </span><a href="#local-6989586621679808596"><span class="hs-identifier hs-var">p1'</span></a><span> </span><a href="#local-6989586621679808592"><span class="hs-identifier hs-var">l1</span></a><span> </span><a href="#local-6989586621679808598"><span class="hs-identifier hs-var">p2'</span></a><span> </span><a href="#local-6989586621679808594"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1613"></a><span class="hs-identifier">zonkTidyOrigin</span><span> </span><a name="local-6989586621679808599"><a href="#local-6989586621679808599"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#FunDepOrigin2"><span class="hs-identifier hs-var">FunDepOrigin2</span></a><span> </span><a name="local-6989586621679808600"><a href="#local-6989586621679808600"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679808601"><a href="#local-6989586621679808601"><span class="hs-identifier">o1</span></a></a><span> </span><a name="local-6989586621679808602"><a href="#local-6989586621679808602"><span class="hs-identifier">p2</span></a></a><span> </span><a name="local-6989586621679808603"><a href="#local-6989586621679808603"><span class="hs-identifier">l2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1614"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679808604"><a href="#local-6989586621679808604"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808605"><a href="#local-6989586621679808605"><span class="hs-identifier">p1'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span> </span><a href="#local-6989586621679808599"><span class="hs-identifier hs-var">env</span></a><span>  </span><a href="#local-6989586621679808600"><span class="hs-identifier hs-var">p1</span></a><span>
</span><a name="line-1615"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679808606"><a href="#local-6989586621679808606"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808607"><a href="#local-6989586621679808607"><span class="hs-identifier">p2'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a><span> </span><a href="#local-6989586621679808604"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621679808602"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-1616"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679808608"><a href="#local-6989586621679808608"><span class="hs-identifier">env3</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808609"><a href="#local-6989586621679808609"><span class="hs-identifier">o1'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkTidyOrigin"><span class="hs-identifier hs-var">zonkTidyOrigin</span></a><span> </span><a href="#local-6989586621679808606"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621679808601"><span class="hs-identifier hs-var">o1</span></a><span>
</span><a name="line-1617"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808608"><span class="hs-identifier hs-var">env3</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#FunDepOrigin2"><span class="hs-identifier hs-var">FunDepOrigin2</span></a><span> </span><a href="#local-6989586621679808605"><span class="hs-identifier hs-var">p1'</span></a><span> </span><a href="#local-6989586621679808609"><span class="hs-identifier hs-var">o1'</span></a><span> </span><a href="#local-6989586621679808607"><span class="hs-identifier hs-var">p2'</span></a><span> </span><a href="#local-6989586621679808603"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1618"></a><span class="hs-identifier">zonkTidyOrigin</span><span> </span><a name="local-6989586621679808610"><a href="#local-6989586621679808610"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679808611"><a href="#local-6989586621679808611"><span class="hs-identifier">orig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808610"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808611"><span class="hs-identifier hs-var">orig</span></a><span class="hs-special">)</span><span>
</span><a name="line-1619"></a><span>
</span><a name="line-1620"></a><span class="hs-comment">----------------</span><span>
</span><a name="line-1621"></a><span class="hs-identifier">tidyCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-1622"></a><span class="hs-comment">-- Used only in error reporting</span><span>
</span><a name="line-1623"></a><span class="hs-comment">-- Also converts it to non-canonical</span><span>
</span><a name="line-1624"></a><a name="tidyCt"><a href="TcMType.html#tidyCt"><span class="hs-identifier">tidyCt</span></a></a><span> </span><a name="local-6989586621679808612"><a href="#local-6989586621679808612"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679808613"><a href="#local-6989586621679808613"><span class="hs-identifier">ct</span></a></a><span>
</span><a name="line-1625"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679808613"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1626"></a><span>     </span><a href="TcRnTypes.html#CHoleCan"><span class="hs-identifier hs-var">CHoleCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808624"><a href="#local-6989586621679808624"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1627"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679808613"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808614"><span class="hs-identifier hs-var">tidy_ev</span></a><span> </span><a href="#local-6989586621679808612"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679808624"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1628"></a><span>     </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808614"><span class="hs-identifier hs-var">tidy_ev</span></a><span> </span><a href="#local-6989586621679808612"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span> </span><a href="#local-6989586621679808613"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1629"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1630"></a><span>    </span><span class="hs-identifier">tidy_ev</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span>
</span><a name="line-1631"></a><span>     </span><span class="hs-comment">-- NB: we do not tidy the ctev_evar field because we don't</span><span>
</span><a name="line-1632"></a><span>     </span><span class="hs-comment">--     show it in error messages</span><span>
</span><a name="line-1633"></a><span>    </span><a name="local-6989586621679808614"><a href="#local-6989586621679808614"><span class="hs-identifier">tidy_ev</span></a></a><span> </span><a name="local-6989586621679808615"><a href="#local-6989586621679808615"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679808616"><a href="#local-6989586621679808616"><span class="hs-identifier">ctev</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CtGiven"><span class="hs-identifier hs-var">CtGiven</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808617"><a href="#local-6989586621679808617"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1634"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808616"><span class="hs-identifier hs-var">ctev</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-6989586621679808615"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679808617"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1635"></a><span>    </span><span class="hs-identifier">tidy_ev</span><span> </span><a name="local-6989586621679808618"><a href="#local-6989586621679808618"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679808619"><a href="#local-6989586621679808619"><span class="hs-identifier">ctev</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808620"><a href="#local-6989586621679808620"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1636"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808619"><span class="hs-identifier hs-var">ctev</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-6989586621679808618"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679808620"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1637"></a><span>    </span><span class="hs-identifier">tidy_ev</span><span> </span><a name="local-6989586621679808621"><a href="#local-6989586621679808621"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679808622"><a href="#local-6989586621679808622"><span class="hs-identifier">ctev</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CtDerived"><span class="hs-identifier hs-var">CtDerived</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679808623"><a href="#local-6989586621679808623"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1638"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808622"><span class="hs-identifier hs-var">ctev</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-6989586621679808621"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679808623"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1639"></a><span>
</span><a name="line-1640"></a><span class="hs-comment">----------------</span><span>
</span><a name="line-1641"></a><span class="hs-identifier">tidyEvVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span>
</span><a name="line-1642"></a><a name="tidyEvVar"><a href="TcMType.html#tidyEvVar"><span class="hs-identifier">tidyEvVar</span></a></a><span> </span><a name="local-6989586621679808625"><a href="#local-6989586621679808625"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679808626"><a href="#local-6989586621679808626"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#setVarType"><span class="hs-identifier hs-var">setVarType</span></a><span> </span><a href="#local-6989586621679808626"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-6989586621679808625"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679808626"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1643"></a><span>
</span><a name="line-1644"></a><span class="hs-comment">----------------</span><span>
</span><a name="line-1645"></a><span class="hs-identifier">tidySkolemInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span>
</span><a name="line-1646"></a><a name="tidySkolemInfo"><a href="TcMType.html#tidySkolemInfo"><span class="hs-identifier">tidySkolemInfo</span></a></a><span> </span><a name="local-6989586621679808627"><a href="#local-6989586621679808627"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#DerivSkol"><span class="hs-identifier hs-var">DerivSkol</span></a><span> </span><a name="local-6989586621679808628"><a href="#local-6989586621679808628"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#DerivSkol"><span class="hs-identifier hs-var">DerivSkol</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-6989586621679808627"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679808628"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1647"></a><span class="hs-identifier">tidySkolemInfo</span><span> </span><a name="local-6989586621679808629"><a href="#local-6989586621679808629"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#SigSkol"><span class="hs-identifier hs-var">SigSkol</span></a><span> </span><a name="local-6989586621679808630"><a href="#local-6989586621679808630"><span class="hs-identifier">cx</span></a></a><span> </span><a name="local-6989586621679808631"><a href="#local-6989586621679808631"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679808632"><a href="#local-6989586621679808632"><span class="hs-identifier">tv_prs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#tidySigSkol"><span class="hs-identifier hs-var">tidySigSkol</span></a><span> </span><a href="#local-6989586621679808629"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679808630"><span class="hs-identifier hs-var">cx</span></a><span> </span><a href="#local-6989586621679808631"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679808632"><span class="hs-identifier hs-var">tv_prs</span></a><span>
</span><a name="line-1648"></a><span class="hs-identifier">tidySkolemInfo</span><span> </span><a name="local-6989586621679808633"><a href="#local-6989586621679808633"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#InferSkol"><span class="hs-identifier hs-var">InferSkol</span></a><span> </span><a name="local-6989586621679808634"><a href="#local-6989586621679808634"><span class="hs-identifier">ids</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#InferSkol"><span class="hs-identifier hs-var">InferSkol</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-6989586621679808633"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808634"><span class="hs-identifier hs-var">ids</span></a><span class="hs-special">)</span><span>
</span><a name="line-1649"></a><span class="hs-identifier">tidySkolemInfo</span><span> </span><a name="local-6989586621679808635"><a href="#local-6989586621679808635"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#UnifyForAllSkol"><span class="hs-identifier hs-var">UnifyForAllSkol</span></a><span> </span><a name="local-6989586621679808636"><a href="#local-6989586621679808636"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#UnifyForAllSkol"><span class="hs-identifier hs-var">UnifyForAllSkol</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-6989586621679808635"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679808636"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1650"></a><span class="hs-identifier">tidySkolemInfo</span><span> </span><span class="hs-identifier">_</span><span>   </span><a name="local-6989586621679808637"><a href="#local-6989586621679808637"><span class="hs-identifier">info</span></a></a><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808637"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-1651"></a><span>
</span><a name="line-1652"></a><span class="hs-identifier">tidySigSkol</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span>
</span><a name="line-1653"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><a href="TcType.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span>
</span><a name="line-1654"></a><span class="hs-comment">-- We need to take special care when tidying SigSkol</span><span>
</span><a name="line-1655"></a><span class="hs-comment">-- See Note [SigSkol SkolemInfo] in TcRnTypes</span><span>
</span><a name="line-1656"></a><a name="tidySigSkol"><a href="TcMType.html#tidySigSkol"><span class="hs-identifier">tidySigSkol</span></a></a><span> </span><a name="local-6989586621679808638"><a href="#local-6989586621679808638"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679808639"><a href="#local-6989586621679808639"><span class="hs-identifier">cx</span></a></a><span> </span><a name="local-6989586621679808640"><a href="#local-6989586621679808640"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679808641"><a href="#local-6989586621679808641"><span class="hs-identifier">tv_prs</span></a></a><span>
</span><a name="line-1657"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#SigSkol"><span class="hs-identifier hs-var">SigSkol</span></a><span> </span><a href="#local-6989586621679808639"><span class="hs-identifier hs-var">cx</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808644"><span class="hs-identifier hs-var">tidy_ty</span></a><span> </span><a href="#local-6989586621679808638"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679808640"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808642"><span class="hs-identifier hs-var">tv_prs'</span></a><span>
</span><a name="line-1658"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1659"></a><span>    </span><a name="local-6989586621679808642"><a href="#local-6989586621679808642"><span class="hs-identifier">tv_prs'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyTyVarOcc"><span class="hs-identifier hs-var">tidyTyVarOcc</span></a><span> </span><a href="#local-6989586621679808638"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679808641"><span class="hs-identifier hs-var">tv_prs</span></a><span>
</span><a name="line-1660"></a><span>    </span><a name="local-6989586621679808643"><a href="#local-6989586621679808643"><span class="hs-identifier">inst_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a><span> </span><a href="#local-6989586621679808642"><span class="hs-identifier hs-var">tv_prs'</span></a><span>
</span><a name="line-1661"></a><span>
</span><a name="line-1662"></a><span>    </span><a name="local-6989586621679808644"><a href="#local-6989586621679808644"><span class="hs-identifier">tidy_ty</span></a></a><span> </span><a name="local-6989586621679808646"><a href="#local-6989586621679808646"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TvBndr"><span class="hs-identifier hs-var">TvBndr</span></a><span> </span><a name="local-6989586621679808647"><a href="#local-6989586621679808647"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679808648"><a href="#local-6989586621679808648"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679808649"><a href="#local-6989586621679808649"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1663"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#TvBndr"><span class="hs-identifier hs-var">TvBndr</span></a><span> </span><a href="#local-6989586621679808651"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621679808648"><span class="hs-identifier hs-var">vis</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808644"><span class="hs-identifier hs-var">tidy_ty</span></a><span> </span><a href="#local-6989586621679808650"><span class="hs-identifier hs-var">env'</span></a><span> </span><a href="#local-6989586621679808649"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1664"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1665"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679808650"><a href="#local-6989586621679808650"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808651"><a href="#local-6989586621679808651"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808645"><span class="hs-identifier hs-var">tidy_tv_bndr</span></a><span> </span><a href="#local-6989586621679808646"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679808647"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1666"></a><span>
</span><a name="line-1667"></a><span>    </span><span class="hs-identifier">tidy_ty</span><span> </span><a name="local-6989586621679808652"><a href="#local-6989586621679808652"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621679808653"><a href="#local-6989586621679808653"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679808654"><a href="#local-6989586621679808654"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1668"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-6989586621679808652"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679808653"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679808644"><span class="hs-identifier hs-var">tidy_ty</span></a><span> </span><a href="#local-6989586621679808652"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679808654"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-1669"></a><span>
</span><a name="line-1670"></a><span>    </span><span class="hs-identifier">tidy_ty</span><span> </span><a name="local-6989586621679808655"><a href="#local-6989586621679808655"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679808656"><a href="#local-6989586621679808656"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-6989586621679808655"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679808656"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1671"></a><span>
</span><a name="line-1672"></a><span>    </span><span class="hs-identifier">tidy_tv_bndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-1673"></a><span>    </span><a name="local-6989586621679808645"><a href="#local-6989586621679808645"><span class="hs-identifier">tidy_tv_bndr</span></a></a><span> </span><a name="local-6989586621679808657"><a href="#local-6989586621679808657"><span class="hs-identifier">env</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679808658"><a href="#local-6989586621679808658"><span class="hs-identifier">occ_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808659"><a href="#local-6989586621679808659"><span class="hs-identifier">subst</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679808660"><a href="#local-6989586621679808660"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1674"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679808661"><a href="#local-6989586621679808661"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><a href="#local-6989586621679808643"><span class="hs-identifier hs-var">inst_env</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a><span> </span><a href="#local-6989586621679808660"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1675"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679808658"><span class="hs-identifier hs-var">occ_env</span></a><span class="hs-special">,</span><span> </span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-6989586621679808659"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679808660"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679808661"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679808661"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1676"></a><span>
</span><a name="line-1677"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1678"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyTyCoVarBndr"><span class="hs-identifier hs-var">tidyTyCoVarBndr</span></a><span> </span><a href="#local-6989586621679808657"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679808660"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1679"></a><span>
</span><a name="line-1680"></a><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><a name="line-1681"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
             Levity polymorphism checks
*                                                                      *
************************************************************************

See Note [Levity polymorphism checking] in DsMonad

-}</span><span>
</span><a name="line-1691"></a><span>
</span><a name="line-1692"></a><span class="hs-comment">-- | According to the rules around representation polymorphism</span><span>
</span><a name="line-1693"></a><span class="hs-comment">-- (see https://ghc.haskell.org/trac/ghc/wiki/NoSubKinds), no binder</span><span>
</span><a name="line-1694"></a><span class="hs-comment">-- can have a representation-polymorphic type. This check ensures</span><span>
</span><a name="line-1695"></a><span class="hs-comment">-- that we respect this rule. It is a bit regrettable that this error</span><span>
</span><a name="line-1696"></a><span class="hs-comment">-- occurs in zonking, after which we should have reported all errors.</span><span>
</span><a name="line-1697"></a><span class="hs-comment">-- But it's hard to see where else to do it, because this can be discovered</span><span>
</span><a name="line-1698"></a><span class="hs-comment">-- only after all solving is done. And, perhaps most importantly, this</span><span>
</span><a name="line-1699"></a><span class="hs-comment">-- isn't really a compositional property of a type system, so it's</span><span>
</span><a name="line-1700"></a><span class="hs-comment">-- not a terrible surprise that the check has to go in an awkward spot.</span><span>
</span><a name="line-1701"></a><span class="hs-identifier">ensureNotLevPoly</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>  </span><span class="hs-comment">-- its zonked type</span><span>
</span><a name="line-1702"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>  </span><span class="hs-comment">-- where this happened</span><span>
</span><a name="line-1703"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1704"></a><a name="ensureNotLevPoly"><a href="TcMType.html#ensureNotLevPoly"><span class="hs-identifier">ensureNotLevPoly</span></a></a><span> </span><a name="local-6989586621679808662"><a href="#local-6989586621679808662"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679808663"><a href="#local-6989586621679808663"><span class="hs-identifier">doc</span></a></a><span>
</span><a name="line-1705"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#whenNoErrs"><span class="hs-identifier hs-var">whenNoErrs</span></a><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>   </span><span class="hs-comment">-- sometimes we end up zonking bogus definitions of type</span><span>
</span><a name="line-1706"></a><span>                   </span><span class="hs-comment">-- forall a. a. See, for example, test ghci/scripts/T9140</span><span>
</span><a name="line-1707"></a><span>    </span><a href="TcMType.html#checkForLevPoly"><span class="hs-identifier hs-var">checkForLevPoly</span></a><span> </span><a href="#local-6989586621679808663"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679808662"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1708"></a><span>
</span><a name="line-1709"></a><span>  </span><span class="hs-comment">-- See Note [Levity polymorphism checking] in DsMonad</span><span>
</span><a name="line-1710"></a><span class="hs-identifier">checkForLevPoly</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1711"></a><a name="checkForLevPoly"><a href="TcMType.html#checkForLevPoly"><span class="hs-identifier">checkForLevPoly</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcMType.html#checkForLevPolyX"><span class="hs-identifier hs-var">checkForLevPolyX</span></a><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span>
</span><a name="line-1712"></a><span>
</span><a name="line-1713"></a><span class="hs-identifier">checkForLevPolyX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a><span> </span><a href="#local-6989586621679808158"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-1714"></a><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679808158"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- how to report an error</span><span>
</span><a name="line-1715"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679808158"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1716"></a><a name="checkForLevPolyX"><a href="TcMType.html#checkForLevPolyX"><span class="hs-identifier">checkForLevPolyX</span></a></a><span> </span><a name="local-6989586621679808664"><a href="#local-6989586621679808664"><span class="hs-identifier">add_err</span></a></a><span> </span><a name="local-6989586621679808665"><a href="#local-6989586621679808665"><span class="hs-identifier">extra</span></a></a><span> </span><a name="local-6989586621679808666"><a href="#local-6989586621679808666"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1717"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isTypeLevPoly"><span class="hs-identifier hs-var">isTypeLevPoly</span></a><span> </span><a href="#local-6989586621679808666"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1718"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679808664"><span class="hs-identifier hs-var">add_err</span></a><span> </span><span class="hs-special">(</span><a href="TcMType.html#formatLevPolyErr"><span class="hs-identifier hs-var">formatLevPolyErr</span></a><span> </span><a href="#local-6989586621679808666"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="#local-6989586621679808665"><span class="hs-identifier hs-var">extra</span></a><span class="hs-special">)</span><span>
</span><a name="line-1719"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1720"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.11.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1721"></a><span>
</span><a name="line-1722"></a><span class="hs-identifier">formatLevPolyErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>  </span><span class="hs-comment">-- levity-polymorphic type</span><span>
</span><a name="line-1723"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1724"></a><a name="formatLevPolyErr"><a href="TcMType.html#formatLevPolyErr"><span class="hs-identifier">formatLevPolyErr</span></a></a><span> </span><a name="local-6989586621679808667"><a href="#local-6989586621679808667"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1725"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;A levity-polymorphic type is not allowed here:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1726"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Type:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808669"><span class="hs-identifier hs-var">tidy_ty</span></a><span>
</span><a name="line-1727"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Kind:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679808670"><span class="hs-identifier hs-var">tidy_ki</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1728"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1729"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679808668"><a href="#local-6989586621679808668"><span class="hs-identifier">tidy_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679808669"><a href="#local-6989586621679808669"><span class="hs-identifier">tidy_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyOpenType"><span class="hs-identifier hs-var">tidyOpenType</span></a><span> </span><a href="VarEnv.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a><span> </span><a href="#local-6989586621679808667"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1730"></a><span>    </span><a name="local-6989586621679808670"><a href="#local-6989586621679808670"><span class="hs-identifier">tidy_ki</span></a></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-6989586621679808668"><span class="hs-identifier hs-var">tidy_env</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621679808667"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1731"></a></pre></body></html>