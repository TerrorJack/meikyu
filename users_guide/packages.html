

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>7.9. Packages &#8212; Glasgow Haskell Compiler 8.5.20180310 User&#39;s Guide</title>
    <link rel="stylesheet" href="_static/ghc-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '8.5.20180310',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Glasgow Haskell Compiler 8.5.20180310 User&#39;s Guide"
          href="_static/opensearch.xml"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="7.10. GHC Backends" href="codegens.html" />
    <link rel="prev" title="7.8. Filenames and separate compilation" href="separate_compilation.html" /> 
  </head>
  <body>
<div class="logo">
    <h1><a href="index.html">Glasgow Haskell Compiler User's Guide</a></h1>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="codegens.html" title="7.10. GHC Backends"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="separate_compilation.html" title="7.8. Filenames and separate compilation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">GHC 8.5.20180310 User&#39;s Guide</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="usage.html" accesskey="U">7. Using GHC</a> &#187;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">7.9. Packages</a><ul>
<li><a class="reference internal" href="#using-packages">7.9.1. Using Packages</a></li>
<li><a class="reference internal" href="#the-main-package">7.9.2. The <code class="docutils literal"><span class="pre">main</span></code> package</a></li>
<li><a class="reference internal" href="#consequences-of-packages-for-the-haskell-language">7.9.3. Consequences of packages for the Haskell language</a></li>
<li><a class="reference internal" href="#thinning-and-renaming-modules">7.9.4. Thinning and renaming modules</a></li>
<li><a class="reference internal" href="#package-databases">7.9.5. Package Databases</a><ul>
<li><a class="reference internal" href="#the-ghc-package-path-environment-variable">7.9.5.1. The <code class="docutils literal"><span class="pre">GHC_PACKAGE_PATH</span></code> environment variable</a></li>
<li><a class="reference internal" href="#package-environments">7.9.5.2. Package environments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installed-package-ids-dependencies-and-broken-packages">7.9.6. Installed package IDs, dependencies, and broken packages</a></li>
<li><a class="reference internal" href="#package-management-the-ghc-pkg-command">7.9.7. Package management (the <code class="docutils literal"><span class="pre">ghc-pkg</span></code> command)</a></li>
<li><a class="reference internal" href="#building-a-package-from-haskell-source">7.9.8. Building a package from Haskell source</a></li>
<li><a class="reference internal" href="#installedpackageinfo-a-package-specification">7.9.9. <code class="docutils literal"><span class="pre">InstalledPackageInfo</span></code>: a package specification</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="separate_compilation.html"
                        title="previous chapter">7.8. Filenames and separate compilation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="codegens.html"
                        title="next chapter">7.10. GHC Backends</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/packages.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="packages">
<span id="id1"></span><h1>7.9. Packages<a class="headerlink" href="#packages" title="Permalink to this headline">¶</a></h1>
<p id="index-0">A package is a library of Haskell modules known to the compiler. GHC
comes with several packages: see the accompanying <a class="reference external" href="../libraries/index.html">library
documentation</a>. More packages to install can
be obtained from
<a class="reference external" href="http://hackage.haskell.org/packages/hackage.html">HackageDB</a>.</p>
<p>Using a package couldn’t be simpler: if you’re using <code class="docutils literal"><span class="pre">--make</span></code> or GHCi,
then most of the installed packages will be automatically available to
your program without any further options. The exceptions to this rule
are covered below in <a class="reference internal" href="#using-packages"><span class="std std-ref">Using Packages</span></a>.</p>
<p>Building your own packages is also quite straightforward: we provide the
<a class="reference external" href="http://www.haskell.org/cabal/">Cabal</a> infrastructure which automates
the process of configuring, building, installing and distributing a
package. All you need to do is write a simple configuration file, put a
few files in the right places, and you have a package. See the <a class="reference external" href="http://www.haskell.org/cabal/users-guide/">Cabal
documentation</a> for
details, and also the Cabal libraries
(<a class="reference external" href="../libraries/Cabal-2.2.0.0/Distribution-Simple.html">Distribution.Simple</a>, for example).</p>
<div class="section" id="using-packages">
<span id="id2"></span><h2>7.9.1. Using Packages<a class="headerlink" href="#using-packages" title="Permalink to this headline">¶</a></h2>
<p id="index-1">GHC only knows about packages that are <em>installed</em>. Installed packages live in
package databases. For details on package databases and how to control which
package databases or specific set of packages are visible to GHC, see
<a class="reference internal" href="#package-databases"><span class="std std-ref">Package Databases</span></a>.</p>
<p>To see which packages are currently available, use the <code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">list</span></code> command:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>$ ghc-pkg list
/usr/lib/ghc-6.12.1/package.conf.d:
    Cabal-1.7.4
    array-0.2.0.1
    base-3.0.3.0
    base-4.2.0.0
    bin-package-db-0.0.0.0
    binary-0.5.0.1
    bytestring-0.9.1.4
    containers-0.2.0.1
    directory-1.0.0.2
    (dph-base-0.4.0)
    (dph-par-0.4.0)
    (dph-prim-interface-0.4.0)
    (dph-prim-par-0.4.0)
    (dph-prim-seq-0.4.0)
    (dph-seq-0.4.0)
    extensible-exceptions-0.1.1.0
    ffi-1.0
    filepath-1.1.0.1
    (ghc-6.12.1)
    ghc-prim-0.1.0.0
    haskeline-0.6.2
    haskell98-1.0.1.0
    hpc-0.5.0.2
    integer-gmp-0.1.0.0
    mtl-1.1.0.2
    old-locale-1.0.0.1
    old-time-1.0.0.1
    pretty-1.0.1.0
    process-1.0.1.1
    random-1.0.0.1
    rts-1.0
    syb-0.1.0.0
    template-haskell-2.4.0.0
    terminfo-0.3.1
    time-1.1.4
    unix-2.3.1.0
    utf8-string-0.3.4
</pre></div>
</div>
<p>An installed package is either <em>exposed</em> or <em>hidden</em> by default.
Packages hidden by default are listed in parentheses (e.g.
<code class="docutils literal"><span class="pre">(lang-1.0)</span></code>), or possibly in blue if your terminal supports colour,
in the output of <code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">list</span></code>. Command-line flags, described below,
allow you to expose a hidden package or hide an exposed one. Only
modules from exposed packages may be imported by your Haskell code; if
you try to import a module from a hidden package, GHC will emit an error
message. It should be noted that a hidden package might still get linked
with your program as a dependency of an exposed package, it is only restricted
from direct imports.</p>
<p>If there are multiple exposed versions of a package, GHC will
prefer the latest one. Additionally, some packages may be broken: that
is, they are missing from the package database, or one of their
dependencies are broken; in this case; these packages are excluded from
the default set of packages.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you’re using Cabal, then the exposed or hidden status of a
package is irrelevant: the available packages are instead determined by
the dependencies listed in your <code class="docutils literal"><span class="pre">.cabal</span></code> specification. The
exposed/hidden status of packages is only relevant when using <code class="docutils literal"><span class="pre">ghc</span></code> or
<code class="docutils literal"><span class="pre">ghci</span></code> directly.</p>
</div>
<p>Similar to a package’s hidden status is a package’s trusted status. A
package can be either trusted or not trusted (distrusted). By default
packages are distrusted. This property of a package only plays a role
when compiling code using GHC’s Safe Haskell feature (see
<a class="reference internal" href="safe_haskell.html#safe-haskell"><span class="std std-ref">Safe Haskell</span></a>) with the <code class="docutils literal"><span class="pre">-fpackage-trust</span></code> flag enabled.</p>
<p>To see which modules are provided by a package use the <code class="docutils literal"><span class="pre">ghc-pkg</span></code>
command (see <a class="reference internal" href="#package-management"><span class="std std-ref">Package management (the ghc-pkg command)</span></a>):</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>$ ghc-pkg field network exposed-modules
exposed-modules: Network.BSD,
                 Network.CGI,
                 Network.Socket,
                 Network.URI,
                 Network
</pre></div>
</div>
<p>The GHC command line options that control packages are:</p>
<dl class="ghc-flag">
<dt id="ghc-flag--package ⟨pkg⟩">
<code class="descname">-package</code><code class="descclassname"> ⟨pkg⟩</code><a class="headerlink" href="#ghc-flag--package ⟨pkg⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>This option causes the installed package ⟨pkg⟩ to be exposed. The
package ⟨pkg⟩ can be specified in full with its version number (e.g.
<code class="docutils literal"><span class="pre">network-1.0</span></code>) or the version number can be omitted in which case GHC
will automatically expose the latest non-broken version from the installed
versions of the package.</p>
<p>By default (when <a class="reference internal" href="#ghc-flag--hide-all-packages"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-hide-all-packages</span></code></a> is not specified), GHC
exposes only one version of a package, all other versions become hidden.
If <cite>-package</cite> option is specified multiple times for the same package the
last one overrides the previous ones. On the other hand, if
<a class="reference internal" href="#ghc-flag--hide-all-packages"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-hide-all-packages</span></code></a> is used, GHC allows you to expose multiple
versions of a package by using the <cite>-package</cite> option multiple times with
different versions of the same package.</p>
<p><cite>-package</cite> supports thinning and renaming described in
<a class="reference internal" href="#package-thinning-and-renaming"><span class="std std-ref">Thinning and renaming modules</span></a>.</p>
<p>The <code class="docutils literal"><span class="pre">-package</span> <span class="pre">⟨pkg⟩</span></code> option also causes package ⟨pkg⟩ to be linked into
the resulting executable or shared object. Whether a packages’
library is linked statically or dynamically is controlled by the
flag pair <a class="reference internal" href="phases.html#ghc-flag--static"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-static</span></code></a>/ <a class="reference internal" href="phases.html#ghc-flag--dynamic"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-dynamic</span></code></a>.</p>
<p>In <a class="reference internal" href="using.html#ghc-flag---make"><code class="xref std std-ghc-flag docutils literal"><span class="pre">--make</span></code></a> mode and <a class="reference internal" href="using.html#ghc-flag---interactive"><code class="xref std std-ghc-flag docutils literal"><span class="pre">--interactive</span></code></a> mode (see <a class="reference internal" href="using.html#modes"><span class="std std-ref">Modes of operation</span></a>),
the compiler normally determines which packages are required by the
current Haskell modules, and links only those. In batch mode
however, the dependency information isn’t available, and explicit
<code class="docutils literal"><span class="pre">-package</span></code> options must be given when linking. The one other time
you might need to use <code class="docutils literal"><span class="pre">-package</span></code> to force linking a package is
when the package does not contain any Haskell modules (it might
contain a C library only, for example). In that case, GHC will never
discover a dependency on it, so it has to be mentioned explicitly.</p>
<p>For example, to link a program consisting of objects <code class="docutils literal"><span class="pre">Foo.o</span></code> and
<code class="docutils literal"><span class="pre">Main.o</span></code>, where we made use of the <code class="docutils literal"><span class="pre">network</span></code> package, we need to
give GHC the <code class="docutils literal"><span class="pre">-package</span></code> flag thus:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ ghc -o myprog Foo.o Main.o -package network
</pre></div>
</div>
<p>The same flag is necessary even if we compiled the modules from
source, because GHC still reckons it’s in batch mode:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ ghc -o myprog Foo.hs Main.hs -package network
</pre></div>
</div>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--package-id ⟨unit-id⟩">
<code class="descname">-package-id</code><code class="descclassname"> ⟨unit-id⟩</code><a class="headerlink" href="#ghc-flag--package-id ⟨unit-id⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>Exposes a package like <a class="reference internal" href="#ghc-flag--package ⟨pkg⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-package</span> <span class="pre">⟨pkg⟩</span></code></a>, but the package is named
by its unit ID (i.e. the value of <code class="docutils literal"><span class="pre">id</span></code> in its entry in the installed
package database, also previously known as an installed package ID) rather
than by name. This is a more robust way to name packages, and can be used
to select packages that would otherwise be shadowed. Cabal passes
<code class="docutils literal"><span class="pre">-package-id</span></code> flags to GHC.  <code class="docutils literal"><span class="pre">-package-id</span></code> supports thinning and
renaming described in <a class="reference internal" href="#package-thinning-and-renaming"><span class="std std-ref">Thinning and renaming modules</span></a>.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--hide-all-packages">
<code class="descname">-hide-all-packages</code><a class="headerlink" href="#ghc-flag--hide-all-packages" title="Permalink to this definition">¶</a></dt>
<dd><p>Ignore the exposed flag on installed packages, and hide them all by
default. If you use this flag, then any packages you require
(including <code class="docutils literal"><span class="pre">base</span></code>) need to be explicitly exposed using
<a class="reference internal" href="#ghc-flag--package ⟨pkg⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-package</span> <span class="pre">⟨pkg⟩</span></code></a> options.</p>
<p>This is a good way to insulate your program from differences in the
globally exposed packages, and being explicit about package
dependencies is a Good Thing. Cabal always passes the
<code class="docutils literal"><span class="pre">-hide-all-packages</span></code> flag to GHC, for exactly this reason.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--hide-package ⟨pkg⟩">
<code class="descname">-hide-package</code><code class="descclassname"> ⟨pkg⟩</code><a class="headerlink" href="#ghc-flag--hide-package ⟨pkg⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>This option does the opposite of <a class="reference internal" href="#ghc-flag--package ⟨pkg⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-package</span> <span class="pre">⟨pkg⟩</span></code></a>: it causes the
specified package to be hidden, which means that none of its modules
will be available for import by Haskell <code class="docutils literal"><span class="pre">import</span></code> directives.</p>
<p>Note that the package might still end up being linked into the final
program, if it is a dependency (direct or indirect) of another
exposed package.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--ignore-package ⟨pkg⟩">
<code class="descname">-ignore-package</code><code class="descclassname"> ⟨pkg⟩</code><a class="headerlink" href="#ghc-flag--ignore-package ⟨pkg⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>Causes the compiler to behave as if package ⟨pkg⟩, and any packages
that depend on ⟨pkg⟩, are not installed at all.</p>
<p>Saying <code class="docutils literal"><span class="pre">-ignore-package</span> <span class="pre">⟨pkg⟩</span></code> is the same as giving
<a class="reference internal" href="#ghc-flag--hide-package ⟨pkg⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-hide-package</span> <span class="pre">⟨pkg⟩</span></code></a> flags for ⟨pkg⟩ and all the packages that
depend on ⟨pkg⟩. Sometimes we don’t know ahead of time which packages will
be installed that depend on ⟨pkg⟩, which is when the
<a class="reference internal" href="#ghc-flag--ignore-package ⟨pkg⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-ignore-package</span> <span class="pre">⟨pkg⟩</span></code></a> flag can be useful.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--no-auto-link-packages">
<code class="descname">-no-auto-link-packages</code><a class="headerlink" href="#ghc-flag--no-auto-link-packages" title="Permalink to this definition">¶</a></dt>
<dd><p>By default, GHC will automatically link in the <code class="docutils literal"><span class="pre">base</span></code> and <code class="docutils literal"><span class="pre">rts</span></code>
packages. This flag disables that behaviour.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--this-unit-id ⟨unit-id⟩">
<code class="descname">-this-unit-id</code><code class="descclassname"> ⟨unit-id⟩</code><a class="headerlink" href="#ghc-flag--this-unit-id ⟨unit-id⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>Tells GHC that the module being compiled forms part of unit ID
⟨unit-id⟩; internally, these keys are used to determine type equality
and linker symbols.  As of GHC 8.0, unit IDs must consist solely
of alphanumeric characters, dashes, underscores and periods.  GHC
reserves the right to interpret other characters in a special
way in later releases.</p>
</dd></dl>

<dl class="ghc-flag">
<dt>
<code class="descname">-trust</code><code class="descclassname"> ⟨pkg⟩</code></dt>
<dd><p>This option causes the install package ⟨pkg⟩ to be both exposed and
trusted by GHC. This command functions in a very similar way
to the <a class="reference internal" href="#ghc-flag--package ⟨pkg⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-package</span> <span class="pre">⟨pkg⟩</span></code></a> command but in addition sets the selected
packages to be trusted by GHC, regardless of the contents of the
package database. (see <a class="reference internal" href="safe_haskell.html#safe-haskell"><span class="std std-ref">Safe Haskell</span></a>).</p>
</dd></dl>

<dl class="ghc-flag">
<dt>
<code class="descname">-distrust</code><code class="descclassname"> ⟨pkg⟩</code></dt>
<dd><p>This option causes the install package ⟨pkg⟩ to be both exposed and
distrusted by GHC. This command functions in a very similar way to the
<a class="reference internal" href="#ghc-flag--package ⟨pkg⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-package</span> <span class="pre">⟨pkg⟩</span></code></a> command but in addition sets the selected
packages to be distrusted by GHC, regardless of the contents of the package
database. (see <a class="reference internal" href="safe_haskell.html#safe-haskell"><span class="std std-ref">Safe Haskell</span></a>).</p>
</dd></dl>

<dl class="ghc-flag">
<dt>
<code class="descname">-distrust-all-packages</code></dt>
<dd><p>Ignore the trusted flag on installed packages, and distrust them by
default. If you use this flag and Safe Haskell then any packages you
require to be trusted (including <code class="docutils literal"><span class="pre">base</span></code>) need to be explicitly trusted
using <a class="reference internal" href="safe_haskell.html#ghc-flag--trust ⟨pkg⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-trust</span> <span class="pre">⟨pkg⟩</span></code></a> options. This option does not change the
exposed/hidden status of a package, so it isn’t equivalent to applying
<a class="reference internal" href="safe_haskell.html#ghc-flag--distrust ⟨pkg⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-distrust</span> <span class="pre">⟨pkg⟩</span></code></a> to all packages on the system. (see
<a class="reference internal" href="safe_haskell.html#safe-haskell"><span class="std std-ref">Safe Haskell</span></a>).</p>
</dd></dl>

</div>
<div class="section" id="the-main-package">
<span id="package-main"></span><h2>7.9.2. The <code class="docutils literal"><span class="pre">main</span></code> package<a class="headerlink" href="#the-main-package" title="Permalink to this headline">¶</a></h2>
<p>Every complete Haskell program must define <code class="docutils literal"><span class="pre">main</span></code> in module <code class="docutils literal"><span class="pre">Main</span></code> in
package <code class="docutils literal"><span class="pre">main</span></code>. Omitting the <a class="reference internal" href="#ghc-flag--this-unit-id ⟨unit-id⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-this-unit-id</span> <span class="pre">⟨unit-id⟩</span></code></a> flag
compiles code for package <code class="docutils literal"><span class="pre">main</span></code>. Failure to do so leads to a somewhat
obscure link-time error of the form:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>/usr/bin/ld: Undefined symbols:
_ZCMain_main_closure
</pre></div>
</div>
</div>
<div class="section" id="consequences-of-packages-for-the-haskell-language">
<span id="package-overlaps"></span><h2>7.9.3. Consequences of packages for the Haskell language<a class="headerlink" href="#consequences-of-packages-for-the-haskell-language" title="Permalink to this headline">¶</a></h2>
<p>It is possible that by using packages you might end up with a program
that contains two modules with the same name: perhaps you used a package
<code class="docutils literal"><span class="pre">P</span></code> that has a <em>hidden</em> module <code class="docutils literal"><span class="pre">M</span></code>, and there is also a module <code class="docutils literal"><span class="pre">M</span></code> in your
program. Or perhaps the dependencies of packages that you used contain
some overlapping modules. Perhaps the program even contains multiple
versions of a certain package, due to dependencies from other packages.</p>
<p>None of these scenarios gives rise to an error on its own <a class="footnote-reference" href="#id6" id="id3">[1]</a>, but they
may have some interesting consequences. For instance, if you have a type
<code class="docutils literal"><span class="pre">M.T</span></code> from version 1 of package <code class="docutils literal"><span class="pre">P</span></code>, then this is <em>not</em> the same as
the type <code class="docutils literal"><span class="pre">M.T</span></code> from version 2 of package <code class="docutils literal"><span class="pre">P</span></code>, and GHC will report an
error if you try to use one where the other is expected.</p>
<p>Formally speaking, in Haskell 98, an entity (function, type or class) in
a program is uniquely identified by the pair of the module name in which
it is defined and its name. In GHC, an entity is uniquely defined by a
triple: package, module, and name.</p>
</div>
<div class="section" id="thinning-and-renaming-modules">
<span id="package-thinning-and-renaming"></span><h2>7.9.4. Thinning and renaming modules<a class="headerlink" href="#thinning-and-renaming-modules" title="Permalink to this headline">¶</a></h2>
<p>When incorporating packages from multiple sources, you may end up in a
situation where multiple packages publish modules with the same name.
Previously, the only way to distinguish between these modules was to use
<a class="reference internal" href="glasgow_exts.html#package-qualified-imports"><span class="std std-ref">Package-qualified imports</span></a>. However, since GHC 7.10, the
<a class="reference internal" href="#ghc-flag--package ⟨pkg⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-package</span> <span class="pre">⟨pkg⟩</span></code></a> flags (and their variants) have been extended to
allow a user to explicitly control what modules a package brings into scope, by
analogy to the import lists that users can attach to module imports.</p>
<p>The basic syntax is that instead of specifying a package name P to the
package flag <code class="docutils literal"><span class="pre">-package</span></code>, instead we specify both a package name and a
parenthesized, comma-separated list of module names to import. For
example, <code class="docutils literal"><span class="pre">-package</span> <span class="pre">&quot;base</span> <span class="pre">(Data.List,</span> <span class="pre">Data.Bool)&quot;</span></code> makes only
<code class="docutils literal"><span class="pre">Data.List</span></code> and <code class="docutils literal"><span class="pre">Data.Bool</span></code> visible from package <code class="docutils literal"><span class="pre">base</span></code>. We also
support renaming of modules, in case you need to refer to both modules
simultaneously; this is supporting by writing
<code class="docutils literal"><span class="pre">OldModName</span> <span class="pre">as</span> <span class="pre">NewModName</span></code>, e.g.
<code class="docutils literal"><span class="pre">-package</span> <span class="pre">&quot;base</span> <span class="pre">(Data.Bool</span> <span class="pre">as</span> <span class="pre">Bool)</span></code>. You can also write
<code class="docutils literal"><span class="pre">-package</span> <span class="pre">&quot;base</span> <span class="pre">with</span> <span class="pre">(Data.Bool</span> <span class="pre">as</span> <span class="pre">Bool)</span></code> to include all of the
original bindings (e.g. the renaming is strictly additive). It’s
important to specify quotes so that your shell passes the package name
and thinning/renaming list as a single argument to GHC.</p>
<p>Package imports with thinning/renaming do not hide other versions of the
package: e.g. if containers-0.9 is already exposed,
<code class="docutils literal"><span class="pre">-package</span> <span class="pre">&quot;containers-0.8</span> <span class="pre">(Data.List</span> <span class="pre">as</span> <span class="pre">ListV8)&quot;</span></code> will only add an
additional binding to the environment. Similarly,
<code class="docutils literal"><span class="pre">-package</span> <span class="pre">&quot;base</span> <span class="pre">(Data.Bool</span> <span class="pre">as</span> <span class="pre">Bool)&quot;</span> <span class="pre">-package</span> <span class="pre">&quot;base</span> <span class="pre">(Data.List</span> <span class="pre">as</span> <span class="pre">List)&quot;</span></code>
is equivalent to
<code class="docutils literal"><span class="pre">-package</span> <span class="pre">&quot;base</span> <span class="pre">(Data.Bool</span> <span class="pre">as</span> <span class="pre">Bool,</span> <span class="pre">Data.List</span> <span class="pre">as</span> <span class="pre">List)&quot;</span></code>. Literal
names must refer to modules defined by the original package, so for
example <code class="docutils literal"><span class="pre">-package</span> <span class="pre">&quot;base</span> <span class="pre">(Data.Bool</span> <span class="pre">as</span> <span class="pre">Bool,</span> <span class="pre">Bool</span> <span class="pre">as</span> <span class="pre">Baz)&quot;</span></code> is invalid
unless there was a <code class="docutils literal"><span class="pre">Bool</span></code> module defined in the original package.
Hiding a package also clears all of its renamings.</p>
<p>You can use renaming to provide an alternate prelude, e.g.
<code class="docutils literal"><span class="pre">-hide-all-packages</span> <span class="pre">-package</span> <span class="pre">&quot;basic-prelude</span> <span class="pre">(BasicPrelude</span> <span class="pre">as</span> <span class="pre">Prelude)&quot;</span></code>,
in lieu of the <a class="reference internal" href="glasgow_exts.html#rebindable-syntax"><span class="std std-ref">Rebindable syntax and the implicit Prelude import</span></a> extension.</p>
</div>
<div class="section" id="package-databases">
<span id="id4"></span><h2>7.9.5. Package Databases<a class="headerlink" href="#package-databases" title="Permalink to this headline">¶</a></h2>
<p>A package database is where the details about installed packages are
stored. It is a directory, usually called <code class="docutils literal"><span class="pre">package.conf.d</span></code>, that
contains a file for each package, together with a binary cache of the
package data in the file <code class="file docutils literal"><span class="pre">package.cache</span></code>. Normally you won’t need to
look at or modify the contents of a package database directly; all
management of package databases can be done through the <strong class="command">ghc-pkg</strong> tool
(see <a class="reference internal" href="#package-management"><span class="std std-ref">Package management (the ghc-pkg command)</span></a>).</p>
<p>GHC knows about two package databases in particular:</p>
<ul class="simple">
<li>The <em>global package database</em>, which comes with your GHC installation,
e.g. <code class="docutils literal"><span class="pre">/usr/lib/ghc-6.12.1/package.conf.d</span></code>.</li>
<li>The <em>user package database</em> private to each user. On Unix systems this will
be <code class="docutils literal"><span class="pre">$HOME/.ghc/arch-os-version/package.conf.d</span></code>, and on Windows it will
be something like
<code class="docutils literal"><span class="pre">C:\Documents&nbsp;And&nbsp;Settings\user\ghc\package.conf.d</span></code>. The
<code class="docutils literal"><span class="pre">ghc-pkg</span></code> tool knows where this file should be located, and will
create it if it doesn’t exist (see <a class="reference internal" href="#package-management"><span class="std std-ref">Package management (the ghc-pkg command)</span></a>).</li>
</ul>
<p><em>Package database stack:</em> Package databases are arranged in a stack structure.
When GHC starts up it adds the global and the user package databases to the
stack, in that order, unless <span class="target" id="index-2"></span><a class="reference internal" href="#envvar-GHC_PACKAGE_PATH"><code class="xref std std-envvar docutils literal"><span class="pre">GHC_PACKAGE_PATH</span></code></a> is specified. When
<cite>GHC_PACKAGE_PATH</cite> is specified then it will determine the initial database
stack. Several command line options described below can further manipulate this
initial stack. You can see GHC’s effective package database stack by running
GHC with the <a class="reference internal" href="using.html#ghc-flag--v"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-v</span></code></a> flag.</p>
<p>This stack structure means that the order of <a class="reference internal" href="#ghc-flag--package-db ⟨file⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-package-db</span> <span class="pre">⟨file⟩</span></code></a>
flags or <span class="target" id="index-3"></span><a class="reference internal" href="#envvar-GHC_PACKAGE_PATH"><code class="xref std std-envvar docutils literal"><span class="pre">GHC_PACKAGE_PATH</span></code></a> is important.  Each substack of the stack
must be well formed (packages in databases on top of the stack can refer to
packages below, but not vice versa).</p>
<p><em>Package shadowing:</em> When multiple package databases are in use it
is possible, though rarely, that the same installed package id is present in
more than one database. In that case, packages closer to the top of the stack
will override (<em>shadow</em>) those below them. If the conflicting packages are
found to be equivalent (by ABI hash comparison) then one of them replaces all
references to the other, otherwise the overridden package and all those
depending on it will be removed.</p>
<p><em>Package version selection:</em> When selecting a package, GHC will search for
packages in all available databases. If multiple versions of the same package
are available the latest non-broken version will be chosen.</p>
<p><em>Version conflict resolution:</em> If multiple instances of a package version
chosen by GHC are available then GHC will choose an unspecified instance.</p>
<p>You can control GHC’s package database stack using the following
options:</p>
<dl class="ghc-flag">
<dt id="ghc-flag--package-db ⟨file⟩">
<code class="descname">-package-db</code><code class="descclassname"> ⟨file⟩</code><a class="headerlink" href="#ghc-flag--package-db ⟨file⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>Add the package database ⟨file⟩ on top of the current stack.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--no-global-package-db">
<code class="descname">-no-global-package-db</code><a class="headerlink" href="#ghc-flag--no-global-package-db" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove the global package database from the package database stack.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--no-user-package-db">
<code class="descname">-no-user-package-db</code><a class="headerlink" href="#ghc-flag--no-user-package-db" title="Permalink to this definition">¶</a></dt>
<dd><p>Prevent loading of the user’s local package database in the initial
stack.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--clear-package-db">
<code class="descname">-clear-package-db</code><a class="headerlink" href="#ghc-flag--clear-package-db" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset the current package database stack. This option removes every
previously specified package database (including those read from the
<span class="target" id="index-4"></span><a class="reference internal" href="#envvar-GHC_PACKAGE_PATH"><code class="xref std std-envvar docutils literal"><span class="pre">GHC_PACKAGE_PATH</span></code></a> environment variable) from the package database
stack.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--global-package-db">
<code class="descname">-global-package-db</code><a class="headerlink" href="#ghc-flag--global-package-db" title="Permalink to this definition">¶</a></dt>
<dd><p>Add the global package database on top of the current stack. This
option can be used after <a class="reference internal" href="#ghc-flag--no-global-package-db"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-no-global-package-db</span></code></a> to specify the
position in the stack where the global package database should be
loaded.</p>
</dd></dl>

<dl class="ghc-flag">
<dt id="ghc-flag--user-package-db">
<code class="descname">-user-package-db</code><a class="headerlink" href="#ghc-flag--user-package-db" title="Permalink to this definition">¶</a></dt>
<dd><p>Add the user’s package database on top of the current stack. This
option can be used after <a class="reference internal" href="#ghc-flag--no-user-package-db"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-no-user-package-db</span></code></a> to specify the
position in the stack where the user’s package database should be
loaded.</p>
</dd></dl>

<div class="section" id="the-ghc-package-path-environment-variable">
<span id="ghc-package-path"></span><h3>7.9.5.1. The <code class="docutils literal"><span class="pre">GHC_PACKAGE_PATH</span></code> environment variable<a class="headerlink" href="#the-ghc-package-path-environment-variable" title="Permalink to this headline">¶</a></h3>
<dl class="envvar">
<dt id="envvar-GHC_PACKAGE_PATH">
<code class="descname">GHC_PACKAGE_PATH</code><a class="headerlink" href="#envvar-GHC_PACKAGE_PATH" title="Permalink to this definition">¶</a></dt>
<dd><p>The <cite>GHC_PACKAGE_PATH</cite> environment variable may be set to a
<code class="docutils literal"><span class="pre">:</span></code>-separated (<code class="docutils literal"><span class="pre">;</span></code>-separated on Windows) list of files containing
package databases. This list of package databases, used by GHC and ghc-pkg,
specifies a stack of package databases from top to bottom. This order was
chosen to match the behaviour of the <span class="target" id="index-5"></span><code class="xref std std-envvar docutils literal"><span class="pre">PATH</span></code> environment variable
where entries earlier in the PATH override ones that come later. See
<a class="reference internal" href="#package-databases"><span class="std std-ref">Package Databases</span></a> for details on how the package database stack is
used.</p>
<p>Normally <cite>GHC_PACKAGE_PATH</cite> replaces the default package stack. For
example, all of the following commands are equivalent, creating a stack with
db1 at the top followed by db2 (use <code class="docutils literal"><span class="pre">;</span></code> instead of <code class="docutils literal"><span class="pre">:</span></code> on Windows):</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>$ ghc -clear-package-db -package-db db2.conf -package-db db1.conf
$ env GHC_PACKAGE_PATH=db1.conf:db2.conf ghc
$ env GHC_PACKAGE_PATH=db2.conf ghc -package-db db1.conf
</pre></div>
</div>
<p>However, if <cite>GHC_PACKAGE_PATH</cite> ends in a separator, the default databases
(i.e. the user and global package databases, in that order) are appended
to the path. For example, to augment the usual set of packages with a
database of your own, you could say (on Unix):</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>$ export GHC_PACKAGE_PATH=$HOME/.my-ghc-packages.conf:
</pre></div>
</div>
<p>To check whether your <cite>GHC_PACKAGE_PATH</cite> setting is doing the right
thing, <code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">list</span></code> will list all the databases in use, in the
reverse order they are searched.</p>
</dd></dl>

</div>
<div class="section" id="package-environments">
<span id="id5"></span><h3>7.9.5.2. Package environments<a class="headerlink" href="#package-environments" title="Permalink to this headline">¶</a></h3>
<p id="index-6">A <em>package environment file</em> is a file that tells <code class="docutils literal"><span class="pre">ghc</span></code> precisely which
packages should be visible. It can be used to create environments for <code class="docutils literal"><span class="pre">ghc</span></code>
or <code class="docutils literal"><span class="pre">ghci</span></code> that are local to a shell session or to some file system location.
They are intended to be managed by build/package tools, to enable <code class="docutils literal"><span class="pre">ghc</span></code> and
<code class="docutils literal"><span class="pre">ghci</span></code> to automatically use an environment created by the tool.</p>
<p>The file contains package IDs and optionally package databases, one directive
per line:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>clear-package-db
global-package-db
user-package-db
package-db db.d/
package-id id_1
package-id id_2
...
package-id id_n
</pre></div>
</div>
<p>If such a package environment is found, it is equivalent to passing these
command line arguments to <code class="docutils literal"><span class="pre">ghc</span></code>:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>-hide-all-packages
-clear-package-db
-global-package-db
-user-package-db
-package-db db.d/
-package-id id_1
-package-id id_2
...
-package-id id_n
</pre></div>
</div>
<p>Note the implicit <a class="reference internal" href="#ghc-flag--hide-all-packages"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-hide-all-packages</span></code></a> and the fact that it is
<a class="reference internal" href="#ghc-flag--package-id ⟨unit-id⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-package-id</span> <span class="pre">⟨unit-id⟩</span></code></a>, not <a class="reference internal" href="#ghc-flag--package ⟨pkg⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-package</span> <span class="pre">⟨pkg⟩</span></code></a>. This is
because the environment specifies precisely which packages should be visible.</p>
<p>Note that for the <code class="docutils literal"><span class="pre">package-db</span></code> directive, if a relative path is given it
must be relative to the location of the package environment file.</p>
<dl class="ghc-flag">
<dt id="ghc-flag--package-env ⟨file⟩|⟨name⟩">
<code class="descname">-package-env</code><code class="descclassname"> ⟨file⟩|⟨name⟩</code><a class="headerlink" href="#ghc-flag--package-env ⟨file⟩|⟨name⟩" title="Permalink to this definition">¶</a></dt>
<dd><p>Use the package environment in ⟨file⟩, or in
<code class="docutils literal"><span class="pre">$HOME/.ghc/arch-os-version/environments/⟨name⟩</span></code></p>
</dd></dl>

<p>In order, <code class="docutils literal"><span class="pre">ghc</span></code> will look for the package environment in the following
locations:</p>
<ul class="simple">
<li>File ⟨file⟩ if you pass the option <a class="reference internal" href="#ghc-flag--package-env ⟨file⟩|⟨name⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-package-env</span> <span class="pre">⟨file⟩|⟨name⟩</span></code></a>.</li>
<li>File <code class="docutils literal"><span class="pre">$HOME/.ghc/arch-os-version/environments/name</span></code> if you pass the
option <code class="docutils literal"><span class="pre">-package-env</span> <span class="pre">⟨name⟩</span></code>.</li>
<li>File ⟨file⟩ if the environment variable <code class="docutils literal"><span class="pre">GHC_ENVIRONMENT</span></code> is set to
⟨file⟩.</li>
<li>File <code class="docutils literal"><span class="pre">$HOME/.ghc/arch-os-version/environments/name</span></code> if the
environment variable <code class="docutils literal"><span class="pre">GHC_ENVIRONMENT</span></code> is set to ⟨name⟩.</li>
</ul>
<p>Additionally, unless <code class="docutils literal"><span class="pre">-hide-all-packages</span></code> is specified <code class="docutils literal"><span class="pre">ghc</span></code> will also
look for the package environment in the following locations:</p>
<ul class="simple">
<li>File <code class="docutils literal"><span class="pre">.ghc.environment.arch-os-version</span></code> if it exists in the current
directory or any parent directory (but not the user’s home directory).</li>
<li>File <code class="docutils literal"><span class="pre">$HOME/.ghc/arch-os-version/environments/default</span></code> if it
exists.</li>
</ul>
<p>Package environments can be modified by further command line arguments;
for example, if you specify <code class="docutils literal"><span class="pre">-package</span> <span class="pre">foo</span></code> on the command line, then
package ⟨foo⟩ will be visible even if it’s not listed in the currently
active package environment.</p>
</div>
</div>
<div class="section" id="installed-package-ids-dependencies-and-broken-packages">
<span id="package-ids"></span><h2>7.9.6. Installed package IDs, dependencies, and broken packages<a class="headerlink" href="#installed-package-ids-dependencies-and-broken-packages" title="Permalink to this headline">¶</a></h2>
<p>Each installed package has a unique identifier (the “installed package
ID”), which distinguishes it from all other installed packages on the
system. To see the installed package IDs associated with each installed
package, use <code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">list</span> <span class="pre">-v</span></code>:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>$ ghc-pkg list -v
using cache: /usr/lib/ghc-6.12.1/package.conf.d/package.cache
/usr/lib/ghc-6.12.1/package.conf.d
   Cabal-1.7.4 (Cabal-1.7.4-48f5247e06853af93593883240e11238)
   array-0.2.0.1 (array-0.2.0.1-9cbf76a576b6ee9c1f880cf171a0928d)
   base-3.0.3.0 (base-3.0.3.0-6cbb157b9ae852096266e113b8fac4a2)
   base-4.2.0.0 (base-4.2.0.0-247bb20cde37c3ef4093ee124e04bc1c)
   ...
</pre></div>
</div>
<p>The string in parentheses after the package name is the installed
package ID: it normally begins with the package name and version, and
ends in a hash string derived from the compiled package. Dependencies
between packages are expressed in terms of installed package IDs, rather
than just packages and versions. For example, take a look at the
dependencies of the <code class="docutils literal"><span class="pre">haskell98</span></code> package:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>$ ghc-pkg field haskell98 depends
depends: array-0.2.0.1-9cbf76a576b6ee9c1f880cf171a0928d
         base-4.2.0.0-247bb20cde37c3ef4093ee124e04bc1c
         directory-1.0.0.2-f51711bc872c35ce4a453aa19c799008
         old-locale-1.0.0.1-d17c9777c8ee53a0d459734e27f2b8e9
         old-time-1.0.0.1-1c0d8ea38056e5087ef1e75cb0d139d1
         process-1.0.1.1-d8fc6d3baf44678a29b9d59ca0ad5780
         random-1.0.0.1-423d08c90f004795fd10e60384ce6561
</pre></div>
</div>
<p>The purpose of the installed package ID is to detect problems caused by
re-installing a package without also recompiling the packages that
depend on it. Recompiling dependencies is necessary, because the newly
compiled package may have a different ABI (Application Binary Interface)
than the previous version, even if both packages were built from the
same source code using the same compiler. With installed package IDs, a
recompiled package will have a different installed package ID from the
previous version, so packages that depended on the previous version are
now orphaned - one of their dependencies is not satisfied. Packages that
are broken in this way are shown in the <code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">list</span></code> output either
in red (if possible) or otherwise surrounded by braces. In the following
example, we have recompiled and reinstalled the <code class="docutils literal"><span class="pre">filepath</span></code> package,
and this has caused various dependencies including <code class="docutils literal"><span class="pre">Cabal</span></code> to break:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>$ ghc-pkg list
WARNING: there are broken packages.  Run &#39;ghc-pkg check&#39; for more details.
/usr/lib/ghc-6.12.1/package.conf.d:
    {Cabal-1.7.4}
    array-0.2.0.1
    base-3.0.3.0
    ... etc ...
</pre></div>
</div>
<p>Additionally, <code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">list</span></code> reminds you that there are broken
packages and suggests <code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">check</span></code>, which displays more information
about the nature of the failure:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>$ ghc-pkg check
There are problems in package ghc-6.12.1:
  dependency &quot;filepath-1.1.0.1-87511764eb0af2bce4db05e702750e63&quot; doesn&#39;t exist
There are problems in package haskeline-0.6.2:
  dependency &quot;filepath-1.1.0.1-87511764eb0af2bce4db05e702750e63&quot; doesn&#39;t exist
There are problems in package Cabal-1.7.4:
  dependency &quot;filepath-1.1.0.1-87511764eb0af2bce4db05e702750e63&quot; doesn&#39;t exist
There are problems in package process-1.0.1.1:
  dependency &quot;filepath-1.1.0.1-87511764eb0af2bce4db05e702750e63&quot; doesn&#39;t exist
There are problems in package directory-1.0.0.2:
  dependency &quot;filepath-1.1.0.1-87511764eb0af2bce4db05e702750e63&quot; doesn&#39;t exist

The following packages are broken, either because they have a problem
listed above, or because they depend on a broken package.
ghc-6.12.1
haskeline-0.6.2
Cabal-1.7.4
process-1.0.1.1
directory-1.0.0.2
bin-package-db-0.0.0.0
hpc-0.5.0.2
haskell98-1.0.1.0
</pre></div>
</div>
<p>To fix the problem, you need to recompile the broken packages against
the new dependencies. The easiest way to do this is to use
<code class="docutils literal"><span class="pre">cabal-install</span></code>, or download the packages from
<a class="reference external" href="http://hackage.haskell.org/packages/hackage.html">HackageDB</a> and
build and install them as normal.</p>
<p>Be careful not to recompile any packages that GHC itself depends on, as
this may render the <code class="docutils literal"><span class="pre">ghc</span></code> package itself broken, and <code class="docutils literal"><span class="pre">ghc</span></code> cannot be
simply recompiled. The only way to recover from this would be to
re-install GHC.</p>
</div>
<div class="section" id="package-management-the-ghc-pkg-command">
<span id="package-management"></span><h2>7.9.7. Package management (the <code class="docutils literal"><span class="pre">ghc-pkg</span></code> command)<a class="headerlink" href="#package-management-the-ghc-pkg-command" title="Permalink to this headline">¶</a></h2>
<p id="index-7">The <strong class="command">ghc-pkg</strong> tool is for querying and modifying package databases. To
see what package databases are in use, use <code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">list</span></code>. The stack of
databases that <strong class="command">ghc-pkg</strong> knows about can be modified using the
<span class="target" id="index-8"></span><a class="reference internal" href="#envvar-GHC_PACKAGE_PATH"><code class="xref std std-envvar docutils literal"><span class="pre">GHC_PACKAGE_PATH</span></code></a> environment variable (see <a class="reference internal" href="#ghc-package-path"><span class="std std-ref">The GHC_PACKAGE_PATH environment variable</span></a>,
and using <a class="reference internal" href="#ghc-flag--package-db ⟨file⟩"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-package-db</span> <span class="pre">⟨file⟩</span></code></a> options on the <strong class="command">ghc-pkg</strong>
command line.</p>
<p>When asked to modify a database, <code class="docutils literal"><span class="pre">ghc-pkg</span></code> modifies the global
database by default. Specifying <code class="docutils literal"><span class="pre">--user</span></code> causes it to act on the user
database, or <code class="docutils literal"><span class="pre">--package-db</span></code> can be used to act on another database
entirely. When multiple of these options are given, the rightmost one is
used as the database to act upon.</p>
<p>Commands that query the package database (list, latest, describe, field,
dot) operate on the list of databases specified by the flags <code class="docutils literal"><span class="pre">--user</span></code>,
<code class="docutils literal"><span class="pre">--global</span></code>, and <code class="docutils literal"><span class="pre">--package-db</span></code>. If none of these flags are given,
the default is <code class="docutils literal"><span class="pre">--global</span> <span class="pre">--user</span></code>.</p>
<p>If the environment variable <span class="target" id="index-9"></span><a class="reference internal" href="#envvar-GHC_PACKAGE_PATH"><code class="xref std std-envvar docutils literal"><span class="pre">GHC_PACKAGE_PATH</span></code></a> is set, and its value
does not end in a separator (<code class="docutils literal"><span class="pre">:</span></code> on Unix, <code class="docutils literal"><span class="pre">;</span></code> on Windows), then the
last database is considered to be the global database, and will be
modified by default by <code class="docutils literal"><span class="pre">ghc-pkg</span></code>. The intention here is that
<code class="docutils literal"><span class="pre">GHC_PACKAGE_PATH</span></code> can be used to create a virtual package environment
into which Cabal packages can be installed without setting anything
other than <code class="docutils literal"><span class="pre">GHC_PACKAGE_PATH</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">ghc-pkg</span></code> program may be run in the ways listed below. Where a
package name is required, the package can be named in full including the
version number (e.g. <code class="docutils literal"><span class="pre">network-1.0</span></code>), or without the version number.
Naming a package without the version number matches all versions of the
package; the specified action will be applied to all the matching
packages. A package specifier that matches all version of the package
can also be written <code class="docutils literal"><span class="pre">⟨pkg⟩</span> <span class="pre">-*</span></code>, to make it clearer that multiple
packages are being matched. To match against the installed package ID
instead of just package name and version, pass the <code class="docutils literal"><span class="pre">--ipid</span></code> flag.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">init</span> <span class="pre">path</span></code></dt>
<dd>Creates a new, empty, package database at ⟨path⟩, which must not
already exist.</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">register</span> <span class="pre">⟨file⟩</span></code></dt>
<dd><p class="first">Reads a package specification from ⟨file⟩ (which may be “<code class="docutils literal"><span class="pre">-</span></code>”
to indicate standard input), and adds it to the database of
installed packages. The syntax of ⟨file⟩ is given in
<a class="reference internal" href="#installed-pkg-info"><span class="std std-ref">InstalledPackageInfo: a package specification</span></a>.</p>
<p class="last">The package specification must be a package that isn’t already
installed.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">update</span> <span class="pre">⟨file⟩</span></code></dt>
<dd>The same as <code class="docutils literal"><span class="pre">register</span></code>, except that if a package of the same name
is already installed, it is replaced by the new one.</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">unregister</span> <span class="pre">⟨P⟩</span></code></dt>
<dd>Remove the specified package from the database.</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">check</span></code></dt>
<dd>Check consistency of dependencies in the package database, and
report packages that have missing dependencies.</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">expose</span> <span class="pre">⟨P⟩</span></code></dt>
<dd>Sets the <code class="docutils literal"><span class="pre">exposed</span></code> flag for package ⟨P⟩ to <code class="docutils literal"><span class="pre">True</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">hide</span> <span class="pre">⟨P⟩</span></code></dt>
<dd>Sets the <code class="docutils literal"><span class="pre">exposed</span></code> flag for package ⟨P⟩ to <code class="docutils literal"><span class="pre">False</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">trust</span> <span class="pre">⟨P⟩</span></code></dt>
<dd>Sets the <code class="docutils literal"><span class="pre">trusted</span></code> flag for package ⟨P⟩ to <code class="docutils literal"><span class="pre">True</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">distrust</span> <span class="pre">⟨P⟩</span></code></dt>
<dd>Sets the <code class="docutils literal"><span class="pre">trusted</span></code> flag for package ⟨P⟩ to <code class="docutils literal"><span class="pre">False</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">list</span> <span class="pre">[⟨P⟩]</span> <span class="pre">[--simple-output]</span></code></dt>
<dd><p class="first">This option displays the currently installed packages, for each of
the databases known to <code class="docutils literal"><span class="pre">ghc-pkg</span></code>. That includes the global
database, the user’s local database, and any further files specified
using the <code class="docutils literal"><span class="pre">-f</span></code> option on the command line.</p>
<p>Hidden packages (those for which the <code class="docutils literal"><span class="pre">exposed</span></code> flag is <code class="docutils literal"><span class="pre">False</span></code>)
are shown in parentheses in the list of packages.</p>
<p>If an optional package identifier ⟨P⟩ is given, then only packages
matching that identifier are shown.</p>
<p class="last">If the option <code class="docutils literal"><span class="pre">--simple-output</span></code> is given, then the packages are
listed on a single line separated by spaces, and the database names
are not included. This is intended to make it easier to parse the
output of <code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">list</span></code> using a script.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">find-module</span> <span class="pre">⟨M⟩</span> <span class="pre">[--simple-output]</span></code></dt>
<dd><p class="first">This option lists registered packages exposing module ⟨M⟩. Examples:</p>
<div class="highlight-haskell"><div class="highlight"><pre><span></span><span class="o">$</span> <span class="n">ghc</span><span class="o">-</span><span class="n">pkg</span> <span class="n">find</span><span class="o">-</span><span class="kr">module</span> <span class="nn">Var</span>
<span class="nf">c</span><span class="kt">:/</span><span class="n">fptools</span><span class="o">/</span><span class="n">validate</span><span class="o">/</span><span class="n">ghc</span><span class="o">/</span><span class="n">driver</span><span class="o">/</span><span class="n">package</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">inplace</span><span class="kt">:</span>
    <span class="p">(</span><span class="n">ghc</span><span class="o">-</span><span class="mf">6.9</span><span class="o">.</span><span class="mi">20080428</span><span class="p">)</span>

<span class="o">$</span> <span class="n">ghc</span><span class="o">-</span><span class="n">pkg</span> <span class="n">find</span><span class="o">-</span><span class="kr">module</span> <span class="nn">Data.Sequence</span>
<span class="nf">c</span><span class="kt">:/</span><span class="n">fptools</span><span class="o">/</span><span class="n">validate</span><span class="o">/</span><span class="n">ghc</span><span class="o">/</span><span class="n">driver</span><span class="o">/</span><span class="n">package</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">inplace</span><span class="kt">:</span>
    <span class="n">containers</span><span class="o">-</span><span class="mf">0.1</span>
</pre></div>
</div>
<p class="last">Otherwise, it behaves like <code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">list</span></code>, including options.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">latest</span> <span class="pre">⟨P⟩</span></code></dt>
<dd>Prints the latest available version of package ⟨P⟩.</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">describe</span> <span class="pre">⟨P⟩</span></code></dt>
<dd><p class="first">Emit the full description of the specified package. The description
is in the form of an <code class="docutils literal"><span class="pre">InstalledPackageInfo</span></code>, the same as the input
file format for <code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">register</span></code>. See <a class="reference internal" href="#installed-pkg-info"><span class="std std-ref">InstalledPackageInfo: a package specification</span></a>
for details.</p>
<p class="last">If the pattern matches multiple packages, the description for each
package is emitted, separated by the string <code class="docutils literal"><span class="pre">---</span></code> on a line by
itself.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">field</span> <span class="pre">⟨P⟩</span> <span class="pre">⟨field⟩[,⟨field⟩]*</span></code></dt>
<dd>Show just a single field of the installed package description for
<code class="docutils literal"><span class="pre">P</span></code>. Multiple fields can be selected by separating them with
commas</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">dot</span></code></dt>
<dd><p class="first">Generate a graph of the package dependencies in a form suitable for
input for the <a class="reference external" href="http://www.graphviz.org/">graphviz</a> tools. For
example, to generate a PDF of the dependency graph:</p>
<div class="last highlight-haskell"><div class="highlight"><pre><span></span><span class="nf">ghc</span><span class="o">-</span><span class="n">pkg</span> <span class="n">dot</span> <span class="o">|</span> <span class="n">tred</span> <span class="o">|</span> <span class="n">dot</span> <span class="o">-</span><span class="kt">Tpdf</span> <span class="o">&gt;</span><span class="n">pkgs</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">dump</span></code></dt>
<dd><p class="first">Emit the full description of every package, in the form of an
<code class="docutils literal"><span class="pre">InstalledPackageInfo</span></code>. Multiple package descriptions are
separated by the string <code class="docutils literal"><span class="pre">---</span></code> on a line by itself.</p>
<p class="last">This is almost the same as <code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">describe</span> <span class="pre">'*'</span></code>, except that
<code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">dump</span></code> is intended for use by tools that parse the
results, so for example where <code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">describe</span> <span class="pre">'*'</span></code> will emit an
error if it can’t find any packages that match the pattern,
<code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">dump</span></code> will simply emit nothing.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">recache</span></code></dt>
<dd><p class="first">Re-creates the binary cache file <code class="docutils literal"><span class="pre">package.cache</span></code> for the selected
database. This may be necessary if the cache has somehow become
out-of-sync with the contents of the database (<code class="docutils literal"><span class="pre">ghc-pkg</span></code> will warn
you if this might be the case).</p>
<p class="last">The other time when <code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">recache</span></code> is useful is for registering
packages manually: it is possible to register a package by simply
putting the appropriate file in the package database directory and
invoking <code class="docutils literal"><span class="pre">ghc-pkg</span> <span class="pre">recache</span></code> to update the cache. This method of
registering packages may be more convenient for automated packaging
systems.</p>
</dd>
</dl>
<p>Substring matching is supported for ⟨M⟩ in <code class="docutils literal"><span class="pre">find-module</span></code> and for ⟨P⟩
in <code class="docutils literal"><span class="pre">list</span></code>, <code class="docutils literal"><span class="pre">describe</span></code>, and <code class="docutils literal"><span class="pre">field</span></code>, where a <code class="docutils literal"><span class="pre">'*'</span></code> indicates open
substring ends (<code class="docutils literal"><span class="pre">prefix*</span></code>, <code class="docutils literal"><span class="pre">*suffix</span></code>, <code class="docutils literal"><span class="pre">*infix*</span></code>). Examples (output
omitted):</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>-- list all regex-related packages
ghc-pkg list &#39;*regex*&#39; --ignore-case
-- list all string-related packages
ghc-pkg list &#39;*string*&#39; --ignore-case
-- list OpenGL-related packages
ghc-pkg list &#39;*gl*&#39; --ignore-case
-- list packages exporting modules in the Data hierarchy
ghc-pkg find-module &#39;Data.*&#39;
-- list packages exporting Monad modules
ghc-pkg find-module &#39;*Monad*&#39;
-- list names and maintainers for all packages
ghc-pkg field &#39;*&#39; name,maintainer
-- list location of haddock htmls for all packages
ghc-pkg field &#39;*&#39; haddock-html
-- dump the whole database
ghc-pkg describe &#39;*&#39;
</pre></div>
</div>
<p>Additionally, the following flags are accepted by <code class="docutils literal"><span class="pre">ghc-pkg</span></code>:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">-f</span> <span class="pre">⟨file⟩</span></code>, <code class="docutils literal"><span class="pre">-package-db</span> <span class="pre">⟨file⟩</span></code></dt>
<dd><p class="first last" id="index-10">Adds ⟨file⟩ to the stack of package databases. Additionally, ⟨file⟩
will also be the database modified by a <code class="docutils literal"><span class="pre">register</span></code>,
<code class="docutils literal"><span class="pre">unregister</span></code>, <code class="docutils literal"><span class="pre">expose</span></code> or <code class="docutils literal"><span class="pre">hide</span></code> command, unless it is
overridden by a later <code class="docutils literal"><span class="pre">--package-db</span></code>, <code class="docutils literal"><span class="pre">--user</span></code> or <code class="docutils literal"><span class="pre">--global</span></code>
option.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">--force</span></code></dt>
<dd><p class="first last" id="index-11">Causes <code class="docutils literal"><span class="pre">ghc-pkg</span></code> to ignore missing dependencies, directories and
libraries when registering a package, and just go ahead and add it
anyway. This might be useful if your package installation system
needs to add the package to GHC before building and installing the
files.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">--global</span></code></dt>
<dd><p class="first last" id="index-12">Operate on the global package database (this is the default). This
flag affects the <code class="docutils literal"><span class="pre">register</span></code>, <code class="docutils literal"><span class="pre">update</span></code>, <code class="docutils literal"><span class="pre">unregister</span></code>,
<code class="docutils literal"><span class="pre">expose</span></code>, and <code class="docutils literal"><span class="pre">hide</span></code> commands.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">--help</span></code>, <code class="docutils literal"><span class="pre">-?</span></code></dt>
<dd><p class="first last" id="index-13">Outputs the command-line syntax.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">--user</span></code></dt>
<dd><p class="first last" id="index-14">Operate on the current user’s local package database. This flag
affects the <code class="docutils literal"><span class="pre">register</span></code>, <code class="docutils literal"><span class="pre">update</span></code>, <code class="docutils literal"><span class="pre">unregister</span></code>, <code class="docutils literal"><span class="pre">expose</span></code>,
and <code class="docutils literal"><span class="pre">hide</span></code> commands.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">-v</span> <span class="pre">[⟨n⟩]</span></code>, <code class="docutils literal"><span class="pre">--verbose</span> <span class="pre">[=⟨n⟩]</span></code></dt>
<dd><p class="first last" id="index-15">Control verbosity. Verbosity levels range from 0-2, where the
default is 1, and <code class="docutils literal"><span class="pre">-v</span></code> alone selects level 2.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">-V</span></code>; <code class="docutils literal"><span class="pre">--version</span></code></dt>
<dd><p class="first last" id="index-16">Output the <code class="docutils literal"><span class="pre">ghc-pkg</span></code> version number.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">--ipid</span></code></dt>
<dd><p class="first last" id="index-17">Causes <code class="docutils literal"><span class="pre">ghc-pkg</span></code> to interpret arguments as installed package IDs
(e.g., an identifier like
<code class="docutils literal"><span class="pre">unix-2.3.1.0-de7803f1a8cd88d2161b29b083c94240</span></code>). This is useful
if providing just the package name and version are ambiguous (in old
versions of GHC, this was guaranteed to be unique, but this
invariant no longer necessarily holds).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">--package-key</span></code></dt>
<dd><p class="first last" id="index-18">Causes <code class="docutils literal"><span class="pre">ghc-pkg</span></code> to interpret arguments as unit IDs (e.g., an
identifier like <code class="docutils literal"><span class="pre">I5BErHzyOm07EBNpKBEeUv</span></code>). Package keys are used
to prefix symbol names GHC produces (e.g.,
<code class="docutils literal"><span class="pre">6VWy06pWzzJq9evDvK2d4w6_DataziByteStringziInternal_unsafePackLenChars_info</span></code>),
so if you need to figure out what package a symbol belongs to, use
<code class="docutils literal"><span class="pre">ghc-pkg</span></code> with this flag.</p>
</dd>
</dl>
</div>
<div class="section" id="building-a-package-from-haskell-source">
<span id="building-packages"></span><h2>7.9.8. Building a package from Haskell source<a class="headerlink" href="#building-a-package-from-haskell-source" title="Permalink to this headline">¶</a></h2>
<p id="index-19">We don’t recommend building packages the hard way. Instead, use the
<a class="reference external" href="http://www.haskell.org/cabal/users-guide/">Cabal</a> infrastructure if
possible. If your package is particularly complicated or requires a lot
of configuration, then you might have to fall back to the low-level
mechanisms, so a few hints for those brave souls follow.</p>
<p>You need to build an “installed package info” file for passing to
<code class="docutils literal"><span class="pre">ghc-pkg</span></code> when installing your package. The contents of this file are
described in <a class="reference internal" href="#installed-pkg-info"><span class="std std-ref">InstalledPackageInfo: a package specification</span></a>.</p>
<p>The Haskell code in a package may be built into one or more archive
libraries (e.g. <code class="docutils literal"><span class="pre">libHSfoo.a</span></code>), or a single shared object (e.g.
<code class="docutils literal"><span class="pre">libHSfoo.dll/.so/.dylib</span></code>). The restriction to a single shared object
is because the package system is used to tell the compiler when it
should make an inter-shared-object call rather than an
intra-shared-object-call call (inter-shared-object calls require an
extra indirection).</p>
<ul>
<li><p class="first">Building a static library is done by using the <strong class="command">ar</strong> tool, like so:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>ar cqs libHSfoo-1.0.a A.o B.o C.o ...
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">A.o</span></code>, <code class="docutils literal"><span class="pre">B.o</span></code> and so on are the compiled Haskell modules,
and <code class="docutils literal"><span class="pre">libHSfoo.a</span></code> is the library you wish to create. The syntax may
differ slightly on your system, so check the documentation if you run
into difficulties.</p>
</li>
<li><p class="first">To load a package <code class="docutils literal"><span class="pre">foo</span></code>, GHCi can load its <code class="docutils literal"><span class="pre">libHSfoo.a</span></code> library
directly, but it can also load a package in the form of a single
<code class="docutils literal"><span class="pre">HSfoo.o</span></code> file that has been pre-linked. Loading the <code class="docutils literal"><span class="pre">.o</span></code> file is
slightly quicker, but at the expense of having another copy of the
compiled package. The rule of thumb is that if the modules of the
package were compiled with <a class="reference internal" href="phases.html#ghc-flag--split-objs"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-split-objs</span></code></a> then building the
<code class="docutils literal"><span class="pre">HSfoo.o</span></code> is worthwhile because it saves time when loading the
package into GHCi. Without <a class="reference internal" href="phases.html#ghc-flag--split-objs"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-split-objs</span></code></a>, there is not much
difference in load time between the <code class="docutils literal"><span class="pre">.o</span></code> and <code class="docutils literal"><span class="pre">.a</span></code> libraries, so
it is better to save the disk space and only keep the <code class="docutils literal"><span class="pre">.a</span></code> around.
In a GHC distribution we provide <code class="docutils literal"><span class="pre">.o</span></code> files for most packages
except the GHC package itself.</p>
<p>The <code class="docutils literal"><span class="pre">HSfoo.o</span></code> file is built by Cabal automatically; use
<code class="docutils literal"><span class="pre">--disable-library-for-ghci</span></code> to disable it. To build one manually,
the following GNU <code class="docutils literal"><span class="pre">ld</span></code> command can be used:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>ld -r --whole-archive -o HSfoo.o libHSfoo.a
</pre></div>
</div>
<p>(replace <code class="docutils literal"><span class="pre">--whole-archive</span></code> with <code class="docutils literal"><span class="pre">-all_load</span></code> on MacOS X)</p>
</li>
<li><p class="first">When building the package as shared library, GHC can be used to
perform the link step. This hides some of the details out the
underlying linker and provides a common interface to all shared
object variants that are supported by GHC (DLLs, ELF DSOs, and Mac OS
dylibs). The shared object must be named in specific way for two
reasons: (1) the name must contain the GHC compiler version, so that
two library variants don’t collide that are compiled by different
versions of GHC and that therefore are most likely incompatible with
respect to calling conventions, (2) it must be different from the
static name otherwise we would not be able to control the linker as
precisely as necessary to make the <a class="reference internal" href="phases.html#ghc-flag--static"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-static</span></code></a>/<a class="reference internal" href="phases.html#ghc-flag--dynamic"><code class="xref std std-ghc-flag docutils literal"><span class="pre">-dynamic</span></code></a>
flags work, see <a class="reference internal" href="phases.html#options-linker"><span class="std std-ref">Options affecting linking</span></a>.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>ghc -shared libHSfoo-1.0-ghcGHCVersion.so A.o B.o C.o
</pre></div>
</div>
<p>Using GHC’s version number in the shared object name allows different
library versions compiled by different GHC versions to be installed
in standard system locations, e.g. under *nix <code class="docutils literal"><span class="pre">/usr/lib</span></code>. To obtain
the version number of GHC invoke <code class="docutils literal"><span class="pre">ghc</span> <span class="pre">--numeric-version</span></code> and use
its output in place of ⟨GHCVersion⟩. See also <a class="reference internal" href="phases.html#options-codegen"><span class="std std-ref">Options affecting code generation</span></a>
on how object files must be prepared for shared object linking.</p>
</li>
</ul>
<p>To compile a module which is to be part of a new package, use the
<code class="docutils literal"><span class="pre">-package-name</span></code> (to identify the name of the package) and
<code class="docutils literal"><span class="pre">-library-name</span></code> (to identify the version and the version hashes of its
identities.) options (<a class="reference internal" href="#using-packages"><span class="std std-ref">Using Packages</span></a>). Failure to use these
options when compiling a package will probably result in disaster, but
you will only discover later when you attempt to import modules from the
package. At this point GHC will complain that the package name it was
expecting the module to come from is not the same as the package name
stored in the <code class="docutils literal"><span class="pre">.hi</span></code> file.</p>
<p>It is worth noting with shared objects, when each package is built as a
single shared object file, since a reference to a shared object costs an
extra indirection, intra-package references are cheaper than
inter-package references. Of course, this applies to the <code class="docutils literal"><span class="pre">main</span></code>
package as well.</p>
</div>
<div class="section" id="installedpackageinfo-a-package-specification">
<span id="installed-pkg-info"></span><h2>7.9.9. <code class="docutils literal"><span class="pre">InstalledPackageInfo</span></code>: a package specification<a class="headerlink" href="#installedpackageinfo-a-package-specification" title="Permalink to this headline">¶</a></h2>
<p>A package specification is a Haskell record; in particular, it is the
record <a class="reference external" href="../libraries/Cabal-2.2.0.0/Distribution-InstalledPackageInfo.html#t:InstalledPackageInfo">Distribution.InstalledPackageInfo.InstalledPackageInfo</a>
in the module Distribution.InstalledPackageInfo, which is part of the
Cabal package distributed with GHC.</p>
<p>An <code class="docutils literal"><span class="pre">InstalledPackageInfo</span></code> has a human readable/writable syntax. The
functions <code class="docutils literal"><span class="pre">parseInstalledPackageInfo</span></code> and <code class="docutils literal"><span class="pre">showInstalledPackageInfo</span></code>
read and write this syntax respectively. Here’s an example of the
<code class="docutils literal"><span class="pre">InstalledPackageInfo</span></code> for the <code class="docutils literal"><span class="pre">unix</span></code> package:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>$ ghc-pkg describe unix
name: unix
version: 2.3.1.0
id: unix-2.3.1.0-de7803f1a8cd88d2161b29b083c94240
license: BSD3
copyright:
maintainer: libraries@haskell.org
stability:
homepage:
package-url:
description: This package gives you access to the set of operating system
             services standardised by POSIX 1003.1b (or the IEEE Portable
             Operating System Interface for Computing Environments -
             IEEE Std. 1003.1).
             .
             The package is not supported under Windows (except under Cygwin).
category: System
author:
exposed: True
exposed-modules: System.Posix System.Posix.DynamicLinker.Module
                 System.Posix.DynamicLinker.Prim System.Posix.Directory
                 System.Posix.DynamicLinker System.Posix.Env System.Posix.Error
                 System.Posix.Files System.Posix.IO System.Posix.Process
                 System.Posix.Process.Internals System.Posix.Resource
                 System.Posix.Temp System.Posix.Terminal System.Posix.Time
                 System.Posix.Unistd System.Posix.User System.Posix.Signals
                 System.Posix.Signals.Exts System.Posix.Semaphore
                 System.Posix.SharedMem
hidden-modules:
trusted: False
import-dirs: /usr/lib/ghc-6.12.1/unix-2.3.1.0
library-dirs: /usr/lib/ghc-6.12.1/unix-2.3.1.0
hs-libraries: HSunix-2.3.1.0
extra-libraries: rt util dl
extra-ghci-libraries:
include-dirs: /usr/lib/ghc-6.12.1/unix-2.3.1.0/include
includes: HsUnix.h execvpe.h
depends: base-4.2.0.0-247bb20cde37c3ef4093ee124e04bc1c
hugs-options:
cc-options:
ld-options:
framework-dirs:
frameworks:
haddock-interfaces: /usr/share/doc/ghc/html/libraries/unix/unix.haddock
haddock-html: /usr/share/doc/ghc/html/libraries/unix
</pre></div>
</div>
<p>Here is a brief description of the syntax of this file:</p>
<p>A package description consists of a number of field/value pairs. A field
starts with the field name in the left-hand column followed by a
“<code class="docutils literal"><span class="pre">:</span></code>”, and the value continues until the next line that begins in
the left-hand column, or the end of file.</p>
<p>The syntax of the value depends on the field. The various field types
are:</p>
<dl class="docutils">
<dt>freeform</dt>
<dd>Any arbitrary string, no interpretation or parsing is done.</dd>
<dt>string</dt>
<dd>A sequence of non-space characters, or a sequence of arbitrary
characters surrounded by quotes <code class="docutils literal"><span class="pre">&quot;....&quot;</span></code>.</dd>
<dt>string list</dt>
<dd>A sequence of strings, separated by commas. The sequence may be
empty.</dd>
</dl>
<p>In addition, there are some fields with special syntax (e.g. package
names, version, dependencies).</p>
<p>The allowed fields, with their types, are:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">name</span></code></dt>
<dd><p class="first last" id="index-20">(string) The package’s name (without the version).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">id</span></code></dt>
<dd><p class="first last" id="index-21">(string) The installed package ID. It is up to you to choose a suitable one.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">version</span></code></dt>
<dd><p class="first last" id="index-22">(string) The package’s version, usually in the form <code class="docutils literal"><span class="pre">A.B</span></code> (any number of
components are allowed).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">license</span></code></dt>
<dd><p class="first last" id="index-23">(string) The type of license under which this package is
distributed. This field is a value of the
<a class="reference external" href="../libraries/Cabal-2.2.0.0/Distribution-License.html#t:License">Distribution.License.License</a> type.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">license-file</span></code></dt>
<dd><p class="first last" id="index-24">(optional string) The name of a file giving detailed license
information for this package.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">copyright</span></code></dt>
<dd><p class="first last" id="index-25">(optional freeform) The copyright string.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">maintainer</span></code></dt>
<dd><p class="first last" id="index-26">(optional freeform) The email address of the package’s maintainer.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">stability</span></code></dt>
<dd><p class="first last" id="index-27">(optional freeform) A string describing the stability of the package
(e.g. stable, provisional or experimental).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">homepage</span></code></dt>
<dd><p class="first last" id="index-28">(optional freeform) URL of the package’s home page.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">package-url</span></code></dt>
<dd><p class="first last" id="index-29">(optional freeform) URL of a downloadable distribution for this
package. The distribution should be a Cabal package.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">description</span></code></dt>
<dd><p class="first last" id="index-30">(optional freeform) Description of the package.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">category</span></code></dt>
<dd><p class="first last" id="index-31">(optional freeform) Which category the package belongs to. This
field is for use in conjunction with a future centralised package
distribution framework, tentatively titled Hackage.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">author</span></code></dt>
<dd><p class="first last" id="index-32">(optional freeform) Author of the package.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">exposed</span></code></dt>
<dd><p class="first last" id="index-33">(bool) Whether the package is exposed or not.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">exposed-modules</span></code></dt>
<dd><p class="first last" id="index-34">(string list) modules exposed by this package.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">hidden-modules</span></code></dt>
<dd><p class="first last" id="index-35">(string list) modules provided by this package, but not exposed to
the programmer. These modules cannot be imported, but they are still
subject to the overlapping constraint: no other package in the same
program may provide a module of the same name.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">reexported-modules</span></code></dt>
<dd><p class="first last" id="index-36">Modules reexported by this package. This list takes the form of
<code class="docutils literal"><span class="pre">pkg:OldName</span> <span class="pre">as</span> <span class="pre">NewName</span> <span class="pre">(A&#64;orig-pkg-0.1-HASH)</span></code>: the first portion
of the string is the user-written reexport specification (possibly
omitting the package qualifier and the renaming), while the
parenthetical is the original package which exposed the module under
are particular name. Reexported modules have a relaxed overlap
constraint: it’s permissible for two packages to reexport the same
module as the same name if the reexported moduleis identical.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">trusted</span></code></dt>
<dd><p class="first last" id="index-37">(bool) Whether the package is trusted or not.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">import-dirs</span></code></dt>
<dd><p class="first" id="index-38">(string list) A list of directories containing interface files
(<code class="docutils literal"><span class="pre">.hi</span></code> files) for this package.</p>
<p class="last">If the package contains profiling libraries, then the interface
files for those library modules should have the suffix <code class="docutils literal"><span class="pre">.p_hi</span></code>. So
the package can contain both normal and profiling versions of the
same library without conflict (see also <code class="docutils literal"><span class="pre">library_dirs</span></code> below).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">library-dirs</span></code></dt>
<dd><p class="first last" id="index-39">(string list) A list of directories containing libraries for this
package.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">hs-libraries</span></code></dt>
<dd><p class="first" id="index-40">(string list) A list of libraries containing Haskell code for this
package, with the <code class="docutils literal"><span class="pre">.a</span></code> or <code class="docutils literal"><span class="pre">.dll</span></code> suffix omitted. When packages
are built as libraries, the <code class="docutils literal"><span class="pre">lib</span></code> prefix is also omitted.</p>
<p>For use with GHCi, each library should have an object file too. The
name of the object file does <em>not</em> have a <code class="docutils literal"><span class="pre">lib</span></code> prefix, and has
the normal object suffix for your platform.</p>
<p>For example, if we specify a Haskell library as <code class="docutils literal"><span class="pre">HSfoo</span></code> in the
package spec, then the various flavours of library that GHC actually
uses will be called:</p>
<dl class="last docutils">
<dt><code class="docutils literal"><span class="pre">libHSfoo.a</span></code></dt>
<dd>The name of the library on Unix and Windows (mingw) systems.
Note that we don’t support building dynamic libraries of Haskell
code on Unix systems.</dd>
<dt><code class="docutils literal"><span class="pre">HSfoo.dll</span></code></dt>
<dd>The name of the dynamic library on Windows systems (optional).</dd>
<dt><code class="docutils literal"><span class="pre">HSfoo.o</span></code>; <code class="docutils literal"><span class="pre">HSfoo.obj</span></code></dt>
<dd>The object version of the library used by GHCi.</dd>
</dl>
</dd>
<dt><code class="docutils literal"><span class="pre">extra-libraries</span></code></dt>
<dd><p class="first" id="index-41">(string list) A list of extra libraries for this package. The
difference between <code class="docutils literal"><span class="pre">hs-libraries</span></code> and <code class="docutils literal"><span class="pre">extra-libraries</span></code> is that
<code class="docutils literal"><span class="pre">hs-libraries</span></code> normally have several versions, to support
profiling, parallel and other build options. The various versions
are given different suffixes to distinguish them, for example the
profiling version of the standard prelude library is named
<code class="docutils literal"><span class="pre">libHSbase_p.a</span></code>, with the <code class="docutils literal"><span class="pre">_p</span></code> indicating that this is a
profiling version. The suffix is added automatically by GHC for
<code class="docutils literal"><span class="pre">hs-libraries</span></code> only, no suffix is added for libraries in
<code class="docutils literal"><span class="pre">extra-libraries</span></code>.</p>
<p>The libraries listed in <code class="docutils literal"><span class="pre">extra-libraries</span></code> may be any libraries
supported by your system’s linker, including dynamic libraries
(<code class="docutils literal"><span class="pre">.so</span></code> on Unix, <code class="docutils literal"><span class="pre">.DLL</span></code> on Windows).</p>
<p class="last">Also, <code class="docutils literal"><span class="pre">extra-libraries</span></code> are placed on the linker command line
after the <code class="docutils literal"><span class="pre">hs-libraries</span></code> for the same package. If your package has
dependencies in the other direction (i.e. <code class="docutils literal"><span class="pre">extra-libraries</span></code>
depends on <code class="docutils literal"><span class="pre">hs-libraries</span></code>), and the libraries are static, you
might need to make two separate packages.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">include-dirs</span></code></dt>
<dd><p class="first last" id="index-42">(string list) A list of directories containing C includes for this
package.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">includes</span></code></dt>
<dd><p class="first last" id="index-43">(string list) A list of files to include for via-C compilations
using this package. Typically the include file(s) will contain
function prototypes for any C functions used in the package, in case
they end up being called as a result of Haskell functions from the
package being inlined.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">depends</span></code></dt>
<dd><p class="first last" id="index-44">(package id list) Packages on which this package depends.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">hugs-options</span></code></dt>
<dd><p class="first last" id="index-45">(string list) Options to pass to Hugs for this package.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">cc-options</span></code></dt>
<dd><p class="first last" id="index-46">(string list) Extra arguments to be added to the gcc command line
when this package is being used (only for via-C compilations).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">ld-options</span></code></dt>
<dd><p class="first last" id="index-47">(string list) Extra arguments to be added to the <code class="docutils literal"><span class="pre">gcc</span></code> command
line (for linking) when this package is being used.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">framework-dirs</span></code></dt>
<dd><p class="first last" id="index-48">(string list) On Darwin/MacOS X, a list of directories containing
frameworks for this package. This corresponds to the
<code class="docutils literal"><span class="pre">-framework-path</span></code> option. It is ignored on all other platforms.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">frameworks</span></code></dt>
<dd><p class="first last" id="index-49">(string list) On Darwin/MacOS X, a list of frameworks to link to.
This corresponds to the <code class="docutils literal"><span class="pre">-framework</span></code> option. Take a look at
Apple’s developer documentation to find out what frameworks actually
are. This entry is ignored on all other platforms.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">haddock-interfaces</span></code></dt>
<dd><p class="first last" id="index-50">(string list) A list of filenames containing
<a class="reference external" href="http://www.haskell.org/haddock/">Haddock</a> interface files
(<code class="docutils literal"><span class="pre">.haddock</span></code> files) for this package.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">haddock-html</span></code></dt>
<dd><p class="first last" id="index-51">(optional string) The directory containing the Haddock-generated
HTML for this package.</p>
</dd>
</dl>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[1]</a></td><td>it used to in GHC 6.4, but not since 6.6</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="codegens.html" title="7.10. GHC Backends"
             >next</a> |</li>
        <li class="right" >
          <a href="separate_compilation.html" title="7.8. Filenames and separate compilation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">GHC 8.5.20180310 User&#39;s Guide</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="usage.html" >7. Using GHC</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, GHC Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.5.
    </div>
  </body>
</html>